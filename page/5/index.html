<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.157.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Rise的自留地"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="website"><meta property="og:title" content="Rise的自留地"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1772265585"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class="hvr-icon-pulse menu-item-active" rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>679</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>679</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>35</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>118</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2423147></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5207></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2026-02-28 15:59:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/android-framework-knowledge-points/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Framework知识点汇总"><meta itemprop=description content="点击阅读前文前, 首页能看到的文章的简短描述"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/android-framework-knowledge-points/ itemprop=url class=post-title-link>Framework知识点汇总</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年06月03日 14:50:37 CST" itemprop="dateCreated datePublished" datetime="2023-06-03 14:50:37 +0800 +0800">2023年06月03日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/android-framework-knowledge-points/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><ul><li><a href=#handler title=Handler>Handler</a><ul><li><a href=#handler%e6%9c%ba%e5%88%b6%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e4%b8%80%e5%ae%8f%e8%a7%82%e7%90%86%e8%ae%ba%e5%88%86%e6%9e%90%e4%b8%8emessage%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title=Handler机制实现原理(一)宏观理论分析与Message源码分析>Handler机制实现原理(一)宏观理论分析与Message源码分析</a><ul><li><a href=#message title=Message:>Message:</a><ul><li><a href=#%e7%9c%8b%e4%b8%80%e4%b8%8b%e5%85%a8%e5%b1%80%e5%8f%98%e9%87%8f%e6%9c%89%e5%a5%bd%e5%a4%9a%e5%ad%98%e6%95%b0%e6%8d%ae%e7%9a%84%e5%af%b9%e8%b1%a1 title=看一下全局变量：有好多存数据的对象。>看一下全局变量：有好多存数据的对象。</a></li><li><a href=#obtain%e6%96%b9%e6%b3%95 title=Obtain方法：>Obtain方法：</a></li><li><a href=#recycle%e5%9b%9e%e6%94%b6%e5%bd%93%e5%89%8dmessage%e5%88%b0%e5%85%a8%e5%b1%80%e6%b1%a0 title=recycle():回收当前message到全局池>recycle():回收当前message到全局池</a></li></ul></li><li><a href=#setdata title=setData：>setData：</a></li><li><a href=#%e5%8f%91%e9%80%81%e6%b6%88%e6%81%af%e7%9a%84%e4%b8%80%e4%ba%9b%e6%96%b9%e6%b3%95 title=发送消息的一些方法：>发送消息的一些方法：</a><ul><li><a href=#%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95 title=构造方法：>构造方法：</a></li><li><a href=#writetoparcel title=writeToParcel：>writeToParcel：</a></li></ul></li></ul></li><li><a href=#handler%e6%9c%ba%e5%88%b6%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e4%ba%8cmessagequeue%e7%9a%84%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title=Handler机制实现原理（二）MessageQueue的源码分析>Handler机制实现原理（二）MessageQueue的源码分析</a><ul><li><a href=#%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97%e5%ad%98%e5%82%a8%e5%8e%9f%e7%90%86 title=消息队列存储原理>消息队列存储原理</a></li><li><a href=#%e4%bd%bf%e7%94%a8jni%e5%ae%9e%e7%8e%b0%e7%9a%84native%e6%96%b9%e6%b3%95 title=使用JNI实现的native方法>使用JNI实现的native方法</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e4%b8%8e%e9%94%80%e6%af%81 title=创建与销毁>创建与销毁</a></li><li><a href=#%e6%b6%88%e6%81%af%e5%85%a5%e9%98%9f%e7%ae%a1%e7%90%86enqueuemessage%e6%96%b9%e6%b3%95 title=消息入队管理enqueueMessage()方法>消息入队管理enqueueMessage()方法</a></li><li><a href=#%e5%90%8c%e6%ad%a5%e6%b6%88%e6%81%af%e6%8b%a6%e6%88%aa%e5%99%a8 title=同步消息拦截器>同步消息拦截器</a></li><li><a href=#%e9%98%9f%e5%88%97%e7%a9%ba%e9%97%b2%e5%a4%84%e7%90%86%e5%99%a8idlehandler title=队列空闲处理器IdleHandler>队列空闲处理器IdleHandler</a></li><li><a href=#%e6%b6%88%e6%81%af%e5%87%ba%e9%98%9f%e7%ae%a1%e7%90%86next%e6%96%b9%e6%b3%95 title=消息出队管理next()方法>消息出队管理next()方法</a></li><li><a href=#%e6%80%bb%e7%bb%93 title=总结>总结</a></li></ul></li><li><a href=#handler%e6%9c%ba%e5%88%b6%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e4%b8%89looper%e7%9a%84%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title=Handler机制实现原理（三）Looper的源码分析>Handler机制实现原理（三）Looper的源码分析</a><ul><li><a href=#%e5%88%9b%e5%bb%ba%e4%b8%8e%e9%80%80%e5%87%balooper title=创建与退出Looper>创建与退出Looper</a></li><li><a href=#%e8%bf%90%e8%a1%8clooper%e5%a4%84%e7%90%86%e6%b6%88%e6%81%af title=运行Looper处理消息>运行Looper处理消息</a></li><li><a href=#%e6%80%bb%e7%bb%93-1 title=总结>总结</a></li></ul></li><li><a href=#handler%e6%9c%ba%e5%88%b6%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e5%9b%9bhandler%e7%9a%84%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title=Handler机制实现原理（四）handler的源码分析>Handler机制实现原理（四）handler的源码分析</a><ul><li><a href=#%e5%88%9d%e5%a7%8b%e5%8c%96 title=初始化>初始化</a></li><li><a href=#%e5%8f%91%e9%80%81%e6%b6%88%e6%81%af title=发送消息>发送消息</a></li><li><a href=#%e6%8e%a5%e6%94%b6%e6%b6%88%e6%81%af title=接收消息>接收消息</a></li><li><a href=#%e5%86%85%e5%ad%98%e6%b3%84%e6%bc%8f%e7%9a%84%e5%8f%af%e8%83%bd title=内存泄漏的可能>内存泄漏的可能</a></li></ul></li><li><a href=#handler%e6%9c%ba%e5%88%b6%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e4%ba%94%e6%80%bb%e7%bb%93 title=Handler机制实现原理（五）总结>Handler机制实现原理（五）总结</a><ul><li><a href=#message%e7%bc%93%e5%ad%98%e6%b1%a0 title=Message缓存池>Message缓存池</a></li><li><a href=#%e7%9c%9f%e6%ad%a3%e7%9a%84%e9%98%bb%e5%a1%9e%e5%8f%91%e7%94%9f%e5%9c%a8messagequeue title=真正的阻塞发生在MessageQueue>真正的阻塞发生在MessageQueue</a></li><li><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%8e%a8%e8%8d%90%e4%bd%bf%e7%94%a8handler%e5%ae%9e%e7%8e%b0%e7%ba%bf%e7%a8%8b%e9%97%b4%e9%80%9a%e4%bf%a1 title=为什么推荐使用Handler实现线程间通信>为什么推荐使用Handler实现线程间通信</a></li></ul></li></ul></li><li><a href=#binder title=Binder>Binder</a><ul><li><a href=#binder%e5%8e%9f%e7%90%86%e4%b8%80%e5%ad%a6%e4%b9%a0binder%e5%89%8d%e5%bf%85%e9%a1%bb%e8%a6%81%e4%ba%86%e8%a7%a3%e7%9a%84%e7%9f%a5%e8%af%86%e7%82%b9 title=Binder原理（一）学习Binder前必须要了解的知识点>Binder原理（一）学习Binder前必须要了解的知识点</a><ul><li><a href=#linux%e5%92%8candroid%e7%9a%84ipc%e6%9c%ba%e5%88%b6%e7%a7%8d%e7%b1%bb title=Linux和Android的IPC机制种类>Linux和Android的IPC机制种类</a><ul><li><a href=#linux%e4%b8%ad%e7%9a%84ipc%e6%9c%ba%e5%88%b6%e7%a7%8d%e7%b1%bb title=Linux中的IPC机制种类>Linux中的IPC机制种类</a></li><li><a href=#android%e4%b8%ad%e7%9a%84ipc%e6%9c%ba%e5%88%b6 title=Android中的IPC机制>Android中的IPC机制</a></li></ul></li><li><a href=#linux%e5%92%8cbinder%e7%9a%84ipc%e9%80%9a%e4%bf%a1%e5%8e%9f%e7%90%86 title=Linux和Binder的IPC通信原理>Linux和Binder的IPC通信原理</a><ul><li><a href=#linux%e7%9a%84ipc%e9%80%9a%e4%bf%a1%e5%8e%9f%e7%90%86 title=Linux的IPC通信原理>Linux的IPC通信原理</a></li><li><a href=#binder%e7%9a%84%e9%80%9a%e4%bf%a1%e5%8e%9f%e7%90%86 title=Binder的通信原理>Binder的通信原理</a></li></ul></li><li><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e4%bd%bf%e7%94%a8binder title=为什么要使用Binder>为什么要使用Binder</a></li><li><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%ad%a6%e4%b9%a0binder title=为什么要学习Binder?>为什么要学习Binder?</a></li></ul></li><li><a href=#binder%e5%8e%9f%e7%90%86%e4%ba%8cservicemanager%e4%b8%ad%e7%9a%84binder%e6%9c%ba%e5%88%b6 title=Binder原理（二）ServiceManager中的Binder机制>Binder原理（二）ServiceManager中的Binder机制</a><ul><li><a href=#%e5%9f%ba%e4%ba%8ebinder%e9%80%9a%e4%bf%a1%e7%9a%84cs%e6%9e%b6%e6%9e%84 title=基于Binder通信的C/S架构>基于Binder通信的C/S架构</a></li><li><a href=#mediaserver%e7%9a%84main%e5%87%bd%e6%95%b0 title=MediaServer的main函数>MediaServer的main函数</a></li><li><a href=#%e6%af%8f%e4%b8%aa%e8%bf%9b%e7%a8%8b%e5%94%af%e4%b8%80%e7%9a%84processstate title=每个进程唯一的ProcessState>每个进程唯一的ProcessState</a></li><li><a href=#servicemanager%e4%b8%ad%e7%9a%84binder%e6%9c%ba%e5%88%b6 title=ServiceManager中的Binder机制>ServiceManager中的Binder机制</a><ul><li><a href=#bpbinder%e5%92%8cbbinder title=BpBinder和BBinder>BpBinder和BBinder</a></li><li><a href=#%e8%a7%a3%e5%af%86iservicemanager title=解密IServiceManager>解密IServiceManager</a></li><li><a href=#iservicemanager%e5%ae%b6%e6%97%8f title=IServiceManager家族>IServiceManager家族</a></li></ul></li><li><a href=#%e5%b0%8f%e7%bb%93 title=小结>小结</a></li></ul></li><li><a href=#binder%e5%8e%9f%e7%90%86%e4%b8%89%e7%b3%bb%e7%bb%9f%e6%9c%8d%e5%8a%a1%e7%9a%84%e6%b3%a8%e5%86%8c%e8%bf%87%e7%a8%8b title=Binder原理（三）系统服务的注册过程>Binder原理（三）系统服务的注册过程</a><ul><li><a href=#%e4%bb%8e%e8%b0%83%e7%94%a8%e9%93%be%e8%a7%92%e5%ba%a6%e8%af%b4%e6%98%8emediaplayerservice%e6%98%af%e5%a6%82%e4%bd%95%e6%b3%a8%e5%86%8c%e7%9a%84 title=从调用链角度说明MediaPlayerService是如何注册的>从调用链角度说明MediaPlayerService是如何注册的</a><ul><li><a href=#writetransactiondata%e5%87%bd%e6%95%b0%e5%88%86%e6%9e%90 title=writeTransactionData函数分析>writeTransactionData函数分析</a></li><li><a href=#waitforresponse%e5%87%bd%e6%95%b0%e5%88%86%e6%9e%90 title=waitForResponse函数分析>waitForResponse函数分析</a></li><li><a href=#%e5%b0%8f%e7%bb%93-1 title=小结>小结</a></li></ul></li><li><a href=#%e4%bb%8e%e8%bf%9b%e7%a8%8b%e8%a7%92%e5%ba%a6%e8%af%b4%e6%98%8emediaplayerservice%e6%98%af%e5%a6%82%e4%bd%95%e6%b3%a8%e5%86%8c%e7%9a%84 title=从进程角度说明MediaPlayerService是如何注册的>从进程角度说明MediaPlayerService是如何注册的</a></li><li><a href=#%e6%80%bb%e7%bb%93-2 title=总结>总结</a></li></ul></li><li><a href=#binder%e5%8e%9f%e7%90%86%e5%9b%9bservicemanager%e7%9a%84%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b title=Binder原理（四）ServiceManager的启动过程>Binder原理（四）ServiceManager的启动过程</a><ul><li><a href=#servicemanager%e7%9a%84%e5%85%a5%e5%8f%a3%e5%87%bd%e6%95%b0 title=ServiceManager的入口函数>ServiceManager的入口函数</a><ul><li><a href=#%e6%89%93%e5%bc%80binder%e8%ae%be%e5%a4%87 title=打开binder设备>打开binder设备</a></li><li><a href=#%e6%b3%a8%e5%86%8c%e6%88%90%e4%b8%babinder%e6%9c%ba%e5%88%b6%e7%9a%84%e4%b8%8a%e4%b8%8b%e6%96%87%e7%ae%a1%e7%90%86%e8%80%85 title=注册成为Binder机制的上下文管理者>注册成为Binder机制的上下文管理者</a></li><li><a href=#%e5%be%aa%e7%8e%af%e7%ad%89%e5%be%85%e5%92%8c%e5%a4%84%e7%90%86client%e7%ab%af%e5%8f%91%e6%9d%a5%e7%9a%84%e8%af%b7%e6%b1%82 title=循环等待和处理client端发来的请求>循环等待和处理client端发来的请求</a></li></ul></li><li><a href=#%e6%80%bb%e7%bb%93-3 title=总结>总结</a></li></ul></li><li><a href=#binder%e5%8e%9f%e7%90%86%e4%ba%94%e7%b3%bb%e7%bb%9f%e6%9c%8d%e5%8a%a1%e7%9a%84%e8%8e%b7%e5%8f%96%e8%bf%87%e7%a8%8b title=Binder原理（五）系统服务的获取过程>Binder原理（五）系统服务的获取过程</a><ul><li><a href=#%e5%ae%a2%e6%88%b7%e7%ab%afmediaplayerservice%e8%af%b7%e6%b1%82%e8%8e%b7%e5%8f%96%e6%9c%8d%e5%8a%a1 title=客户端MediaPlayerService请求获取服务>客户端MediaPlayerService请求获取服务</a></li><li><a href=#%e6%9c%8d%e5%8a%a1%e7%ab%afservicemanager%e5%a4%84%e7%90%86%e8%af%b7%e6%b1%82 title=服务端ServiceManager处理请求>服务端ServiceManager处理请求</a></li><li><a href=#%e6%80%bb%e7%bb%93-4 title=总结>总结</a></li></ul></li><li><a href=#binder%e5%8e%9f%e7%90%86%e5%85%adjava-binder%e7%9a%84%e5%88%9d%e5%a7%8b%e5%8c%96 title="Binder原理（六）Java Binder的初始化">Binder原理（六）Java Binder的初始化</a><ul><li><a href=#java-binder%e7%9a%84jni%e6%b3%a8%e5%86%8c title="Java Binder的JNI注册">Java Binder的JNI注册</a><ul><li><a href=#binder%e7%b1%bb%e7%9a%84%e6%b3%a8%e5%86%8c title=Binder类的注册>Binder类的注册</a></li><li><a href=#binderinternal%e7%b1%bb%e7%9a%84%e6%b3%a8%e5%86%8c title=BinderInternal类的注册>BinderInternal类的注册</a></li></ul></li></ul></li><li><a href=#binder%e5%8e%9f%e7%90%86%e4%b8%83java-binder%e4%b8%ad%e7%b3%bb%e7%bb%9f%e6%9c%8d%e5%8a%a1%e7%9a%84%e6%b3%a8%e5%86%8c%e8%bf%87%e7%a8%8b title="Binder原理（七）Java Binder中系统服务的注册过程">Binder原理（七）Java Binder中系统服务的注册过程</a><ul><li><a href=#%e5%b0%86ams%e6%b3%a8%e5%86%8c%e5%88%b0servicemanager title=将AMS注册到ServiceManager>将AMS注册到ServiceManager</a><ul><li><a href=#binderinternalgetcontextobject title=BinderInternal.getContextObject()>BinderInternal.getContextObject()</a></li><li><a href=#servicemanagernativeasinterface title=ServiceManagerNative.asInterface()>ServiceManagerNative.asInterface()</a></li><li><a href=#getiservicemanageraddservice title=getIServiceManager().addService()>getIServiceManager().addService()</a></li></ul></li><li><a href=#%e5%bc%95%e5%87%bajavabbinder title=引出JavaBBinder>引出JavaBBinder</a></li><li><a href=#%e8%a7%a3%e6%9e%90javabbinder title=解析JavaBBinder>解析JavaBBinder</a></li><li><a href=#java-binder%e6%9e%b6%e6%9e%84 title="Java Binder架构">Java Binder架构</a></li></ul></li></ul></li><li><a href=#zygote title=Zygote>Zygote</a><ul><li><a href=#zygote%e4%b8%80android%e7%b3%bb%e7%bb%9f%e7%9a%84%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b%e5%8f%8azygote%e7%9a%84%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b title=Zygote(一)：Android系统的启动过程及Zygote的启动过程>Zygote(一)：Android系统的启动过程及Zygote的启动过程</a><ul><li><a href=#init%e8%bf%9b%e7%a8%8b title=init进程>init进程</a><ul><li><a href=#%e5%b1%9e%e6%80%a7%e6%9c%8d%e5%8a%a1%e5%88%9d%e5%a7%8b%e5%8c%96%e4%b8%8e%e5%90%af%e5%8a%a8 title=属性服务初始化与启动>属性服务初始化与启动</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e8%bf%9b%e7%a8%8b%e4%bf%a1%e5%8f%b7%e5%a4%84%e7%90%86 title=设置进程信号处理>设置进程信号处理</a></li><li><a href=#%e8%a7%a3%e6%9e%90init%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 title=解析init配置文件>解析init配置文件</a></li></ul></li><li><a href=#zygote%e8%bf%9b%e7%a8%8b%e5%90%af%e5%8a%a8 title=Zygote进程启动>Zygote进程启动</a><ul><li><a href=#systemserver%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b title=SystemServer启动过程>SystemServer启动过程</a></li></ul></li></ul></li><li><a href=#zygote%e4%ba%8c%e5%ba%94%e7%94%a8%e8%bf%9b%e7%a8%8b%e7%9a%84%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b title=Zygote（二）：应用进程的启动过程>Zygote（二）：应用进程的启动过程</a><ul><li><a href=#zygote%e7%9b%91%e5%90%ac%e5%ae%a2%e6%88%b7%e7%ab%af%e8%af%b7%e6%b1%82 title=Zygote监听客户端请求>Zygote监听客户端请求</a></li><li><a href=#ams%e5%8f%91%e9%80%81%e5%88%9b%e5%bb%ba%e8%bf%9b%e7%a8%8b%e8%af%b7%e6%b1%82 title=AMS发送创建进程请求>AMS发送创建进程请求</a></li><li><a href=#zygote%e6%8e%a5%e6%94%b6%e4%bf%a1%e6%81%af%e5%b9%b6%e5%88%9b%e5%bb%ba%e8%bf%9b%e7%a8%8b title=Zygote接收信息并创建进程>Zygote接收信息并创建进程</a></li><li><a href=#%e5%90%af%e5%8a%a8binder%e7%ba%bf%e7%a8%8b%e6%b1%a0 title=启动Binder线程池>启动Binder线程池</a></li></ul></li></ul></li><li><a href=#ams title=AMS>AMS</a><ul><li><a href=#ams%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b8%80activity%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%ae%a1%e7%90%86 title=AMS源码分析(一)Activity生命周期管理>AMS源码分析(一)Activity生命周期管理</a><ul><li><a href=#activity%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f title=Activity的生命周期>Activity的生命周期</a><ul><li><a href=#%e4%b8%80%e4%b8%aaactivity%e4%bb%8e%e5%90%af%e5%8a%a8%e5%88%b0%e9%94%80%e6%af%81%e6%89%80%e7%bb%8f%e5%8e%86%e7%9a%84%e5%91%a8%e6%9c%9f title=一个Activity从启动到销毁所经历的周期>一个Activity从启动到销毁所经历的周期</a></li><li><a href=#%e4%bb%8e%e4%b8%80%e4%b8%aaactivity%e5%90%af%e5%8a%a8%e5%8f%a6%e4%b8%80%e4%b8%aaactivity%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f title=从一个Activity启动另一个Activity的生命周期>从一个Activity启动另一个Activity的生命周期</a></li></ul></li><li><a href=#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title=源码分析>源码分析</a><ul><li><a href=#binder-1 title=Binder>Binder</a></li><li><a href=#idlehandler title=IdleHandler>IdleHandler</a></li><li><a href=#activity%e5%9c%a8ams%e4%b8%ad%e7%9a%84%e6%a0%87%e8%af%86 title=Activity在AMS中的标识>Activity在AMS中的标识</a></li><li><a href=#%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b%e6%97%b6%e5%ba%8f%e5%9b%be title=启动过程时序图>启动过程时序图</a></li><li><a href=#%e4%bb%8eaactivity%e8%b7%b3%e8%bd%acbactivity%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%88%86%e6%9e%90 title=从AActivity跳转BActivity的生命周期分析>从AActivity跳转BActivity的生命周期分析</a><ul><li><a href=#aactivityonpause title=AActivity#onPause>AActivity#onPause</a></li><li><a href=#bactivityoncreate title=BActivity#onCreate>BActivity#onCreate</a></li><li><a href=#bactivityonstart title=BActivity#onStart>BActivity#onStart</a></li><li><a href=#bactivityonresume title=BActivity#onResume>BActivity#onResume</a></li><li><a href=#aactivityonstop title=AActivity#onStop>AActivity#onStop</a></li></ul></li><li><a href=#%e4%bb%8ebactivity%e8%bf%94%e5%9b%9e%e5%88%b0aactivity title=从BActivity返回到AActivity>从BActivity返回到AActivity</a><ul><li><a href=#bactivityonpause title=BActivity#onPause>BActivity#onPause</a></li><li><a href=#aactivityonstartaactivityonresume title=AActivity#onStart、AActivity#onResume>AActivity#onStart、AActivity#onResume</a></li><li><a href=#bactivityonstopbactivityondestroy title=BActivity#onStop、BActivity#onDestroy>BActivity#onStop、BActivity#onDestroy</a></li></ul></li></ul></li></ul></li><li><a href=#ams%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%ba%8conactivityresult%e6%89%a7%e8%a1%8c%e8%bf%87%e7%a8%8b title=AMS源码分析(二)onActivityResult执行过程>AMS源码分析(二)onActivityResult执行过程</a><ul><li><a href=#onactivityresult title=onActivityResult>onActivityResult</a><ul><li><a href=#aactivity%e8%b7%b3%e8%bd%acbacitivty%e5%b9%b6%e4%bb%8ebactivity%e8%bf%94%e5%9b%9e%e6%95%b0%e6%8d%ae title=AActivity跳转BAcitivty并从BActivity返回数据>AActivity跳转BAcitivty并从BActivity返回数据</a></li></ul></li><li><a href=#intentflag_activity_forward_result title=Intent.FLAG_ACTIVITY_FORWARD_RESULT>Intent.FLAG_ACTIVITY_FORWARD_RESULT</a><ul><li><a href=#%e7%a4%ba%e4%be%8b title=示例：>示例：</a><ul><li><a href=#aactivity%e4%bb%a5startactivityforresult%e6%96%b9%e5%bc%8f%e6%89%93%e5%bc%80bactivity title=AActivity以startActivityForResult方式打开BActivity>AActivity以startActivityForResult方式打开BActivity</a></li><li><a href=#bactivity%e4%bb%a5%e6%99%ae%e9%80%9a%e6%96%b9%e5%bc%8f%e6%89%93%e5%bc%80cactivity%e8%ae%be%e7%bd%aeintent-%e7%9a%84flag-intentflag_activity_forward_result title="BActivity以普通方式打开CActivity，设置Intent 的Flag Intent.FLAG_ACTIVITY_FORWARD_RESULT">BActivity以普通方式打开CActivity，设置Intent 的Flag Intent.FLAG_ACTIVITY_FORWARD_RESULT</a></li></ul></li></ul></li><li><a href=#%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90 title=源码解析>源码解析</a><ul><li><a href=#activityresult%e6%95%b0%e6%8d%ae%e7%9a%84%e5%86%99%e5%85%a5 title=ActivityResult数据的写入>ActivityResult数据的写入</a></li><li><a href=#activityresult%e6%95%b0%e6%8d%ae%e7%9a%84%e4%bc%a0%e9%80%92 title=ActivityResult数据的传递>ActivityResult数据的传递</a></li><li><a href=#intentflag_activity_forward_result%e7%9a%84%e5%ae%9e%e7%8e%b0 title=Intent.FLAG_ACTIVITY_FORWARD_RESULT的实现>Intent.FLAG_ACTIVITY_FORWARD_RESULT的实现</a></li></ul></li></ul></li><li><a href=#ams%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b8%89ams%e4%b8%adactivity%e6%a0%88%e7%ae%a1%e7%90%86%e8%af%a6%e8%a7%a3 title=AMS源码分析(三)AMS中Activity栈管理详解>AMS源码分析(三)AMS中Activity栈管理详解</a><ul><li><a href=#activity%e6%a0%88%e7%ae%a1%e7%90%86%e7%9b%b8%e5%85%b3%e7%b1%bb title=Activity栈管理相关类>Activity栈管理相关类</a><ul><li><a href=#activitystacksupervisor title=ActivityStackSupervisor>ActivityStackSupervisor</a></li><li><a href=#activitydisplay title=ActivityDisplay>ActivityDisplay</a></li><li><a href=#taskrecord title=TaskRecord>TaskRecord</a></li><li><a href=#activitystack title=ActivityStack>ActivityStack</a></li><li><a href=#%e5%85%b3%e7%b3%bb%e5%9b%be title=关系图：>关系图：</a></li></ul></li><li><a href=#%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f title=启动模式>启动模式</a><ul><li><a href=#standard title=standard>standard</a><ul><li><a href=#intentflag_activity_clear_top title=Intent.FLAG_ACTIVITY_CLEAR_TOP>Intent.FLAG_ACTIVITY_CLEAR_TOP</a></li><li><a href=#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90-1 title=源码分析>源码分析</a><ul><li><a href=#%e5%8a%a0%e5%85%a5taskrecord title=加入TaskRecord>加入TaskRecord</a></li><li><a href=#standard--intentflag_activity_clear_top title="standard + Intent.FLAG_ACTIVITY_CLEAR_TOP">standard + Intent.FLAG_ACTIVITY_CLEAR_TOP</a></li></ul></li></ul></li><li><a href=#singletop title=singleTop>singleTop</a><ul><li><a href=#%e6%b5%81%e7%a8%8b%e5%9b%be title=流程图：>流程图：</a><ul><li><a href=#%e5%8e%9factivity%e4%b8%8d%e5%9c%a8%e6%a0%88%e9%a1%b6 title=原Activity不在栈顶>原Activity不在栈顶</a></li><li><a href=#%e5%8e%9factivity%e5%9c%a8%e6%a0%88%e9%a1%b6 title=原Activity在栈顶>原Activity在栈顶</a></li></ul></li><li><a href=#singletop--intentflag_activity_clear_top title="singleTop + Intent.FLAG_ACTIVITY_CLEAR_TOP">singleTop + Intent.FLAG_ACTIVITY_CLEAR_TOP</a></li><li><a href=#log title=log>log</a><ul><li><a href=#%e5%8e%9factivity%e4%b8%8d%e5%9c%a8%e6%a0%88%e9%a1%b6-1 title=原Activity不在栈顶>原Activity不在栈顶</a></li><li><a href=#%e5%8e%9factivity%e5%9c%a8%e6%a0%88%e9%a1%b6-1 title=原Activity在栈顶>原Activity在栈顶</a></li><li><a href=#%e5%8e%9factiivty%e5%9c%a8%e6%a0%88%e9%a1%b6%e4%b8%94%e8%ae%be%e7%bd%aeintentflag_activity_clear_top title=原Actiivty在栈顶且设置Intent.FLAG_ACTIVITY_CLEAR_TOP>原Actiivty在栈顶且设置Intent.FLAG_ACTIVITY_CLEAR_TOP</a></li></ul></li><li><a href=#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90-2 title=源码分析>源码分析</a><ul><li><a href=#singletop--intentflag_activity_clear_top-1 title="singleTop + Intent.FLAG_ACTIVITY_CLEAR_TOP">singleTop + Intent.FLAG_ACTIVITY_CLEAR_TOP</a></li></ul></li></ul></li><li><a href=#singletask title=singleTask>singleTask</a><ul><li><a href=#%e5%90%af%e5%8a%a8%e6%b5%81%e7%a8%8b title=启动流程>启动流程</a><ul><li><a href=#%e5%9c%ba%e6%99%af%e4%b8%80 title=场景一>场景一</a></li><li><a href=#%e5%9c%ba%e6%99%af%e4%ba%8c title=场景二>场景二</a></li><li><a href=#%e5%9c%ba%e6%99%af%e4%b8%89 title=场景三>场景三</a></li></ul></li><li><a href=#singetask%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title=singeTask源码分析>singeTask源码分析</a></li></ul></li><li><a href=#singleinstance title=singleInstance>singleInstance</a></li></ul></li><li><a href=#intentflag_activity_new_tasktaskaffinity%e6%96%b0task%e7%9a%84%e5%88%9b%e5%bb%ba title=Intent.FLAG_ACTIVITY_NEW_TASK、taskAffinity、新Task的创建>Intent.FLAG_ACTIVITY_NEW_TASK、taskAffinity、新Task的创建</a><ul><li><a href=#intentflag_activity_new_task%e7%9a%84%e8%87%aa%e5%8a%a8%e8%ae%be%e7%bd%ae title=Intent.FLAG_ACTIVITY_NEW_TASK的自动设置>Intent.FLAG_ACTIVITY_NEW_TASK的自动设置</a></li><li><a href=#taskaffinity%e7%9a%84%e8%af%86%e5%88%ab title=taskAffinity的识别>taskAffinity的识别</a></li><li><a href=#%e6%98%af%e5%90%a6%e5%88%9b%e5%bb%ba%e6%96%b0task%e7%9a%84%e8%af%86%e5%88%ab title=是否创建新task的识别>是否创建新task的识别</a></li><li><a href=#%e6%80%bb%e7%bb%93-5 title=总结>总结</a></li></ul></li></ul></li></ul></li><li><a href=#pms title=PMS>PMS</a><ul><li><a href=#%e6%b7%b1%e5%85%a5pms%e6%ba%90%e7%a0%81%e4%b8%80-pms%e7%9a%84%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b%e5%92%8c%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b title="深入PMS源码（一）—— PMS的启动过程和执行流程">深入PMS源码（一）—— PMS的启动过程和执行流程</a><ul><li><a href=#pms%e7%ae%80%e4%bb%8b title=PMS简介>PMS简介</a></li><li><a href=#pms%e7%9a%84%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b title=PMS的启动过程>PMS的启动过程</a></li><li><a href=#pms%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0 title=PMS构造函数>PMS构造函数</a><ul><li><a href=#pms%e7%9a%84%e5%b7%a5%e4%bd%9c%e8%bf%87%e7%a8%8b title=PMS的工作过程>PMS的工作过程</a></li><li><a href=#%e8%a7%a3%e6%9e%90%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6packagexml title=解析配置文件package.xml>解析配置文件package.xml</a></li><li><a href=#%e6%89%ab%e6%8f%8f%e5%ae%89%e8%a3%85%e7%9a%84%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f title=扫描安装的应用程序>扫描安装的应用程序</a></li><li><a href=#%e5%b0%86apk%e8%a7%a3%e6%9e%90%e6%95%b0%e6%8d%ae%e5%90%8c%e6%ad%a5%e5%88%b0pms%e7%9a%84%e5%b1%9e%e6%80%a7%e4%b8%ad title=将apk解析数据同步到PMS的属性中>将apk解析数据同步到PMS的属性中</a></li><li><a href=#%e6%9b%b4%e6%96%b0%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 title=更新配置文件>更新配置文件</a></li></ul></li></ul></li><li><a href=#%e6%b7%b1%e5%85%a5pms%e6%ba%90%e7%a0%81%e4%ba%8c-apk%e7%9a%84%e5%ae%89%e8%a3%85%e5%92%8c%e5%8d%b8%e8%bd%bd%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title="深入PMS源码（二）—— APK的安装和卸载源码分析">深入PMS源码（二）—— APK的安装和卸载源码分析</a><ul><li><a href=#%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e5%ae%89%e8%a3%85%e5%9f%ba%e7%a1%80 title=应用程序安装基础>应用程序安装基础</a></li><li><a href=#pms%e4%b8%adapk%e5%ae%89%e8%a3%85%e8%bf%87%e7%a8%8b title=PMS中APK安装过程>PMS中APK安装过程</a></li><li><a href=#%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%8d%b8%e8%bd%bd%e8%bf%87%e7%a8%8b title=应用程序的卸载过程>应用程序的卸载过程</a></li></ul></li><li><a href=#%e6%b7%b1%e5%85%a5pms%e6%ba%90%e7%a0%81%e4%b8%89-pms%e4%b8%adintent-filter%e7%9a%84%e5%8c%b9%e9%85%8d%e6%9e%b6%e6%9e%84 title="深入PMS源码（三）—— PMS中intent-filter的匹配架构">深入PMS源码（三）—— PMS中intent-filter的匹配架构</a><ul><li><a href=#pms%e4%bf%9d%e5%ad%98intentfilter title=PMS保存IntentFilter>PMS保存IntentFilter</a></li><li><a href=#intentfilter%e7%9a%84%e6%9f%a5%e6%89%be%e5%8c%b9%e9%85%8d title=IntentFilter的查找匹配>IntentFilter的查找匹配</a></li></ul></li></ul></li><li><a href=#wms title=WMS>WMS</a><ul><li><a href=#wms%e4%b8%80wms%e7%9a%84%e8%af%9e%e7%94%9f title=WMS（一）：WMS的诞生>WMS（一）：WMS的诞生</a><ul><li><a href=#wms%e6%a6%82%e8%bf%b0 title=WMS概述>WMS概述</a><ul><li><a href=#%e7%aa%97%e5%8f%a3%e7%ae%a1%e7%90%86 title=窗口管理>窗口管理</a></li><li><a href=#%e7%aa%97%e5%8f%a3%e5%8a%a8%e7%94%bb title=窗口动画>窗口动画</a></li><li><a href=#%e8%be%93%e5%85%a5%e7%b3%bb%e7%bb%9f%e7%9a%84%e4%b8%ad%e8%bd%ac%e7%ab%99 title=输入系统的中转站>输入系统的中转站</a></li><li><a href=#surface%e7%ae%a1%e7%90%86 title=Surface管理>Surface管理</a></li></ul></li><li><a href=#wms%e7%9a%84%e8%af%9e%e7%94%9f title=WMS的诞生>WMS的诞生</a></li></ul></li><li><a href=#wms%e4%ba%8cwms%e7%9a%84%e9%87%8d%e8%a6%81%e6%88%90%e5%91%98%e5%92%8cwindow%e7%9a%84%e6%b7%bb%e5%8a%a0%e8%bf%87%e7%a8%8b title=WMS（二）：WMS的重要成员和Window的添加过程>WMS（二）：WMS的重要成员和Window的添加过程</a><ul><li><a href=#wms%e7%9a%84%e9%87%8d%e8%a6%81%e6%88%90%e5%91%98 title=WMS的重要成员>WMS的重要成员</a></li><li><a href=#window%e7%9a%84%e6%b7%bb%e5%8a%a0%e8%bf%87%e7%a8%8bwms%e9%83%a8%e5%88%86 title=Window的添加过程（WMS部分）>Window的添加过程（WMS部分）</a><ul><li><a href=#addwindow%e6%96%b9%e6%b3%95part1 title=addWindow方法part1>addWindow方法part1</a></li><li><a href=#addwindow%e6%96%b9%e6%b3%95part2 title=addWindow方法part2>addWindow方法part2</a></li><li><a href=#addwindow%e6%96%b9%e6%b3%95part3 title=addWindow方法part3>addWindow方法part3</a></li><li><a href=#addwindow%e6%96%b9%e6%b3%95%e6%80%bb%e7%bb%93 title=addWindow方法总结>addWindow方法总结</a></li></ul></li><li><a href=#%e7%bb%93%e8%af%ad title=结语>结语</a></li></ul></li><li><a href=#wms%e4%b8%89window%e7%9a%84%e5%88%a0%e9%99%a4%e8%bf%87%e7%a8%8b title=WMS（三）：Window的删除过程>WMS（三）：Window的删除过程</a><ul><li><a href=#window%e7%9a%84%e5%88%a0%e9%99%a4%e8%bf%87%e7%a8%8b title=Window的删除过程>Window的删除过程</a></li></ul></li></ul></li></ul><h1 id=handler>Handler
<a class=header-anchor href=#handler></a></h1><h2 id=handler机制实现原理一宏观理论分析与message源码分析>Handler机制实现原理(一)宏观理论分析与Message源码分析
<a class=header-anchor href=#handler%e6%9c%ba%e5%88%b6%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86%e4%b8%80%e5%ae%8f%e8%a7%82%e7%90%86%e8%ae%ba%e5%88%86%e6%9e%90%e4%b8%8emessage%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90></a></h2><h3 id=message>Message:
<a class=header-anchor href=#message></a></h3><p>定义：</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/android-framework-knowledge-points/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/android-open-source-library-source-analysis/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Android开源库源码分析"><meta itemprop=description content="点击阅读前文前, 首页能看到的文章的简短描述"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/android-open-source-library-source-analysis/ itemprop=url class=post-title-link>Android开源库源码分析</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年06月03日 14:49:36 CST" itemprop="dateCreated datePublished" datetime="2023-06-03 14:49:36 +0800 +0800">2023年06月03日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/android-open-source-library-source-analysis/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><ul><li><a href=#OKHttp title=OKHttp>OKHttp</a><ul><li><a href=#OKHttp%e8%af%b7%e6%b1%82%e6%b5%81%e7%a8%8b title=OKHttp请求流程>OKHttp请求流程</a><ul><li><a href=#%e6%96%b0%e5%bb%baOKHttpClient%e5%ae%a2%e6%88%b7%e7%ab%af title=新建OKHttpClient客户端>新建OKHttpClient客户端</a></li><li><a href=#%e5%90%8c%e6%ad%a5%e8%af%b7%e6%b1%82%e6%b5%81%e7%a8%8b title=同步请求流程>同步请求流程</a></li><li><a href=#%e5%bc%82%e6%ad%a5%e8%af%b7%e6%b1%82%e6%b5%81%e7%a8%8b title=异步请求流程>异步请求流程</a></li></ul></li><li><a href=#%e7%bd%91%e7%bb%9c%e8%af%b7%e6%b1%82%e7%bc%93%e5%ad%98%e5%a4%84%e7%90%86%e4%b9%8bCacheInterceptor title=网络请求缓存处理>网络请求缓存处理</a></li><li><a href=#ConnectInterceptor%e4%b9%8b%e8%bf%9e%e6%8e%a5%e6%b1%a0 title=连接池>连接池</a></li></ul></li><li><a href=#Retrofit title=Retrofit>Retrofit</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8%e6%b5%81%e7%a8%8b title=基本使用流程>基本使用流程</a></li><li><a href=#Retrofit%e6%9e%84%e5%bb%ba%e8%bf%87%e7%a8%8b title=Retrofit构建过程>Retrofit构建过程</a><ul><li><a href=#Retrofit%e6%a0%b8%e5%bf%83%e5%af%b9%e8%b1%a1%e8%a7%a3%e6%9e%90 title=Retrofit核心对象解析>Retrofit核心对象解析</a></li><li><a href=#Builder%e5%86%85%e9%83%a8%e6%9e%84%e9%80%a0 title=Builder内部构造>Builder内部构造</a></li><li><a href=#%e6%b7%bb%e5%8a%a0baseUrl title=添加baseUrl>添加baseUrl</a></li><li><a href=#%e6%b7%bb%e5%8a%a0GsonConverterFactory title=添加GsonConverterFactory>添加GsonConverterFactory</a></li><li><a href=#build%e8%bf%87%e7%a8%8b title=build过程>build过程</a></li></ul></li><li><a href=#%e5%88%9b%e5%bb%ba%e7%bd%91%e7%bb%9c%e8%af%b7%e6%b1%82%e6%8e%a5%e5%8f%a3%e5%ae%9e%e4%be%8b%e8%bf%87%e7%a8%8b title=创建网络请求接口实例过程>创建网络请求接口实例过程</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e7%bd%91%e7%bb%9c%e8%af%b7%e6%b1%82%e6%8e%a5%e5%8f%a3%e7%b1%bb%e5%ae%9e%e4%be%8b%e5%b9%b6%e6%89%a7%e8%a1%8c%e8%af%b7%e6%b1%82%e8%bf%87%e7%a8%8b title=创建网络请求接口类实例并执行请求过程>创建网络请求接口类实例并执行请求过程</a></li><li><a href=#Retrofit%e6%ba%90%e7%a0%81%e6%b5%81%e7%a8%8b%e5%9b%be title=Retrofit源码流程图>Retrofit源码流程图</a></li></ul></li><li><a href=#Glide title=Glide>Glide</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8%e6%b5%81%e7%a8%8b-1 title=基本使用流程>基本使用流程</a></li><li><a href=#GlideAppwithcontext%e6%ba%90%e7%a0%81%e8%af%a6%e8%a7%a3 title=GlideApp.with(context)源码详解>GlideApp.with(context)源码详解</a></li><li><a href=#loadurl%e6%ba%90%e7%a0%81%e8%af%a6%e8%a7%a3 title=load(url)源码详解>load(url)源码详解</a></li><li><a href=#intoiv%e6%ba%90%e7%a0%81%e8%af%a6%e8%a7%a3 title=into(iv)源码详解>into(iv)源码详解</a></li><li><a href=#%e5%ae%8c%e6%95%b4Glide%e5%8a%a0%e8%bd%bd%e6%b5%81%e7%a8%8b%e5%9b%be title=完整Glide加载流程图>完整Glide加载流程图</a></li></ul></li><li><a href=#GreenDao title=GreenDao>GreenDao</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8%e6%b5%81%e7%a8%8b-2 title=基本使用流程>基本使用流程</a></li><li><a href=#GreenDao%e4%bd%bf%e7%94%a8%e6%b5%81%e7%a8%8b%e5%88%86%e6%9e%90 title=GreenDao使用流程分析>GreenDao使用流程分析</a><ul><li><a href=#%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93%e5%b8%ae%e5%8a%a9%e7%b1%bb%e5%af%b9%e8%b1%a1DaoMasterDevOpenHelper title=创建数据库帮助类对象DaoMaster.DevOpenHelper>创建数据库帮助类对象DaoMaster.DevOpenHelper</a></li><li><a href=#%e5%88%9b%e5%bb%baDaoMaster%e5%af%b9%e8%b1%a1 title=创建DaoMaster对象>创建DaoMaster对象</a></li><li><a href=#%e5%88%9b%e5%bb%baDaoSession%e5%af%b9%e8%b1%a1 title=创建DaoSession对象>创建DaoSession对象</a></li><li><a href=#%e6%8f%92%e5%85%a5%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title=插入源码分析>插入源码分析</a></li><li><a href=#%e6%9f%a5%e8%af%a2%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title=查询源码分析>查询源码分析</a></li></ul></li><li><a href=#GreenDao%e6%98%af%e5%a6%82%e4%bd%95%e4%b8%8eReactiveX%e7%bb%93%e5%90%88 title=GreenDao是如何与ReactiveX结合？>GreenDao是如何与ReactiveX结合？</a></li></ul></li><li><a href=#RxJava title=RxJava>RxJava</a><ul><li><a href=#RxJava%e5%88%b0%e5%ba%95%e6%98%af%e4%bb%80%e4%b9%88 title=RxJava是什么？>RxJava是什么？</a></li><li><a href=#RxJava%e7%9a%84%e8%ae%a2%e9%98%85%e6%b5%81%e7%a8%8b title=RxJava的订阅流程>RxJava的订阅流程</a><ul><li><a href=#%e5%88%9b%e5%bb%ba%e8%a2%ab%e8%a7%82%e5%af%9f%e8%80%85%e8%bf%87%e7%a8%8b title=创建被观察者过程>创建被观察者过程</a></li><li><a href=#%e8%ae%a2%e9%98%85%e8%bf%87%e7%a8%8b title=订阅过程>订阅过程</a></li></ul></li><li><a href=#RxJava%e7%9a%84%e7%ba%bf%e7%a8%8b%e5%88%87%e6%8d%a2 title=RxJava的线程切换>RxJava的线程切换</a></li></ul></li><li><a href=#LeakCanary title=LeakCanary>LeakCanary</a><ul><li><a href=#%e5%8e%9f%e7%90%86%e6%a6%82%e8%bf%b0 title=原理概述>原理概述</a></li><li><a href=#%e7%ae%80%e5%8d%95%e7%a4%ba%e4%be%8b title=简单示例>简单示例</a></li><li><a href=#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90 title=源码分析>源码分析</a></li><li><a href=#LeakCanary%e8%bf%90%e4%bd%9c%e6%b5%81%e7%a8%8b title=LeakCanary运作流程>LeakCanary运作流程</a></li></ul></li><li><a href=#ButterKnife title=ButterKnife>ButterKnife</a><ul><li><a href=#%e7%ae%80%e5%8d%95%e7%a4%ba%e4%be%8b-1 title=简单示例>简单示例</a></li><li><a href=#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90-1 title=源码分析>源码分析</a><ul><li><a href=#%e6%a8%a1%e6%9d%bf%e4%bb%a3%e7%a0%81%e8%a7%a3%e6%9e%90 title=模板代码解析>模板代码解析</a></li><li><a href=#ButterKnife-%e6%98%af%e6%80%8e%e6%a0%b7%e5%ae%9e%e7%8e%b0%e4%bb%a3%e7%a0%81%e6%b3%a8%e5%85%a5%e7%9a%84 title="ButterKnife 是怎样实现代码注入的">ButterKnife 是怎样实现代码注入的</a></li><li><a href=#ButterKnife%e6%98%af%e5%a6%82%e4%bd%95%e5%9c%a8%e7%bc%96%e8%af%91%e6%97%b6%e7%94%9f%e6%88%90%e4%bb%a3%e7%a0%81%e7%9a%84 title=ButterKnife是如何在编译时生成代码的？>ButterKnife是如何在编译时生成代码的？</a></li></ul></li></ul></li><li><a href=#Dagger-2 title="Dagger 2">Dagger 2</a><ul><li><a href=#%e9%a2%84%e5%a4%87%e7%9f%a5%e8%af%86 title=预备知识>预备知识</a><ul><li><a href=#@Inject title=@Inject>@Inject</a></li><li><a href=#@Module title=@Module>@Module</a></li><li><a href=#@Singleton title=@Singleton>@Singleton</a></li><li><a href=#@Providers title=@Providers>@Providers</a></li><li><a href=#@Component title=@Component>@Component</a></li><li><a href=#@Scope title=@Scope>@Scope</a></li><li><a href=#@Qualifier title=@Qualifier>@Qualifier</a></li><li><a href=#dependencies title=dependencies>dependencies</a></li><li><a href=#@SubComponent title=@SubComponent>@SubComponent</a></li></ul></li><li><a href=#%e7%ae%80%e5%8d%95%e7%a4%ba%e4%be%8b-2 title=简单示例>简单示例</a></li><li><a href=#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90-2 title=源码分析>源码分析</a></li></ul></li><li><a href=#EventBus title=EventBus>EventBus</a><ul><li><a href=#%e7%ae%80%e5%8d%95%e7%a4%ba%e4%be%8b-3 title=简单示例>简单示例</a></li><li><a href=#%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90-3 title=源码分析>源码分析</a></li></ul></li></ul><h1 id=okhttp>OKHttp
<a class=header-anchor href=#okhttp></a></h1><h2 id=okhttp请求流程>OKHttp请求流程
<a class=header-anchor href=#okhttp%e8%af%b7%e6%b1%82%e6%b5%81%e7%a8%8b></a></h2><p>OKHttp内部的大致请求流程图如下所示：</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/android-open-source-library-source-analysis/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/android-extension-knowledge-points/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Android扩展知识点"><meta itemprop=description content="点击阅读前文前, 首页能看到的文章的简短描述"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/android-extension-knowledge-points/ itemprop=url class=post-title-link>Android扩展知识点</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年06月03日 14:48:29 CST" itemprop="dateCreated datePublished" datetime="2023-06-03 14:48:29 +0800 +0800">2023年06月03日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/android-extension-knowledge-points/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><ul><li><a href=#art title=ART>ART</a><ul><li><a href=#art-%e5%8a%9f%e8%83%bd title="ART 功能">ART 功能</a><ul><li><a href=#%e9%a2%84%e5%85%88-aot-%e7%bc%96%e8%af%91 title="预先 (AOT) 编译">预先 (AOT) 编译</a></li><li><a href=#%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e4%bc%98%e5%8c%96 title=垃圾回收优化>垃圾回收优化</a></li><li><a href=#%e5%bc%80%e5%8f%91%e5%92%8c%e8%b0%83%e8%af%95%e6%96%b9%e9%9d%a2%e7%9a%84%e4%bc%98%e5%8c%96 title=开发和调试方面的优化>开发和调试方面的优化</a></li></ul></li><li><a href=#art-gc title="ART GC">ART GC</a></li></ul></li><li><a href=#hook title=Hook>Hook</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e6%b5%81%e7%a8%8b title=基本流程>基本流程</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b title=使用示例>使用示例</a></li></ul></li><li><a href=#proguard title=Proguard>Proguard</a><ul><li><a href=#%e8%a7%84%e5%88%99 title=规则>规则</a></li><li><a href=#%e5%85%ac%e5%85%b1%e6%a8%a1%e6%9d%bf title=公共模板>公共模板</a></li><li><a href=#%e5%b8%b8%e7%94%a8%e7%9a%84%e8%87%aa%e5%ae%9a%e4%b9%89%e6%b7%b7%e6%b7%86%e8%a7%84%e5%88%99 title=常用的自定义混淆规则>常用的自定义混淆规则</a></li><li><a href=#aar%e4%b8%ad%e5%a2%9e%e5%8a%a0%e7%8b%ac%e7%ab%8b%e7%9a%84%e6%b7%b7%e6%b7%86%e9%85%8d%e7%bd%ae title=aar中增加独立的混淆配置>aar中增加独立的混淆配置</a></li><li><a href=#%e6%a3%80%e6%9f%a5%e6%b7%b7%e6%b7%86%e5%92%8c%e8%bf%bd%e8%b8%aa%e5%bc%82%e5%b8%b8 title=检查混淆和追踪异常>检查混淆和追踪异常</a></li></ul></li><li><a href=#%e6%9e%b6%e6%9e%84 title=架构>架构</a><ul><li><a href=#mvc title=MVC>MVC</a></li><li><a href=#mvp title=MVP>MVP</a></li><li><a href=#mvvm title=MVVM>MVVM</a></li></ul></li><li><a href=#jetpack title=Jetpack>Jetpack</a><ul><li><a href=#%e6%9e%b6%e6%9e%84-1 title=架构>架构</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b-1 title=使用示例>使用示例</a></li></ul></li><li><a href=#ndk-%e5%bc%80%e5%8f%91 title="NDK 开发">NDK 开发</a><ul><li><a href=#jni-%e5%9f%ba%e7%a1%80 title="JNI 基础">JNI 基础</a><ul><li><a href=#%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b title=数据类型>数据类型</a></li><li><a href=#string-%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%87%bd%e6%95%b0%e6%93%8d%e4%bd%9c title="String 字符串函数操作">String 字符串函数操作</a></li><li><a href=#%e5%b8%b8%e7%94%a8-jni-%e8%ae%bf%e9%97%ae-java-%e5%af%b9%e8%b1%a1%e6%96%b9%e6%b3%95 title="常用 JNI 访问 Java 对象方法">常用 JNI 访问 Java 对象方法</a></li></ul></li><li><a href=#ndk-%e5%bc%80%e5%8f%91-1 title="NDK 开发">NDK 开发</a><ul><li><a href=#%e5%9f%ba%e7%a1%80%e5%bc%80%e5%8f%91%e6%b5%81%e7%a8%8b title=基础开发流程>基础开发流程</a></li><li><a href=#systemloadlibrary title=System.loadLibrary()>System.loadLibrary()</a></li></ul></li><li><a href=#cmake-%e6%9e%84%e5%bb%ba-ndk-%e9%a1%b9%e7%9b%ae title="CMake 构建 NDK 项目">CMake 构建 NDK 项目</a></li><li><a href=#%e5%b8%b8%e7%94%a8%e7%9a%84-android-ndk-%e5%8e%9f%e7%94%9f-api title="常用的 Android NDK 原生 API">常用的 Android NDK 原生 API</a></li></ul></li><li><a href=#%e7%b1%bb%e5%8a%a0%e8%bd%bd%e5%99%a8 title=类加载器>类加载器</a><ul><li><a href=#%e5%8f%8c%e4%ba%b2%e5%a7%94%e6%89%98%e6%a8%a1%e5%bc%8f title=双亲委托模式>双亲委托模式</a></li><li><a href=#dexpathlist title=DexPathList>DexPathList</a></li></ul></li></ul><h1 id=art>ART
<a class=header-anchor href=#art></a></h1><p>ART 代表 Android Runtime，其处理应用程序执行的方式完全不同于 Dalvik，Dalvik 是依靠一个 Just-In-Time (JIT) 编译器去解释字节码。开发者编译后的应用代码需要通过一个解释器在用户的设备上运行，这一机制并不高效，但让应用能更容易在不同硬件和架构上运 行。ART 则完全改变了这套做法，在应用安装时就预编译字节码到机器语言，这一机制叫 Ahead-Of-Time (AOT）编译。在移除解释代码这一过程后，应用程序执行将更有效率，启动更快。</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/android-extension-knowledge-points/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/android-knowledge-points/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Android知识点汇总"><meta itemprop=description content="点击阅读前文前, 首页能看到的文章的简短描述"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/android-knowledge-points/ itemprop=url class=post-title-link>Android知识点汇总</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年06月03日 14:45:46 CST" itemprop="dateCreated datePublished" datetime="2023-06-03 14:45:46 +0800 +0800">2023年06月03日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/android-knowledge-points/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><ul><li><a href=#activity title=Activity>Activity</a><ul><li><a href=#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f title=生命周期>生命周期</a></li><li><a href=#%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f title=启动模式>启动模式</a></li><li><a href=#%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b title=启动过程>启动过程</a></li></ul></li><li><a href=#fragment title=Fragment>Fragment</a><ul><li><a href=#%e7%89%b9%e7%82%b9 title=特点>特点</a></li><li><a href=#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f-1 title=生命周期>生命周期</a></li><li><a href=#%e4%b8%8eactivity%e9%80%9a%e4%bf%a1 title=与Activity通信>与Activity通信</a></li></ul></li><li><a href=#service title=Service>Service</a><ul><li><a href=#%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b-1 title=启动过程>启动过程</a></li><li><a href=#%e7%bb%91%e5%ae%9a%e8%bf%87%e7%a8%8b title=绑定过程>绑定过程</a></li><li><a href=#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f-2 title=生命周期>生命周期</a></li><li><a href=#%e5%90%af%e7%94%a8%e5%89%8d%e5%8f%b0%e6%9c%8d%e5%8a%a1 title=启用前台服务>启用前台服务</a></li></ul></li><li><a href=#broadcastreceiver title=BroadcastReceiver>BroadcastReceiver</a><ul><li><a href=#%e6%b3%a8%e5%86%8c%e8%bf%87%e7%a8%8b title=注册过程>注册过程</a></li></ul></li><li><a href=#contentprovider title=ContentProvider>ContentProvider</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8 title=基本使用>基本使用</a></li></ul></li><li><a href=#%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8 title=数据存储>数据存储</a></li><li><a href=#view title=View>View</a><ul><li><a href=#measurespec title=MeasureSpec>MeasureSpec</a></li><li><a href=#motionevent title=MotionEvent>MotionEvent</a></li><li><a href=#velocitytracker title=VelocityTracker>VelocityTracker</a></li><li><a href=#gesturedetector title=GestureDetector>GestureDetector</a></li><li><a href=#scroller title=Scroller>Scroller</a></li><li><a href=#view-%e7%9a%84%e6%bb%91%e5%8a%a8 title="View 的滑动">View 的滑动</a></li><li><a href=#view-%e7%9a%84%e4%ba%8b%e4%bb%b6%e5%88%86%e5%8f%91 title="View 的事件分发">View 的事件分发</a></li><li><a href=#%e5%9c%a8-activity-%e4%b8%ad%e8%8e%b7%e5%8f%96%e6%9f%90%e4%b8%aa-view-%e7%9a%84%e5%ae%bd%e9%ab%98 title="在 Activity 中获取某个 View 的宽高">在 Activity 中获取某个 View 的宽高</a></li><li><a href=#draw-%e7%9a%84%e5%9f%ba%e6%9c%ac%e6%b5%81%e7%a8%8b title="Draw 的基本流程">Draw 的基本流程</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89-view title="自定义 View">自定义 View</a></li></ul></li><li><a href=#%e8%bf%9b%e7%a8%8b title=进程>进程</a><ul><li><a href=#%e8%bf%9b%e7%a8%8b%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f title=进程生命周期>进程生命周期</a></li><li><a href=#%e5%a4%9a%e8%bf%9b%e7%a8%8b title=多进程>多进程</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e5%ad%98%e6%b4%bb title=进程存活>进程存活</a><ul><li><a href=#oom_adj title=OOM_ADJ>OOM_ADJ</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e8%a2%ab%e6%9d%80%e6%83%85%e5%86%b5 title=进程被杀情况>进程被杀情况</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e4%bf%9d%e6%b4%bb%e6%96%b9%e6%a1%88 title=进程保活方案>进程保活方案</a></li></ul></li></ul></li><li><a href=#parcelable-%e6%8e%a5%e5%8f%a3 title="Parcelable 接口">Parcelable 接口</a><ul><li><a href=#%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b title=使用示例>使用示例</a></li><li><a href=#%e6%96%b9%e6%b3%95%e8%af%b4%e6%98%8e title=方法说明>方法说明</a></li><li><a href=#parcelable-%e4%b8%8e-serializable-%e5%af%b9%e6%af%94 title="Parcelable 与 Serializable 对比">Parcelable 与 Serializable 对比</a></li></ul></li><li><a href=#ipc title=IPC>IPC</a><ul><li><a href=#ipc%e6%96%b9%e5%bc%8f title=IPC方式>IPC方式</a></li><li><a href=#binder title=Binder>Binder</a><ul><li><a href=#%e6%b5%81%e7%a8%8b title=流程>流程</a></li></ul></li><li><a href=#aidl-%e9%80%9a%e4%bf%a1 title="AIDL 通信">AIDL 通信</a></li><li><a href=#messenger title=Messenger>Messenger</a></li></ul></li><li><a href=#window--windowmanager title="Window / WindowManager">Window / WindowManager</a><ul><li><a href=#window-%e6%a6%82%e5%bf%b5%e4%b8%8e%e5%88%86%e7%b1%bb title="Window 概念与分类">Window 概念与分类</a></li><li><a href=#window-%e7%9a%84%e5%86%85%e9%83%a8%e6%9c%ba%e5%88%b6 title="Window 的内部机制">Window 的内部机制</a></li><li><a href=#window-%e7%9a%84%e5%88%9b%e5%bb%ba%e8%bf%87%e7%a8%8b title="Window 的创建过程">Window 的创建过程</a><ul><li><a href=#activity-%e7%9a%84-window-%e5%88%9b%e5%bb%ba%e8%bf%87%e7%a8%8b title="Activity 的 Window 创建过程">Activity 的 Window 创建过程</a></li><li><a href=#dialog-%e7%9a%84-window-%e5%88%9b%e5%bb%ba%e8%bf%87%e7%a8%8b title="Dialog 的 Window 创建过程">Dialog 的 Window 创建过程</a></li><li><a href=#toast-%e7%9a%84-window-%e5%88%9b%e5%bb%ba%e8%bf%87%e7%a8%8b title="Toast 的 Window 创建过程">Toast 的 Window 创建过程</a></li></ul></li></ul></li><li><a href=#bitmap title=Bitmap>Bitmap</a><ul><li><a href=#%e9%85%8d%e7%bd%ae%e4%bf%a1%e6%81%af%e4%b8%8e%e5%8e%8b%e7%bc%a9%e6%96%b9%e5%bc%8f title=配置信息与压缩方式>配置信息与压缩方式</a></li><li><a href=#%e5%b8%b8%e7%94%a8%e6%93%8d%e4%bd%9c title=常用操作>常用操作</a><ul><li><a href=#%e8%a3%81%e5%89%aa%e7%bc%a9%e6%94%be%e6%97%8b%e8%bd%ac%e7%a7%bb%e5%8a%a8 title=裁剪、缩放、旋转、移动>裁剪、缩放、旋转、移动</a></li><li><a href=#bitmap%e4%b8%8edrawable%e8%bd%ac%e6%8d%a2 title=Bitmap与Drawable转换>Bitmap与Drawable转换</a></li><li><a href=#%e4%bf%9d%e5%ad%98%e4%b8%8e%e9%87%8a%e6%94%be title=保存与释放>保存与释放</a></li><li><a href=#%e5%9b%be%e7%89%87%e5%8e%8b%e7%bc%a9 title=图片压缩>图片压缩</a></li></ul></li><li><a href=#bitmapfactory title=BitmapFactory>BitmapFactory</a><ul><li><a href=#bitmap%e5%88%9b%e5%bb%ba%e6%b5%81%e7%a8%8b title=Bitmap创建流程>Bitmap创建流程</a></li><li><a href=#option%e7%b1%bb title=Option类>Option类</a></li><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-1 title=基本使用>基本使用</a></li></ul></li><li><a href=#%e5%86%85%e5%ad%98%e5%9b%9e%e6%94%b6 title=内存回收>内存回收</a></li></ul></li><li><a href=#%e5%b1%8f%e5%b9%95%e9%80%82%e9%85%8d title=屏幕适配>屏幕适配</a><ul><li><a href=#%e5%8d%95%e4%bd%8d title=单位>单位</a></li><li><a href=#%e5%a4%b4%e6%9d%a1%e9%80%82%e9%85%8d%e6%96%b9%e6%a1%88 title=头条适配方案>头条适配方案</a></li><li><a href=#%e5%88%98%e6%b5%b7%e5%b1%8f%e9%80%82%e9%85%8d title=刘海屏适配>刘海屏适配</a></li></ul></li><li><a href=#context title=Context>Context</a></li><li><a href=#sharedpreferences title=SharedPreferences>SharedPreferences</a><ul><li><a href=#%e8%8e%b7%e5%8f%96%e6%96%b9%e5%bc%8f title=获取方式>获取方式</a><ul><li><a href=#getpreferences title=getPreferences>getPreferences</a></li><li><a href=#getdefaultsharedpreferences title=getDefaultSharedPreferences>getDefaultSharedPreferences</a></li><li><a href=#getsharedpreferences title=getSharedPreferences>getSharedPreferences</a></li></ul></li><li><a href=#%e6%9e%b6%e6%9e%84 title=架构>架构</a></li><li><a href=#apply--commit title="apply / commit">apply / commit</a></li><li><a href=#%e6%b3%a8%e6%84%8f title=注意>注意</a></li></ul></li><li><a href=#%e6%b6%88%e6%81%af%e6%9c%ba%e5%88%b6 title=消息机制>消息机制</a><ul><li><a href=#handler-%e6%9c%ba%e5%88%b6 title="Handler 机制">Handler 机制</a></li><li><a href=#%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 title=工作原理>工作原理</a><ul><li><a href=#threadlocal title=ThreadLocal>ThreadLocal</a></li><li><a href=#messagequeue title=MessageQueue>MessageQueue</a></li><li><a href=#looper title=Looper>Looper</a></li><li><a href=#handler title=Handler>Handler</a></li></ul></li></ul></li><li><a href=#%e7%ba%bf%e7%a8%8b%e5%bc%82%e6%ad%a5 title=线程异步>线程异步</a><ul><li><a href=#asynctask title=AsyncTask>AsyncTask</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-2 title=基本使用>基本使用</a></li><li><a href=#%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86-1 title=工作原理>工作原理</a></li></ul></li><li><a href=#handlerthread title=HandlerThread>HandlerThread</a></li><li><a href=#intentservice title=IntentService>IntentService</a></li><li><a href=#%e7%ba%bf%e7%a8%8b%e6%b1%a0 title=线程池>线程池</a></li></ul></li><li><a href=#recyclerview-%e4%bc%98%e5%8c%96 title="RecyclerView 优化">RecyclerView 优化</a></li><li><a href=#webview title=Webview>Webview</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8-3 title=基本使用>基本使用</a><ul><li><a href=#webview-1 title=WebView>WebView</a></li><li><a href=#websettings title=WebSettings>WebSettings</a></li><li><a href=#webviewclient title=WebViewClient>WebViewClient</a></li><li><a href=#webchromeclient title=WebChromeClient>WebChromeClient</a></li></ul></li><li><a href=#webview-%e5%8a%a0%e8%bd%bd%e4%bc%98%e5%8c%96 title="Webview 加载优化">Webview 加载优化</a></li><li><a href=#%e5%86%85%e5%ad%98%e6%b3%84%e6%bc%8f title=内存泄漏>内存泄漏</a></li></ul></li></ul><h1 id=activity>Activity
<a class=header-anchor href=#activity></a></h1><h2 id=生命周期>生命周期
<a class=header-anchor href=#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f></a></h2><p><img src=/imgs/img-lazy-loading.gif data-src=http://gityuan.com/images/lifecycle/activity.png alt></p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/android-knowledge-points/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/frida-source-code-analysis/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Frida 源码分析"><meta itemprop=description content="
    frida 代码结构：frida-core: Frida core library intended for static linking into bindingsfrida-gum: Low-leve&mldr;&mldr;

  


    
    
frida 代码结构：

frida-core: Frida core library intended for static linking into bindings
frida-gum: Low-level code instrumentation library used by frida-core
bindings:
frida-python: Frida Python bindings
frida-node: Frida Node.js bindings
frida-qml: Frida Qml plugin
frida-swift: Frida Swift bindings
frida-tools: Frida CLI tools
capstone: instruction disammbler"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/frida-source-code-analysis/ itemprop=url class=post-title-link>Frida 源码分析</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年04月23日 11:38:19 CST" itemprop="dateCreated datePublished" datetime="2023-04-23 11:38:19 +0800 +0800">2023年04月23日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/frida-source-code-analysis/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><blockquote><p>frida 代码结构：frida-core: Frida core library intended for static linking into bindingsfrida-gum: Low-leve&mldr;&mldr;</p></blockquote><h2 id=frida-代码结构><a href=#frida%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84%ef%bc%9a title></a>frida 代码结构：
<a class=header-anchor href=#frida-%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84></a></h2><p><strong>frida-core</strong>: Frida core library intended for static linking into bindings<br><strong>frida-gum</strong>: Low-level code instrumentation library used by frida-core<br>bindings:<br><strong>frida-python</strong>: Frida Python bindings<br><strong>frida-node</strong>: Frida Node.js bindings<br><strong>frida-qml</strong>: Frida Qml plugin<br><strong>frida-swift</strong>: Frida Swift bindings<br><strong>frida-tools</strong>: Frida CLI tools<br><strong>capstone</strong>: instruction disammbler</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/frida-source-code-analysis/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/android-mobile-game-accelerator-brief-introduction/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="android手游加速器简述"><meta itemprop=description content="这几年手游加速器很火。以光环为代表，进行C层的HOOK,既可以实现加速，又可以免Root保证手机安全。
a. 什么是加速？
加速就是改变游戏的运行速度。
b. 怎么样才能加速？"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/android-mobile-game-accelerator-brief-introduction/ itemprop=url class=post-title-link>android手游加速器简述</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年04月17日 16:25:37 CST" itemprop="dateCreated datePublished" datetime="2023-04-17 16:25:37 +0800 +0800">2023年04月17日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/android-mobile-game-accelerator-brief-introduction/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>这几年手游加速器很火。以光环为代表，进行C层的HOOK,既可以实现加速，又可以免Root保证手机安全。</p><p>a. 什么是加速？</p><p>加速就是改变游戏的运行速度。</p><p>b. 怎么样才能加速？</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/android-mobile-game-accelerator-brief-introduction/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/use-frida-call-unity-mono-class-method-sample/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="使用Frida调用Unity中Mono类方法的示例代码"><meta itemprop=description content='
javascript
这个示例代码使用Frida框架来调用Unity游戏引擎中的Mono类方法。它首先通过attach到目标进程和获取相关模块的基址来获取Mono类和方法信息。然后，它构造了一个包含参数的调用，并使用mono_runtime_invoke函数来调用方法。最后，它使用mono_object_to_string函数来获取返回值并打印出来。请注意，这个示例代码仅供参考，实际使用时需要根据具体情况进行修改。




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27


// attach到目标进程
const processName = &#39;your_process_name&#39;;
const targetProcess = Process.getFromName(processName);
const module = Process.getModuleByName(&#39;UnityPlayer.dll&#39;);
const baseAddr = module.base;

// 获取Mono类和方法信息
const monoImage = Module.findBaseAddress(&#39;mono.dll&#39;);
const monoClass = MonoApi.mono_class_from_name(monoImage, &#39;YourNamespace&#39;, &#39;YourClassName&#39;);
const monoMethod = MonoApi.mono_class_get_method_from_name(monoClass, &#39;YourMethodName&#39;, -1);

// 构造参数
const arg1 = MonoApi.mono_string_new(monoImage, Memory.allocUtf8String(&#39;your_string_argument&#39;));
const arg2 = MonoApi.mono_object_new(monoImage, monoClass);

// 构造调用
const args = Memory.alloc(2 * Process.pointerSize);
Memory.writePointer(args, arg1);
Memory.writePointer(args.add(Process.pointerSize), arg2);
const result = Memory.alloc(Process.pointerSize);

// 调用方法
MonoApi.mono_runtime_invoke(monoMethod, null, args, result);

// 获取返回值
const returnValue = MonoApi.mono_object_to_string(result, null);
console.log(Memory.readUtf16String(returnValue));




C
这个示例代码使用C语言和Frida框架来调用Unity游戏引擎中的Mono类方法。它首先初始化Frida并连接到目标进程，然后获取UnityPlayer.dll模块基址和Mono类和方法信息。接着，它构造了一个包含参数的调用，并使用frida_runtime_invoke_method函数来调用方法。最后，它使用frida_value_to_string函数来获取返回值并打印出来。请注意，这个示例代码仅供参考，实际使用时需要根据具体情况进行修改。




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57


#include <frida-core.h>

// Frida回调函数
static void on_message(FridaSession *session, const gchar *message, GBytes *data, gpointer user_data)
{
    // 处理回调消息
}

int main(int argc, char **argv)
{
    // 初始化Frida
    frida_init();

    // 连接到目标进程
    FridaSession *session = frida_attach("your_process_name");

    // 获取UnityPlayer.dll模块基址
    FridaModule *module = frida_session_find_module(session, "UnityPlayer.dll");
    guint64 base_addr = frida_module_get_base_address(module);

    // 获取Mono类和方法信息
    gpointer mono_image = frida_module_find_export_by_name(module, "mono_image_open_from_data_with_name");
    gpointer mono_class = frida_session_create_script(session, "YourNamespace", "YourClassName", NULL);
    gpointer mono_method = frida_class_find_method_by_name(mono_class, "YourMethodName");

    // 构造参数
    gpointer arg1 = frida_value_from_string("your_string_argument");
    gpointer arg2 = frida_value_new_object(mono_class);

    // 构造调用
    GArray *args = g_array_new(FALSE, FALSE, sizeof(GValue *));
    g_array_append_val(args, *((GValue *) arg1));
    g_array_append_val(args, *((GValue *) arg2));
    gpointer result = frida_value_new();

    // 调用方法
    frida_runtime_invoke_method(mono_method, NULL, args, result);

    // 获取返回值
    gchar *return_value = frida_value_to_string(result);
    g_print("%s\n", return_value);

    // 释放资源
    g_free(return_value);
    g_array_unref(args);
    frida_value_free(result);
    frida_value_free(arg1);
    frida_value_free(arg2);
    g_object_unref(mono_method);
    g_object_unref(mono_class);
    g_object_unref(mono_image);
    g_object_unref(module);
    g_object_unref(session);
    frida_deinit();

    return 0;
}

'></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/use-frida-call-unity-mono-class-method-sample/ itemprop=url class=post-title-link>使用Frida调用Unity中Mono类方法的示例代码</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年04月17日 14:10:09 CST" itemprop="dateCreated datePublished" datetime="2023-04-17 14:10:09 +0800 +0800">2023年04月17日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/use-frida-call-unity-mono-class-method-sample/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><ul><li>javascript
这个示例代码使用Frida框架来调用Unity游戏引擎中的Mono类方法。它首先通过attach到目标进程和获取相关模块的基址来获取Mono类和方法信息。然后，它构造了一个包含参数的调用，并使用<code>mono_runtime_invoke</code>函数来调用方法。最后，它使用<code>mono_object_to_string</code>函数来获取返回值并打印出来。请注意，这个示例代码仅供参考，实际使用时需要根据具体情况进行修改。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span><span class=lnt id=hl-0-24><a class=lnlinks href=#hl-0-24>24</a>
</span><span class=lnt id=hl-0-25><a class=lnlinks href=#hl-0-25>25</a>
</span><span class=lnt id=hl-0-26><a class=lnlinks href=#hl-0-26>26</a>
</span><span class=lnt id=hl-0-27><a class=lnlinks href=#hl-0-27>27</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// attach到目标进程
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>processName</span> <span class=o>=</span> <span class=s1>&#39;your_process_name&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>targetProcess</span> <span class=o>=</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>getFromName</span><span class=p>(</span><span class=nx>processName</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>module</span> <span class=o>=</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>getModuleByName</span><span class=p>(</span><span class=s1>&#39;UnityPlayer.dll&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>baseAddr</span> <span class=o>=</span> <span class=nx>module</span><span class=p>.</span><span class=nx>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取Mono类和方法信息
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>monoImage</span> <span class=o>=</span> <span class=nx>Module</span><span class=p>.</span><span class=nx>findBaseAddress</span><span class=p>(</span><span class=s1>&#39;mono.dll&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>monoClass</span> <span class=o>=</span> <span class=nx>MonoApi</span><span class=p>.</span><span class=nx>mono_class_from_name</span><span class=p>(</span><span class=nx>monoImage</span><span class=p>,</span> <span class=s1>&#39;YourNamespace&#39;</span><span class=p>,</span> <span class=s1>&#39;YourClassName&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>monoMethod</span> <span class=o>=</span> <span class=nx>MonoApi</span><span class=p>.</span><span class=nx>mono_class_get_method_from_name</span><span class=p>(</span><span class=nx>monoClass</span><span class=p>,</span> <span class=s1>&#39;YourMethodName&#39;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 构造参数
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>arg1</span> <span class=o>=</span> <span class=nx>MonoApi</span><span class=p>.</span><span class=nx>mono_string_new</span><span class=p>(</span><span class=nx>monoImage</span><span class=p>,</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>allocUtf8String</span><span class=p>(</span><span class=s1>&#39;your_string_argument&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>arg2</span> <span class=o>=</span> <span class=nx>MonoApi</span><span class=p>.</span><span class=nx>mono_object_new</span><span class=p>(</span><span class=nx>monoImage</span><span class=p>,</span> <span class=nx>monoClass</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 构造调用
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>args</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Memory</span><span class=p>.</span><span class=nx>writePointer</span><span class=p>(</span><span class=nx>args</span><span class=p>,</span> <span class=nx>arg1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Memory</span><span class=p>.</span><span class=nx>writePointer</span><span class=p>(</span><span class=nx>args</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span><span class=p>),</span> <span class=nx>arg2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>Memory</span><span class=p>.</span><span class=nx>alloc</span><span class=p>(</span><span class=nx>Process</span><span class=p>.</span><span class=nx>pointerSize</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 调用方法
</span></span></span><span class=line><span class=cl><span class=nx>MonoApi</span><span class=p>.</span><span class=nx>mono_runtime_invoke</span><span class=p>(</span><span class=nx>monoMethod</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=nx>args</span><span class=p>,</span> <span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取返回值
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>returnValue</span> <span class=o>=</span> <span class=nx>MonoApi</span><span class=p>.</span><span class=nx>mono_object_to_string</span><span class=p>(</span><span class=nx>result</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>Memory</span><span class=p>.</span><span class=nx>readUtf16String</span><span class=p>(</span><span class=nx>returnValue</span><span class=p>));</span></span></span></code></pre></td></tr></table></div></div><ul><li>C
这个示例代码使用C语言和Frida框架来调用Unity游戏引擎中的Mono类方法。它首先初始化Frida并连接到目标进程，然后获取UnityPlayer.dll模块基址和Mono类和方法信息。接着，它构造了一个包含参数的调用，并使用<code>frida_runtime_invoke_method</code>函数来调用方法。最后，它使用<code>frida_value_to_string</code>函数来获取返回值并打印出来。请注意，这个示例代码仅供参考，实际使用时需要根据具体情况进行修改。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a>
</span><span class=lnt id=hl-1-33><a class=lnlinks href=#hl-1-33>33</a>
</span><span class=lnt id=hl-1-34><a class=lnlinks href=#hl-1-34>34</a>
</span><span class=lnt id=hl-1-35><a class=lnlinks href=#hl-1-35>35</a>
</span><span class=lnt id=hl-1-36><a class=lnlinks href=#hl-1-36>36</a>
</span><span class=lnt id=hl-1-37><a class=lnlinks href=#hl-1-37>37</a>
</span><span class=lnt id=hl-1-38><a class=lnlinks href=#hl-1-38>38</a>
</span><span class=lnt id=hl-1-39><a class=lnlinks href=#hl-1-39>39</a>
</span><span class=lnt id=hl-1-40><a class=lnlinks href=#hl-1-40>40</a>
</span><span class=lnt id=hl-1-41><a class=lnlinks href=#hl-1-41>41</a>
</span><span class=lnt id=hl-1-42><a class=lnlinks href=#hl-1-42>42</a>
</span><span class=lnt id=hl-1-43><a class=lnlinks href=#hl-1-43>43</a>
</span><span class=lnt id=hl-1-44><a class=lnlinks href=#hl-1-44>44</a>
</span><span class=lnt id=hl-1-45><a class=lnlinks href=#hl-1-45>45</a>
</span><span class=lnt id=hl-1-46><a class=lnlinks href=#hl-1-46>46</a>
</span><span class=lnt id=hl-1-47><a class=lnlinks href=#hl-1-47>47</a>
</span><span class=lnt id=hl-1-48><a class=lnlinks href=#hl-1-48>48</a>
</span><span class=lnt id=hl-1-49><a class=lnlinks href=#hl-1-49>49</a>
</span><span class=lnt id=hl-1-50><a class=lnlinks href=#hl-1-50>50</a>
</span><span class=lnt id=hl-1-51><a class=lnlinks href=#hl-1-51>51</a>
</span><span class=lnt id=hl-1-52><a class=lnlinks href=#hl-1-52>52</a>
</span><span class=lnt id=hl-1-53><a class=lnlinks href=#hl-1-53>53</a>
</span><span class=lnt id=hl-1-54><a class=lnlinks href=#hl-1-54>54</a>
</span><span class=lnt id=hl-1-55><a class=lnlinks href=#hl-1-55>55</a>
</span><span class=lnt id=hl-1-56><a class=lnlinks href=#hl-1-56>56</a>
</span><span class=lnt id=hl-1-57><a class=lnlinks href=#hl-1-57>57</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;frida-core.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Frida回调函数
</span></span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>on_message</span><span class=p>(</span><span class=n>FridaSession</span> <span class=o>*</span><span class=n>session</span><span class=p>,</span> <span class=k>const</span> <span class=n>gchar</span> <span class=o>*</span><span class=n>message</span><span class=p>,</span> <span class=n>GBytes</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=n>gpointer</span> <span class=n>user_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 处理回调消息
</span></span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 初始化Frida
</span></span></span><span class=line><span class=cl>    <span class=nf>frida_init</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 连接到目标进程
</span></span></span><span class=line><span class=cl>    <span class=n>FridaSession</span> <span class=o>*</span><span class=n>session</span> <span class=o>=</span> <span class=nf>frida_attach</span><span class=p>(</span><span class=s>&#34;your_process_name&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取UnityPlayer.dll模块基址
</span></span></span><span class=line><span class=cl>    <span class=n>FridaModule</span> <span class=o>*</span><span class=n>module</span> <span class=o>=</span> <span class=nf>frida_session_find_module</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=s>&#34;UnityPlayer.dll&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>guint64</span> <span class=n>base_addr</span> <span class=o>=</span> <span class=nf>frida_module_get_base_address</span><span class=p>(</span><span class=n>module</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取Mono类和方法信息
</span></span></span><span class=line><span class=cl>    <span class=n>gpointer</span> <span class=n>mono_image</span> <span class=o>=</span> <span class=nf>frida_module_find_export_by_name</span><span class=p>(</span><span class=n>module</span><span class=p>,</span> <span class=s>&#34;mono_image_open_from_data_with_name&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>gpointer</span> <span class=n>mono_class</span> <span class=o>=</span> <span class=nf>frida_session_create_script</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=s>&#34;YourNamespace&#34;</span><span class=p>,</span> <span class=s>&#34;YourClassName&#34;</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>gpointer</span> <span class=n>mono_method</span> <span class=o>=</span> <span class=nf>frida_class_find_method_by_name</span><span class=p>(</span><span class=n>mono_class</span><span class=p>,</span> <span class=s>&#34;YourMethodName&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 构造参数
</span></span></span><span class=line><span class=cl>    <span class=n>gpointer</span> <span class=n>arg1</span> <span class=o>=</span> <span class=nf>frida_value_from_string</span><span class=p>(</span><span class=s>&#34;your_string_argument&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>gpointer</span> <span class=n>arg2</span> <span class=o>=</span> <span class=nf>frida_value_new_object</span><span class=p>(</span><span class=n>mono_class</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 构造调用
</span></span></span><span class=line><span class=cl>    <span class=n>GArray</span> <span class=o>*</span><span class=n>args</span> <span class=o>=</span> <span class=nf>g_array_new</span><span class=p>(</span><span class=n>FALSE</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>GValue</span> <span class=o>*</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>g_array_append_val</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=o>*</span><span class=p>((</span><span class=n>GValue</span> <span class=o>*</span><span class=p>)</span> <span class=n>arg1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>g_array_append_val</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=o>*</span><span class=p>((</span><span class=n>GValue</span> <span class=o>*</span><span class=p>)</span> <span class=n>arg2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>gpointer</span> <span class=n>result</span> <span class=o>=</span> <span class=nf>frida_value_new</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 调用方法
</span></span></span><span class=line><span class=cl>    <span class=nf>frida_runtime_invoke_method</span><span class=p>(</span><span class=n>mono_method</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取返回值
</span></span></span><span class=line><span class=cl>    <span class=n>gchar</span> <span class=o>*</span><span class=n>return_value</span> <span class=o>=</span> <span class=nf>frida_value_to_string</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>g_print</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>return_value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 释放资源
</span></span></span><span class=line><span class=cl>    <span class=nf>g_free</span><span class=p>(</span><span class=n>return_value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>g_array_unref</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>frida_value_free</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>frida_value_free</span><span class=p>(</span><span class=n>arg1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>frida_value_free</span><span class=p>(</span><span class=n>arg2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>g_object_unref</span><span class=p>(</span><span class=n>mono_method</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>g_object_unref</span><span class=p>(</span><span class=n>mono_class</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>g_object_unref</span><span class=p>(</span><span class=n>mono_image</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>g_object_unref</span><span class=p>(</span><span class=n>module</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>g_object_unref</span><span class=p>(</span><span class=n>session</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>frida_deinit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><div class=post-button><a class=btn href=/post/use-frida-call-unity-mono-class-method-sample/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/the-small-ways-often-use-frida/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="记录一些日常使用frida经常会用到的一些小方法"><meta itemprop=description content='整理一下之前的学习的一些常用frida的技巧，以备哪天快速查找。

常规的java层的函数hook




1
2
3


var manActivity=Java.use("com.kanxue.algorithmbase.MainActivity");
var res= manActivity.encodeFromJni_71(input)
console.log("input:",input,"output:",res);




主动调用函数




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11


//主动调用静态函数
var FridaActivity2 = Java.use("com.kanxue.algorithmbase.MainActivity");
FridaActivity2.setStatic_bool_var(); 
//主动调用非静态函数
Java.choose("com.example.androiddemo.Activity.FridaActivity2", {
  onMatch: function (instance) {
    instance.setBool_var();
  },
  onComplete: function () {
  }
});




主动设置成员变量




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15


var FridaActivity3 = Java.use("com.example.androiddemo.Activity.FridaActivity3");
//设置非静态成员变量的值
FridaActivity3.static_bool_var.value = true;
console.log(FridaActivity3.static_bool_var.value);
Java.choose("com.example.androiddemo.Activity.FridaActivity3", {
  onMatch: function (instance) {
  //设置非静态成员变量的值
  instance.bool_var.value = true;
  //设置有相同函数名的成员变量的值
  instance._same_name_bool_var.value = true;
  console.log(instance.bool_var.value, instance._same_name_bool_var.value);
  },
  onComplete: function () {
    }
});




hook内部类




1
2
3
4
5


var InnerClasses = Java.use("com.example.androiddemo.Activity.FridaActivity4$InnerClasses");
console.log(InnerClasses);
InnerClasses.check1.implementation = function () {
    return true;
};




根据条件判断动态hook多个函数




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14


var class_name = "com.example.androiddemo.Activity.FridaActivity4$InnerClasses";
var InnerClasses = Java.use(class_name);
var all_methods = InnerClasses.class.getDeclaredMethods();
for (var i = 0; i < all_methods.length; i++) {
  var method = (all_methods[i]);
  var methodStr = method.toString();
  var substring = methodStr.substr(methodStr.indexOf(class_name) + class_name.length + 1);
  var methodname = substring.substr(0, substring.indexOf("("));
  console.log(methodname);
  InnerClasses[methodname].implementation = function () {
    console.log("hook_mul_function:", this);
    return true;
  }
}




interface中的函数进行hook。需要先切换classloader




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26


var FridaActivity5 = Java.use("com.example.androiddemo.Activity.FridaActivity5");
Java.choose("com.example.androiddemo.Activity.FridaActivity5", {
  onMatch: function (instance) {
  console.log(instance.getDynamicDexCheck().$className);
  }, onComplete: function () {

  }
});
Java.enumerateClassLoaders({
  onMatch: function (loader) {
    try {
      if (loader.findClass("com.example.androiddemo.Dynamic.DynamicCheck")) {
        console.log(loader);
        Java.classFactory.loader = loader;  
     }
    } catch (error) {
    }
  }, onComplete: function () {
  }
});
var DynamicCheck = Java.use("com.example.androiddemo.Dynamic.DynamicCheck");
console.log(DynamicCheck);
DynamicCheck.check.implementation = function () {
  console.log("DynamicCheck.check");
  return true;
}




frida动态加载dex然后再调用dex中的函数




1
2
3
4


var ddex2 = Java.openClassFile("/data/local/tmp/ddex2.dex");
ddex2.load();
var DecodeUtils = Java.use("com.example.androiddemo.DecodeUtils");
console.log("DecodeUtils.decode_p:", DecodeUtils.decode_p());




hook构造函数




1
2
3
4
5
6
7


var a = Java.use("com.tlamb96.kgbmessenger.b.a");
  //hook 构造函数
  a.$init.implementation = function (i, str, str2, z) {
  this.$init(i, str, str2, z);
  console.log("a.$init:", i, str, str2, z);
  print_stack();       //打印了调用栈
};




打印java堆栈




1
2
3
4
5
6
7
8
9


function print_stack() {
    Java.perform(function () {
        var Exception = Java.use("java.lang.Exception");
        var instance = Exception.$new("print_stack");
        var stack = instance.getStackTrace();
        console.log(stack);
        instance.$dispose();
    });
}




调用NativeFunction来写入文件




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22


function write_reg_dat2() {
    //把C函数定义为NativeFunction来写文件
    var addr_fopen = Module.findExportByName("libc.so", "fopen");
    var addr_fputs = Module.findExportByName("libc.so", "fputs");
    var addr_fclose = Module.findExportByName("libc.so", "fclose");

    console.log("addr_fopen:", addr_fopen, "addr_fputs:", addr_fputs, "addr_fclose:", addr_fclose);
    var fopen = new NativeFunction(addr_fopen, "pointer", ["pointer", "pointer"]);
    var fputs = new NativeFunction(addr_fputs, "int", ["pointer", "pointer"]);
    var fclose = new NativeFunction(addr_fclose, "int", ["pointer"]);

    var filename = Memory.allocUtf8String("/sdcard/reg.dat");
    var open_mode = Memory.allocUtf8String("w+");
    var file = fopen(filename, open_mode);
    console.log("fopen file:", file);

    var buffer = Memory.allocUtf8String("EoPAoY62@ElRD");
    var ret = fputs(buffer, file);
    console.log("fputs ret:", ret);

    fclose(file);
}




将指针以字符串的方式打印




1
2
3
4
5


function print_string(addr) {
    var base_hello_jni = Module.findBaseAddress("libhello-jni.so");
    var addr_str = base_hello_jni.add(addr);
    console.log("addr:", addr, " ", ptr(addr_str).readCString());
}




延时hook。当用frida来启动应用时。hook的so还没有加载。所以要延时到加载完这个so后。才能hook




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35


function hook_dlopen() {
    var dlopen = Module.findExportByName(null, "dlopen");
    Interceptor.attach(dlopen, {
        onEnter: function (args) {
            this.call_hook = false;
            var so_name = ptr(args[0]).readCString();
            if (so_name.indexOf("libhello-jni.so") >= 0) {
                console.log("dlopen:", ptr(args[0]).readCString());
                this.call_hook = true;
            }

        }, onLeave: function (retval) {
            if (this.call_hook) {
                inline_hook();
            }
        }
    });
    // 高版本Android系统使用android_dlopen_ext
    var android_dlopen_ext = Module.findExportByName(null, "android_dlopen_ext");
    Interceptor.attach(android_dlopen_ext, {
        onEnter: function (args) {
            this.call_hook = false;
            var so_name = ptr(args[0]).readCString();
            if (so_name.indexOf("libhello-jni.so") >= 0) {
                console.log("android_dlopen_ext:", ptr(args[0]).readCString());
                this.call_hook = true;
            }

        }, onLeave: function (retval) {
            if (this.call_hook) {
                inline_hook();
            }
        }
    });
}




hook获取时间的函数。并且替换函数内容




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32


function hook_gettimeofday() {
    var addr_gettimeofday = Module.findExportByName(null, "gettimeofday");
    var gettimeofday = new NativeFunction(addr_gettimeofday, "int", ["pointer", "pointer"]);

    var source = [
        &#39;struct timeval {&#39;,
        &#39;    int tv_sec;&#39;,
        &#39;    int tv_usec;&#39;,
        &#39;};&#39;,
        &#39;void modify_time(struct timeval* tv, int tv_sec, int tv_usec) {&#39;,
        &#39;  tv->tv_sec = tv_sec;&#39;,
        &#39;  tv->tv_usec = tv_usec;&#39;,
        &#39;}&#39;,
    ].join(&#39;\n&#39;);

    var cm = new CModule(source);
    var modify_time = new NativeFunction(cm.modify_time, &#39;void&#39;, ["pointer", "int", "int"]);

    Interceptor.replace(addr_gettimeofday, new NativeCallback(function (ptr_tz, ptr_tzp) {

        var result = gettimeofday(ptr_tz, ptr_tzp);
        if (result == 0) {
            console.log("hook gettimeofday:", ptr_tz, ptr_tzp, result);
            //modify_time(ptr_tz, 0xAAAA, 0xBBBB);
            var t = new Int32Array(ArrayBuffer.wrap(ptr_tz, 8));
            t[0] = 0xAAAA;
            t[1] = 0xBBBB;
            console.log(hexdump(ptr_tz));
        }
        return result;
    }, "int", ["pointer", "pointer"]));
}




frida打patch补丁。可以用来搞反调试的




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56


function dis(address, number) {
    for (var i = 0; i < number; i++) {
        var ins = Instruction.parse(address);
        console.log("address:" + address + "--dis:" + ins.toString());
        address = ins.next;
    }
}

//libc->strstr()
function hook() {
//call_function("DT_INIT", init_func_, get_realpath());
    var linkermodule = Process.getModuleByName("linker");
    var call_function_addr = null;
    var symbols = linkermodule.enumerateSymbols();
    for (var i = 0; i < symbols.length; i++) {
        var symbol = symbols[i];
        //LogPrint(linkername + "->" + symbol.name + "---" + symbol.address);
        if (symbol.name.indexOf("__dl__ZL13call_functionPKcPFviPPcS2_ES0_") != -1) {
            call_function_addr = symbol.address;
            //LogPrint("linker->" + symbol.name + "---" + symbol.address)

        }
    }
    Interceptor.attach(call_function_addr, {
        onEnter: function (args) {
            var type = ptr(args[0]).readUtf8String();
            var address = args[1];
            var sopath = ptr(args[2]).readUtf8String();
            console.log("loadso:" + sopath + "--addr:" + address + "--type:" + type);
            if (sopath.indexOf("libnative-lib.so") != -1) {
                var libnativemodule = Process.getModuleByName("libnative-lib.so");
                var base = libnativemodule.base;
                dis(base.add(0x8D8E).add(1), 10);
                var patchaddr = base.add(0x8d96);
                Memory.patchCode(patchaddr, 4, patchaddr => {
                    var cw = new ThumbWriter(patchaddr);
                    cw.putNop();
                    cw = new ThumbWriter(patchaddr.add(0x2));
                    cw.putNop();
                    cw.flush();
                });
                /*                Memory.protect(base.add(0x8d96),4,&#39;rwx&#39;);
                                base.add(0x8d96).writeByteArray([0x00,0xbf,0x00,0xbf]);*/
                console.log("+++++++++++++++++++++++")
                dis(base.add(0x8D8E).add(1), 10);
                console.log("----------------------")

                dis(base.add(0x8E6E).add(1), 10);
                Memory.protect(base.add(0x8E78), 4, &#39;rwx&#39;);
                base.add(0x8E78).writeByteArray([0x00, 0xbf, 0x00, 0xbf]);
                console.log("+++++++++++++++++++++++")
                dis(base.add(0x8E6E).add(1), 10);
            }
        }
    })
}




用stalker来trace




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52


function hook_native(){
    var base_addr=Module.getBaseAddress("libnative-lib.so");
    var encodeFromJni_71=base_addr.add(0x156B4);
    Interceptor.attach(encodeFromJni_71,{
        onEnter:function(args){
            this.tid=Process.getCurrentThreadId();
            console.log("enter encodeFromJni_71 tid:",this.tid);
            Stalker.follow(this.tid, {
                events: {
                    call: true, // CALL instructions: yes please
                    // Other events:
                    ret: false, // RET instructions
                    exec: false, // all instructions: not recommended as it&#39;s
                                 //                   a lot of data
                    block: false, // block executed: coarse execution trace
                    compile: false // block compiled: useful for coverage
                },
                onCallSummary:function(summary){        //调用的地址和调用的次数
                    for(var iter in summary){
                        var module= Process.getModuleByAddress(ptr(iter))
                        if(module.name.indexOf("libnative-lib.so")!=-1){
                            console.log(ptr(iter).sub(module.base));
                        }
                    }
                },
                onReceive:function(events){             //调用的流程，地址1是哪里发生的调用。地址2是调用到了哪里
                    console.log("enter onReceive")
                    var eventsData=Stalker.parse(events,{
                        annotate: true,
                        stringify: true
                    });
                    for(var idx in eventsData){
                        var dataSp=eventsData[idx];
                        var addr1=dataSp[1];
                        var addr2=dataSp[2];
                        try{
                            var module1=Process.getModuleByAddress(ptr(addr1));
                            if(module1.name.indexOf("libnative-lib.so")!=-1){
                                var module2=Process.getModuleByAddress(ptr(addr2));
                                console.log(dataSp[0],module1.name,addr1,module2.name,addr2);
                            }
                        }catch(err){
                            console.log(dataSp);
                        }
                    }
                }
            })
        },onLeave(retval){
            Stalker.unfollow(this.tid);
        }
    })
}




比较通用的native函数hook打印




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40


//打印参数
function hexdumpMem(addr){
    if(Process.findRangeByAddress(addr)){
        return hexdump(ptr(addr),{length:0x40})+"\r\n"
    }else{
        return ptr(addr)+"\r\n";
    }
}
//比较通用的hook地址并且打印5个参数。如果参数是地址就打印下内存信息
function nativeHookFunction(addr){
    var base_addr=Module.getBaseAddress("libnative-lib.so");
    var hook_addr=base_addr.add(addr);
    Interceptor.attach(hook_addr,{
        onEnter:function(args){
            this.logs=[];
            this.logs.push("call",addr);
            this.arg0=args[0];
            this.arg1=args[1];
            this.arg2=args[2];
            this.arg3=args[3];
            this.arg4=args[4];
            this.arg5=args[5];
            this.logs.push("arg0:",hexdumpMem(this.arg0));
            this.logs.push("arg1:",hexdumpMem(this.arg1));
            this.logs.push("arg2:",hexdumpMem(this.arg2));
            this.logs.push("arg3:",hexdumpMem(this.arg3));
            this.logs.push("arg4:",hexdumpMem(this.arg4));
            this.logs.push("arg5:",hexdumpMem(this.arg5));
        },onLeave:function(retval){
            this.logs.push("arg0 leave:",hexdumpMem(this.arg0));
            this.logs.push("arg1 leave:",hexdumpMem(this.arg1));
            this.logs.push("arg2 leave:",hexdumpMem(this.arg2));
            this.logs.push("arg3 leave:",hexdumpMem(this.arg3));
            this.logs.push("arg4 leave:",hexdumpMem(this.arg4));
            this.logs.push("arg5 leave:",hexdumpMem(this.arg5));
            this.logs.push("retval leave:",hexdumpMem(retval));
            console.log(this.logs);
        }
    })
}




Frida打印java中的byte数组




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18


function Bytes2HexString(arrBytes) {
    var str = "";
    for (var i = 0; i < arrBytes.length; i++) {
        var tmp;
        var num = arrBytes[i];
        if (num < 0) {
            //此处填坑，当byte因为符合位导致数值为负时候，需要对数据进行处理
            tmp = (255 + num + 1).toString(16);
        } else {
            tmp = num.toString(16);
        }
        if (tmp.length === 1) {
            tmp = "0" + tmp;
        }
        str += tmp;
    }
    return str;
}

'></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/the-small-ways-often-use-frida/ itemprop=url class=post-title-link>记录一些日常使用frida经常会用到的一些小方法</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年04月15日 09:25:00 CST" itemprop="dateCreated datePublished" datetime="2023-04-15 09:25:00 +0800 +0800">2023年04月15日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/frida/ itemprop=url rel=index><span itemprop=name>frida</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/the-small-ways-often-use-frida/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>整理一下之前的学习的一些常用frida的技巧，以备哪天快速查找。</p><ul><li>常规的java层的函数hook</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>manActivity</span><span class=o>=</span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=s>&#34;com.kanxue.algorithmbase.MainActivity&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>res</span><span class=o>=</span><span class=w> </span><span class=n>manActivity</span><span class=p>.</span><span class=na>encodeFromJni_71</span><span class=p>(</span><span class=n>input</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;input:&#34;</span><span class=p>,</span><span class=n>input</span><span class=p>,</span><span class=s>&#34;output:&#34;</span><span class=p>,</span><span class=n>res</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div><ul><li>主动调用函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//主动调用静态函数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>FridaActivity2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=s>&#34;com.kanxue.algorithmbase.MainActivity&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>FridaActivity2</span><span class=p>.</span><span class=na>setStatic_bool_var</span><span class=p>();</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=c1>//主动调用非静态函数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>Java</span><span class=p>.</span><span class=na>choose</span><span class=p>(</span><span class=s>&#34;com.example.androiddemo.Activity.FridaActivity2&#34;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>onMatch</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>instance</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>instance</span><span class=p>.</span><span class=na>setBool_var</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>onComplete</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></td></tr></table></div></div><ul><li>主动设置成员变量</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>FridaActivity3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=s>&#34;com.example.androiddemo.Activity.FridaActivity3&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>//设置非静态成员变量的值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>FridaActivity3</span><span class=p>.</span><span class=na>static_bool_var</span><span class=p>.</span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>FridaActivity3</span><span class=p>.</span><span class=na>static_bool_var</span><span class=p>.</span><span class=na>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>Java</span><span class=p>.</span><span class=na>choose</span><span class=p>(</span><span class=s>&#34;com.example.androiddemo.Activity.FridaActivity3&#34;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>onMatch</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>instance</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//设置非静态成员变量的值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>instance</span><span class=p>.</span><span class=na>bool_var</span><span class=p>.</span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//设置有相同函数名的成员变量的值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>instance</span><span class=p>.</span><span class=na>_same_name_bool_var</span><span class=p>.</span><span class=na>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>instance</span><span class=p>.</span><span class=na>bool_var</span><span class=p>.</span><span class=na>value</span><span class=p>,</span><span class=w> </span><span class=n>instance</span><span class=p>.</span><span class=na>_same_name_bool_var</span><span class=p>.</span><span class=na>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>onComplete</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></td></tr></table></div></div><ul><li>hook内部类</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>InnerClasses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=s>&#34;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>InnerClasses</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>InnerClasses</span><span class=p>.</span><span class=na>check1</span><span class=p>.</span><span class=na>implementation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><ul><li>根据条件判断动态hook多个函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>class_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>InnerClasses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=n>class_name</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>all_methods</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InnerClasses</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getDeclaredMethods</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>all_methods</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>var</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>all_methods</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>var</span><span class=w> </span><span class=n>methodStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>method</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>var</span><span class=w> </span><span class=n>substring</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>methodStr</span><span class=p>.</span><span class=na>substr</span><span class=p>(</span><span class=n>methodStr</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=n>class_name</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>class_name</span><span class=p>.</span><span class=na>length</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>var</span><span class=w> </span><span class=n>methodname</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>substring</span><span class=p>.</span><span class=na>substr</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>substring</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=s>&#34;(&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>methodname</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>InnerClasses</span><span class=o>[</span><span class=n>methodname</span><span class=o>]</span><span class=p>.</span><span class=na>implementation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;hook_mul_function:&#34;</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>interface中的函数进行hook。需要先切换classloader</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>FridaActivity5</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=s>&#34;com.example.androiddemo.Activity.FridaActivity5&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>Java</span><span class=p>.</span><span class=na>choose</span><span class=p>(</span><span class=s>&#34;com.example.androiddemo.Activity.FridaActivity5&#34;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>onMatch</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>instance</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>instance</span><span class=p>.</span><span class=na>getDynamicDexCheck</span><span class=p>().</span><span class=na>$className</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=n>onComplete</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>Java</span><span class=p>.</span><span class=na>enumerateClassLoaders</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>onMatch</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>loader</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>loader</span><span class=p>.</span><span class=na>findClass</span><span class=p>(</span><span class=s>&#34;com.example.androiddemo.Dynamic.DynamicCheck&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>loader</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Java</span><span class=p>.</span><span class=na>classFactory</span><span class=p>.</span><span class=na>loader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>loader</span><span class=p>;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=n>onComplete</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>DynamicCheck</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=s>&#34;com.example.androiddemo.Dynamic.DynamicCheck&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>DynamicCheck</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>DynamicCheck</span><span class=p>.</span><span class=na>check</span><span class=p>.</span><span class=na>implementation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;DynamicCheck.check&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>frida动态加载dex然后再调用dex中的函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>ddex2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>openClassFile</span><span class=p>(</span><span class=s>&#34;/data/local/tmp/ddex2.dex&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>ddex2</span><span class=p>.</span><span class=na>load</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>DecodeUtils</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=s>&#34;com.example.androiddemo.DecodeUtils&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;DecodeUtils.decode_p:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>DecodeUtils</span><span class=p>.</span><span class=na>decode_p</span><span class=p>());</span></span></span></code></pre></td></tr></table></div></div><ul><li>hook构造函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5>5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6>6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=s>&#34;com.tlamb96.kgbmessenger.b.a&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//hook 构造函数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>a</span><span class=p>.</span><span class=na>$init</span><span class=p>.</span><span class=na>implementation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>str</span><span class=p>,</span><span class=w> </span><span class=n>str2</span><span class=p>,</span><span class=w> </span><span class=n>z</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>this</span><span class=p>.</span><span class=na>$init</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>str</span><span class=p>,</span><span class=w> </span><span class=n>str2</span><span class=p>,</span><span class=w> </span><span class=n>z</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;a.$init:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>str</span><span class=p>,</span><span class=w> </span><span class=n>str2</span><span class=p>,</span><span class=w> </span><span class=n>z</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>print_stack</span><span class=p>();</span><span class=w>       </span><span class=c1>//打印了调用栈</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><ul><li>打印java堆栈</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span><span class=lnt id=hl-8-5><a class=lnlinks href=#hl-8-5>5</a>
</span><span class=lnt id=hl-8-6><a class=lnlinks href=#hl-8-6>6</a>
</span><span class=lnt id=hl-8-7><a class=lnlinks href=#hl-8-7>7</a>
</span><span class=lnt id=hl-8-8><a class=lnlinks href=#hl-8-8>8</a>
</span><span class=lnt id=hl-8-9><a class=lnlinks href=#hl-8-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>print_stack</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Java</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>function</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Java</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=s>&#34;java.lang.Exception&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>instance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Exception</span><span class=p>.</span><span class=na>$new</span><span class=p>(</span><span class=s>&#34;print_stack&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>stack</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>instance</span><span class=p>.</span><span class=na>getStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>stack</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>instance</span><span class=p>.</span><span class=na>$dispose</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>调用NativeFunction来写入文件</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span><span class=lnt id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a>
</span><span class=lnt id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a>
</span><span class=lnt id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a>
</span><span class=lnt id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a>
</span><span class=lnt id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a>
</span><span class=lnt id=hl-9-17><a class=lnlinks href=#hl-9-17>17</a>
</span><span class=lnt id=hl-9-18><a class=lnlinks href=#hl-9-18>18</a>
</span><span class=lnt id=hl-9-19><a class=lnlinks href=#hl-9-19>19</a>
</span><span class=lnt id=hl-9-20><a class=lnlinks href=#hl-9-20>20</a>
</span><span class=lnt id=hl-9-21><a class=lnlinks href=#hl-9-21>21</a>
</span><span class=lnt id=hl-9-22><a class=lnlinks href=#hl-9-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>write_reg_dat2</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//把C函数定义为NativeFunction来写文件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>addr_fopen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Module</span><span class=p>.</span><span class=na>findExportByName</span><span class=p>(</span><span class=s>&#34;libc.so&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;fopen&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>addr_fputs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Module</span><span class=p>.</span><span class=na>findExportByName</span><span class=p>(</span><span class=s>&#34;libc.so&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;fputs&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>addr_fclose</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Module</span><span class=p>.</span><span class=na>findExportByName</span><span class=p>(</span><span class=s>&#34;libc.so&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;fclose&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;addr_fopen:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>addr_fopen</span><span class=p>,</span><span class=w> </span><span class=s>&#34;addr_fputs:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>addr_fputs</span><span class=p>,</span><span class=w> </span><span class=s>&#34;addr_fclose:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>addr_fclose</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>fopen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NativeFunction</span><span class=p>(</span><span class=n>addr_fopen</span><span class=p>,</span><span class=w> </span><span class=s>&#34;pointer&#34;</span><span class=p>,</span><span class=w> </span><span class=o>[</span><span class=s>&#34;pointer&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;pointer&#34;</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>fputs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NativeFunction</span><span class=p>(</span><span class=n>addr_fputs</span><span class=p>,</span><span class=w> </span><span class=s>&#34;int&#34;</span><span class=p>,</span><span class=w> </span><span class=o>[</span><span class=s>&#34;pointer&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;pointer&#34;</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>fclose</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NativeFunction</span><span class=p>(</span><span class=n>addr_fclose</span><span class=p>,</span><span class=w> </span><span class=s>&#34;int&#34;</span><span class=p>,</span><span class=w> </span><span class=o>[</span><span class=s>&#34;pointer&#34;</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>filename</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Memory</span><span class=p>.</span><span class=na>allocUtf8String</span><span class=p>(</span><span class=s>&#34;/sdcard/reg.dat&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>open_mode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Memory</span><span class=p>.</span><span class=na>allocUtf8String</span><span class=p>(</span><span class=s>&#34;w+&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fopen</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span><span class=w> </span><span class=n>open_mode</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;fopen file:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>buffer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Memory</span><span class=p>.</span><span class=na>allocUtf8String</span><span class=p>(</span><span class=s>&#34;EoPAoY62@ElRD&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fputs</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span><span class=w> </span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;fputs ret:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ret</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>fclose</span><span class=p>(</span><span class=n>file</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>将指针以字符串的方式打印</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>5</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>print_string</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>base_hello_jni</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Module</span><span class=p>.</span><span class=na>findBaseAddress</span><span class=p>(</span><span class=s>&#34;libhello-jni.so&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>addr_str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>base_hello_jni</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>addr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;addr:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>addr</span><span class=p>,</span><span class=w> </span><span class=s>&#34; &#34;</span><span class=p>,</span><span class=w> </span><span class=n>ptr</span><span class=p>(</span><span class=n>addr_str</span><span class=p>).</span><span class=na>readCString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>延时hook。当用frida来启动应用时。hook的so还没有加载。所以要延时到加载完这个so后。才能hook</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span><span class=lnt id=hl-11-15><a class=lnlinks href=#hl-11-15>15</a>
</span><span class=lnt id=hl-11-16><a class=lnlinks href=#hl-11-16>16</a>
</span><span class=lnt id=hl-11-17><a class=lnlinks href=#hl-11-17>17</a>
</span><span class=lnt id=hl-11-18><a class=lnlinks href=#hl-11-18>18</a>
</span><span class=lnt id=hl-11-19><a class=lnlinks href=#hl-11-19>19</a>
</span><span class=lnt id=hl-11-20><a class=lnlinks href=#hl-11-20>20</a>
</span><span class=lnt id=hl-11-21><a class=lnlinks href=#hl-11-21>21</a>
</span><span class=lnt id=hl-11-22><a class=lnlinks href=#hl-11-22>22</a>
</span><span class=lnt id=hl-11-23><a class=lnlinks href=#hl-11-23>23</a>
</span><span class=lnt id=hl-11-24><a class=lnlinks href=#hl-11-24>24</a>
</span><span class=lnt id=hl-11-25><a class=lnlinks href=#hl-11-25>25</a>
</span><span class=lnt id=hl-11-26><a class=lnlinks href=#hl-11-26>26</a>
</span><span class=lnt id=hl-11-27><a class=lnlinks href=#hl-11-27>27</a>
</span><span class=lnt id=hl-11-28><a class=lnlinks href=#hl-11-28>28</a>
</span><span class=lnt id=hl-11-29><a class=lnlinks href=#hl-11-29>29</a>
</span><span class=lnt id=hl-11-30><a class=lnlinks href=#hl-11-30>30</a>
</span><span class=lnt id=hl-11-31><a class=lnlinks href=#hl-11-31>31</a>
</span><span class=lnt id=hl-11-32><a class=lnlinks href=#hl-11-32>32</a>
</span><span class=lnt id=hl-11-33><a class=lnlinks href=#hl-11-33>33</a>
</span><span class=lnt id=hl-11-34><a class=lnlinks href=#hl-11-34>34</a>
</span><span class=lnt id=hl-11-35><a class=lnlinks href=#hl-11-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>hook_dlopen</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>dlopen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Module</span><span class=p>.</span><span class=na>findExportByName</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dlopen&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Interceptor</span><span class=p>.</span><span class=na>attach</span><span class=p>(</span><span class=n>dlopen</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>onEnter</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>call_hook</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>so_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr</span><span class=p>(</span><span class=n>args</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>).</span><span class=na>readCString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>so_name</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=s>&#34;libhello-jni.so&#34;</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;dlopen:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ptr</span><span class=p>(</span><span class=n>args</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>).</span><span class=na>readCString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>call_hook</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>},</span><span class=w> </span><span class=n>onLeave</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>retval</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>call_hook</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>inline_hook</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 高版本Android系统使用android_dlopen_ext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>android_dlopen_ext</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Module</span><span class=p>.</span><span class=na>findExportByName</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;android_dlopen_ext&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Interceptor</span><span class=p>.</span><span class=na>attach</span><span class=p>(</span><span class=n>android_dlopen_ext</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>onEnter</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>call_hook</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>so_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr</span><span class=p>(</span><span class=n>args</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>).</span><span class=na>readCString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>so_name</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=s>&#34;libhello-jni.so&#34;</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;android_dlopen_ext:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ptr</span><span class=p>(</span><span class=n>args</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>).</span><span class=na>readCString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>this</span><span class=p>.</span><span class=na>call_hook</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>},</span><span class=w> </span><span class=n>onLeave</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>retval</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>call_hook</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>inline_hook</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>hook获取时间的函数。并且替换函数内容</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a>
</span><span class=lnt id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a>
</span><span class=lnt id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a>
</span><span class=lnt id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a>
</span><span class=lnt id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a>
</span><span class=lnt id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a>
</span><span class=lnt id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a>
</span><span class=lnt id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a>
</span><span class=lnt id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a>
</span><span class=lnt id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a>
</span><span class=lnt id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a>
</span><span class=lnt id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a>
</span><span class=lnt id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a>
</span><span class=lnt id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a>
</span><span class=lnt id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a>
</span><span class=lnt id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a>
</span><span class=lnt id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a>
</span><span class=lnt id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a>
</span><span class=lnt id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a>
</span><span class=lnt id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a>
</span><span class=lnt id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a>
</span><span class=lnt id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a>
</span><span class=lnt id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a>
</span><span class=lnt id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a>
</span><span class=lnt id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a>
</span><span class=lnt id=hl-12-31><a class=lnlinks href=#hl-12-31>31</a>
</span><span class=lnt id=hl-12-32><a class=lnlinks href=#hl-12-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>hook_gettimeofday</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>addr_gettimeofday</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Module</span><span class=p>.</span><span class=na>findExportByName</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;gettimeofday&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>gettimeofday</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NativeFunction</span><span class=p>(</span><span class=n>addr_gettimeofday</span><span class=p>,</span><span class=w> </span><span class=s>&#34;int&#34;</span><span class=p>,</span><span class=w> </span><span class=o>[</span><span class=s>&#34;pointer&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;pointer&#34;</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=err>&#39;</span><span class=n>struct</span><span class=w> </span><span class=n>timeval</span><span class=w> </span><span class=p>{</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=err>&#39;</span><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>tv_sec</span><span class=p>;</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=err>&#39;</span><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>tv_usec</span><span class=p>;</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=err>&#39;</span><span class=p>};</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=err>&#39;</span><span class=kt>void</span><span class=w> </span><span class=nf>modify_time</span><span class=p>(</span><span class=n>struct</span><span class=w> </span><span class=n>timeval</span><span class=o>*</span><span class=w> </span><span class=n>tv</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tv_sec</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tv_usec</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=err>&#39;</span><span class=w>  </span><span class=n>tv</span><span class=o>-&gt;</span><span class=n>tv_sec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tv_sec</span><span class=p>;</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=err>&#39;</span><span class=w>  </span><span class=n>tv</span><span class=o>-&gt;</span><span class=n>tv_usec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tv_usec</span><span class=p>;</span><span class=err>&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=sc>&#39;}&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>]</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>cm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CModule</span><span class=p>(</span><span class=n>source</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>modify_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NativeFunction</span><span class=p>(</span><span class=n>cm</span><span class=p>.</span><span class=na>modify_time</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=kt>void</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=o>[</span><span class=s>&#34;pointer&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;int&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;int&#34;</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Interceptor</span><span class=p>.</span><span class=na>replace</span><span class=p>(</span><span class=n>addr_gettimeofday</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NativeCallback</span><span class=p>(</span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>ptr_tz</span><span class=p>,</span><span class=w> </span><span class=n>ptr_tzp</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gettimeofday</span><span class=p>(</span><span class=n>ptr_tz</span><span class=p>,</span><span class=w> </span><span class=n>ptr_tzp</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>result</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;hook gettimeofday:&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ptr_tz</span><span class=p>,</span><span class=w> </span><span class=n>ptr_tzp</span><span class=p>,</span><span class=w> </span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>//modify_time(ptr_tz, 0xAAAA, 0xBBBB);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Int32Array</span><span class=p>(</span><span class=n>ArrayBuffer</span><span class=p>.</span><span class=na>wrap</span><span class=p>(</span><span class=n>ptr_tz</span><span class=p>,</span><span class=w> </span><span class=n>8</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>t</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0xAAAA</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>t</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0xBBBB</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>hexdump</span><span class=p>(</span><span class=n>ptr_tz</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=s>&#34;int&#34;</span><span class=p>,</span><span class=w> </span><span class=o>[</span><span class=s>&#34;pointer&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;pointer&#34;</span><span class=o>]</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>frida打patch补丁。可以用来搞反调试的</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span><span class=lnt id=hl-13-15><a class=lnlinks href=#hl-13-15>15</a>
</span><span class=lnt id=hl-13-16><a class=lnlinks href=#hl-13-16>16</a>
</span><span class=lnt id=hl-13-17><a class=lnlinks href=#hl-13-17>17</a>
</span><span class=lnt id=hl-13-18><a class=lnlinks href=#hl-13-18>18</a>
</span><span class=lnt id=hl-13-19><a class=lnlinks href=#hl-13-19>19</a>
</span><span class=lnt id=hl-13-20><a class=lnlinks href=#hl-13-20>20</a>
</span><span class=lnt id=hl-13-21><a class=lnlinks href=#hl-13-21>21</a>
</span><span class=lnt id=hl-13-22><a class=lnlinks href=#hl-13-22>22</a>
</span><span class=lnt id=hl-13-23><a class=lnlinks href=#hl-13-23>23</a>
</span><span class=lnt id=hl-13-24><a class=lnlinks href=#hl-13-24>24</a>
</span><span class=lnt id=hl-13-25><a class=lnlinks href=#hl-13-25>25</a>
</span><span class=lnt id=hl-13-26><a class=lnlinks href=#hl-13-26>26</a>
</span><span class=lnt id=hl-13-27><a class=lnlinks href=#hl-13-27>27</a>
</span><span class=lnt id=hl-13-28><a class=lnlinks href=#hl-13-28>28</a>
</span><span class=lnt id=hl-13-29><a class=lnlinks href=#hl-13-29>29</a>
</span><span class=lnt id=hl-13-30><a class=lnlinks href=#hl-13-30>30</a>
</span><span class=lnt id=hl-13-31><a class=lnlinks href=#hl-13-31>31</a>
</span><span class=lnt id=hl-13-32><a class=lnlinks href=#hl-13-32>32</a>
</span><span class=lnt id=hl-13-33><a class=lnlinks href=#hl-13-33>33</a>
</span><span class=lnt id=hl-13-34><a class=lnlinks href=#hl-13-34>34</a>
</span><span class=lnt id=hl-13-35><a class=lnlinks href=#hl-13-35>35</a>
</span><span class=lnt id=hl-13-36><a class=lnlinks href=#hl-13-36>36</a>
</span><span class=lnt id=hl-13-37><a class=lnlinks href=#hl-13-37>37</a>
</span><span class=lnt id=hl-13-38><a class=lnlinks href=#hl-13-38>38</a>
</span><span class=lnt id=hl-13-39><a class=lnlinks href=#hl-13-39>39</a>
</span><span class=lnt id=hl-13-40><a class=lnlinks href=#hl-13-40>40</a>
</span><span class=lnt id=hl-13-41><a class=lnlinks href=#hl-13-41>41</a>
</span><span class=lnt id=hl-13-42><a class=lnlinks href=#hl-13-42>42</a>
</span><span class=lnt id=hl-13-43><a class=lnlinks href=#hl-13-43>43</a>
</span><span class=lnt id=hl-13-44><a class=lnlinks href=#hl-13-44>44</a>
</span><span class=lnt id=hl-13-45><a class=lnlinks href=#hl-13-45>45</a>
</span><span class=lnt id=hl-13-46><a class=lnlinks href=#hl-13-46>46</a>
</span><span class=lnt id=hl-13-47><a class=lnlinks href=#hl-13-47>47</a>
</span><span class=lnt id=hl-13-48><a class=lnlinks href=#hl-13-48>48</a>
</span><span class=lnt id=hl-13-49><a class=lnlinks href=#hl-13-49>49</a>
</span><span class=lnt id=hl-13-50><a class=lnlinks href=#hl-13-50>50</a>
</span><span class=lnt id=hl-13-51><a class=lnlinks href=#hl-13-51>51</a>
</span><span class=lnt id=hl-13-52><a class=lnlinks href=#hl-13-52>52</a>
</span><span class=lnt id=hl-13-53><a class=lnlinks href=#hl-13-53>53</a>
</span><span class=lnt id=hl-13-54><a class=lnlinks href=#hl-13-54>54</a>
</span><span class=lnt id=hl-13-55><a class=lnlinks href=#hl-13-55>55</a>
</span><span class=lnt id=hl-13-56><a class=lnlinks href=#hl-13-56>56</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>dis</span><span class=p>(</span><span class=n>address</span><span class=p>,</span><span class=w> </span><span class=n>number</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>number</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>ins</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Instruction</span><span class=p>.</span><span class=na>parse</span><span class=p>(</span><span class=n>address</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;address:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>address</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;--dis:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>ins</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>address</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ins</span><span class=p>.</span><span class=na>next</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>//libc-&gt;strstr()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>hook</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>//call_function(&#34;DT_INIT&#34;, init_func_, get_realpath());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>linkermodule</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Process</span><span class=p>.</span><span class=na>getModuleByName</span><span class=p>(</span><span class=s>&#34;linker&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>call_function_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>symbols</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>linkermodule</span><span class=p>.</span><span class=na>enumerateSymbols</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>symbols</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>symbol</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>symbols</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//LogPrint(linkername + &#34;-&gt;&#34; + symbol.name + &#34;---&#34; + symbol.address);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>symbol</span><span class=p>.</span><span class=na>name</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=s>&#34;__dl__ZL13call_functionPKcPFviPPcS2_ES0_&#34;</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>call_function_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>symbol</span><span class=p>.</span><span class=na>address</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>//LogPrint(&#34;linker-&gt;&#34; + symbol.name + &#34;---&#34; + symbol.address)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Interceptor</span><span class=p>.</span><span class=na>attach</span><span class=p>(</span><span class=n>call_function_addr</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>onEnter</span><span class=p>:</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr</span><span class=p>(</span><span class=n>args</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>).</span><span class=na>readUtf8String</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>address</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>args</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>var</span><span class=w> </span><span class=n>sopath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ptr</span><span class=p>(</span><span class=n>args</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=p>).</span><span class=na>readUtf8String</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;loadso:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sopath</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;--addr:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>address</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;--type:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>type</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>sopath</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=s>&#34;libnative-lib.so&#34;</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>var</span><span class=w> </span><span class=n>libnativemodule</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Process</span><span class=p>.</span><span class=na>getModuleByName</span><span class=p>(</span><span class=s>&#34;libnative-lib.so&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>var</span><span class=w> </span><span class=n>base</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>libnativemodule</span><span class=p>.</span><span class=na>base</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>dis</span><span class=p>(</span><span class=n>base</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>0x8D8E</span><span class=p>).</span><span class=na>add</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>var</span><span class=w> </span><span class=n>patchaddr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>base</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>0x8d96</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Memory</span><span class=p>.</span><span class=na>patchCode</span><span class=p>(</span><span class=n>patchaddr</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>,</span><span class=w> </span><span class=n>patchaddr</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kd>var</span><span class=w> </span><span class=n>cw</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ThumbWriter</span><span class=p>(</span><span class=n>patchaddr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>cw</span><span class=p>.</span><span class=na>putNop</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>cw</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ThumbWriter</span><span class=p>(</span><span class=n>patchaddr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>0x2</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>cw</span><span class=p>.</span><span class=na>putNop</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>cw</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=cm>/*                Memory.protect(base.add(0x8d96),4,&#39;rwx&#39;);
</span></span></span><span class=line><span class=cl><span class=cm>                                base.add(0x8d96).writeByteArray([0x00,0xbf,0x00,0xbf]);*/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;+++++++++++++++++++++++&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>dis</span><span class=p>(</span><span class=n>base</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>0x8D8E</span><span class=p>).</span><span class=na>add</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;----------------------&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>dis</span><span class=p>(</span><span class=n>base</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>0x8E6E</span><span class=p>).</span><span class=na>add</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Memory</span><span class=p>.</span><span class=na>protect</span><span class=p>(</span><span class=n>base</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>0x8E78</span><span class=p>),</span><span class=w> </span><span class=n>4</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>rwx</span><span class=err>&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>base</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>0x8E78</span><span class=p>).</span><span class=na>writeByteArray</span><span class=p>(</span><span class=o>[</span><span class=n>0x00</span><span class=p>,</span><span class=w> </span><span class=n>0xbf</span><span class=p>,</span><span class=w> </span><span class=n>0x00</span><span class=p>,</span><span class=w> </span><span class=n>0xbf</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;+++++++++++++++++++++++&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>dis</span><span class=p>(</span><span class=n>base</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>0x8E6E</span><span class=p>).</span><span class=na>add</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>用stalker来trace</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28>28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29>29</a>
</span><span class=lnt id=hl-14-30><a class=lnlinks href=#hl-14-30>30</a>
</span><span class=lnt id=hl-14-31><a class=lnlinks href=#hl-14-31>31</a>
</span><span class=lnt id=hl-14-32><a class=lnlinks href=#hl-14-32>32</a>
</span><span class=lnt id=hl-14-33><a class=lnlinks href=#hl-14-33>33</a>
</span><span class=lnt id=hl-14-34><a class=lnlinks href=#hl-14-34>34</a>
</span><span class=lnt id=hl-14-35><a class=lnlinks href=#hl-14-35>35</a>
</span><span class=lnt id=hl-14-36><a class=lnlinks href=#hl-14-36>36</a>
</span><span class=lnt id=hl-14-37><a class=lnlinks href=#hl-14-37>37</a>
</span><span class=lnt id=hl-14-38><a class=lnlinks href=#hl-14-38>38</a>
</span><span class=lnt id=hl-14-39><a class=lnlinks href=#hl-14-39>39</a>
</span><span class=lnt id=hl-14-40><a class=lnlinks href=#hl-14-40>40</a>
</span><span class=lnt id=hl-14-41><a class=lnlinks href=#hl-14-41>41</a>
</span><span class=lnt id=hl-14-42><a class=lnlinks href=#hl-14-42>42</a>
</span><span class=lnt id=hl-14-43><a class=lnlinks href=#hl-14-43>43</a>
</span><span class=lnt id=hl-14-44><a class=lnlinks href=#hl-14-44>44</a>
</span><span class=lnt id=hl-14-45><a class=lnlinks href=#hl-14-45>45</a>
</span><span class=lnt id=hl-14-46><a class=lnlinks href=#hl-14-46>46</a>
</span><span class=lnt id=hl-14-47><a class=lnlinks href=#hl-14-47>47</a>
</span><span class=lnt id=hl-14-48><a class=lnlinks href=#hl-14-48>48</a>
</span><span class=lnt id=hl-14-49><a class=lnlinks href=#hl-14-49>49</a>
</span><span class=lnt id=hl-14-50><a class=lnlinks href=#hl-14-50>50</a>
</span><span class=lnt id=hl-14-51><a class=lnlinks href=#hl-14-51>51</a>
</span><span class=lnt id=hl-14-52><a class=lnlinks href=#hl-14-52>52</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>hook_native</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>base_addr</span><span class=o>=</span><span class=n>Module</span><span class=p>.</span><span class=na>getBaseAddress</span><span class=p>(</span><span class=s>&#34;libnative-lib.so&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>encodeFromJni_71</span><span class=o>=</span><span class=n>base_addr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>0x156B4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Interceptor</span><span class=p>.</span><span class=na>attach</span><span class=p>(</span><span class=n>encodeFromJni_71</span><span class=p>,{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>onEnter</span><span class=p>:</span><span class=n>function</span><span class=p>(</span><span class=n>args</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>tid</span><span class=o>=</span><span class=n>Process</span><span class=p>.</span><span class=na>getCurrentThreadId</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;enter encodeFromJni_71 tid:&#34;</span><span class=p>,</span><span class=k>this</span><span class=p>.</span><span class=na>tid</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Stalker</span><span class=p>.</span><span class=na>follow</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>tid</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>events</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>call</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=c1>// CALL instructions: yes please</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c1>// Other events:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ret</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=c1>// RET instructions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>exec</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=c1>// all instructions: not recommended as it&#39;s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                 </span><span class=c1>//                   a lot of data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>block</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=c1>// block executed: coarse execution trace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>compile</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=c1>// block compiled: useful for coverage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>onCallSummary</span><span class=p>:</span><span class=n>function</span><span class=p>(</span><span class=n>summary</span><span class=p>){</span><span class=w>        </span><span class=c1>//调用的地址和调用的次数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>for</span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>iter</span><span class=w> </span><span class=n>in</span><span class=w> </span><span class=n>summary</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kd>var</span><span class=w> </span><span class=n>module</span><span class=o>=</span><span class=w> </span><span class=n>Process</span><span class=p>.</span><span class=na>getModuleByAddress</span><span class=p>(</span><span class=n>ptr</span><span class=p>(</span><span class=n>iter</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>if</span><span class=p>(</span><span class=n>module</span><span class=p>.</span><span class=na>name</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=s>&#34;libnative-lib.so&#34;</span><span class=p>)</span><span class=o>!=-</span><span class=n>1</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>ptr</span><span class=p>(</span><span class=n>iter</span><span class=p>).</span><span class=na>sub</span><span class=p>(</span><span class=n>module</span><span class=p>.</span><span class=na>base</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>onReceive</span><span class=p>:</span><span class=n>function</span><span class=p>(</span><span class=n>events</span><span class=p>){</span><span class=w>             </span><span class=c1>//调用的流程，地址1是哪里发生的调用。地址2是调用到了哪里</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=s>&#34;enter onReceive&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kd>var</span><span class=w> </span><span class=n>eventsData</span><span class=o>=</span><span class=n>Stalker</span><span class=p>.</span><span class=na>parse</span><span class=p>(</span><span class=n>events</span><span class=p>,{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>annotate</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>stringify</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>for</span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>idx</span><span class=w> </span><span class=n>in</span><span class=w> </span><span class=n>eventsData</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kd>var</span><span class=w> </span><span class=n>dataSp</span><span class=o>=</span><span class=n>eventsData</span><span class=o>[</span><span class=n>idx</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kd>var</span><span class=w> </span><span class=n>addr1</span><span class=o>=</span><span class=n>dataSp</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=kd>var</span><span class=w> </span><span class=n>addr2</span><span class=o>=</span><span class=n>dataSp</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=k>try</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=kd>var</span><span class=w> </span><span class=n>module1</span><span class=o>=</span><span class=n>Process</span><span class=p>.</span><span class=na>getModuleByAddress</span><span class=p>(</span><span class=n>ptr</span><span class=p>(</span><span class=n>addr1</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=k>if</span><span class=p>(</span><span class=n>module1</span><span class=p>.</span><span class=na>name</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=s>&#34;libnative-lib.so&#34;</span><span class=p>)</span><span class=o>!=-</span><span class=n>1</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=kd>var</span><span class=w> </span><span class=n>module2</span><span class=o>=</span><span class=n>Process</span><span class=p>.</span><span class=na>getModuleByAddress</span><span class=p>(</span><span class=n>ptr</span><span class=p>(</span><span class=n>addr2</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>dataSp</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>,</span><span class=n>module1</span><span class=p>.</span><span class=na>name</span><span class=p>,</span><span class=n>addr1</span><span class=p>,</span><span class=n>module2</span><span class=p>.</span><span class=na>name</span><span class=p>,</span><span class=n>addr2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=k>catch</span><span class=p>(</span><span class=n>err</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=n>dataSp</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>},</span><span class=n>onLeave</span><span class=p>(</span><span class=n>retval</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Stalker</span><span class=p>.</span><span class=na>unfollow</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>tid</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>比较通用的native函数hook打印</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1> 1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2> 2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3> 3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4> 4</a>
</span><span class=lnt id=hl-15-5><a class=lnlinks href=#hl-15-5> 5</a>
</span><span class=lnt id=hl-15-6><a class=lnlinks href=#hl-15-6> 6</a>
</span><span class=lnt id=hl-15-7><a class=lnlinks href=#hl-15-7> 7</a>
</span><span class=lnt id=hl-15-8><a class=lnlinks href=#hl-15-8> 8</a>
</span><span class=lnt id=hl-15-9><a class=lnlinks href=#hl-15-9> 9</a>
</span><span class=lnt id=hl-15-10><a class=lnlinks href=#hl-15-10>10</a>
</span><span class=lnt id=hl-15-11><a class=lnlinks href=#hl-15-11>11</a>
</span><span class=lnt id=hl-15-12><a class=lnlinks href=#hl-15-12>12</a>
</span><span class=lnt id=hl-15-13><a class=lnlinks href=#hl-15-13>13</a>
</span><span class=lnt id=hl-15-14><a class=lnlinks href=#hl-15-14>14</a>
</span><span class=lnt id=hl-15-15><a class=lnlinks href=#hl-15-15>15</a>
</span><span class=lnt id=hl-15-16><a class=lnlinks href=#hl-15-16>16</a>
</span><span class=lnt id=hl-15-17><a class=lnlinks href=#hl-15-17>17</a>
</span><span class=lnt id=hl-15-18><a class=lnlinks href=#hl-15-18>18</a>
</span><span class=lnt id=hl-15-19><a class=lnlinks href=#hl-15-19>19</a>
</span><span class=lnt id=hl-15-20><a class=lnlinks href=#hl-15-20>20</a>
</span><span class=lnt id=hl-15-21><a class=lnlinks href=#hl-15-21>21</a>
</span><span class=lnt id=hl-15-22><a class=lnlinks href=#hl-15-22>22</a>
</span><span class=lnt id=hl-15-23><a class=lnlinks href=#hl-15-23>23</a>
</span><span class=lnt id=hl-15-24><a class=lnlinks href=#hl-15-24>24</a>
</span><span class=lnt id=hl-15-25><a class=lnlinks href=#hl-15-25>25</a>
</span><span class=lnt id=hl-15-26><a class=lnlinks href=#hl-15-26>26</a>
</span><span class=lnt id=hl-15-27><a class=lnlinks href=#hl-15-27>27</a>
</span><span class=lnt id=hl-15-28><a class=lnlinks href=#hl-15-28>28</a>
</span><span class=lnt id=hl-15-29><a class=lnlinks href=#hl-15-29>29</a>
</span><span class=lnt id=hl-15-30><a class=lnlinks href=#hl-15-30>30</a>
</span><span class=lnt id=hl-15-31><a class=lnlinks href=#hl-15-31>31</a>
</span><span class=lnt id=hl-15-32><a class=lnlinks href=#hl-15-32>32</a>
</span><span class=lnt id=hl-15-33><a class=lnlinks href=#hl-15-33>33</a>
</span><span class=lnt id=hl-15-34><a class=lnlinks href=#hl-15-34>34</a>
</span><span class=lnt id=hl-15-35><a class=lnlinks href=#hl-15-35>35</a>
</span><span class=lnt id=hl-15-36><a class=lnlinks href=#hl-15-36>36</a>
</span><span class=lnt id=hl-15-37><a class=lnlinks href=#hl-15-37>37</a>
</span><span class=lnt id=hl-15-38><a class=lnlinks href=#hl-15-38>38</a>
</span><span class=lnt id=hl-15-39><a class=lnlinks href=#hl-15-39>39</a>
</span><span class=lnt id=hl-15-40><a class=lnlinks href=#hl-15-40>40</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//打印参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>hexdumpMem</span><span class=p>(</span><span class=n>addr</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>Process</span><span class=p>.</span><span class=na>findRangeByAddress</span><span class=p>(</span><span class=n>addr</span><span class=p>)){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>hexdump</span><span class=p>(</span><span class=n>ptr</span><span class=p>(</span><span class=n>addr</span><span class=p>),{</span><span class=n>length</span><span class=p>:</span><span class=n>0x40</span><span class=p>})</span><span class=o>+</span><span class=s>&#34;\r\n&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=k>else</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ptr</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span><span class=o>+</span><span class=s>&#34;\r\n&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>//比较通用的hook地址并且打印5个参数。如果参数是地址就打印下内存信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>nativeHookFunction</span><span class=p>(</span><span class=n>addr</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>base_addr</span><span class=o>=</span><span class=n>Module</span><span class=p>.</span><span class=na>getBaseAddress</span><span class=p>(</span><span class=s>&#34;libnative-lib.so&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>hook_addr</span><span class=o>=</span><span class=n>base_addr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>addr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Interceptor</span><span class=p>.</span><span class=na>attach</span><span class=p>(</span><span class=n>hook_addr</span><span class=p>,{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>onEnter</span><span class=p>:</span><span class=n>function</span><span class=p>(</span><span class=n>args</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=o>=[]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;call&#34;</span><span class=p>,</span><span class=n>addr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>arg0</span><span class=o>=</span><span class=n>args</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>arg1</span><span class=o>=</span><span class=n>args</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>arg2</span><span class=o>=</span><span class=n>args</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>arg3</span><span class=o>=</span><span class=n>args</span><span class=o>[</span><span class=n>3</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>arg4</span><span class=o>=</span><span class=n>args</span><span class=o>[</span><span class=n>4</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>arg5</span><span class=o>=</span><span class=n>args</span><span class=o>[</span><span class=n>5</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg0:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg0</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg1:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg1</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg2:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg2</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg3:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg3</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg4:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg4</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg5:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg5</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>},</span><span class=n>onLeave</span><span class=p>:</span><span class=n>function</span><span class=p>(</span><span class=n>retval</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg0 leave:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg0</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg1 leave:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg1</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg2 leave:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg2</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg3 leave:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg3</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg4 leave:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg4</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;arg5 leave:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>arg5</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>.</span><span class=na>push</span><span class=p>(</span><span class=s>&#34;retval leave:&#34;</span><span class=p>,</span><span class=n>hexdumpMem</span><span class=p>(</span><span class=n>retval</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>console</span><span class=p>.</span><span class=na>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>logs</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ul><li>Frida打印java中的byte数组</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1> 1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2> 2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3> 3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4> 4</a>
</span><span class=lnt id=hl-16-5><a class=lnlinks href=#hl-16-5> 5</a>
</span><span class=lnt id=hl-16-6><a class=lnlinks href=#hl-16-6> 6</a>
</span><span class=lnt id=hl-16-7><a class=lnlinks href=#hl-16-7> 7</a>
</span><span class=lnt id=hl-16-8><a class=lnlinks href=#hl-16-8> 8</a>
</span><span class=lnt id=hl-16-9><a class=lnlinks href=#hl-16-9> 9</a>
</span><span class=lnt id=hl-16-10><a class=lnlinks href=#hl-16-10>10</a>
</span><span class=lnt id=hl-16-11><a class=lnlinks href=#hl-16-11>11</a>
</span><span class=lnt id=hl-16-12><a class=lnlinks href=#hl-16-12>12</a>
</span><span class=lnt id=hl-16-13><a class=lnlinks href=#hl-16-13>13</a>
</span><span class=lnt id=hl-16-14><a class=lnlinks href=#hl-16-14>14</a>
</span><span class=lnt id=hl-16-15><a class=lnlinks href=#hl-16-15>15</a>
</span><span class=lnt id=hl-16-16><a class=lnlinks href=#hl-16-16>16</a>
</span><span class=lnt id=hl-16-17><a class=lnlinks href=#hl-16-17>17</a>
</span><span class=lnt id=hl-16-18><a class=lnlinks href=#hl-16-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>function</span><span class=w> </span><span class=nf>Bytes2HexString</span><span class=p>(</span><span class=n>arrBytes</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=n>str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>var</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>arrBytes</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>tmp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=n>num</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>arrBytes</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>num</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>//此处填坑，当byte因为符合位导致数值为负时候，需要对数据进行处理</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>tmp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>255</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>num</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>).</span><span class=na>toString</span><span class=p>(</span><span class=n>16</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>tmp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>num</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>16</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>tmp</span><span class=p>.</span><span class=na>length</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>tmp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;0&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>tmp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>str</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>tmp</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><div class=post-button><a class=btn href=/post/the-small-ways-often-use-frida/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/c-round-to-n-decimal-places/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="c++四舍五入到小数点后N位"><meta itemprop=description content="

1
2
3
4
5
6


double round(double value, unsigned int decimal_places) {
    double multiplier = 1.00;
    if (decimal_places > 0)
        multiplier = std::pow(10, decimal_places);
    return std::floor(value * multiplier + 0.5) / multiplier;
}

"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/c-round-to-n-decimal-places/ itemprop=url class=post-title-link>c++四舍五入到小数点后N位</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年04月08日 18:12:10 CST" itemprop="dateCreated datePublished" datetime="2023-04-08 18:12:10 +0800 +0800">2023年04月08日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/c-round-to-n-decimal-places/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>double</span> <span class=nf>round</span><span class=p>(</span><span class=kt>double</span> <span class=n>value</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>decimal_places</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>multiplier</span> <span class=o>=</span> <span class=mf>1.00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>decimal_places</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>multiplier</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>pow</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=n>decimal_places</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>floor</span><span class=p>(</span><span class=n>value</span> <span class=o>*</span> <span class=n>multiplier</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>/</span> <span class=n>multiplier</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><div class=post-button><a class=btn href=/post/c-round-to-n-decimal-places/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/c-cpp-hide-symbol/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="C/C++程序隐藏符号"><meta itemprop=description content='使用visibility




 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23


#if defined _WIN32 || defined __CYGWIN__
    #ifdef MY_NO_EXPORT
        #define API
    #else
        #define API __declspec(dllexport)
    #endif
#else
    #ifdef __GNUC__
        #define API  __attribute__((visibility("default")))
    #else
        #define API
    #endif
#endif

#if defined __cplusplus
    #define EXTERN extern "C"
#else
    #include <stdarg.h>
    #include <stdbool.h>
    #define EXTERN extern
#endif

#define MY_API EXTERN API



GNU C 的一大特色就是attribute 机制。
试想这样的情景，程序调用某函数A，A函数存在于两个动态链接库liba.so，libb.so中，并且程序执行需要链接这两个库，此时程序调用的A函数到底是来自于a还是b呢？
这取决于链接时的顺序，比如先链接liba.so，这时候通过liba.so的导出符号表就可以找到函数A的定义，并加入到符号表中，链接libb.so的时候，符号表中已经存在函数A，就不会再更新符号表，所以调用的始终是liba.so中的A函数。
为了避免这种混乱，所以使用'></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/c-cpp-hide-symbol/ itemprop=url class=post-title-link>C/C++程序隐藏符号</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023年02月23日 11:09:43 CST" itemprop="dateCreated datePublished" datetime="2023-02-23 11:09:43 +0800 +0800">2023年02月23日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/c-cpp-hide-symbol/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><h2 id=使用visibility>使用<code>visibility</code>
<a class=header-anchor href=#%e4%bd%bf%e7%94%a8visibility></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span><span class=lnt id=hl-0-23><a class=lnlinks href=#hl-0-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#if defined _WIN32 || defined __CYGWIN__
</span></span></span><span class=line><span class=cl>    <span class=cp>#ifdef MY_NO_EXPORT
</span></span></span><span class=line><span class=cl>        <span class=cp>#define API
</span></span></span><span class=line><span class=cl>    <span class=cp>#else
</span></span></span><span class=line><span class=cl>        <span class=cp>#define API __declspec(dllexport)
</span></span></span><span class=line><span class=cl>    <span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl>    <span class=cp>#ifdef __GNUC__
</span></span></span><span class=line><span class=cl>        <span class=cp>#define API  __attribute__((visibility(&#34;default&#34;)))
</span></span></span><span class=line><span class=cl>    <span class=cp>#else
</span></span></span><span class=line><span class=cl>        <span class=cp>#define API
</span></span></span><span class=line><span class=cl>    <span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#if defined __cplusplus
</span></span></span><span class=line><span class=cl>    <span class=cp>#define EXTERN extern &#34;C&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl>    <span class=cp>#include</span> <span class=cpf>&lt;stdarg.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl>    <span class=cp>#include</span> <span class=cpf>&lt;stdbool.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl>    <span class=cp>#define EXTERN extern
</span></span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#define MY_API EXTERN API</span></span></span></code></pre></td></tr></table></div></div><p>GNU C 的一大特色就是attribute 机制。
试想这样的情景，程序调用某函数A，A函数存在于两个动态链接库liba.so，libb.so中，并且程序执行需要链接这两个库，此时程序调用的A函数到底是来自于a还是b呢？
这取决于链接时的顺序，比如先链接liba.so，这时候通过liba.so的导出符号表就可以找到函数A的定义，并加入到符号表中，链接libb.so的时候，符号表中已经存在函数A，就不会再更新符号表，所以调用的始终是liba.so中的A函数。
为了避免这种混乱，所以使用</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/c-cpp-hide-symbol/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><nav class=pagination><a class="extend prev" rel=prev href=/page/4/><i class="fa fa-angle-left"></i>
</a><a class=page-number href=/>1</a>
<a class=page-number href=/page/2/>2</a>
<a class=page-number href=/page/3/>3</a>
<a class=page-number href=/page/4/>4</a>
<span class="page-number current">5</span>
<a class=page-number href=/page/6/>6</a>
<a class=page-number href=/page/7/>7</a>
<a class=page-number href=/page/8/>8</a>
<a class=page-number href=/page/9/>9</a>
<a class="extend next" rel=next href=/page/6/><i class="fa fa-angle-right"></i></a></nav></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2026
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.157.0 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":true,"isPage":false,"path":"blogs.qipai360.cn","permalink":"https://blogs.qipai360.cn/","title":"Rise的自留地","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1772265585" defer></script></body></html>