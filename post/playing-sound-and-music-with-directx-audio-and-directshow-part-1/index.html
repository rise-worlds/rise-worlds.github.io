<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（1）"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="用DirectX Audio和DirectShow播放声音和音乐（1）"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-1/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2007-07-26 17:51:00 +0800 +0800"><meta property="article:modified_time" content="2007-08-27 17:19:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1761990628"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>用DirectX Audio和DirectShow播放声音和音乐（1） - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>678</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>678</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2418817></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5198></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-01 14:55:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-1/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（1）"><meta itemprop=description content="音乐就是一系列的音符，这些音符在不同的时间用不同的幅度被播放或者停止。有非常多的指令被用来播放音乐，但是这些指令的操作基本相同，都在使用各种各样不同的音符。在计算机上进行作曲，实际上是存储了很多组音乐，回放时由音频硬件将这些音符播放出来。Midi格式（文件扩展名是.MID）是存储数字音乐的标准格式。DirectMusic 音乐片段（music segments）使用.SGT文件扩展名，其他的相关文件包括乐队文件（band file .BND），这种文件里面包含乐器信息；弦映射表文件（chordmaps file .CDM）包含在回放时修改音乐的和弦指令；样式文件（styles file .STY）包含回放样式信息；模板文件（templates file .TPL）包含创造音乐片段的模板。Midi是一种非常强大的音乐格式，惟一的不利因素是音乐品质依赖于音乐合成器的性能，因为Midi 仅仅记录了音符，其播放的品质由播放音乐的软硬件决定。MP3文件（文件后缀为.MP3）是一种类似于波表文件的文件格式，但是MP3文件和WAV文件最大的区别在于MP3文件将声音压缩到了最小的程度，但是音质却基本不变。可以用DirectShow组件播放MP3文件，DirectShow组件是一个非常强大的多媒体组件，用DirectShow几乎可以播放任何媒体文件，包括声音和音频文件，部分声音文件我们只能用DirectShow播放。 Direct Audio是一个复合组件，它由DirectSound和DirectMusic两个组件组成，DirectMusic在DirectX8中得到了巨大的增强，但是DirectSound基本保持原有的状态。DirectSound是主要的数字声音回放组件。DirectMusic处理所有的乐曲格式，包括MIDI、DirectMusic本地格式文件和波表文件。DirectMusic处理完之后将它们送入DirectSound中做其他处理，这意味着回放MIDI的时候可以使用数字化的乐器。使用DirectSound使用时需要创建一个和声卡通讯的COM对象，用这个COM对象再创造一些独立的声音数据缓冲区（被称之为辅助音频缓冲区 secondary sound buffers）来存储音频数据。缓冲区中的这些数据在主混音缓存（称之为主音频缓存 primary sound buffer）中被混合，然后可以用指定的任何格式播放出来。回放格式通过采样频率、声道数、采样精度排列，可能的采样频率有8000HZ， 11025HZ，22050HZ和44100HZ（CD音质）。对于声道数可以有两个选择：单通道的单声道声音和双通道的立体声声音。采样精度被限制在两种选择上：8位的低质量声音和16位的高保真声音。在没有修改的情况下，DirectSound主缓冲区的默认设置是22025HZ采样率、8位精度、立体声。在DirectSound中可以调整声音的播放速度（这同样会改变声音的音调），调整音量。循环播放等。甚至还可以在一个虚拟的3D环境中播放，以模拟一个实际环绕在周围的声音。需要做的是将声音数据充满缓冲区，如果声音数据太大的话，必须创建流播放方法，加载声音数据中的一小块，当这一小块播放完毕以后，再加载另外的小块数据进缓冲区，一直持续这个过程，直到声音被处理完毕。在缓冲区中调整播放位置可以实现流式音频，当播放完成通知应用程序更新音频数据。这个通知更新的过程我们称之为“通告”。在同一时间被播放的缓存数目虽然没有限制，但是仍然需要保证缓冲区数目不要太多，因为每增加一个缓冲区，就要消耗很多内存和CPU资源。在项目中使用DirectSound和DirectMusic，需要添加头文件dsound.h和dmsuic.h，并且需要链接DSound.lib到包含库中，添加DXGuid.lib库可以让DirectSound更容易使用。以下是DirectSound COM接口：IDirectSound8：DirectSound接口。IDirectSoundBuffer8：主缓冲区和辅助缓冲区接口，保存数据并控制回放。IDirectSoundNotify8：通知对象，通知应用程序指定播放位置已经达到。IDirectSound8是主接口，用它来创建缓冲区（IDirectSoundBuffer8），然后用缓冲区接口创建通告接口（IDirectSoundNotify8），通告接口告诉应用程序指定的位置已经到达，通告接口在流化音频文件时非常有用。初始化DirectSound使用 DirectSound的第一步是创建IDirectSound8对象，IDirectSound8起到控制音频硬件设备的作用，可以通过 DirectSoundCreate8函数来创建。"></span><header class=post-header><h1 class=post-title itemprop="name headline">用DirectX Audio和DirectShow播放声音和音乐（1）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月26日 17:51:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-26 17:51:00 +0800 +0800">2007年07月26日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:19:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:19:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>5548</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>12分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-1/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>音乐就是一系列的音符，这些音符在不同的时间用不同的幅度被播放或者停止。有非常多的指令被用来播放音乐，但是这些指令的操作基本相同，都在使用各种各样不同的音符。在计算机上进行作曲，实际上是存储了很多组音乐，回放时由音频硬件将这些音符播放出来。<br><br>Midi格式（文件扩展名是.MID）是存储数字音乐的标准格式。<br><br>DirectMusic 音乐片段（music segments）使用.SGT文件扩展名，其他的相关文件包括乐队文件（band file .BND），这种文件里面包含乐器信息；弦映射表文件（chordmaps file .CDM）包含在回放时修改音乐的和弦指令；样式文件（styles file .STY）包含回放样式信息；模板文件（templates file .TPL）包含创造音乐片段的模板。<br><br>Midi是一种非常强大的音乐格式，惟一的不利因素是音乐品质依赖于音乐合成器的性能，因为Midi 仅仅记录了音符，其播放的品质由播放音乐的软硬件决定。MP3文件（文件后缀为.MP3）是一种类似于波表文件的文件格式，但是MP3文件和WAV文件最大的区别在于MP3文件将声音压缩到了最小的程度，但是音质却基本不变。可以用DirectShow组件播放MP3文件，DirectShow组件是一个非常强大的多媒体组件，用DirectShow几乎可以播放任何媒体文件，包括声音和音频文件，部分声音文件我们只能用DirectShow播放。<br><br>Direct Audio是一个复合组件，它由DirectSound和DirectMusic两个组件组成，DirectMusic在DirectX8中得到了巨大的增强，但是DirectSound基本保持原有的状态。DirectSound是主要的数字声音回放组件。DirectMusic处理所有的乐曲格式，包括MIDI、DirectMusic本地格式文件和波表文件。DirectMusic处理完之后将它们送入DirectSound中做其他处理，这意味着回放MIDI的时候可以使用数字化的乐器。<br><br><span style=font-weight:700;color:#2c3076>使用DirectSound</span><br><br>使用时需要创建一个和声卡通讯的COM对象，用这个COM对象再创造一些独立的声音数据缓冲区（被称之为辅助音频缓冲区 secondary sound buffers）来存储音频数据。缓冲区中的这些数据在主混音缓存（称之为主音频缓存 primary sound buffer）中被混合，然后可以用指定的任何格式播放出来。回放格式通过采样频率、声道数、采样精度排列，可能的采样频率有8000HZ， 11025HZ，22050HZ和44100HZ（CD音质）。<br><br>对于声道数可以有两个选择：单通道的单声道声音和双通道的立体声声音。采样精度被限制在两种选择上：8位的低质量声音和16位的高保真声音。在没有修改的情况下，DirectSound主缓冲区的默认设置是22025HZ采样率、8位精度、立体声。在DirectSound中可以调整声音的播放速度（这同样会改变声音的音调），调整音量。循环播放等。甚至还可以在一个虚拟的3D环境中播放，以模拟一个实际环绕在周围的声音。<br><br>需要做的是将声音数据充满缓冲区，如果声音数据太大的话，必须创建流播放方法，加载声音数据中的一小块，当这一小块播放完毕以后，再加载另外的小块数据进缓冲区，一直持续这个过程，直到声音被处理完毕。在缓冲区中调整播放位置可以实现流式音频，当播放完成通知应用程序更新音频数据。这个通知更新的过程我们称之为“通告”。在同一时间被播放的缓存数目虽然没有限制，但是仍然需要保证缓冲区数目不要太多，因为每增加一个缓冲区，就要消耗很多内存和CPU资源。<br><br>在项目中使用DirectSound和DirectMusic，需要添加头文件dsound.h和dmsuic.h，并且需要链接DSound.lib到包含库中，添加DXGuid.lib库可以让DirectSound更容易使用。<br><br>以下是DirectSound COM接口：<br><br>IDirectSound8：DirectSound接口。<br>IDirectSoundBuffer8：主缓冲区和辅助缓冲区接口，保存数据并控制回放。<br>IDirectSoundNotify8：通知对象，通知应用程序指定播放位置已经达到。<br><br>IDirectSound8是主接口，用它来创建缓冲区（IDirectSoundBuffer8），然后用缓冲区接口创建通告接口（IDirectSoundNotify8），通告接口告诉应用程序指定的位置已经到达，通告接口在流化音频文件时非常有用。<br><br><span style=font-weight:700;color:#2c3076>初始化DirectSound</span><br><br>使用 DirectSound的第一步是创建IDirectSound8对象，IDirectSound8起到控制音频硬件设备的作用，可以通过 DirectSoundCreate8函数来创建。<br></p><a id=more></a><p style=font-family:Arial><font style=font-size:11pt></font></p><font style=font-size:11pt>The DirectSoundCreate8 function creates and initializes an object that supports the IDirectSound8 interface.</font><span style=font-size:12pt><span style=font-size:10pt><pre class=syntax style=font-family:arial><font style=font-size:11pt><strong>HRESULT DirectSoundCreate8(</strong><br> <strong>LPCGUID</strong> <em>lpcGuidDevice</em><strong>,</strong><br> <strong>LPDIRECTSOUND8 *</strong> <em>ppDS8</em><strong>,</strong><br> <strong>LPUNKNOWN</strong> <em>pUnkOuter</em><br><strong>);</strong></font></pre><h4 style=font-family:Arial><font style=font-size:11pt>Parameters</font></h4><dl style=font-family:Arial><dt><font style=font-size:11pt><em>lpcGuidDevice</em></font><dd><font style=font-size:11pt>Address of the GUID that identifies the sound device. The value of this parameter must be one of the GUIDs returned by DirectSoundEnumerate, or NULL for the default device, or one of the following values.</font><p>&nbsp;</p><table style=border-collapse:collapse bordercolor=#808080 cellspacing=1 border=1><tbody><tr><th bgcolor=#e2e2e2><font style=font-size:11pt>Value</font></th><th bgcolor=#e2e2e2><font style=font-size:11pt>Description</font></th></tr><tr><td><font style=font-size:11pt>DSDEVID_DefaultPlayback</font></td><td><font style=font-size:11pt>System-wide default audio playback device. Equivalent to NULL.</font></td></tr><tr><td><font style=font-size:11pt>DSDEVID_DefaultVoicePlayback</font></td><td><font style=font-size:11pt>Default voice playback device.</font></td></tr></tbody></table><p></p><dt><font style=font-size:11pt><em>ppDS8</em></font><dd><font style=font-size:11pt>Address of a variable to receive an <strong>IDirectSound8</strong> interface pointer.</font><dt><font style=font-size:11pt><em>pUnkOuter</em></font><dd><font style=font-size:11pt>Address of the controlling object's IUnknown interface for COM aggregation. Must be NULL, because aggregation is not supported.</font></dd></dl><h4 style=font-family:Arial><font style=font-size:11pt>Return Values</font></h4><p style=font-family:Arial><font style=font-size:11pt>If the function succeeds, it returns DS_OK. If it fails, the return value may be one of the following.</font></p><p style=font-family:Arial><font style=font-size:11pt><br></font></p><table style=font-family:arial;border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><th bgcolor=#e2e2e2><font style=font-size:11pt>Return Code</font></th></tr><tr><td><font style=font-size:11pt>DSERR_ALLOCATED</font></td></tr><tr><td><font style=font-size:11pt>DSERR_INVALIDPARAM</font></td></tr><tr><td><font style=font-size:11pt>DSERR_NOAGGREGATION</font></td></tr><tr><td><font style=font-size:11pt>DSERR_NODRIVER</font></td></tr><tr><td><font style=font-size:11pt>DSERR_OUTOFMEMORY</font></td></tr></tbody></table><h4 style=font-family:Arial><font style=font-size:11pt>Remarks</font></h4><p style=font-family:Arial><font style=font-size:11pt>The application must call the IDirectSound8::SetCooperativeLevel method immediately after creating a device object.</font></p></span><p style=font-family:Arial><font style=font-size:11pt></font></p></span><p style=font-family:Arial><font style=font-size:11pt></font></p><span style=font-weight:700;color:#2c3076>创建主音频缓冲区</span><br><br>用 IDirectSoundBuffer对象控制主音频缓冲区，创建主缓冲区不需要DirectX8的接口，因为这个接口从来没有改变。用来创建音频缓冲区的函数是IDirectSound8::CreateSoundBuffer。<br><br><p><font style=font-size:11pt face=微软雅黑>The CreateSoundBuffer method creates a sound buffer object to manage audio samples.</font></p><pre class=syntax><font style=font-size:11pt face=微软雅黑><strong>HRESULT CreateSoundBuffer(</strong><br> <strong>LPCDSBUFFERDESC</strong> <em>pcDSBufferDesc</em><strong>,</strong><br> <strong>LPDIRECTSOUNDBUFFER *</strong> <em>ppDSBuffer</em><strong>,</strong><br> <strong>LPUNKNOWN</strong> <em>pUnkOuter</em><br><strong>);</strong></font></pre><h4><font style=font-size:11pt face=微软雅黑>Parameters</font></h4><dl><dt><font style=font-size:11pt face=微软雅黑><em>pcDSBufferDesc</em></font><dd><font style=font-size:11pt face=微软雅黑>Address of a DSBUFFERDESC structure that describes the sound buffer to create.</font><dt><font style=font-size:11pt face=微软雅黑><em>ppDSBuffer</em></font><dd><font style=font-size:11pt face=微软雅黑>Address of a variable that receives the IDirectSoundBuffer interface of the new buffer object. Use QueryInterface to obtain IDirectSoundBuffer8. IDirectSoundBuffer8 is not available for the primary buffer.</font><dt><font style=font-size:11pt face=微软雅黑><em>pUnkOuter</em></font><dd><font style=font-size:11pt face=微软雅黑>Address of the controlling object's IUnknown interface for COM aggregation. Must be NULL.</font></dd></dl><h4><font style=font-size:11pt face=微软雅黑>Return Values</font></h4><p><font style=font-size:11pt face=微软雅黑>If the method succeeds, the return value is DS_OK, or DS_NO_VIRTUALIZATION if a requested 3D algorithm was not available and stereo panning was substituted. See the description of the guid3DAlgorithm member of <strong>DSBUFFERDESC</strong>. If the method fails, the return value may be one of the error values shown in the following table.</font></p><p><font style=font-size:11pt face=微软雅黑><br></font></p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=微软雅黑>Return code</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSERR_ALLOCATED</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_BADFORMAT</strong></font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_BUFFERTOOSMALL</strong></font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_CONTROLUNAVAIL</strong></font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_DS8_REQUIRED</strong></font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_INVALIDCALL</strong></font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_INVALIDPARAM</strong></font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_NOAGGREGATION</strong></font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_OUTOFMEMORY</strong></font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_UNINITIALIZED</strong></font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑><strong>DSERR_UNSUPPORTED</strong></font></td></tr></tbody></table><h4><font style=font-size:11pt face=微软雅黑>Remarks</font></h4><p><font style=font-size:11pt face=微软雅黑>DirectSound does not initialize the contents of the buffer, and the application cannot assume that it contains silence.</font></p><p><font style=font-size:11pt face=微软雅黑>If an attempt is made to create a buffer with the DSBCAPS_LOCHARDWARE flag on a system where hardware acceleration is not available, the method fails with either DSERR_CONTROLUNAVAIL or DSERR_INVALIDCALL, depending on the operating system.</font></p><font style=font-size:11pt face=微软雅黑><em></em></font><br>pcDSBufferDesc是一个指向DSBUFFERDESC结构的指针，保存所创建的缓冲区的信息。<br><br><p><font style=font-size:11pt face=微软雅黑>The DSBUFFERDESC structure describes the characteristics of a new buffer object. It is used by the IDirectSound8::CreateSoundBuffer method and by the DirectSoundFullDuplexCreate8 function.</font></p><p><font style=font-size:11pt face=微软雅黑>An earlier version of this structure, DSBUFFERDESC1, is maintained in Dsound.h for compatibility with DirectX 7 and earlier.</font></p><pre class=syntax><font style=font-size:11pt face=微软雅黑>typedef struct DSBUFFERDESC {<br> DWORD dwSize;<br> DWORD dwFlags;<br> DWORD dwBufferBytes;<br> DWORD dwReserved;<br> LPWAVEFORMATEX lpwfxFormat;<br> GUID guid3DAlgorithm;<br>} DSBUFFERDESC;</font></pre><h4><font style=font-size:11pt face=微软雅黑>Members</font></h4><dl><dt><font style=font-size:11pt face=微软雅黑><strong>dwSize</strong></font><dd><font style=font-size:11pt face=微软雅黑>Size of the structure, in bytes. This member must be initialized before the structure is used.</font><dt><font style=font-size:11pt face=微软雅黑><strong>dwFlags</strong></font><dd><font style=font-size:11pt face=微软雅黑>Flags specifying the capabilities of the buffer. See the <strong>dwFlags</strong> member of the DSBCAPS structure for a detailed listing of valid flags.</font><dt><font style=font-size:11pt face=微软雅黑><strong>dwBufferBytes</strong></font><dd><font style=font-size:11pt face=微软雅黑>Size of the new buffer, in bytes. This value must be 0 when creating a buffer with the DSBCAPS_PRIMARYBUFFER flag. For secondary buffers, the minimum and maximum sizes allowed are specified by DSBSIZE_MIN and DSBSIZE_MAX, defined in Dsound.h.</font><dt><font style=font-size:11pt face=微软雅黑><strong>dwReserved</strong></font><dd><font style=font-size:11pt face=微软雅黑>Reserved. Must be 0.</font><dt><font style=font-size:11pt face=微软雅黑><strong>lpwfxFormat</strong></font><dd><font style=font-size:11pt face=微软雅黑>Address of a WAVEFORMATEX or WAVEFORMATEXTENSIBLE structure specifying the waveform format for the buffer. This value must be NULL for primary buffers.</font><dt><font style=font-size:11pt face=微软雅黑><strong>guid3DAlgorithm</strong></font><dd><font style=font-size:11pt face=微软雅黑>Unique identifier of the two-speaker virtualization algorithm to be used by DirectSound3D hardware emulation. If DSBCAPS_CTRL3D is not set in dwFlags, this member must be GUID_NULL (DS3DALG_DEFAULT). The following algorithm identifiers are defined.</font><p>&nbsp;</p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><th bgcolor=#c0c0c0><font style=font-size:11pt face=微软雅黑>Value</font></th><th bgcolor=#c0c0c0><font style=font-size:11pt face=微软雅黑>Description</font></th><th bgcolor=#c0c0c0><font style=font-size:11pt face=微软雅黑>Availability</font></th></tr><tr><td><font style=font-size:11pt face=微软雅黑>DS3DALG_DEFAULT</font></td><td><font style=font-size:11pt face=微软雅黑>DirectSound uses the default algorithm. In most cases this is DS3DALG_NO_VIRTUALIZATION. On WDM drivers, if the user has selected a surround sound speaker configuration in Control Panel, the sound is panned among the available directional speakers.</font></td><td><font style=font-size:11pt face=微软雅黑>Applies to software mixing only. Available on WDM or Vxd Drivers.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DS3DALG_NO_VIRTUALIZATION</font></td><td><font style=font-size:11pt face=微软雅黑>3D output is mapped onto normal left and right stereo panning. At 90 degrees to the left, the sound is coming out of only the left speaker; at 90 degrees to the right, sound is coming out of only the right speaker. The vertical axis is ignored except for scaling of volume due to distance. Doppler shift and volume scaling are still applied, but the 3D filtering is not performed on this buffer. This is the most efficient software implementation, but provides no virtual 3D audio effect. When the DS3DALG_NO_VIRTUALIZATION algorithm is specified, HRTF processing will not be done. Because DS3DALG_NO_VIRTUALIZATION uses only normal stereo panning, a buffer created with this algorithm may be accelerated by a 2D hardware voice if no free 3D hardware voices are available.</font></td><td><font style=font-size:11pt face=微软雅黑>Applies to software mixing only. Available on WDM or Vxd Drivers.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DS3DALG_HRTF_FULL</font></td><td><font style=font-size:11pt face=微软雅黑>The 3D API is processed with the high quality 3D audio algorithm. This algorithm gives the highest quality 3D audio effect, but uses more CPU cycles. See Remarks.</font></td><td><font style=font-size:11pt face=微软雅黑>Applies to software mixing only. Available on Microsoft Windows 98 Second Edition and later operating systems when using WDM drivers.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DS3DALG_HRTF_LIGHT</font></td><td><font style=font-size:11pt face=微软雅黑>The 3D API is processed with the efficient 3D audio algorithm. This algorithm gives a good 3D audio effect, but uses fewer CPU cycles than DS3DALG_HRTF_FULL.</font></td><td><font style=font-size:11pt face=微软雅黑>Applies to software mixing only. Available on Windows 98 Second Edition and later operating systems when using WDM drivers.</font></td></tr></tbody></table></dd></dl><br>需要设置的惟一一个值是dwFlags，这是一系列标志，用于决定缓冲区性能。<br><dl><dt><font style=font-size:11pt face=微软雅黑><strong>dwFlags</strong></font><dd><font style=font-size:11pt face=微软雅黑>Flags that specify buffer-object capabilities. Use one or more of the values shown in the following table.</font><p>&nbsp;</p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><th bgcolor=#c0c0c0><font style=font-size:11pt face=微软雅黑>Value</font></th><th bgcolor=#c0c0c0><font style=font-size:11pt face=微软雅黑>Description</font></th></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_CTRL3D</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer has 3D control capability.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_CTRLFREQUENCY</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer has frequency control capability.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_CTRLFX</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer supports effects processing.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_CTRLPAN</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer has pan control capability.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_CTRLVOLUME</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer has volume control capability.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_CTRLPOSITIONNOTIFY</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer has position notification capability. See the Remarks for DSCBUFFERDESC.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_GETCURRENTPOSITION2</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer uses the new behavior of the play cursor when IDirectSoundBuffer8::GetCurrentPosition is called. In the first version of DirectSound, the play cursor was significantly ahead of the actual playing sound on emulated sound cards; it was directly behind the write cursor. Now, if the DSBCAPS_GETCURRENTPOSITION2 flag is specified, the application can get a more accurate play cursor. If this flag is not specified, the old behavior is preserved for compatibility. This flag affects only emulated devices; if a DirectSound driver is present, the play cursor is accurate for DirectSound in all versions of DirectX.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_GLOBALFOCUS</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer is a global sound buffer. With this flag set, an application using DirectSound can continue to play its buffers if the user switches focus to another application, even if the new application uses DirectSound. The one exception is if you switch focus to a DirectSound application that uses the DSSCL_WRITEPRIMARY flag for its cooperative level. In this case, the global sounds from other applications will not be audible.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_LOCDEFER</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer can be assigned to a hardware or software resource at play time, or when IDirectSoundBuffer8::AcquireResources is called.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_LOCHARDWARE</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer uses hardware mixing.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_LOCSOFTWARE</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer is in software memory and uses software mixing.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_MUTE3DATMAXDISTANCE</font></td><td><font style=font-size:11pt face=微软雅黑>The sound is reduced to silence at the maximum distance. The buffer will stop playing when the maximum distance is exceeded, so that processor time is not wasted. Applies only to software buffers.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_PRIMARYBUFFER</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer is a primary buffer.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_STATIC</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer is in on-board hardware memory.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_STICKYFOCUS</font></td><td><font style=font-size:11pt face=微软雅黑>The buffer has sticky focus. If the user switches to another application not using DirectSound, the buffer is still audible. However, if the user switches to another DirectSound application, the buffer is muted.</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSBCAPS_TRUEPLAYPOSITION</font></td><td><font style=font-size:11pt face=微软雅黑>Force IDirectSoundBuffer8::GetCurrentPosition to return the buffer's true play position. This flag is only valid in Windows Vista.</font></td></tr></tbody></table></dd></dl><span style=color:#2c3076><span style=color:#000>以下是创建声音缓冲区的代码:</span><br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>&nbsp;&nbsp;&nbsp; //</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;DSBUFFERDESC&nbsp;structure</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DSBUFFERDESC&nbsp;ds_buffer_desc;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;zero&nbsp;out&nbsp;strcutre</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_desc,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DSBUFFERDESC));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DSBUFFERDESC);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwFlags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DSBCAPS_CTRLVOLUME;<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwBufferBytes&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_format.nAvgBytesPerSec&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#000>2</span><span style=color:#000>;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;2&nbsp;seconds</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.lpwfxFormat&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>&</span><span style=color:#000>wave_format;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;fist&nbsp;version&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_ds</span><span style=color:#000>-></span><span style=color:#000>CreateSoundBuffer(</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_desc,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>ds,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;error&nbsp;ocuurred</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Unable&nbsp;to&nbsp;create&nbsp;sound&nbsp;buffer</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;}</span></div></span><span style=font-weight:700;color:#2c3076><br>设置格式</span><br><br><font color=#2b2b2b>对于格式，有一系列的选择，但是建议在11025HZ、16位、单通道；22050HZ、16位、单通道中选择。选择格式的时候，不要尝试使用立体声，立体声浪费处理时间，而且效果很难评估。同样也不要使用16位以外的采样精度，因为这会导致音质的大幅下降。对于采样频率来说，越高越好，但是也不要设置超过22050HZ，在这个采样频率下，也能表现出CD音质的水准而没有太多的损失。<br><br>设置回放格式需要通过调用 IDirectSoundBuffer::SetFormat。<br><br></font><p><font style=font-size:11pt face=微软雅黑>The SetFormat method sets the format of the primary buffer. Whenever this application has the input focus, DirectSound will set the primary buffer to the specified format.</font></p><pre class=syntax><font style=font-size:11pt face=微软雅黑><strong>HRESULT SetFormat(</strong><br> <strong>LPCWAVEFORMATEX</strong> <em>pcfxFormat</em><br><strong>);</strong></font></pre><h4><font style=font-size:11pt face=微软雅黑>Parameters</font></h4><dl><dt><font style=font-size:11pt face=微软雅黑><em>pcfxFormat</em></font><dd><font style=font-size:11pt face=微软雅黑>Address of a WAVEFORMATEX structure that describes the new format for the primary sound buffer.</font></dd></dl><h4><font style=font-size:11pt face=微软雅黑>Return Values</font></h4><p><font style=font-size:11pt face=微软雅黑>If the method succeeds, the return value is DS_OK. If the method fails, the return value may be one of the following error values:</font></p><p><font style=font-size:11pt face=微软雅黑><br></font></p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=微软雅黑>Return code</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSERR_BADFORMAT</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSERR_INVALIDCALL</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSERR_INVALIDPARAM</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSERR_OUTOFMEMORY</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSERR_PRIOLEVELNEEDED</font></td></tr><tr><td><font style=font-size:11pt face=微软雅黑>DSERR_UNSUPPORTED</font></td></tr></tbody></table><h4><font style=font-size:11pt face=微软雅黑>Remarks</font></h4><p><font style=font-size:11pt face=微软雅黑>The format of the primary buffer should be set before secondary buffers are created.</font></p><p><font style=font-size:11pt face=微软雅黑>The method fails if the application has the DSSCL_NORMAL cooperative level.</font></p><p><font style=font-size:11pt face=微软雅黑>If the application is using DirectSound at the DSSCL_WRITEPRIMARY cooperative level, and the format is not supported, the method fails.</font></p><p><font style=font-size:11pt face=微软雅黑>If the cooperative level is DSSCL_PRIORITY, DirectSound stops the primary buffer, changes the format, and restarts the buffer. The method succeeds even if the hardware does not support the requested format; DirectSound sets the buffer to the closest supported format. To determine whether this has happened, an application can call the GetFormat method for the primary buffer and compare the result with the format that was requested with the SetFormat method.</font></p><p><font style=font-size:11pt face=微软雅黑>This method is not available for secondary sound buffers. If a new format is required, the application must create a new DirectSoundBuffer object.</font></p><br>这个函数惟一的参数是指向WAVEFORMATEX结构的指针，该结构保存已设置的格式信息。<br><br><p><font style=font-size:11pt face=微软雅黑>The WAVEFORMATEX structure defines the format of waveform-audio data. Only format information common to all waveform-audio data formats is included in this structure. For formats that require additional information, this structure is included as the first member in another structure, along with the additional information.</font></p><p><font style=font-size:11pt face=微软雅黑>This structure is part of the Platform SDK and is not declared in Dsound.h. It is documented here for convenience.</font></p><pre class=syntax><font style=font-size:11pt face=微软雅黑>typedef struct WAVEFORMATEX {<br> WORD wFormatTag;<br> WORD nChannels;<br> DWORD nSamplesPerSec;<br> DWORD nAvgBytesPerSec;<br> WORD nBlockAlign;<br> WORD wBitsPerSample;<br> WORD cbSize;<br>} WAVEFORMATEX;</font></pre><h4><font style=font-size:11pt face=微软雅黑>Members</font></h4><dl><dt><font style=font-size:11pt face=微软雅黑><strong>wFormatTag</strong></font><dd><font style=font-size:11pt face=微软雅黑>Waveform-audio format type. Format tags are registered with Microsoft Corporation for many compression algorithms. A complete list of format tags can be found in the Mmreg.h header file. For one- or two-channel PCM data, this value should be WAVE_FORMAT_PCM.</font><dt><font style=font-size:11pt face=微软雅黑><strong>nChannels</strong></font><dd><font style=font-size:11pt face=微软雅黑>Number of channels in the waveform-audio data. Monaural data uses one channel and stereo data uses two channels.</font><dt><font style=font-size:11pt face=微软雅黑><strong>nSamplesPerSec</strong></font><dd><font style=font-size:11pt face=微软雅黑>Sample rate, in samples per second (hertz). If wFormatTag is WAVE_FORMAT_PCM, then common values for nSamplesPerSec are 8.0 kHz, 11.025 kHz, 22.05 kHz, and 44.1 kHz. For non-PCM formats, this member must be computed according to the manufacturer's specification of the format tag.</font><dt><font style=font-size:11pt face=微软雅黑><strong>nAvgBytesPerSec</strong></font><dd><font style=font-size:11pt face=微软雅黑>Required average data-transfer rate, in bytes per second, for the format tag. If wFormatTag is WAVE_FORMAT_PCM, nAvgBytesPerSec should be equal to the product of nSamplesPerSec and nBlockAlign. For non-PCM formats, this member must be computed according to the manufacturer's specification of the format tag.</font><dt><font style=font-size:11pt face=微软雅黑><strong>nBlockAlign</strong></font><dd><font style=font-size:11pt face=微软雅黑>Block alignment, in bytes. The block alignment is the minimum atomic unit of data for the wFormatTag format type. If wFormatTag is WAVE_FORMAT_PCM or WAVE_FORMAT_EXTENSIBLE, nBlockAlign must be equal to the product of nChannels and wBitsPerSample divided by 8 (bits per byte). For non-PCM formats, this member must be computed according to the manufacturer's specification of the format tag.</font><p><font style=font-size:11pt face=微软雅黑>Software must process a multiple of nBlockAlign bytes of data at a time. Data written to and read from a device must always start at the beginning of a block. For example, it is illegal to start playback of PCM data in the middle of a sample (that is, on a non-block-aligned boundary).</font></p><dt><font style=font-size:11pt face=微软雅黑><strong>wBitsPerSample</strong></font><dd><font style=font-size:11pt face=微软雅黑>Bits per sample for the wFormatTag format type. If wFormatTag is WAVE_FORMAT_PCM, then wBitsPerSample should be equal to 8 or 16. For non-PCM formats, this member must be set according to the manufacturer's specification of the format tag. If wFormatTag is WAVE_FORMAT_EXTENSIBLE, this value can be any integer multiple of 8. Some compression schemes cannot define a value for wBitsPerSample, so this member can be zero.</font><dt><font style=font-size:11pt face=微软雅黑><strong>cbSize</strong></font><dd><font style=font-size:11pt face=微软雅黑>Size, in bytes, of extra format information appended to the end of the WAVEFORMATEX structure. This information can be used by non-PCM formats to store extra attributes for the wFormatTag. If no extra information is required by the wFormatTag, this member must be set to zero. For WAVE_FORMAT_PCM formats (and only WAVE_FORMAT_PCM formats), this member is ignored.</font></dd></dl>以下设置音频格式为：11025HZ、单通道、16位。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;WAVEFORMATEX&nbsp;structure</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;WAVEFORMATEX&nbsp;wave_format;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>wave_format,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WAVEFORMATEX));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.wFormatTag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;WAVE_FORMAT_PCM;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nChannels&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;mono</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nSamplesPerSec&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>11025</span><span style=color:#000>;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.wBitsPerSample&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nBlockAlign&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(wave_format.wBitsPerSample&nbsp;</span><span style=color:#000>/</span><span style=color:#000>&nbsp;</span><span style=color:#000>8</span><span style=color:#000>)&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;wave_format.nChannels;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nAvgBytesPerSec&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_format.nSamplesPerSec&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;wave_format.nBlockAlign;</span></div></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
用DirectX Audio和DirectShow播放声音和音乐（1）</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-1/ title="用DirectX Audio和DirectShow播放声音和音乐（1）">https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-1/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-2/ rel=next title="用DirectX Audio和DirectShow播放声音和音乐（2）"><i class="fa fa-chevron-left"></i> 用DirectX Audio和DirectShow播放声音和音乐（2）</a></div><div class="post-nav-prev post-nav-item"><a href=/post/introduction-to-mmorpg-development/ rel=prev title=MMORPG开发入门[转]>MMORPG开发入门[转]
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"playing-sound-and-music-with-directx-audio-and-directshow-part-1","permalink":"https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-1/","title":"用DirectX Audio和DirectShow播放声音和音乐（1）","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1761990624" defer></script></body></html>