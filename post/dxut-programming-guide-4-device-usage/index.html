<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="【转贴】DXUT编程指南(四):通过DXUT使用设备"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="【转贴】DXUT编程指南(四):通过DXUT使用设备"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/dxut-programming-guide-4-device-usage/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2007-08-31 15:14:00 +0800 +0800"><meta property="article:modified_time" content="2007-08-31 15:15:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1761990627"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>【转贴】DXUT编程指南(四):通过DXUT使用设备 - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>678</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>678</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2418817></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5198></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-01 14:55:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/dxut-programming-guide-4-device-usage/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="【转贴】DXUT编程指南(四):通过DXUT使用设备"><meta itemprop=description content="通过DXUT使用设备 DirectX设备的创建在DXUT中得到了改进。你可以让你的应用程序直接创建设备而其它有框架提供的特征仍然可用。创建设备选择最佳的设备设置修改可用的设备设置降为软件顶点处理使用你自己的设备
创建设备 典型地，你将通过标准的Direct3D方法创建设备HRESULT CreateDevice(&nbsp;&nbsp;&nbsp; UINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Adapter,&nbsp;&nbsp;&nbsp; D3DDEVTYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DeviceType,&nbsp;&nbsp;&nbsp; HWND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hFocusWindow,&nbsp;&nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BehaviorFlags,&nbsp;&nbsp;&nbsp; D3DPRESENT_PARAMETERS *pPresentationParameters,&nbsp;&nbsp;&nbsp; IDirect3DDevice9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **ppReturnedDeviceInterface);这个方法需要有效的适配器，设备类型(HAL or REF),窗口句柄，行为标志(software/hardware vertex processing 和其它驱动标志)，以及呈现参数(presentation parameters).此外，D3DPRESENT_PARAMETER结构体还拥有大量的成员指定后备缓冲区，多重采样设定，交换效果，窗口模式，深度模版缓冲，刷新率，呈现间隔，以及呈现标志。为所有这些参数选择有效的设定是具有挑战性的。框架通过DXUTCreateDevice函数简化了这一选择过程。HRESULT DXUTCreateDevice(&nbsp;&nbsp;&nbsp; UINT AdapterOrdinal&nbsp; = D3DADAPTER_DEFAULT,&nbsp;&nbsp;&nbsp; BOOL bWindowed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = TRUE,&nbsp;&nbsp;&nbsp; INT nSuggestedWidth&nbsp; = 640,&nbsp;&nbsp;&nbsp; INT nSuggestedHeight = 480,&nbsp;&nbsp;&nbsp; LPDXUTCALLBACKISDEVICEACCEPTABLE pCallbackIsDeviceAcceptable&nbsp;&nbsp;&nbsp;&nbsp; = NULL,&nbsp;&nbsp;&nbsp; LPDXUTCALLBACKMODIFYDEVICESETTINGS pCallbackModifyDeviceSettings = NULL);最基本的用法是全部使用缺省参数调用：DXUTCreateDevice();通过这样的调用框架使用缺省设置创建一个在大多数情况下可用的设备。缺省的设置如下：



Direct3D Creation Flag
Description
Default Value from DXUTCreateDevice

AdapterFormat parameter of CheckDeviceFormat
Adapter surface format.
Desktop display mode, or D3DFMT_X8R8G8B8 if the desktop display mode is less than 32 bits.

Adapter parameter of IDirect3D9::CreateDevice
Display adapter ordinal.
D3DADAPTER_DEFAULT 

D3DPRESENT_PARAMETERS. BackBufferCount
Number of back buffers.
2, indicating triple buffering.

D3DPRESENT_PARAMETERS. BackBufferFormat
Back buffer format.
Desktop display mode, or D3DFMT_X8R8G8B8 if the desktop display mode is less than 32 bits.

D3DPRESENT_PARAMETERS. AutoDepthStencilFormat
Depth format of the automatic depth-stencil surface that the device will create.
D3DFMT_D16 if the backbuffer format is 16 bits or less, or D3DFMT_D32 otherwise.

The DeviceType parameter of IDirect3D9::CreateDevice
Enumerated type of the device.
D3DDEVTYPE_HAL if available, otherwise D3DDEVTYPE_REF or failure code if neither is available.

D3DPRESENT_PARAMETERS. MultiSampleQuality
Quality level.
MultiSampleQuality = 0, indicating multisampling is disabled.

D3DPRESENT_PARAMETERS. Flags
Presentation parameters flags.
D3DPRESENTFLAG_DISCARD_DEPTHSTENCIL 

D3DPRESENT_PARAMETERS. PresentationInterval
Presentation interval.
D3DPRESENT_INTERVAL_IMMEDIATE for windowed mode, or D3DPRESENT_INTERVAL_DEFAULT for full-screen mode.

D3DPRESENT_PARAMETERS. FullScreen_RefreshRateInHz
Rate at which the display adapter refreshes the screen.
0, indicating windowed mode.

D3DPRESENT_PARAMETERS. BackBufferWidth and .BackBufferHeight
Display mode resolution.
640 x 480 pixels for windowed mode, or the desktop resolution for full-screen mode.

D3DPRESENT_PARAMETERS. AutoDepthStencilFormat
Stencil format of the automatic depth-stencil surface that the device will create.
D3DFMT_D16 if the backbuffer format is 16 bits or less, or D3DFMT_D32 otherwise.

D3DPRESENT_PARAMETERS. SwapEffect
Swap effect.
D3DSWAPEFFECT_DISCARD

BehaviorFlags parameter of IDirect3D9::CreateDevice
Vertex processing flags.
D3DCREATE_HARDWARE_VERTEXPROCESSING if supported, otherwise D3DCREATE_SOFTWARE_VERTEXPROCESSING.

D3DPRESENT_PARAMETERS. Windowed
Windowed or full-screen mode.
true, indicating windowed mode.

hFocusWindow parameter of CreateDevice
Handle to the created window (see Using Application Windows with DXUT).
hWndFocus parameter of DXUTSetWindow

D3DPRESENT_PARAMETERS. hDeviceWindow
Handle to the device window.
hWndDeviceFullScreen or hWndDeviceWindowed parameters of DXUTSetWindow

D3DPRESENT_PARAMETERS. EnableAutoDepthStencil
Depth-stencil buffer creation flag.
true.应用程序可以通过参数传递给CreateDevice来更多的控制设备的创建，这将比使用缺省的方式更好。例如，你可以通过nSuggestedWidth and nSuggestedHeight参数改变窗口的尺寸。DXUTCreateDevice(&nbsp;&nbsp;&nbsp; D3DADAPTER_DEFAULT,&nbsp;&nbsp;&nbsp; false,&nbsp;&nbsp;&nbsp; 1024,&nbsp;&nbsp;&nbsp; 786,&nbsp;&nbsp;&nbsp; NULL,&nbsp;&nbsp;&nbsp; NULL,&nbsp;&nbsp;&nbsp; NULL);要得到更多的控制权，应用程序可以使用这两个可选的回调函数，LPDXUTCALLBACKISDEVICEACCEPTABLE and LPDXUTCALLBACKMODIFYDEVICESETTINGS.
选择最佳的设备设置你可以使用IsDeviceAcceptable回调函数帮助框架为你的应用程序选择最佳的设备设置，就像下面的代码：bool CALLBACK IsDeviceAcceptable(D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps,D3DFORMAT&nbsp;&nbsp;&nbsp;&nbsp; AdapterFormat,D3DFORMAT&nbsp;&nbsp;&nbsp;&nbsp; BackBufferFormat,bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bWindowed,void*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pUserContext ){&nbsp;&nbsp;&nbsp; // TODO: return true for acceptable settings and false otherwise.&nbsp;&nbsp;&nbsp; return true;}这个回调函数的模型基于LPDXUTCALLBACKISDEVICEACCEPTABLE原型(This callback function is modeled on the prototype LPDXUTCALLBACKISDEVICEACCEPTABLE)，框架为每个唯一的以下5个设置的有效组合调用这个函数一次：D3DDEVTYPE DeviceType;UINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AdapterOrdinal;D3DFORMAT&nbsp; AdapterFormat;D3DFORMAT&nbsp; BackBufferFormat;bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Windowed;注意适配器序号和设备类型没有直接的传入回调函数，而是分别作为D3DCAPS9结构体的成员。通过这个回调函数，应用程序可以拒绝任何它不支持的或不想要的组合。例如，应用程序可以使用下面的代码拒绝16bits的后备缓冲区格式和所有至少不能支持像素着色器PS_2_0的设备： bool CALLBACK IsDeviceAcceptable(&nbsp;&nbsp;&nbsp; D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps,&nbsp;&nbsp;&nbsp; D3DFORMAT&nbsp;&nbsp;&nbsp;&nbsp; AdapterFormat,&nbsp;&nbsp;&nbsp; D3DFORMAT&nbsp;&nbsp;&nbsp;&nbsp; BackBufferFormat,&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bWindowed ){&nbsp;&nbsp;&nbsp; if( pCaps->PixelShaderVersion < D3DPS_VERSION(2,0) )&nbsp;&nbsp;&nbsp;&nbsp; return false;&nbsp;&nbsp;&nbsp; if( BackBufferFormat == D3DFMT_X1R5G5B5 || BackBufferFormat == D3DFMT_R5G6B5 )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;&nbsp;&nbsp;&nbsp; return true;}
为每个唯一的组合调用回调函数后，框架排列剩下的可用组合，并选择它们当中最好的。排名较高的如下：D3DDEVTYPE_HAL，获取硬件加速如果应用程序以全屏模式显示，框架更趋向于使用匹配桌面格式的适配器格式，这样可以在全屏与窗口之间快速切换。例外的是，如果桌面显示模式小于32位，框架更趋向于D3DFMT_X8R8G8B8.匹配适配器格式的后备缓冲区格式在选择了这些排名高的组合后，要创建设备，行为标志和呈现参数仍然是需要的。对于这些设置,Direct3D使用上面表中的缺省值。
修改可用的设备设置应用程序可以通过使用第二个可选的回调函数修改对框架可用的设置，这个函数是ModifyDeviceSettings:bool CALLBACK ModifyDeviceSettings(&nbsp;&nbsp;&nbsp; DXUTDeviceSettings* pDeviceSettings,&nbsp;&nbsp;&nbsp; const D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps ){&nbsp;&nbsp;&nbsp; // TODO: Include device creation requirements here.&nbsp; &nbsp;&nbsp;&nbsp; // 返回真创建设备返回False保持当前设置&nbsp;&nbsp;&nbsp; return true;}这个函数是基于原型LPDXUTCALLBACKMODIFYDEVICESETTINGS的。DXUTDeviceSettings结构体被框架定义为：struct DXUTDeviceSettings{&nbsp;&nbsp;&nbsp; UINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AdapterOrdinal;&nbsp;&nbsp;&nbsp; D3DDEVTYPE DeviceType;&nbsp;&nbsp;&nbsp; D3DFORMAT&nbsp; AdapterFormat;&nbsp;&nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BehaviorFlags;&nbsp;&nbsp;&nbsp; D3DPRESENT_PARAMETERS pp;};
这个结构体包含了创建设备所需要的所有东西，除了窗口句柄,它被假定为先前创建的窗口的句柄。框架用有效的数据填充这个结构体，然后允许应用程序通过ModifyDeviceSettings回调函数改变设备创建的选择。在这个回调函数中，应用程序可以在DXUTDeviceSettings结构体中改变行为标志以及呈现参数,乃至结构体中任何其它的东西。如果应用程序在回调函数中什么都不改变，设备会成功的创建。然而，对设备创建设置的任何改变都需要被设备支持，否则可能会导致设备创建失败。比如，如果应用程序需要一个D3DFMT_D24S8的深度模板缓冲区格式，就必须验证设备是否支持，就像下面的代码：bool CALLBACK ModifyDeviceSettings(&nbsp;&nbsp;&nbsp; DXUTDeviceSettings* pDeviceSettings,&nbsp;&nbsp;&nbsp; const D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps ){&nbsp;&nbsp;&nbsp; IDirect3D9* pD3D = DXUTGetD3DObject();&nbsp;&nbsp;&nbsp; if( SUCCEEDED( pD3D->CheckDeviceFormat(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->AdapterOrdinal,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->DeviceType,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->AdapterFormat,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D3DUSAGE_DEPTHSTENCIL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D3DRTYPE_SURFACE,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D3DFMT_D24S8 ) ) )&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp; if( SUCCEEDED( pD3D->CheckDepthStencilMatch(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->AdapterOrdinal,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->DeviceType,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->AdapterFormat,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->pp.BackBufferFormat,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D3DFMT_D24S8 ) ) )&nbsp;&nbsp;&nbsp; &nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->pp.AutoDepthStencilFormat = D3DFMT_D24S8;&nbsp;&nbsp;&nbsp; &nbsp;}&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return true;}
候选的方案是，回调函数可以使用框架的CD3DEnumeration 对象验证D3DFMT_D24S8是否被支持：&nbsp;bool CALLBACK ModifyDeviceSettings(&nbsp;&nbsp;&nbsp; DXUTDeviceSettings* pDeviceSettings,&nbsp;&nbsp;&nbsp; const D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps ){&nbsp;&nbsp;&nbsp; CD3DEnumeration *pEnum = DXUTGetEnumeration();&nbsp;&nbsp;&nbsp; CD3DEnumDeviceSettingsCombo *pCombo;&nbsp;&nbsp;&nbsp;&nbsp; pCombo = pEnum->GetDeviceSettingsCombo( pDeviceSettings );&nbsp;&nbsp;&nbsp;&nbsp; if( pCombo->depthStencilFormatList.Contains( D3DFMT_D24S8 ) )&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->pp.AutoDepthStencilFormat = D3DFMT_D24S8;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return true;}
应用程序修改了设备的设置后，框架就会用新的设置创建设备。DirectX April 2005 SDK Update中的更新，ModifyDeviceSettings 回调函数返回了一个bool值。如果应用程序返回true框架继续正常的创建设备。如果返回false框架不改变设备并且保持当前的设备，如果已经有一个存在的话。这允许应用程序能够拒绝框架将设备改变到程序不能使用的请求。例如，在多监视器的缺省配置下，在监视器之间拖动窗口会导致框架改变设备。然而，如果应用程序不能使用其它的设备的话，它应当可以拒绝改变，并继续使用当前的设备。
回降到软件顶点处理如果你设置一个Direct3D设备到支持像素处理却不支持顶点处理的硬件，你会因此需要改变行为标志。为了确保正确地降到软件顶点处理，谨防你不能拒绝一个基于IsDeviceAcceptable回调函数中顶点着色器版本的设备，并确保行为标志在ModifyDeviceSettings 回调函数中被正确调整。这儿有一个例子演示怎样做这些事情。bool CALLBACK ModifyDeviceSettings( DXUTDeviceSettings* pDeviceSettings, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const D3DCAPS9* pCaps ){&nbsp;&nbsp;&nbsp; // If device doesn't support HW T&amp;L or doesn't support 1.1 vertex &nbsp;&nbsp;&nbsp; // shaders in HW, then switch to SWVP.&nbsp;&nbsp;&nbsp; if( (pCaps->DevCaps & D3DDEVCAPS_HWTRANSFORMANDLIGHT) == 0 ||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pCaps->VertexShaderVersion < D3DVS_VERSION(1,1) )&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->BehaviorFlags = D3DCREATE_SOFTWARE_VERTEXPROCESSING;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; else&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->BehaviorFlags = D3DCREATE_HARDWARE_VERTEXPROCESSING;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return true; }
使用你自己的设备你没有必要依赖于框架来创建Direct3D设备。应用程序自己可以创建设备并将他传递给框架使用。就像应用程序可以覆盖框架的window creation 设置。简单的使用你想要的设置创建一个设备，然后调用 DXUTSetDevice函数让框架在你的设备上渲染。注意：如果应用程序创建了不依赖于框架的设备，那么应用程序也必须在主循环执行完以后亲自的通过cleanup 释放设备接口。另请参阅通过DXUT作更高级的设备选择
李锦俊 2006-11-22 11:35 发表评论"></span><header class=post-header><h1 class=post-title itemprop="name headline">【转贴】DXUT编程指南(四):通过DXUT使用设备</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年08月31日 15:14:00 CST" itemprop="dateCreated datePublished" datetime="2007-08-31 15:14:00 +0800 +0800">2007年08月31日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月31日 15:15:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-31 15:15:00 +0800 +0800">2007年08月31日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>3015</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>7分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/dxut-programming-guide-4-device-usage/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><font size=5>通过DXUT使用设备</font><br>DirectX设备的创建在DXUT中得到了改进。你可以让你的应用程序直接创建设备而其它有框架提供的特征仍然可用。<br><a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/1009763.aspx#创建设备>创建设备</a><br><a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/1009763.aspx#使用你自己的设备>选择最佳的设备设置<br>修改可用的设备设置<br>降为软件顶点处理<br>使用你自己的设备</a></p><p><font size=4><a name=创建设备></a>创建设备</font><br>典型地，你将通过标准的Direct3D方法创建设备<br>HRESULT CreateDevice(<br>&nbsp;&nbsp;&nbsp; UINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Adapter,<br>&nbsp;&nbsp;&nbsp; D3DDEVTYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DeviceType,<br>&nbsp;&nbsp;&nbsp; HWND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hFocusWindow,<br>&nbsp;&nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BehaviorFlags,<br>&nbsp;&nbsp;&nbsp; D3DPRESENT_PARAMETERS *pPresentationParameters,<br>&nbsp;&nbsp;&nbsp; IDirect3DDevice9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **ppReturnedDeviceInterface<br>);<br>这个方法需要有效的适配器，设备类型(HAL or REF),窗口句柄，行为标志(software/hardware vertex processing 和其它驱动标志)，以及呈现参数(presentation parameters).此外，D3DPRESENT_PARAMETER结构体还拥有大量的成员指定后备缓冲区，多重采样设定，交换效果，窗口模式，深度模版缓冲，刷新率，呈现间隔，以及呈现标志。<br>为所有这些参数选择有效的设定是具有挑战性的。框架通过DXUTCreateDevice函数简化了这一选择过程。<br>HRESULT DXUTCreateDevice(<br>&nbsp;&nbsp;&nbsp; UINT AdapterOrdinal&nbsp; = D3DADAPTER_DEFAULT,<br>&nbsp;&nbsp;&nbsp; BOOL bWindowed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = TRUE,<br>&nbsp;&nbsp;&nbsp; INT nSuggestedWidth&nbsp; = 640,<br>&nbsp;&nbsp;&nbsp; INT nSuggestedHeight = 480,<br>&nbsp;&nbsp;&nbsp; LPDXUTCALLBACKISDEVICEACCEPTABLE pCallbackIsDeviceAcceptable&nbsp;&nbsp;&nbsp;&nbsp; = NULL,<br>&nbsp;&nbsp;&nbsp; LPDXUTCALLBACKMODIFYDEVICESETTINGS pCallbackModifyDeviceSettings = NULL<br>);<br>最基本的用法是全部使用缺省参数调用：<br>DXUTCreateDevice();<br>通过这样的调用框架使用缺省设置创建一个在大多数情况下可用的设备。缺省的设置如下：<br></p><table><tbody><tr><th>Direct3D Creation Flag</th><th>Description</th><th>Default Value from <strong>DXUTCreateDevice</strong></th></tr><tr><td>AdapterFormat parameter of <a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/IDirect3D9__CheckDeviceFormat.htm>CheckDeviceFormat</a></td><td>Adapter surface format.</td><td>Desktop display mode, or <a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/D3DFORMAT.htm>D3DFMT_X8R8G8B8</a> if the desktop display mode is less than 32 bits.</td></tr><tr><td>Adapter parameter of <strong>IDirect3D9::CreateDevice</strong></td><td>Display adapter ordinal.</td><td><a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/D3DADAPTER_DEFAULT.htm>D3DADAPTER_DEFAULT</a></td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. BackBufferCount</td><td>Number of back buffers.</td><td>2, indicating triple buffering.</td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. BackBufferFormat</td><td>Back buffer format.</td><td>Desktop display mode, or <strong>D3DFMT_X8R8G8B8</strong> if the desktop display mode is less than 32 bits.</td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. AutoDepthStencilFormat</td><td>Depth format of the automatic depth-stencil surface that the device will create.</td><td><strong>D3DFMT_D16</strong> if the backbuffer format is 16 bits or less, or <strong>D3DFMT_D32</strong> otherwise.</td></tr><tr><td>The DeviceType parameter of <strong>IDirect3D9::CreateDevice</strong></td><td>Enumerated type of the device.</td><td>D3DDEVTYPE_HAL if available, otherwise D3DDEVTYPE_REF or failure code if neither is available.</td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. MultiSampleQuality</td><td>Quality level.</td><td>MultiSampleQuality = 0, indicating multisampling is disabled.</td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. Flags</td><td>Presentation parameters flags.</td><td><a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/D3DPRESENTFLAG.htm>D3DPRESENTFLAG_DISCARD_DEPTHSTENCIL</a></td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. PresentationInterval</td><td>Presentation interval.</td><td><a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/D3DPRESENT.htm>D3DPRESENT_INTERVAL_IMMEDIATE</a> for windowed mode, or <strong>D3DPRESENT_INTERVAL_DEFAULT</strong> for full-screen mode.</td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. FullScreen_RefreshRateInHz</td><td>Rate at which the display adapter refreshes the screen.</td><td>0, indicating windowed mode.</td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. BackBufferWidth and .BackBufferHeight</td><td>Display mode resolution.</td><td>640 x 480 pixels for windowed mode, or the desktop resolution for full-screen mode.</td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. AutoDepthStencilFormat</td><td>Stencil format of the automatic depth-stencil surface that the device will create.</td><td><strong>D3DFMT_D16</strong> if the backbuffer format is 16 bits or less, or <strong>D3DFMT_D32</strong> otherwise.</td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. SwapEffect</td><td>Swap effect.</td><td>D3DSWAPEFFECT_DISCARD</td></tr><tr><td>BehaviorFlags parameter of <strong>IDirect3D9::CreateDevice</strong></td><td>Vertex processing flags.</td><td><a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/D3DCREATE.htm>D3DCREATE_HARDWARE_VERTEXPROCESSING</a> if supported, otherwise <strong>D3DCREATE_SOFTWARE_VERTEXPROCESSING</strong>.</td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. Windowed</td><td>Windowed or full-screen mode.</td><td>true, indicating windowed mode.</td></tr><tr><td>hFocusWindow parameter of <strong>CreateDevice</strong></td><td>Handle to the created window (see <a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/Using_Application_Windows_with_DXUT.htm>Using Application Windows with DXUT</a>).</td><td>hWndFocus parameter of <a href=http://blog.csdn.net/ntwilford/archive/2006/08/02/DXUTSetWindow.htm>DXUTSetWindow</a></td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. hDeviceWindow</td><td>Handle to the device window.</td><td>hWndDeviceFullScreen or hWndDeviceWindowed parameters of <strong>DXUTSetWindow</strong></td></tr><tr><td><strong>D3DPRESENT_PARAMETERS</strong>. EnableAutoDepthStencil</td><td>Depth-stencil buffer creation flag.</td><td>true.</td></tr></tbody></table><br>应用程序可以通过参数传递给CreateDevice来更多的控制设备的创建，这将比使用缺省的方式更好。例如，你可以通过nSuggestedWidth and nSuggestedHeight参数改变窗口的尺寸。<br>DXUTCreateDevice(<br>&nbsp;&nbsp;&nbsp; D3DADAPTER_DEFAULT,<br>&nbsp;&nbsp;&nbsp; false,<br>&nbsp;&nbsp;&nbsp; 1024,<br>&nbsp;&nbsp;&nbsp; 786,<br>&nbsp;&nbsp;&nbsp; NULL,<br>&nbsp;&nbsp;&nbsp; NULL,<br>&nbsp;&nbsp;&nbsp; NULL<br>);<br>要得到更多的控制权，应用程序可以使用这两个可选的回调函数，LPDXUTCALLBACKISDEVICEACCEPTABLE and LPDXUTCALLBACKMODIFYDEVICESETTINGS.<p><font size=4><a name=选择最佳的设备设置></a>选择最佳的设备设置</font><br>你可以使用IsDeviceAcceptable回调函数帮助框架为你的应用程序选择最佳的设备设置，就像下面的代码：<br>bool CALLBACK IsDeviceAcceptable(<br>D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps,<br>D3DFORMAT&nbsp;&nbsp;&nbsp;&nbsp; AdapterFormat,<br>D3DFORMAT&nbsp;&nbsp;&nbsp;&nbsp; BackBufferFormat,<br>bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bWindowed,<br>void*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pUserContext )<br>{<br>&nbsp;&nbsp;&nbsp; // TODO: return true for acceptable settings and false otherwise.<br>&nbsp;&nbsp;&nbsp; return true;<br>}<br>这个回调函数的模型基于LPDXUTCALLBACKISDEVICEACCEPTABLE原型(This callback function is modeled on the prototype LPDXUTCALLBACKISDEVICEACCEPTABLE)，框架为每个唯一的以下5个设置的有效组合调用这个函数一次：<br>D3DDEVTYPE DeviceType;<br>UINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AdapterOrdinal;<br>D3DFORMAT&nbsp; AdapterFormat;<br>D3DFORMAT&nbsp; BackBufferFormat;<br>bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Windowed;<br>注意适配器序号和设备类型没有直接的传入回调函数，而是分别作为D3DCAPS9结构体的成员。<br>通过这个回调函数，应用程序可以拒绝任何它不支持的或不想要的组合。例如，应用程序可以使用下面的代码拒绝16bits的后备缓冲区格式和所有至少不能支持像素着色器PS_2_0的设备：<br>bool CALLBACK IsDeviceAcceptable(<br>&nbsp;&nbsp;&nbsp; D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps,<br>&nbsp;&nbsp;&nbsp; D3DFORMAT&nbsp;&nbsp;&nbsp;&nbsp; AdapterFormat,<br>&nbsp;&nbsp;&nbsp; D3DFORMAT&nbsp;&nbsp;&nbsp;&nbsp; BackBufferFormat,<br>&nbsp;&nbsp;&nbsp; bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bWindowed )<br>{<br>&nbsp;&nbsp;&nbsp; if( pCaps->PixelShaderVersion &lt; D3DPS_VERSION(2,0) )<br>&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>&nbsp;&nbsp;&nbsp; if( BackBufferFormat == D3DFMT_X1R5G5B5 || BackBufferFormat == D3DFMT_R5G6B5 )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>&nbsp;&nbsp;&nbsp; return true;<br>}</p><p>为每个唯一的组合调用回调函数后，框架排列剩下的可用组合，并选择它们当中最好的。排名较高的如下：<br>D3DDEVTYPE_HAL，获取硬件加速<br>如果应用程序以全屏模式显示，框架更趋向于使用匹配桌面格式的适配器格式，这样可以在全屏与窗口之间快速切换。例外的是，如果桌面显示模式小于32位，框架更趋向于D3DFMT_X8R8G8B8.<br>匹配适配器格式的后备缓冲区格式<br>在选择了这些排名高的组合后，要创建设备，行为标志和呈现参数仍然是需要的。对于这些设置,Direct3D使用上面表中的缺省值。</p><p><font size=4><a name=修改可用的设备设置></a>修改可用的设备设置</font><br>应用程序可以通过使用第二个可选的回调函数修改对框架可用的设置，这个函数是ModifyDeviceSettings:<br>bool CALLBACK ModifyDeviceSettings(<br>&nbsp;&nbsp;&nbsp; DXUTDeviceSettings* pDeviceSettings,<br>&nbsp;&nbsp;&nbsp; const D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps )<br>{<br>&nbsp;&nbsp;&nbsp; // TODO: Include device creation requirements here.&nbsp;<br>&nbsp;&nbsp;&nbsp; // 返回真创建设备返回False保持当前设置<br>&nbsp;&nbsp;&nbsp; return true;<br>}<br>这个函数是基于原型LPDXUTCALLBACKMODIFYDEVICESETTINGS的。DXUTDeviceSettings结构体被框架定义为：<br>struct DXUTDeviceSettings<br>{<br>&nbsp;&nbsp;&nbsp; UINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AdapterOrdinal;<br>&nbsp;&nbsp;&nbsp; D3DDEVTYPE DeviceType;<br>&nbsp;&nbsp;&nbsp; D3DFORMAT&nbsp; AdapterFormat;<br>&nbsp;&nbsp;&nbsp; DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BehaviorFlags;<br>&nbsp;&nbsp;&nbsp; D3DPRESENT_PARAMETERS pp;<br>};</p><p>这个结构体包含了创建设备所需要的所有东西，除了窗口句柄,它被假定为先前创建的窗口的句柄。框架用有效的数据填充这个结构体，然后允许应用程序通过ModifyDeviceSettings回调函数改变设备创建的选择。<br>在这个回调函数中，应用程序可以在DXUTDeviceSettings结构体中改变行为标志以及呈现参数,乃至结构体中任何其它的东西。如果应用程序在回调函数中什么都不改变，设备会成功的创建。然而，对设备创建设置的任何改变都需要被设备支持，否则可能会导致设备创建失败。<br>比如，如果应用程序需要一个D3DFMT_D24S8的深度模板缓冲区格式，就必须验证设备是否支持，就像下面的代码：<br>bool CALLBACK ModifyDeviceSettings(<br>&nbsp;&nbsp;&nbsp; DXUTDeviceSettings* pDeviceSettings,<br>&nbsp;&nbsp;&nbsp; const D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps )<br>{<br>&nbsp;&nbsp;&nbsp; IDirect3D9* pD3D = DXUTGetD3DObject();<br>&nbsp;&nbsp;&nbsp; if( SUCCEEDED( pD3D->CheckDeviceFormat(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->AdapterOrdinal,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->DeviceType,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->AdapterFormat,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D3DUSAGE_DEPTHSTENCIL,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D3DRTYPE_SURFACE,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D3DFMT_D24S8 ) ) )<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp; if( SUCCEEDED( pD3D->CheckDepthStencilMatch(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->AdapterOrdinal,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->DeviceType,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->AdapterFormat,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->pp.BackBufferFormat,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D3DFMT_D24S8 ) ) )<br>&nbsp;&nbsp;&nbsp; &nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->pp.AutoDepthStencilFormat = D3DFMT_D24S8;<br>&nbsp;&nbsp;&nbsp; &nbsp;}<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; return true;<br>}</p><p>候选的方案是，回调函数可以使用框架的CD3DEnumeration 对象验证D3DFMT_D24S8是否被支持：<br>&nbsp;bool CALLBACK ModifyDeviceSettings(<br>&nbsp;&nbsp;&nbsp; DXUTDeviceSettings* pDeviceSettings,<br>&nbsp;&nbsp;&nbsp; const D3DCAPS9*&nbsp;&nbsp;&nbsp;&nbsp; pCaps )<br>{<br>&nbsp;&nbsp;&nbsp; CD3DEnumeration *pEnum = DXUTGetEnumeration();<br>&nbsp;&nbsp;&nbsp; CD3DEnumDeviceSettingsCombo *pCombo;<br>&nbsp;<br>&nbsp;&nbsp;&nbsp; pCombo = pEnum->GetDeviceSettingsCombo( pDeviceSettings );<br>&nbsp;<br>&nbsp;&nbsp;&nbsp; if( pCombo->depthStencilFormatList.Contains( D3DFMT_D24S8 ) )<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->pp.AutoDepthStencilFormat = D3DFMT_D24S8;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; return true;<br>}</p><p>应用程序修改了设备的设置后，框架就会用新的设置创建设备。<br>DirectX April 2005 SDK Update中的更新，ModifyDeviceSettings 回调函数返回了一个bool值。如果应用程序返回true框架继续正常的创建设备。如果返回false框架不改变设备并且保持当前的设备，如果已经有一个存在的话。这允许应用程序能够拒绝框架将设备改变到程序不能使用的请求。例如，在多监视器的缺省配置下，在监视器之间拖动窗口会导致框架改变设备。然而，如果应用程序不能使用其它的设备的话，它应当可以拒绝改变，并继续使用当前的设备。</p><p><font size=4><a name=回降到软件顶点处理></a>回降到软件顶点处理</font><br>如果你设置一个Direct3D设备到支持像素处理却不支持顶点处理的硬件，你会因此需要改变行为标志。为了确保正确地降到软件顶点处理，谨防你不能拒绝一个基于IsDeviceAcceptable回调函数中顶点着色器版本的设备，并确保行为标志在ModifyDeviceSettings 回调函数中被正确调整。这儿有一个例子演示怎样做这些事情。<br>bool CALLBACK ModifyDeviceSettings( DXUTDeviceSettings* pDeviceSettings,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const D3DCAPS9* pCaps )<br>{<br>&nbsp;&nbsp;&nbsp; // If device doesn't support HW T&amp;L or doesn't support 1.1 vertex<br>&nbsp;&nbsp;&nbsp; // shaders in HW, then switch to SWVP.<br>&nbsp;&nbsp;&nbsp; if( (pCaps->DevCaps & D3DDEVCAPS_HWTRANSFORMANDLIGHT) == 0 ||<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pCaps->VertexShaderVersion &lt; D3DVS_VERSION(1,1) )<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->BehaviorFlags = D3DCREATE_SOFTWARE_VERTEXPROCESSING;<br>&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;&nbsp;&nbsp; else<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pDeviceSettings->BehaviorFlags = D3DCREATE_HARDWARE_VERTEXPROCESSING;<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; return true;<br>}</p><p><font size=4><a name=使用你自己的设备></a>使用你自己的设备</font><br>你没有必要依赖于框架来创建Direct3D设备。应用程序自己可以创建设备并将他传递给框架使用。就像应用程序可以覆盖框架的window creation 设置。简单的使用你想要的设置创建一个设备，然后调用 DXUTSetDevice函数让框架在你的设备上渲染。<br>注意：如果应用程序创建了不依赖于框架的设备，那么应用程序也必须在主循环执行完以后亲自的通过cleanup 释放设备接口。<br>另请参阅<br>通过DXUT作更高级的设备选择</p><img height=1 src=http://www.cppblog.com/mybios/aggbug/15531.html width=1><br><br><div align=right><a style=text-decoration:none href=http://www.cppblog.com/mybios/ target=_blank>李锦俊</a> 2006-11-22 11:35 <a style=text-decoration:none href=http://www.cppblog.com/mybios/archive/2006/11/22/15531.html#Feedback target=_blank>发表评论</a></div><a id=more></a></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
【转贴】DXUT编程指南(四):通过DXUT使用设备</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/dxut-programming-guide-4-device-usage/ title=【转贴】DXUT编程指南(四):通过DXUT使用设备>https://blogs.qipai360.cn/post/dxut-programming-guide-4-device-usage/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/dxut-framework-introduction-2/ rel=next title="【转贴】DXUT 框架入门 2"><i class="fa fa-chevron-left"></i> 【转贴】DXUT 框架入门 2</a></div><div class="post-nav-prev post-nav-item"><a href=/post/render-to-texture/ rel=prev title="【转贴】Render to Texture（渲染到纹理）">【转贴】Render to Texture（渲染到纹理）
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"dxut-programming-guide-4-device-usage","permalink":"https://blogs.qipai360.cn/post/dxut-programming-guide-4-device-usage/","title":"【转贴】DXUT编程指南(四):通过DXUT使用设备","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1761990624" defer></script></body></html>