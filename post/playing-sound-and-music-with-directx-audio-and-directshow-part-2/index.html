<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（2）"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="用DirectX Audio和DirectShow播放声音和音乐（2）"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-2/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2007-07-26 20:00:00 +0800 +0800"><meta property="article:modified_time" content="2007-08-27 17:19:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1761990628"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>用DirectX Audio和DirectShow播放声音和音乐（2） - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>678</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>678</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2418817></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5198></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-01 14:55:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-2/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（2）"><meta itemprop=description content="开始使用主音频缓存让缓存在程序启动的时候开始播放可以节省不少处理器时间。因为内存资源是有限的，特别是在硬件设备中，而你使用的数据缓存可能需要任意大小，因此主音频缓冲区和辅助缓冲区使用环形缓存。因为数据缓冲是一个一维数组，所以可以让这个缓冲区头尾相接。这是一个十分强大的技术，利用这个技术我们可以节省大量的内存。声音在进行混音处理后，被送入环形主音频缓存。一旦播放位置到达主音频缓存的终点，声音又从头开始播放，这样声音就被无间隙地连续播放。如果想要使用缓存的这种循环特性，需要指定启用循环播放的特性，若不然当播放到缓冲区终点时，播放就停止了。为了播放缓存中的音频数据（在开启循环选项的情况下播放），需要调用Play函数。"></span><header class=post-header><h1 class=post-title itemprop="name headline">用DirectX Audio和DirectShow播放声音和音乐（2）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月26日 20:00:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-26 20:00:00 +0800 +0800">2007年07月26日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:19:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:19:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>18522</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>37分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-2/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><span style=font-weight:700;color:#1c6e11>开始使用主音频缓存</span><br><br>让缓存在程序启动的时候开始播放可以节省不少处理器时间。因为内存资源是有限的，特别是在硬件设备中，而你使用的数据缓存可能需要任意大小，因此主音频缓冲区和辅助缓冲区使用环形缓存。因为数据缓冲是一个一维数组，所以可以让这个缓冲区头尾相接。这是一个十分强大的技术，利用这个技术我们可以节省大量的内存。<br><br>声音在进行混音处理后，被送入环形主音频缓存。一旦播放位置到达主音频缓存的终点，声音又从头开始播放，这样声音就被无间隙地连续播放。如果想要使用缓存的这种循环特性，需要指定启用循环播放的特性，若不然当播放到缓冲区终点时，播放就停止了。<br><br>为了播放缓存中的音频数据（在开启循环选项的情况下播放），需要调用Play函数。<br><br></p><a id=more></a><p></p><font style=font-size:11pt face=Arial>The Play method causes the sound buffer to play, starting at the play cursor.</font><pre class=syntax><font style=font-size:11pt face=Arial><strong>HRESULT Play(</strong><br> <strong>DWORD</strong> <em>dwReserved1</em><strong>,</strong><br> <strong>DWORD</strong> <em>dwPriority</em><strong>,</strong><br> <strong>DWORD</strong> <em>dwFlags</em><br><strong>);</strong></font></pre><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>dwReserved1</em></font><dd><font style=font-size:11pt face=Arial>Reserved. Must be 0.</font><dt><font style=font-size:11pt face=Arial><em>dwPriority</em></font><dd><font style=font-size:11pt face=Arial>Priority for the sound, used by the voice manager when assigning hardware mixing resources. The lowest priority is 0, and the highest priority is 0xFFFFFFFF. If the buffer was not created with the DSBCAPS_LOCDEFER flag, this value must be 0.</font><dt><font style=font-size:11pt face=Arial><em>dwFlags</em></font><dd><font style=font-size:11pt face=Arial>Flags specifying how to play the buffer. The following flags are defined:</font><p><font style=font-size:11pt face=Arial>Looping flag</font></p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Value</font></td><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Description</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSBPLAY_LOOPING</font></td><td><font style=font-size:11pt face=Arial>After the end of the audio buffer is reached, play restarts at the beginning of the buffer. Play continues until explicitly stopped. This flag must be set when playing a primary buffer.</font></td></tr></tbody></table><p><font style=font-size:11pt face=Arial>Voice allocation flags</font></p><dd><font style=font-size:11pt face=Arial>The voice allocation flags are valid only for buffers created with the DSBCAPS_LOCDEFER flag. One of the following flags can be used to force the processing of the sound into hardware or software. If neither DBSPLAY_LOCHARDWARE nor DBSPLAY_LOCSOFTWARE is set, the sound is played in either software or hardware, depending on the availability of resources at the time the method is called. See Remarks.</font><br><br><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Value</font></td><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Description</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSBPLAY_LOCHARDWARE</font></td><td><font style=font-size:11pt face=Arial>Play this voice in a hardware buffer only. If the hardware has no available voices and no voice management flags are set, the call to IDirectSoundBuffer8::Play fails. This flag cannot be combined with DSBPLAY_LOCSOFTWARE.</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSBPLAY_LOCSOFTWARE</font></td><td><font style=font-size:11pt face=Arial>Play this voice in a software buffer only. This flag cannot be combined with DSBPLAY_LOCHARDWARE or any voice management flag.</font></td></tr></tbody></table><p><font style=font-size:11pt face=Arial>Voice management flags</font></p><dd><font style=font-size:11pt face=Arial>The voice management flags are valid only for buffers created with the DSBCAPS_LOCDEFER flag, and are used for sounds that are to play in hardware. These flags enable hardware resources that are already in use to be yielded to the current sound. Only buffers created with the DSBCAPS_LOCDEFER flag are candidates for premature termination. See Remarks.</font><p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Value</font></td><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Description</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSBPLAY_TERMINATEBY_TIME</font></td><td><font style=font-size:11pt face=Arial>If the hardware has no available voices, a currently playing nonlooping buffer will be stopped to make room for the new buffer. The buffer prematurely terminated is the one with the least time left to play.</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSBPLAY_TERMINATEBY_DISTANCE</font></td><td><font style=font-size:11pt face=Arial>If the hardware has no available voices, a currently playing buffer will be stopped to make room for the new buffer. The buffer prematurely terminated will be selected from buffers that have the buffer's DSBCAPS_ MUTE3DATMAXDISTANCE flag set and are beyond their maximum distance. If there are no such buffers, the method fails.</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSBPLAY_TERMINATEBY_PRIORITY</font></td><td><font style=font-size:11pt face=Arial>If the hardware has no available voices, a currently playing buffer will be stopped to make room for the new buffer. The buffer prematurely terminated will be the one with the lowest priority as set by the dwPriority parameter passed to IDirectSoundBuffer8::Play for the buffer.</font></td></tr></tbody></table></p></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the method succeeds, the return value is DS_OK. If the method fails, the return value may be one of the following error values:</font></p><table style=border-collapse:collapse bordercolor=#808080 width=208 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Return code</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_BUFFERLOST</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDCALL</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDPARAM</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_PRIOLEVELNEEDED</font></td></tr></tbody></table><br>当完成主音频缓存设置后（以及整个音响系统），如果想停止它，需要调用IDirectSoundBuffer::Stop。<br><br><p><font style=font-size:11pt face=Arial>The Stop method causes the sound buffer to stop playing.</font></p><pre class=syntax><font style=font-size:11pt face=Arial><strong>HRESULT Stop();</strong></font></pre><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><p><font style=font-size:11pt face=Arial>None.</font></p><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the method succeeds, the return value is DS_OK. If the method fails, the return value may be one of the following error values:</font></p><h4><font style=font-size:11pt face=Arial>Remarks</font></h4><p><font style=font-size:11pt face=Arial>For secondary sound buffers, IDirectSoundBuffer8::Stop sets the play cursor to the sample that follows the last sample played. This means that when the Play method is next called on the buffer, it will continue playing where it left off.</font></p><p><font style=font-size:11pt face=Arial>For the primary buffer, if an application has the DSSCL_WRITEPRIMARY level, this method will stop the buffer and reset the play cursor to 0 (the beginning of the buffer). This is necessary because the primary buffers on most sound cards can play only from the beginning of the buffer.</font></p><p><font style=font-size:11pt face=Arial>However, if IDirectSoundBuffer8::Stop is called on a primary buffer and the application has a cooperative level other than DSSCL_WRITEPRIMARY, this method simply reverses the effects of IDirectSoundBuffer8::Play. It configures the primary buffer to stop if no secondary buffers are playing. If other buffers are playing in this or other applications, the primary buffer will not actually stop until they are stopped. This method is useful because playing the primary buffer consumes processing overhead even if the buffer is playing sound data with the amplitude of 0 decibels.</font></p><br><span style=font-weight:700;color:#1c6e11>使用辅助音频缓存</span><br><br>想要使用辅助音频缓存的数据，需要将辅助音频缓存中包含的数据填充到主音频缓存，如在主音频缓存的同一区域写入两段音频数据，这两段声音就会被同时播放。辅助音频缓存使用 IDirectSoundBuffer8接口，这个接口和IDirectSoundBuffer十分类似，实际上如果想要创建 IDirectSoundBuffer8接口，必须先创建IDirectSoundBuffer接口，然后通过请求新接口来获取 IDirectSoundBuffer8接口。<br><br>创建辅助音频缓存和创建主音频缓存时主要的不同是必须在初始化时设置回放格式，这意味着缓冲区只能使用一种格式。如果希望使用另外的格式，必须释放当前的缓存，重新创建另外一个。<br><br>代码示例：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp; //</span><span style=color:green>&nbsp;initialize&nbsp;and&nbsp;configure&nbsp;directsound<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;an&nbsp;object&nbsp;that&nbsp;supports&nbsp;the&nbsp;IDirectSound8&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(DirectSoundCreate8(NULL,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_ds,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Unable&nbsp;to&nbsp;create&nbsp;DirectSound&nbsp;object</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;cooperative&nbsp;level&nbsp;of&nbsp;the&nbsp;application&nbsp;for&nbsp;this&nbsp;sound&nbsp;device</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds</span><span style=color:#000>-></span><span style=color:#000>SetCooperativeLevel(g_hwnd,&nbsp;DSSCL_NORMAL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;a&nbsp;sound&nbsp;buffer<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;WAVEFORMATEX&nbsp;structure</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;WAVEFORMATEX&nbsp;wave_format;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>wave_format,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WAVEFORMATEX));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.wFormatTag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;WAVE_FORMAT_PCM;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nChannels&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;mono</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nSamplesPerSec&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>11025</span><span style=color:#000>;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.wBitsPerSample&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nBlockAlign&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(wave_format.wBitsPerSample&nbsp;</span><span style=color:#000>/</span><span style=color:#000>&nbsp;</span><span style=color:#000>8</span><span style=color:#000>)&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;wave_format.nChannels;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nAvgBytesPerSec&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_format.nSamplesPerSec&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;wave_format.nBlockAlign;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;DSBUFFERDESC&nbsp;structure</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DSBUFFERDESC&nbsp;ds_buffer_desc;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;zero&nbsp;out&nbsp;strcutre</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_desc,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DSBUFFERDESC));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DSBUFFERDESC);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwFlags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DSBCAPS_CTRLVOLUME;<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwBufferBytes&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_format.nAvgBytesPerSec&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#000>2</span><span style=color:#000>;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;2&nbsp;seconds</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.lpwfxFormat&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>&</span><span style=color:#000>wave_format;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;fist&nbsp;version&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_ds</span><span style=color:#000>-></span><span style=color:#000>CreateSoundBuffer(</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_desc,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>ds,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;error&nbsp;ocuurred</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Unable&nbsp;to&nbsp;create&nbsp;sound&nbsp;buffer</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>else</span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;the&nbsp;version&nbsp;8&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IDirectSoundBuffer8,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_ds_buffer);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;the&nbsp;original&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds</span><span style=color:#000>-></span><span style=color:#000>Release();<br>}</span></div><br><span style=font-weight:700;color:#1c6e11>锁定和加载 --- 在缓冲区中加载数据</span><br><br>缓存接口有一对处理数据加载的函数。 IDirectSoundBuffer8::Lock函数锁定音频缓冲数据，并且找回指向缓冲区数据的数据指针； IDirectSoundBuffer8::Unlock释放在锁定操作中使用的资源。<br><br>当锁定缓存以后，就能对缓冲区进行写入操作。先告诉缓冲写入偏移量的字节数、写入位置、要写入数据的字节数，写入完成后返回两个指向数据的指针以及写入数据的字节数。为什么会有两个指针和两个数据大小呢？因为音频数据缓冲区是环形的，写入的数据也需要跨过起始位置。返回的第一个指针是请求的位置，第一个值是从请求的位置到结束所写入的字节数，第二个指针通常是缓存区的起始位置，第二个值是从起点开始写入的字节数。<br><br>这里有一个长度是 65536字节大小的缓冲区，这个缓冲区被锁定，以便于写入62000字节的数据。第一个指针处写入了60000字节，第二个指针处还剩下2000字节。<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/r_cache.jpg><br><br>Lock函数使用信息如下：<br><br><p><font style=font-size:11pt face=Arial>The Lock method readies all or part of the buffer for a data write and returns pointers to which data can be written.</font></p><pre class=syntax><font style=font-size:11pt face=Arial><strong>HRESULT Lock(</strong><br> <strong>DWORD</strong> <em>dwOffset</em><strong>,</strong><br> <strong>DWORD</strong> <em>dwBytes</em><strong>,</strong><br> <strong>LPVOID *</strong> <em>ppvAudioPtr1</em><strong>,</strong><br> <strong>LPDWORD </strong> <em>pdwAudioBytes1</em><strong>,</strong><br> <strong>LPVOID *</strong> <em>ppvAudioPtr2</em><strong>,</strong><br> <strong>LPDWORD</strong> <em>pdwAudioBytes2</em><strong>,</strong><br> <strong>DWORD</strong> <em>dwFlags</em><br><strong>);</strong></font></pre><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>dwOffset</em></font><dd><font style=font-size:11pt face=Arial>Offset, in bytes, from the start of the buffer to the point where the lock begins. This parameter is ignored if DSBLOCK_FROMWRITECURSOR is specified in the dwFlags parameter.</font><dt><font style=font-size:11pt face=Arial><em>dwBytes</em></font><dd><font style=font-size:11pt face=Arial>Size, in bytes, of the portion of the buffer to lock. The buffer is conceptually circular, so this number can exceed the number of bytes between dwOffset and the end of the buffer.</font><dt><font style=font-size:11pt face=Arial><em>ppvAudioPtr1</em></font><dd><font style=font-size:11pt face=Arial>Address of a variable that receives a pointer to the first locked part of the buffer.</font><dt><font style=font-size:11pt face=Arial><em>pdwAudioBytes1</em></font><dd><font style=font-size:11pt face=Arial>Address of a variable that receives the number of bytes in the block at ppvAudioPtr1. If this value is less than dwBytes, the lock has wrapped and ppvAudioPtr2 points to a second block of data at the beginning of the buffer .</font><dt><font style=font-size:11pt face=Arial><em>ppvAudioPtr2</em></font><dd><font style=font-size:11pt face=Arial>Address of a variable that receives a pointer to the second locked part of the capture buffer. If NULL is returned, the ppvAudioPtr1 parameter points to the entire locked portion of the capture buffer.</font><dt><font style=font-size:11pt face=Arial><em>pdwAudioBytes2</em></font><dd><font style=font-size:11pt face=Arial>Address of a variable that receives the number of bytes in the block at ppvAudioPtr2. If ppvAudioPtr2 is NULL, this value is zero.</font><dt><font style=font-size:11pt face=Arial><em>dwFlags</em></font><dd><font style=font-size:11pt face=Arial>Flags modifying the lock event. The following flags are defined:</font><p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Value</font></td><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Description</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSBLOCK_FROMWRITECURSOR</font></td><td><font style=font-size:11pt face=Arial>Start the lock at the write cursor. The dwOffset parameter is ignored.</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSBLOCK_ENTIREBUFFER</font></td><td><font style=font-size:11pt face=Arial>Lock the entire buffer. The dwBytes parameter is ignored.</font></td></tr></tbody></table></p></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the method succeeds, the return value is DS_OK. If the method fails, the return value may be one of the following error values:</font></p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Return code</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_BUFFERLOST</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDCALL</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDPARAM</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_PRIOLEVELNEEDED</font></td></tr></tbody></table><h4><font style=font-size:11pt face=Arial>Remarks</font></h4><p><font style=font-size:11pt face=Arial>This method accepts an offset and a byte count, and returns two write pointers and their associated sizes. If the locked portion does not extend to the end of the buffer and wrap to the beginning, the second pointer, ppvAudioBytes2, receives NULL. If the lock does wrap, ppvAudioBytes2 points to the beginning of the buffer.</font></p><p><font style=font-size:11pt face=Arial>If the application passes NULL for the ppvAudioPtr2 and pdwAudioBytes2 parameters, the lock extends no further than the end of the buffer and does not wrap.</font></p><p><font style=font-size:11pt face=Arial>After writing data to the pointers returned by this method, the application must immediately call Unlock to notify DirectSound that the data is ready for playback. Failure to do so can cause audio breakup or silence on some sound device configurations.</font></p><p><font style=font-size:11pt face=Arial>This method returns write pointers only. The application should not try to read sound data from this pointer, because the data might not be valid. For example, if the buffer is located in on-card memory, the pointer might be an address to a temporary buffer in system memory. When IDirectSoundBuffer8::Unlock is called, the contents of this temporary buffer are transferred to the on-card memory.</font></p><br>以下这段代码锁定辅助音频缓冲区，并且填充随机数据。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //</span><span style=color:green>&nbsp;lock&nbsp;buffer,&nbsp;fill&nbsp;with&nbsp;random&nbsp;values,&nbsp;and&nbsp;unlock.</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;ptr;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;size;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;readies&nbsp;all&nbsp;or&nbsp;part&nbsp;of&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;data&nbsp;write&nbsp;and&nbsp;returns&nbsp;pointers&nbsp;to&nbsp;which&nbsp;data&nbsp;can&nbsp;be&nbsp;written</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Lock(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>ptr,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>size,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;DSBLOCK_ENTIREBUFFER)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(DWORD&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;size;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptr[i]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;rand()&nbsp;</span><span style=color:#000>%</span><span style=color:#000>&nbsp;</span><span style=color:#000>256</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><br>填充完数据后，应该给缓冲区解锁，调用IDirectSoundBuffer8::Unlock解锁。<br><br><p><font style=font-size:11pt face=Arial>The Unlock method releases a locked sound buffer.</font></p><pre class=syntax><font style=font-size:11pt face=Arial><strong>HRESULT Unlock(</strong><br> <strong>LPVOID</strong> <em>pvAudioPtr1</em><strong>,</strong><br> <strong>DWORD</strong> <em>dwAudioBytes1</em><strong>,</strong><br> <strong>LPVOID</strong> <em>pvAudioPtr2</em><strong>,</strong><br> <strong>DWORD</strong> <em>dwAudioBytes2</em><br><strong>);</strong></font></pre><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>pvAudioPtr1</em></font><dd><font style=font-size:11pt face=Arial>Address of the value retrieved in the ppvAudioPtr1 parameter of the Lock method.</font><dt><font style=font-size:11pt face=Arial><em>dwAudioBytes1</em></font><dd><font style=font-size:11pt face=Arial>Number of bytes written to the portion of the buffer at pvAudioPtr1. See Remarks.</font><dt><font style=font-size:11pt face=Arial><em>pvAudioPtr2</em></font><dd><font style=font-size:11pt face=Arial>Address of the value retrieved in the ppvAudioPtr2 parameter of the IDirectSoundBuffer8::Lock method.</font><dt><font style=font-size:11pt face=Arial><em>dwAudioBytes2</em></font><dd><font style=font-size:11pt face=Arial>Number of bytes written to the portion of the buffer at pvAudioPtr2. See Remarks.</font></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the method succeeds, the return value is DS_OK. If the method fails, the return value may be one of the following error values:</font></p><table><tbody><tr><td><font style=font-size:11pt face=Arial>Return code</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDCALL</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDPARAM</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_PRIOLEVELNEEDED</font></td></tr></tbody></table><h4><font style=font-size:11pt face=Arial>Remarks</font></h4><p><font style=font-size:11pt face=Arial>An application must pass both pointers, pvAudioPtr1 and pvAudioPtr2, returned by the IDirectSoundBuffer8::Lock method to ensure the correct pairing of IDirectSoundBuffer8::Lock and IDirectSoundBuffer8::Unlock. The second pointer is needed even if nothing was written to the second pointer.</font></p><p><font style=font-size:11pt face=Arial>The values in dwAudioBytes1 and dwAudioBytes2 must specify the number of bytes actually written to each part of the buffer, which might be less than the size of the lock. DirectSound uses these values to determine how much data to commit to the device.</font></p><p>以下代码解锁刚才锁定的辅助音频缓冲区：<br></p><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;releases&nbsp;a&nbsp;locked&nbsp;sound&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Unlock(ptr,&nbsp;size,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);</span></div><br><span style=font-weight:700;color:#1c6e11>播放缓冲区中的声音</span><br><br>在辅助音频缓冲区中播放音频和在主音频缓冲区中播放是一样的，惟一不同的是这次需要设置播放的起始位置，通过IDirectSoundBuffer8:: SetCurrentPosition来设置。一般情况下，会选择从缓冲的开头播放，需要注意的是，停止播放一段音频并不会重置播放位置，所以可以通过停止播放来达到暂停的目的，只需要再次调用播放函数来恢复播放。<br><br><p><font style=font-size:11pt face=Arial>The SetCurrentPosition method sets the position of the play cursor, which is the point at which the next byte of data is read from the buffer.</font></p><pre class=syntax><font style=font-size:11pt face=Arial><strong>HRESULT SetCurrentPosition(</strong><br> <strong>DWORD</strong> <em>dwNewPosition</em><br><strong>);</strong></font></pre><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>dwNewPosition</em></font><dd><font style=font-size:11pt face=Arial>Offset of the play cursor, in bytes, from the beginning of the buffer.</font></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the method succeeds, the return value is DS_OK. If the method fails, the return value may be one of the following error values:</font></p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Return code</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDCALL</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDPARAM</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_PRIOLEVELNEEDED</font></td></tr></tbody></table><h4><font style=font-size:11pt face=Arial>Remarks</font></h4><p><font style=font-size:11pt face=Arial>This method cannot be called on the primary buffer.</font></p><p><font style=font-size:11pt face=Arial>If the buffer is playing, the cursor immediately moves to the new position and play continues from that point. If it is not playing, playback will begin from the new position the next time the Play method is called.</font></p><br><span style=font-weight:700;color:#1c6e11>改变音量</span><br><br>DirectSound在播放声音时按照采样时的最大音量播放，加之受限于音频硬件，所以没有办法让音量变得更大，DirectSound只能让音量变得更小些。这是通过减小声音级别来完成的，这个级别的单位是百分之一分贝。范围从0（最大音量）-- 10000（无声），利用这个特性可以在程序中加入“淡入”或“淡出“的效果。<br><br>要调整音量，可以使用 IDirectSoundBuffer8::SetVolume函数。<br><br><p><font style=font-size:11pt face=Arial>The SetVolume method sets the attenuation of the sound.</font></p><pre class=syntax><font style=font-size:11pt face=Arial><strong>HRESULT SetVolume(</strong><br> <strong>LONG</strong> <em>lVolume</em><br><strong>);</strong></font></pre><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>lVolume</em></font><dd><font style=font-size:11pt face=Arial>Attenuation, in hundredths of a decibel (dB).</font></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the method succeeds, the return value is DS_OK. If the method fails, the return value may be one of the following error values:</font></p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Return code</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_CONTROLUNAVAIL</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_GENERIC</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDPARAM</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_PRIOLEVELNEEDED</font></td></tr></tbody></table><h4><font style=font-size:11pt face=Arial>Remarks</font></h4><p><font style=font-size:11pt face=Arial>Allowable values are between DSBVOLUME_MAX (no attenuation) and DSBVOLUME_MIN (silence). These values are defined in Dsound.h as 0 and ?10,000 respectively. The value DSBVOLUME_MAX represents the original, unadjusted volume of the stream. The value DSBVOLUME_MIN indicates an audio volume attenuated by 100 dB, which, for all practical purposes, is silence. DirectSound does not support amplification.</font></p><br>以下给出一个完整示例来运用刚才学到的知识。<br><br><a href=http://www.cppblog.com/Files/lovedday/LockLoad.rar><font color=#1b1b1b>点击下载源码和工程</font></a><br><br>源码示例：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>/*</span><span style=color:green>**************************************************************************************<br>PURPOSE:<br>&nbsp;&nbsp;&nbsp;&nbsp;Lock&nbsp;Load&nbsp;Playing&nbsp;Demo<br>&nbsp;**************************************************************************************</span><span style=color:green>*/</span><span style=color:#000><br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;DIRECTINPUT_VERSION&nbsp;0x0800</span><span style=color:#000><br><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>windows.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>stdio.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>dsound.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>"</span><span style=color:#000>resource.h</span><span style=color:#000>"</span><span style=color:#000><br><br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dxguid.lib</span><span style=color:#000>"</span><span style=color:#000>)<br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dsound.lib</span><span style=color:#000>"</span><span style=color:#000>)<br><br>#pragma&nbsp;warning(disable&nbsp;:&nbsp;</span><span style=color:#000>4996</span><span style=color:#000>)<br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;Safe_Release(p)&nbsp;if((p))&nbsp;(p)->Release();</span><span style=color:#000><br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class&nbsp;and&nbsp;caption&nbsp;text.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br></span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>LockLoadClass</span><span style=color:#000>"</span><span style=color:#000>;<br><br>IDirectSound8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directsound&nbsp;component</span><span style=color:green><br></span><span style=color:#000>IDirectSoundBuffer8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;sound&nbsp;buffer&nbsp;object<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Window&nbsp;procedure.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;WINAPI&nbsp;Window_Proc(HWND&nbsp;hwnd,&nbsp;UINT&nbsp;msg,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(msg)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;WM_DESTROY:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostQuitMessage(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>long</span><span style=color:#000>)&nbsp;DefWindowProc(hwnd,&nbsp;msg,&nbsp;wParam,&nbsp;lParam);<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Main&nbsp;function,&nbsp;routine&nbsp;entry.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>int</span><span style=color:#000>&nbsp;WINAPI&nbsp;WinMain(HINSTANCE&nbsp;inst,&nbsp;HINSTANCE,&nbsp;LPSTR&nbsp;cmd_line,&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;cmd_show)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;WNDCLASS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;win_class;<br>&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg;<br>&nbsp;&nbsp;&nbsp;&nbsp;IDirectSoundBuffer</span><span style=color:#000>*</span><span style=color:#000>&nbsp;ds&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;window&nbsp;class&nbsp;and&nbsp;register&nbsp;it</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;win_class.style&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CS_HREDRAW&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;CS_VREDRAW;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpfnWndProc&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Window_Proc;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbClsExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbWndExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DLGWINDOWEXTRA;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hInstance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;inst;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIcon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadIcon(inst,&nbsp;IDI_APPLICATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadCursor(NULL,&nbsp;IDC_ARROW);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hbrBackground&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(HBRUSH)&nbsp;(COLOR_BTNFACE&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszMenuName&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszClassName&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_class_name;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;RegisterClass(</span><span style=color:#000>&</span><span style=color:#000>win_class))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;main&nbsp;window</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_hwnd&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateDialog(inst,&nbsp;MAKEINTRESOURCE(IDD_LOCKLOAD),&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ShowWindow(g_hwnd,&nbsp;cmd_show);<br>&nbsp;&nbsp;&nbsp;&nbsp;UpdateWindow(g_hwnd);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;and&nbsp;configure&nbsp;directsound<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;an&nbsp;object&nbsp;that&nbsp;supports&nbsp;the&nbsp;IDirectSound8&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(DirectSoundCreate8(NULL,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_ds,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Unable&nbsp;to&nbsp;create&nbsp;DirectSound&nbsp;object</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;cooperative&nbsp;level&nbsp;of&nbsp;the&nbsp;application&nbsp;for&nbsp;this&nbsp;sound&nbsp;device</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds</span><span style=color:#000>-></span><span style=color:#000>SetCooperativeLevel(g_hwnd,&nbsp;DSSCL_NORMAL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;a&nbsp;sound&nbsp;buffer<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;WAVEFORMATEX&nbsp;structure</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;WAVEFORMATEX&nbsp;wave_format;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>wave_format,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WAVEFORMATEX));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.wFormatTag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;WAVE_FORMAT_PCM;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nChannels&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;mono</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nSamplesPerSec&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>11025</span><span style=color:#000>;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.wBitsPerSample&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nBlockAlign&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(wave_format.wBitsPerSample&nbsp;</span><span style=color:#000>/</span><span style=color:#000>&nbsp;</span><span style=color:#000>8</span><span style=color:#000>)&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;wave_format.nChannels;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nAvgBytesPerSec&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_format.nSamplesPerSec&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;wave_format.nBlockAlign;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;DSBUFFERDESC&nbsp;structure</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DSBUFFERDESC&nbsp;ds_buffer_desc;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;zero&nbsp;out&nbsp;strcutre</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_desc,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DSBUFFERDESC));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DSBUFFERDESC);&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwFlags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DSBCAPS_CTRLVOLUME;<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwBufferBytes&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_format.nAvgBytesPerSec&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#000>2</span><span style=color:#000>;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;2&nbsp;seconds</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.lpwfxFormat&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>&</span><span style=color:#000>wave_format;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;fist&nbsp;version&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_ds</span><span style=color:#000>-></span><span style=color:#000>CreateSoundBuffer(</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_desc,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>ds,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;error&nbsp;ocuurred</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Unable&nbsp;to&nbsp;create&nbsp;sound&nbsp;buffer</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>else</span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;the&nbsp;version&nbsp;8&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IDirectSoundBuffer8,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_ds_buffer);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;the&nbsp;original&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds</span><span style=color:#000>-></span><span style=color:#000>Release();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;lock&nbsp;buffer,&nbsp;fill&nbsp;with&nbsp;random&nbsp;values,&nbsp;and&nbsp;unlock.</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;ptr;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;size;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;readies&nbsp;all&nbsp;or&nbsp;part&nbsp;of&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;data&nbsp;write&nbsp;and&nbsp;returns&nbsp;pointers&nbsp;to&nbsp;which&nbsp;data&nbsp;can&nbsp;be&nbsp;written</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Lock(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>ptr,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>size,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;DSBLOCK_ENTIREBUFFER)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(DWORD&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;size;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptr[i]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;rand()&nbsp;</span><span style=color:#000>%</span><span style=color:#000>&nbsp;</span><span style=color:#000>256</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;releases&nbsp;a&nbsp;locked&nbsp;sound&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Unlock(ptr,&nbsp;size,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;play&nbsp;sound&nbsp;looping<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;sets&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;play&nbsp;cursor,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;which&nbsp;is&nbsp;the&nbsp;point&nbsp;at&nbsp;which&nbsp;the&nbsp;next&nbsp;byte&nbsp;of&nbsp;data&nbsp;is&nbsp;read&nbsp;from&nbsp;the&nbsp;buffer.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>SetCurrentPosition(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;attenuation&nbsp;of&nbsp;the&nbsp;sound</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>SetVolume(DSBVOLUME_MAX);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;causes&nbsp;the&nbsp;sound&nbsp;buffer&nbsp;to&nbsp;play,&nbsp;starting&nbsp;at&nbsp;the&nbsp;play&nbsp;cursor.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Play(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;DSBPLAY_LOOPING);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;start&nbsp;message&nbsp;pump,&nbsp;waiting&nbsp;for&nbsp;signal&nbsp;to&nbsp;quit.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(MSG));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(msg.message&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;WM_QUIT)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(PeekMessage(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;PM_REMOVE))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;directsound&nbsp;objects</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds</span><span style=color:#000>-></span><span style=color:#000>Release();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;UnregisterClass(g_class_name,&nbsp;inst);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>int</span><span style=color:#000>)&nbsp;msg.wParam;<br>}<br></span></div><br>运行截图：<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/r_LockLoad.jpg><br><br></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
用DirectX Audio和DirectShow播放声音和音乐（2）</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-2/ title="用DirectX Audio和DirectShow播放声音和音乐（2）">https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-2/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-3/ rel=next title="用DirectX Audio和DirectShow播放声音和音乐（3）"><i class="fa fa-chevron-left"></i> 用DirectX Audio和DirectShow播放声音和音乐（3）</a></div><div class="post-nav-prev post-nav-item"><a href=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-1/ rel=prev title="用DirectX Audio和DirectShow播放声音和音乐（1）">用DirectX Audio和DirectShow播放声音和音乐（1）
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"playing-sound-and-music-with-directx-audio-and-directshow-part-2","permalink":"https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-2/","title":"用DirectX Audio和DirectShow播放声音和音乐（2）","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1761990624" defer></script></body></html>