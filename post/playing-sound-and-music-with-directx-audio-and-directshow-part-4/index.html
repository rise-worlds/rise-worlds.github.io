<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（4）"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="用DirectX Audio和DirectShow播放声音和音乐（4）"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-4/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2007-07-29 14:09:00 +0800 +0800"><meta property="article:modified_time" content="2007-08-27 17:18:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1761990628"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>用DirectX Audio和DirectShow播放声音和音乐（4） - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>678</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>678</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2418817></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5198></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-01 14:55:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-4/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（4）"><meta itemprop=description content="使用通告“通告”是一种触发机制，当缓存中播放位置达到某个固定的位置时，就会向程序发出通知。有了通告，就可以知道播放什么时候结束，这种机制在比较长的声音中特别有效。通告使用一个叫做 IDirectSoundNotify8的对象，这个程序的作用就是在音频缓存中标记一个位置，然后触发事件通知应用程序，而应用程序可以通过消息循环或者单独的线程进行处理。标记的位置可以是一个缓存中的偏移值，也可以是由宏指定的停止标记，这个表示停止的宏是 DSBPN_OFFSETSTOP。并不是任何偏移值都可以用来作为通告发生的位置，这个值必须和音频的数据块对齐，并且通告的偏移必须按照从小到大的顺序排列。偏移值是不能够共享的，如果使用 DSBPN_OFFSETSTOP宏，它必须被放在最后。举例来说，对于一个块大小为2的音频（单声道、16位），尝试对偏移为4和5的位置设通告会导致失败，因为偏移量位置4和5都在同一个数据块中。如果要在缓存中使用通告，必须在创建缓存的时候使用 DSBCAPS_CTRLPOSITIONNOTIFY标志，并且如果在创建缓存的过程中使用了这个标志，就必须使用通告对象。如果希望获取 IDirectSoundNotify8对象，可以在IDirectSoundBuffer8对象中通过请求接口来获得。"></span><header class=post-header><h1 class=post-title itemprop="name headline">用DirectX Audio和DirectShow播放声音和音乐（4）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月29日 14:09:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-29 14:09:00 +0800 +0800">2007年07月29日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:18:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:18:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>40890</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>82分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-4/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><span style=font-weight:700;color:#aa2a42>使用通告</span><br><br>“通告”是一种触发机制，当缓存中播放位置达到某个固定的位置时，就会向程序发出通知。有了通告，就可以知道播放什么时候结束，这种机制在比较长的声音中特别有效。通告使用一个叫做 IDirectSoundNotify8的对象，这个程序的作用就是在音频缓存中标记一个位置，然后触发事件通知应用程序，而应用程序可以通过消息循环或者单独的线程进行处理。<br><br>标记的位置可以是一个缓存中的偏移值，也可以是由宏指定的停止标记，这个表示停止的宏是 DSBPN_OFFSETSTOP。并不是任何偏移值都可以用来作为通告发生的位置，这个值必须和音频的数据块对齐，并且通告的偏移必须按照从小到大的顺序排列。偏移值是不能够共享的，如果使用 DSBPN_OFFSETSTOP宏，它必须被放在最后。举例来说，对于一个块大小为2的音频（单声道、16位），尝试对偏移为4和5的位置设通告会导致失败，因为偏移量位置4和5都在同一个数据块中。<br><br>如果要在缓存中使用通告，必须在创建缓存的时候使用 DSBCAPS_CTRLPOSITIONNOTIFY标志，并且如果在创建缓存的过程中使用了这个标志，就必须使用通告对象。如果希望获取 IDirectSoundNotify8对象，可以在IDirectSoundBuffer8对象中通过请求接口来获得。<br><br></p><a id=more></a><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>&nbsp;IDirectSound8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directsound&nbsp;component<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;main&nbsp;sound&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_ds</span><span style=color:#000>-></span><span style=color:#000>CreateSoundBuffer(</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_desc,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_primary,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;newer&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(ds_buffer_primary</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IDirectSoundBuffer8,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_second)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_primary</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><br>通告对象只有一个成员函数SetNotificationPositions。<br><br><p><font style=font-size:11pt face=Arial>The SetNotificationPositions method sets the notification positions. During capture or playback, whenever the read or play cursor reaches one of the specified offsets, the associated event is signaled.</font></p><pre class=syntax><font style=font-size:11pt face=Arial><strong>HRESULT SetNotificationPositions(</strong><br> <strong>DWORD</strong> <em>dwPositionNotifies</em><strong>,</strong><br> <strong>LPCDSBPOSITIONNOTIFY</strong> <em>pcPositionNotifies</em><br><strong>);</strong></font></pre><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>dwPositionNotifies</em></font><dd><font style=font-size:11pt face=Arial>Number of DSBPOSITIONNOTIFY structures.</font><dt><font style=font-size:11pt face=Arial><em>pcPositionNotifies</em></font><dd><font style=font-size:11pt face=Arial>Pointer to an array of DSBPOSITIONNOTIFY structures (the maximum array size is DSBNOTIFICATIONS_MAX).</font></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the method succeeds, the return value is DS_OK. If the method fails, the return value may be one of the following error values:</font></p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><td bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Return code</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_INVALIDPARAM</font></td></tr><tr><td><font style=font-size:11pt face=Arial>DSERR_OUTOFMEMORY</font></td></tr></tbody></table><h4><font style=font-size:11pt face=Arial>Remarks</font></h4><p><font style=font-size:11pt face=Arial>The value DSBPN_OFFSETSTOP can be specified in the dwOffset member to tell DirectSound to signal the associated event when the Stop or Stop method is called or when the end of the buffer has been reached and the playback is not looping. If it is used, this should be the last item in the position-notify array.</font></p><p><font style=font-size:11pt face=Arial>If a position-notify array has already been set, the method replaces the previous array.</font></p><p><font style=font-size:11pt face=Arial>The buffer must be stopped when this method is called.</font></p><br>pcPositionNotifies是一个DSBPOSITIONNOTIFY结构的数组。<br><br><p><font style=font-size:11pt face=Arial>The DSBPOSITIONNOTIFY structure describes a notification position. It is used by IDirectSoundNotify8::SetNotificationPositions.</font></p><pre class=syntax><font style=font-size:11pt face=Arial>typedef struct DSBPOSITIONNOTIFY {<br> DWORD dwOffset;<br> HANDLE hEventNotify;<br>} DSBPOSITIONNOTIFY;</font></pre><h4><font style=font-size:11pt face=Arial>Members</font></h4><dl><dt><font style=font-size:11pt face=Arial><strong>dwOffset</strong></font><dd><font style=font-size:11pt face=Arial>Offset from the beginning of the buffer where the notify event is to be triggered, or DSBPN_OFFSETSTOP.</font><dt><font style=font-size:11pt face=Arial><strong>hEventNotify</strong></font><dd><font style=font-size:11pt face=Arial>Handle to the event to be signaled when the offset has been reached.</font></dd></dl><h4><font style=font-size:11pt face=Arial>Remarks</font></h4><p><font style=font-size:11pt face=Arial>The DSBPN_OFFSETSTOP value in the dwOffset member causes the event to be signaled when playback or capture stops, either because the end of the buffer has been reached (and playback or capture is not looping) or because the application called the IDirectSoundBuffer8::Stop or IDirectSoundCaptureBuffer8::Stop method.</font></p><p><font style=font-size:11pt face=Arial>>When a playback buffer was created with DSBCAPS_LOCDEFER and DSBCAPS_CTRLPOSITIONNOTIFY along with any voice management flag, it is possible that a sound that has notifications set, but not yet reached, will be terminated by the voice manager. In this case, no event is signaled.</font></p><br>在使用通告的时候，一般需要使用事件句柄，事件一般有两种状态存在，已发出信号和未发出信号，可以通过CreateEvent函数来创建事件。<br><br><div class=clsServerSDKContent><font style=font-size:11pt face=Arial>The <a><strong>CreateEvent</strong></a> function creates or opens a named or unnamed event object.</font><pre class=syntax xml:space=preserve><font style=font-size:11pt face=Arial><strong>HANDLE</strong> <strong>CreateEvent(</strong><br> <strong>LPSECURITY_ATTRIBUTES</strong> <em><a class=synParam onclick=showTip(this)>lpEventAttributes</a></em><strong>,<br></strong> <strong>BOOL</strong> <em><a class=synParam onclick=showTip(this)>bManualReset</a></em><strong>,<br></strong> <strong>BOOL</strong> <em><a class=synParam onclick=showTip(this)>bInitialState</a></em><strong>,<br></strong> <strong>LPCTSTR</strong> <em><a class=synParam onclick=showTip(this)>lpName</a></em><strong><br>);</strong> </font></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>lpEventAttributes</em></font><dd><font style=font-size:11pt face=Arial>[in] Pointer to a <mshelp:link tabindex=0 keywords=security.security_attributes errorurl=../common/badjump.htm><strong>SECURITY_ATTRIBUTES</strong></mshelp:link> structure that determines whether the returned handle can be inherited by child processes. If <em>lpEventAttributes</em> is NULL, the handle cannot be inherited.</font><p><font style=font-size:11pt face=Arial>The <strong>lpSecurityDescriptor</strong> member of the structure specifies a security descriptor for the new event. If <em>lpEventAttributes</em> is NULL, the event gets a default security descriptor. The ACLs in the default security descriptor for an event come from the primary or impersonation token of the creator.</font></p><dt><font style=font-size:11pt face=Arial><em>bManualReset</em></font><dd><font style=font-size:11pt face=Arial>[in] If this parameter is TRUE, the function creates a manual-reset event object, which requires the use of the <strong>ResetEvent</strong> function to set the event state to nonsignaled. If this parameter is FALSE, the function creates an auto-reset event object, and system automatically resets the event state to nonsignaled after a single waiting thread has been released.</font><dt><font style=font-size:11pt face=Arial><em>bInitialState</em></font><dd><font style=font-size:11pt face=Arial>[in] If this parameter is TRUE, the initial state of the event object is signaled; otherwise, it is nonsignaled.</font><dt><font style=font-size:11pt face=Arial><em>lpName</em></font><dd><font style=font-size:11pt face=Arial>[in] Pointer to a null-terminated string specifying the name of the event object. The name is limited to MAX_PATH characters. Name comparison is case sensitive.</font><p><font style=font-size:11pt face=Arial>If <em>lpName</em> matches the name of an existing named event object, this function requests the EVENT_ALL_ACCESS access right. In this case, the <em>bManualReset</em> and <em>bInitialState</em> parameters are ignored because they have already been set by the creating process. If the <em>lpEventAttributes</em> parameter is not NULL, it determines whether the handle can be inherited, but its security-descriptor member is ignored.</font></p><p><font style=font-size:11pt face=Arial>If <em>lpName</em> is NULL, the event object is created without a name.</font></p><p><font style=font-size:11pt face=Arial>If <em>lpName</em> matches the name of an existing semaphore, mutex, waitable timer, job, or file-mapping object, the function fails and the <mshelp:link tabindex=0 keywords=base.getlasterror errorurl=../common/badjump.htm><strong>GetLastError</strong></mshelp:link> function returns ERROR_INVALID_HANDLE. This occurs because these objects share the same name space.</font></p><blockquote><font style=font-size:11pt face=Arial><strong>Terminal Services:&nbsp;&nbsp;</strong> The name can have a "Global\" or "Local\" prefix to explicitly create the object in the global or session name space. The remainder of the name can contain any character except the backslash character (\). For more information, see <mshelp:link tabindex=0 keywords=_win32_kernel_object_namespaces errorurl=../common/badjump.htm>Kernel Object Namespaces</mshelp:link>.</font></blockquote><blockquote><font style=font-size:11pt face=Arial><strong>Windows&nbsp;XP:&nbsp;&nbsp;</strong> Fast user switching is implemented using Terminal Services sessions. The first user to log on uses session 0, the next user to log on uses session 1, and so on. Kernel object names must follow the guidelines outlined for Terminal Services so that applications can support multiple users.</font></blockquote><blockquote><font style=font-size:11pt face=Arial><strong>Windows&nbsp;2000:&nbsp;&nbsp;</strong> If Terminal Services is not running, the "Global\" and "Local\" prefixes are ignored. The remainder of the name can contain any character except the backslash character.</font></blockquote><blockquote><font style=font-size:11pt face=Arial><strong>Windows&nbsp;NT:&nbsp;&nbsp;</strong>The name can contain any character except the backslash character.</font></blockquote><blockquote><font style=font-size:11pt face=Arial><strong>Windows Me/98/95:&nbsp;&nbsp;</strong> The name can contain any character except the backslash character. The empty string ("") is a valid object name.</font></blockquote></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the function succeeds, the return value is a handle to the event object. If the named event object existed before the function call, the function returns a handle to the existing object and <strong>GetLastError</strong> returns ERROR_ALREADY_EXISTS.</font></p><p><font style=font-size:11pt face=Arial>If the function fails, the return value is NULL. To get extended error information, call <strong>GetLastError</strong>.</font></p><h4><font style=font-size:11pt face=Arial>Remarks</font></h4><p><font style=font-size:11pt face=Arial>The handle returned by <a><strong>CreateEvent</strong></a> has the EVENT_ALL_ACCESS access right; it can be used in any function that requires a handle to an event object, provided that the caller has been granted access. If an event is created from a service or a thread that is impersonating a different user, you can either apply a security descriptor to the event when you create it, or change the default security descriptor for the creating process by changing its default DACL. For more information, see Synchronization Object Security and Access Rights.</font></p><p><font style=font-size:11pt face=Arial>Any thread of the calling process can specify the event-object handle in a call to one of the wait functions. The single-object wait functions return when the state of the specified object is signaled. The multiple-object wait functions can be instructed to return either when any one or when all of the specified objects are signaled. When a wait function returns, the waiting thread is released to continue its execution.</font></p><p><font style=font-size:11pt face=Arial>The initial state of the event object is specified by the <em>bInitialState</em> parameter. Use the <strong>SetEvent</strong> function to set the state of an event object to signaled. Use the <strong>ResetEvent</strong> function to reset the state of an event object to nonsignaled.</font></p><p><font style=font-size:11pt face=Arial>When the state of a manual-reset event object is signaled, it remains signaled until it is explicitly reset to nonsignaled by the <strong>ResetEvent</strong> function. Any number of waiting threads, or threads that subsequently begin wait operations for the specified event object, can be released while the object's state is signaled.</font></p><p><font style=font-size:11pt face=Arial>When the state of an auto-reset event object is signaled, it remains signaled until a single waiting thread is released; the system then automatically resets the state to nonsignaled. If no threads are waiting, the event object's state remains signaled.</font></p><p><font style=font-size:11pt face=Arial>Multiple processes can have handles of the same event object, enabling use of the object for interprocess synchronization. The following object-sharing mechanisms are available:</font></p><ul>&nbsp;<li><font style=font-size:11pt face=Arial>A child process created by the <strong>CreateProcess</strong> function can inherit a handle to an event object if the <em>lpEventAttributes</em> parameter of <a><strong>CreateEvent</strong></a> enabled inheritance.</font><li><font style=font-size:11pt face=Arial>A process can specify the event-object handle in a call to the <mshelp:link tabindex=0 keywords=base.duplicatehandle errorurl=../common/badjump.htm><strong>DuplicateHandle</strong></mshelp:link> function to create a duplicate handle that can be used by another process.</font><li><font style=font-size:11pt face=Arial>A process can specify the name of an event object in a call to the <strong>OpenEvent</strong> or <a><strong>CreateEvent</strong></a> function.</font></li></ul><p><font style=font-size:11pt face=Arial>Use the <mshelp:link tabindex=0 keywords=base.closehandle errorurl=../common/badjump.htm><strong>CloseHandle</strong></mshelp:link> function to close the handle. The system closes the handle automatically when the process terminates. The event object is destroyed when its last handle has been closed.</font></p></div><br>以下代码创建了4个事件，并且给pos_notify设置了4个事件触发的位置标记。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>HANDLE&nbsp;&nbsp;g_events[</span><span style=color:#000>4</span><span style=color:#000>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;notification&nbsp;handles</span><span style=color:green><br></span><span style=color:#000>DSBPOSITIONNOTIFY&nbsp;&nbsp;&nbsp;pos_notify[</span><span style=color:#000>4</span><span style=color:#000>];<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;event&nbsp;handles&nbsp;and&nbsp;set&nbsp;the&nbsp;notifications</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;</span><span style=color:#000>4</span><span style=color:#000>;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;an&nbsp;unnamed&nbsp;event&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_events[i]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateEvent(NULL,&nbsp;FALSE,&nbsp;FALSE,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos_notify[i].dwOffset&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;(i</span><span style=color:#000>+</span><span style=color:#000>1</span><span style=color:#000>)&nbsp;</span><span style=color:#000>-</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos_notify[i].hEventNotify&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_events[i];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;notification&nbsp;position<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;During&nbsp;capture&nbsp;or&nbsp;playback,&nbsp;whenever&nbsp;the&nbsp;read&nbsp;or&nbsp;play&nbsp;cursor&nbsp;reached&nbsp;one&nbsp;of&nbsp;the&nbsp;specified&nbsp;offsets,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;the&nbsp;associated&nbsp;event&nbsp;is&nbsp;signaled.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_notify</span><span style=color:#000>-></span><span style=color:#000>SetNotificationPositions(</span><span style=color:#000>4</span><span style=color:#000>,&nbsp;pos_notify);</span></div><br>在缓存已经准备就绪之后，就可以开始播放了，播放时等待通告事件被触发，它是WaitForMultipleObjects函数的工作。<br><br><div class=clsServerSDKContent><font style=font-size:11pt face=Arial>The <strong>WaitForMultipleObjects</strong> function returns when any one or all of the specified objects are in the signaled state or the time-out interval elapses.</font><p><font style=font-size:11pt face=Arial>To enter an alertable wait state, use the <strong>WaitForMultipleObjectsEx</strong> function.</font></p><pre class=syntax xml:space=preserve><font style=font-size:11pt face=Arial><strong>DWORD</strong> <strong>WaitForMultipleObjects(</strong><br> <strong>DWORD</strong> <em><a class=synParam onclick=showTip(this)>nCount</a></em><strong>,<br></strong> <strong>const HANDLE*</strong> <em><a class=synParam onclick=showTip(this)>lpHandles</a></em><strong>,<br></strong> <strong>BOOL</strong> <em><a class=synParam onclick=showTip(this)>bWaitAll</a></em><strong>,<br></strong> <strong>DWORD</strong> <em><a class=synParam onclick=showTip(this)>dwMilliseconds</a></em><strong><br>);</strong> </font></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>nCount</em></font><dd><font style=font-size:11pt face=Arial>[in] Number of object handles in the array pointed to by <em>lpHandles</em>. The maximum number of object handles is MAXIMUM_WAIT_OBJECTS.</font><dt><font style=font-size:11pt face=Arial><em>lpHandles</em></font><dd><font style=font-size:11pt face=Arial>[in] Pointer to an array of object handles. For a list of the object types whose handles can be specified, see the following Remarks section. The array can contain handles to objects of different types. It may not contain the multiple copies of the same handle.</font><p><font style=font-size:11pt face=Arial>If one of these handles is closed while the wait is still pending, the function's behavior is undefined.</font></p><p><font style=font-size:11pt face=Arial>The handles must have the SYNCHRONIZE access right. For more information, see <mshelp:link tabindex=0 keywords=security.standard_access_rights errorurl=../common/badjump.htm>Standard Access Rights</mshelp:link>.</font></p><blockquote><font style=font-size:11pt face=Arial><strong>Windows Me/98/95:&nbsp;&nbsp;</strong>No handle may be a duplicate of another handle created using <mshelp:link tabindex=0 keywords=base.duplicatehandle errorurl=../common/badjump.htm><strong>DuplicateHandle</strong></mshelp:link>.</font></blockquote><dt><font style=font-size:11pt face=Arial><em>bWaitAll</em></font><dd><font style=font-size:11pt face=Arial>[in] If this parameter is TRUE, the function returns when the state of all objects in the <em>lpHandles</em> array is signaled. If FALSE, the function returns when the state of any one of the objects is set to signaled. In the latter case, the return value indicates the object whose state caused the function to return.</font><dt><font style=font-size:11pt face=Arial><em>dwMilliseconds</em></font><dd><font style=font-size:11pt face=Arial>[in] Time-out interval, in milliseconds. The function returns if the interval elapses, even if the conditions specified by the <em>bWaitAll</em> parameter are not met. If <em>dwMilliseconds</em> is zero, the function tests the states of the specified objects and returns immediately. If <em>dwMilliseconds</em> is INFINITE, the function's time-out interval never elapses.</font></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the function succeeds, the return value indicates the event that caused the function to return. It can be one of the following values. (Note that WAIT_OBJECT_0 is defined as 0 and WAIT_ABANDONED_0 is defined as 0x00000080L.)</font></p><table style=border-collapse:collapse bordercolor=#808080 border=1><tbody><tr><th bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Return code/value</font></th><th bgcolor=#c0c0c0><font style=font-size:11pt face=Arial>Description</font></th></tr><tr><td width=40%><font style=font-size:11pt face=Arial><br>WAIT_OBJECT_0 to (WAIT_OBJECT_0 + <em>nCount</em>– 1)</font></td><td width=60%><font style=font-size:11pt face=Arial>If <em>bWaitAll</em> is TRUE, the return value indicates that the state of all specified objects is signaled.</font><p><font style=font-size:11pt face=Arial>If <em>bWaitAll</em> is FALSE, the return value minus WAIT_OBJECT_0 indicates the <em>lpHandles</em> array index of the object that satisfied the wait. If more than one object became signaled during the call, this is the array index of the signaled object with the smallest index value of all the signaled objects.</font></p></td></tr><tr><td width=40% height=93><font style=font-size:11pt face=Arial><br>WAIT_ABANDONED_0 to (WAIT_ABANDONED_0 + <em>nCount</em>– 1)</font></td><td width=60% height=93><font style=font-size:11pt face=Arial>If <em>bWaitAll</em> is TRUE, the return value indicates that the state of all specified objects is signaled and at least one of the objects is an abandoned mutex object.</font><p><font style=font-size:11pt face=Arial>If <em>bWaitAll</em> is FALSE, the return value minus WAIT_ABANDONED_0 indicates the <em>lpHandles</em> array index of an abandoned mutex object that satisfied the wait.</font></p></td></tr><tr><td width=40%><font style=font-size:11pt face=Arial>WAIT_TIMEOUT<br>0x00000102L</font></td><td width=60%><font style=font-size:11pt face=Arial>The time-out interval elapsed and the conditions specified by the <em>bWaitAll</em> parameter are not satisfied.</font></td></tr></tbody></table><p><font style=font-size:11pt face=Arial>If the function fails, the return value is WAIT_FAILED. To get extended error information, call <mshelp:link tabindex=0 keywords=base.getlasterror errorurl=../common/badjump.htm><strong>GetLastError</strong></mshelp:link>.</font></p></div><br>WaitForMultipleObjects函数可以同时等待64个对象，请确定自己的对象数目小于这个最大值。在没有接收到任何事件的情况下，函数可能会返回WAIT_FAILED，遇到这种情况，只需要再调用一次这个函数，就能恢复正常。取得 WaitForMultipleObjects函数的返回值就能够获取事件号。获取到事件号后，用这个数字减去 WAIT_OBJECT_0，得到的结果就是触发的事件索引号，这个值的范围从0到事件总数减1。<br><br>以下代码示例了如何使用WaitForMultipleObjects，以及如何得到事件索引号。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>HANDLE&nbsp;&nbsp;g_events[</span><span style=color:#000>4</span><span style=color:#000>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;notification&nbsp;handles<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;wait&nbsp;for&nbsp;a&nbsp;message<br></span><span style=color:green>//</span><span style=color:green><br></span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;when&nbsp;any&nbsp;one&nbsp;or&nbsp;all&nbsp;of&nbsp;the&nbsp;specified&nbsp;objects&nbsp;are&nbsp;in&nbsp;the&nbsp;signaled&nbsp;state&nbsp;or&nbsp;the&nbsp;time-out&nbsp;<br>&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;interval&nbsp;elapses.</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;result&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;MsgWaitForMultipleObjects(</span><span style=color:#000>4</span><span style=color:#000>,&nbsp;g_events,&nbsp;FALSE,&nbsp;INFINITE,&nbsp;QS_ALLEVENTS);<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;notification&nbsp;#</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;thread_index&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;result&nbsp;</span><span style=color:#000>-</span><span style=color:#000>&nbsp;WAIT_OBJECT_0;</span></div><br><span style=font-weight:700;color:#aa2a42><br>使用线程控制事件</span><br><br>创建线程可以通过调用CreateThread函数来实现。<br><br><div class=clsServerSDKContent><font style=font-size:11pt face=Arial>The <a><strong>CreateThread</strong></a> function creates a thread to execute within the virtual address space of the calling process.</font><p><font style=font-size:11pt face=Arial>To create a thread that runs in the virtual address space of another process, use the <strong>CreateRemoteThread</strong> function.</font></p><pre class=syntax xml:space=preserve><font style=font-size:11pt face=Arial><strong>HANDLE</strong> <strong>CreateThread(</strong><br> <strong>LPSECURITY_ATTRIBUTES</strong> <em><a class=synParam onclick=showTip(this)>lpThreadAttributes</a></em><strong>,<br></strong> <strong>SIZE_T</strong> <em><a class=synParam onclick=showTip(this)>dwStackSize</a></em><strong>,<br></strong> <strong>LPTHREAD_START_ROUTINE</strong> <em><a class=synParam onclick=showTip(this)>lpStartAddress</a></em><strong>,<br></strong> <strong>LPVOID</strong> <em><a class=synParam onclick=showTip(this)>lpParameter</a></em><strong>,<br></strong> <strong>DWORD</strong> <em><a class=synParam onclick=showTip(this)>dwCreationFlags</a></em><strong>,<br></strong> <strong>LPDWORD</strong> <em><a class=synParam onclick=showTip(this)>lpThreadId</a></em><strong><br>);</strong> </font></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>lpThreadAttributes</em></font><dd><font style=font-size:11pt face=Arial>[in] Pointer to a <mshelp:link tabindex=0 keywords=security.security_attributes errorurl=../common/badjump.htm><strong>SECURITY_ATTRIBUTES</strong></mshelp:link> structure that determines whether the returned handle can be inherited by child processes. If <em>lpThreadAttributes</em> is NULL, the handle cannot be inherited.</font><p><font style=font-size:11pt face=Arial>The <strong>lpSecurityDescriptor</strong> member of the structure specifies a security descriptor for the new thread. If <em>lpThreadAttributes</em> is NULL, the thread gets a default security descriptor. The ACLs in the default security descriptor for a thread come from the primary token of the creator.</font></p><blockquote><font style=font-size:11pt face=Arial><strong>Windows XP/2000/NT:&nbsp;&nbsp;</strong>The ACLs in the default security descriptor for a thread come from the primary or impersonation token of the creator. This behavior changed with Windows&nbsp;XP SP2 and Windows Server&nbsp;2003.</font></blockquote><p></p><dt><font style=font-size:11pt face=Arial><em>dwStackSize</em></font><dd><font style=font-size:11pt face=Arial>[in] Initial size of the stack, in bytes. The system rounds this value to the nearest page. If this parameter is zero, the new thread uses the default size for the executable. For more information, see Thread Stack Size.</font><dt><font style=font-size:11pt face=Arial><em>lpStartAddress</em></font><dd><font style=font-size:11pt face=Arial>[in] Pointer to the application-defined function to be executed by the thread and represents the starting address of the thread. For more information on the thread function, see <strong>ThreadProc</strong>.</font><dt><font style=font-size:11pt face=Arial><em>lpParameter</em></font><dd><font style=font-size:11pt face=Arial>[in] Pointer to a variable to be passed to the thread.</font><dt><font style=font-size:11pt face=Arial><em>dwCreationFlags</em></font><dd><font style=font-size:11pt face=Arial>[in] Flags that control the creation of the thread. If the CREATE_SUSPENDED flag is specified, the thread is created in a suspended state, and will not run until the <strong>ResumeThread</strong> function is called. If this value is zero, the thread runs immediately after creation.</font><p><font style=font-size:11pt face=Arial>If the STACK_SIZE_PARAM_IS_A_RESERVATION flag is specified, the <em>dwStackSize</em> parameter specifies the initial reserve size of the stack. Otherwise, <em>dwStackSize</em> specifies the commit size.</font></p><blockquote><font style=font-size:11pt face=Arial><strong>Windows&nbsp;2000/NT and Windows Me/98/95:&nbsp;&nbsp;</strong>The STACK_SIZE_PARAM_IS_A_RESERVATION flag is not supported.</font></blockquote><dt><font style=font-size:11pt face=Arial><em>lpThreadId</em></font><dd><font style=font-size:11pt face=Arial>[out] Pointer to a variable that receives the thread identifier. If this parameter is NULL, the thread identifier is not returned.</font><blockquote><font style=font-size:11pt face=Arial><strong>Windows Me/98/95:&nbsp;&nbsp;</strong>This parameter may not be NULL.</font></blockquote></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>If the function succeeds, the return value is a handle to the new thread.</font></p><p><font style=font-size:11pt face=Arial>If the function fails, the return value is NULL. To get extended error information, call <mshelp:link tabindex=0 keywords=_win32_getlasterror errorurl=../common/badjump.htm><strong>GetLastError</strong></mshelp:link>.</font></p><p><font style=font-size:11pt face=Arial>Note that <a><strong>CreateThread</strong></a> may succeed even if <em>lpStartAddress</em> points to data, code, or is not accessible. If the start address is invalid when the thread runs, an exception occurs, and the thread terminates. Thread termination due to a invalid start address is handled as an error exit for the thread's process. This behavior is similar to the asynchronous nature of <strong>CreateProcess</strong>, where the process is created even if it refers to invalid or missing dynamic-link libraries (DLLs).</font></p><blockquote><font style=font-size:11pt face=Arial><strong>Windows Me/98/95:&nbsp;&nbsp;</strong><a><strong>CreateThread</strong></a> succeeds only when it is called in the context of a 32-bit program. A 32-bit DLL cannot create an additional thread when that DLL is being called by a 16-bit program.</font></blockquote></div><br>lpStartAddress是一个函数指针，该函数指针的定义如下：<br><br><div class=clsServerSDKContent><font style=font-size:11pt face=Arial>The <a><strong>ThreadProc</strong></a> function is an application-defined function that serves as the starting address for a thread. Specify this address when calling the <strong>CreateThread</strong> or <strong>CreateRemoteThread</strong> function. The <strong>LPTHREAD_START_ROUTINE</strong> type defines a pointer to this callback function. <a><strong>ThreadProc</strong></a> is a placeholder for the application-defined function name.</font><pre class=syntax xml:space=preserve><font style=font-size:11pt face=Arial><strong>DWORD WINAPI</strong> <strong>ThreadProc(</strong><br> <strong>LPVOID</strong> <em><a class=synParam onclick=showTip(this)>lpParameter</a></em><strong><br>);</strong> </font></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4><font style=font-size:11pt face=Arial>Parameters</font></h4><dl><dt><font style=font-size:11pt face=Arial><em>lpParameter</em></font><dd><font style=font-size:11pt face=Arial>[in] Thread data passed to the function using the <em>lpParameter</em> parameter of the <strong>CreateThread</strong> or <strong>CreateRemoteThread</strong> function.</font></dd></dl><h4><font style=font-size:11pt face=Arial>Return Values</font></h4><p><font style=font-size:11pt face=Arial>The function should return a value that indicates its success or failure.</font></p><h4><font style=font-size:11pt face=Arial>Remarks</font></h4><p><font style=font-size:11pt face=Arial>A process can determine when a thread it created has completed by using one of the wait functions. It can also obtain the return value of its <a><strong>ThreadProc</strong></a> by calling the <strong>GetExitCodeThread</strong> function.</font></p><p><font style=font-size:11pt face=Arial>Each thread receives a unique copy of the local variables of this function. Any static or global variables are shared by all threads in the process. To provide unique data to each thread using a global index, use thread local storage.</font></p></div><br>以下代码演示了如何使用函数CreateThread。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>HANDLE&nbsp;&nbsp;g_thread_handle;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;thread&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;&nbsp;&nbsp;g_thread_id;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;thread&nbsp;id<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;a&nbsp;thread&nbsp;for&nbsp;notifications</span><span style=color:green><br></span><span style=color:#000>g_thread_handle&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateThread(NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPTHREAD_START_ROUTINE)&nbsp;Handle_Notifications,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_thread_id);<br>......<br><br>DWORD&nbsp;Handle_Notifications(LPVOID&nbsp;thread_data)<br>{<br>&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;thread&nbsp;function&nbsp;to&nbsp;handle</span><span style=color:green> notification</span><span style=color:green> event&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp; ......<br>}<br><br></span></div><br><span style=font-weight:700;color:#aa2a42>音频流</span><br><br>音频流是一种很简单很容易理解的处理方式，就是循环播放一个缓冲区的音频数据，在播放的时候不断更新这个缓冲区的数据，使得播放能无缝播放。在播放音频缓冲区的时候设置一系列的标志位，然后需要一个指示器告诉应该在刚刚播放掉的部分填充一些新数据。在每次缓冲区播放完毕后，只需要从头开始继续播放，就能将音频连续地播放下去。<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/r_signal.jpg><br><br>上面的这段音频缓冲区有4个标志位，当回放到某个标志位时就表示应该填充新数据到刚刚播放的部分中。<br><br>使用音频流的第一步是用数据填充整个缓冲区，然后开始播放声音，直到播放到达第一个标志位的时候，再读取一段新的数据，取代刚刚播放完成的数据。然后继续播放到达第二个标志位，再读取新数据取代刚刚播放完成的部分。持续这个过程，直到整段音频数据播放完成，最后一个播放到的标志触发一个停止播放的事件。如果需要循环播放音频，只需不触发停止事件，重新开始刚才的过程。在处理通告事件的线程中，使用加载数据的函数不断更新音频缓冲区的数据，保证缓冲区中拥有完成的音频信息。<br><br>下面是整个操作的全部过程：<br><br>1、创建音频缓冲区，65536字节大小。<br>2、设置4个通告位置，每个通告标志都在缓冲区的1/4处。<br>3、用数据填充整个缓冲区。<br>4、使用DSBPLAY_LOOP标志播放音频。<br>5、在每个通告被触发的时候，用新数据填充刚刚播放掉的部分，持续这个过程，直到有通告显示缓冲区中已经没有更多的数据可以放入缓冲区中，最后再播放剩余部分即可。<br>6、最后判断哪个事件表示已经到达了音频数据末端。<br><br>以下是代码示例：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>IDirectSound8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directsound&nbsp;component</span><span style=color:green><br></span><span style=color:#000>IDirectSoundBuffer8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;sound&nbsp;buffer&nbsp;object</span><span style=color:green><br></span><span style=color:#000>IDirectSoundNotify8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_notify;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;notification&nbsp;object</span><span style=color:green><br></span><span style=color:#000><br>HANDLE&nbsp;&nbsp;g_thread_handle;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;thread&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;&nbsp;&nbsp;g_thread_id;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;thread&nbsp;id</span><span style=color:green><br></span><span style=color:#000>HANDLE&nbsp;&nbsp;g_events[</span><span style=color:#000>4</span><span style=color:#000>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;notification&nbsp;handles</span><span style=color:green><br></span><span style=color:#000>FILE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;g_fp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;.WAV&nbsp;file&nbsp;handle</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_size;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directsound&nbsp;data&nbsp;buffer&nbsp;size</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_pos;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;current&nbsp;directsound&nbsp;buffer&nbsp;position</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;leave&nbsp;directsound&nbsp;buffer&nbsp;data&nbsp;needed&nbsp;to&nbsp;be&nbsp;played<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Handle&nbsp;directsound&nbsp;nofification&nbsp;evenet,&nbsp;just&nbsp;stream&nbsp;load&nbsp;sound&nbsp;buffer.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;Handle_Notifications(LPVOID&nbsp;thread_data)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(</span><span style=color:#000>1</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;wait&nbsp;for&nbsp;a&nbsp;message<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;when&nbsp;any&nbsp;one&nbsp;or&nbsp;all&nbsp;of&nbsp;the&nbsp;specified&nbsp;objects&nbsp;are&nbsp;in&nbsp;the&nbsp;signaled&nbsp;state&nbsp;or&nbsp;the&nbsp;time-out&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;interval&nbsp;elapses.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;result&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;MsgWaitForMultipleObjects(</span><span style=color:#000>4</span><span style=color:#000>,&nbsp;g_events,&nbsp;FALSE,&nbsp;INFINITE,&nbsp;QS_ALLEVENTS);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;notification&nbsp;#</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;thread_index&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;result&nbsp;</span><span style=color:#000>-</span><span style=color:#000>&nbsp;WAIT_OBJECT_0;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;check&nbsp;for&nbsp;update&nbsp;#</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(thread_index&nbsp;</span><span style=color:#000>>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>&nbsp;</span><span style=color:#000>&&</span><span style=color:#000>&nbsp;thread_index&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;</span><span style=color:#000>4</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;stop&nbsp;sound&nbsp;and&nbsp;quit&nbsp;thread&nbsp;if&nbsp;no&nbsp;more</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_ds_leave&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExitThread(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;seek&nbsp;to&nbsp;read&nbsp;position&nbsp;in&nbsp;file</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fseek(g_fp,&nbsp;g_ds_pos,&nbsp;SEEK_SET);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;stream&nbsp;in&nbsp;data&nbsp;based&nbsp;on&nbsp;amount&nbsp;of&nbsp;data&nbsp;left</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_ds_leave&nbsp;</span><span style=color:#000>&lt;=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;if&nbsp;this&nbsp;is&nbsp;reached,&nbsp;then&nbsp;end&nbsp;of&nbsp;sound&nbsp;is&nbsp;coming&nbsp;up.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Load_Sound_Data(g_ds_buffer,&nbsp;thread_index&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>,&nbsp;g_ds_leave,&nbsp;g_fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>else</span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Load_Sound_Data(g_ds_buffer,&nbsp;thread_index&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>,&nbsp;</span><span style=color:#000>65536</span><span style=color:#000>,&nbsp;g_fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;reset&nbsp;directsound&nbsp;buffer&nbsp;leave&nbsp;and&nbsp;current&nbsp;position</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave&nbsp;</span><span style=color:#000>-=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_pos&nbsp;&nbsp;&nbsp;</span><span style=color:#000>+=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Play&nbsp;WAVE&nbsp;file&nbsp;sound&nbsp;which&nbsp;specified&nbsp;by&nbsp;filename.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Play_Stream_Sound(</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;filename)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;DSBPOSITIONNOTIFY&nbsp;&nbsp;&nbsp;pos_notify[</span><span style=color:#000>4</span><span style=color:#000>];<br>&nbsp;&nbsp;&nbsp;&nbsp;WAVE_HEADER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wave_header;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;open&nbsp;the&nbsp;source&nbsp;file</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((g_fp&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;fopen(filename,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>rb</span><span style=color:#000>"</span><span style=color:#000>))&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;a&nbsp;2&nbsp;second&nbsp;buffer&nbsp;to&nbsp;stream&nbsp;in&nbsp;wave</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((g_ds_buffer&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Create_Buffer_From_WAV(g_fp,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>wave_header))&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fclose(g_fp);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;streaming&nbsp;size&nbsp;and&nbsp;pointer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_size&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_header.data_size;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_pos&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WAVE_HEADER);<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_ds_size;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;a&nbsp;thread&nbsp;for&nbsp;notifications</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_thread_handle&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateThread(NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPTHREAD_START_ROUTINE)&nbsp;Handle_Notifications,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_thread_id);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;failed</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_thread_handle&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;notification&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IDirectSoundNotify8,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_ds_notify)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;event&nbsp;handles&nbsp;and&nbsp;set&nbsp;the&nbsp;notifications</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;</span><span style=color:#000>4</span><span style=color:#000>;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;an&nbsp;unnamed&nbsp;event&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_events[i]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateEvent(NULL,&nbsp;FALSE,&nbsp;FALSE,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos_notify[i].dwOffset&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;(i</span><span style=color:#000>+</span><span style=color:#000>1</span><span style=color:#000>)&nbsp;</span><span style=color:#000>-</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos_notify[i].hEventNotify&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_events[i];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;notification&nbsp;position<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;During&nbsp;capture&nbsp;or&nbsp;playback,&nbsp;whenever&nbsp;the&nbsp;read&nbsp;or&nbsp;play&nbsp;cursor&nbsp;reached&nbsp;one&nbsp;of&nbsp;the&nbsp;specified&nbsp;offsets,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;the&nbsp;associated&nbsp;event&nbsp;is&nbsp;signaled.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_notify</span><span style=color:#000>-></span><span style=color:#000>SetNotificationPositions(</span><span style=color:#000>4</span><span style=color:#000>,&nbsp;pos_notify);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;fill&nbsp;buffer&nbsp;completely&nbsp;with&nbsp;sound<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;advance&nbsp;file&nbsp;pointer&nbsp;to&nbsp;data&nbsp;buffer's&nbsp;head</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;fseek(g_fp,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WAVE_HEADER),&nbsp;SEEK_SET);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;load&nbsp;sound&nbsp;buffer&nbsp;data&nbsp;with&nbsp;65536&nbsp;bytes</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;Load_Sound_Data(g_ds_buffer,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>65536</span><span style=color:#000>,&nbsp;g_fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;reset&nbsp;leave&nbsp;sound&nbsp;buffer&nbsp;and&nbsp;current&nbsp;sound&nbsp;buffer&nbsp;position</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave&nbsp;</span><span style=color:#000>-=</span><span style=color:#000>&nbsp;</span><span style=color:#000>65536</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_pos&nbsp;&nbsp;&nbsp;</span><span style=color:#000>+=</span><span style=color:#000>&nbsp;</span><span style=color:#000>65536</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;play&nbsp;sound&nbsp;looping</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>SetCurrentPosition(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>SetVolume(DSBVOLUME_MAX);<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Play(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;DSBPLAY_LOOPING);<br>}</span></div><br>下面用一个例子来演示如何使用刚才介绍的那些知识。<br><br><a href=http://www.cppblog.com/Files/lovedday/Stream.rar><font color=#1b1b1b>点击下载源码和工程</font></a><br><br>完整代码示例：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>/*</span><span style=color:green>**************************************************************************************<br>PURPOSE:<br>&nbsp;&nbsp;&nbsp;&nbsp;Streaming&nbsp;Playback&nbsp;Demo<br>&nbsp;**************************************************************************************</span><span style=color:green>*/</span><span style=color:#000><br><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>windows.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>stdio.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>dsound.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>"</span><span style=color:#000>resource.h</span><span style=color:#000>"</span><span style=color:#000><br><br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dxguid.lib</span><span style=color:#000>"</span><span style=color:#000>)<br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dsound.lib</span><span style=color:#000>"</span><span style=color:#000>)<br><br>#pragma&nbsp;warning(disable&nbsp;:&nbsp;</span><span style=color:#000>4996</span><span style=color:#000>)<br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;Safe_Release(p)&nbsp;if((p))&nbsp;(p)->Release();</span><span style=color:#000><br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;.WAV&nbsp;file&nbsp;header</span><span style=color:green><br></span><span style=color:#00f>struct</span><span style=color:#000>&nbsp;WAVE_HEADER<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;riff_sig[</span><span style=color:#000>4</span><span style=color:#000>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;'RIFF'</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;waveform_chunk_size;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;8</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;wave_sig[</span><span style=color:#000>4</span><span style=color:#000>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;'WAVE'</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;format_sig[</span><span style=color:#000>4</span><span style=color:#000>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;'fmt&nbsp;'&nbsp;(notice&nbsp;space&nbsp;after)</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;format_chunk_size;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;16;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>short</span><span style=color:#000>&nbsp;&nbsp;&nbsp;format_tag;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;WAVE_FORMAT_PCM</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>short</span><span style=color:#000>&nbsp;&nbsp;&nbsp;channels;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;#&nbsp;of&nbsp;channels</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;sample_rate;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;sampling&nbsp;rate</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;bytes_per_sec;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;bytes&nbsp;per&nbsp;second</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>short</span><span style=color:#000>&nbsp;&nbsp;&nbsp;block_align;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;sample&nbsp;block&nbsp;alignment</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>short</span><span style=color:#000>&nbsp;&nbsp;&nbsp;bits_per_sample;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;bits&nbsp;per&nbsp;second</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;data_sig[</span><span style=color:#000>4</span><span style=color:#000>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;'data'</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;data_size;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;size&nbsp;of&nbsp;waveform&nbsp;data</span><span style=color:green><br></span><span style=color:#000>};<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br></span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>StreamClass</span><span style=color:#000>"</span><span style=color:#000>;<br><br>IDirectSound8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directsound&nbsp;component</span><span style=color:green><br></span><span style=color:#000>IDirectSoundBuffer8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;sound&nbsp;buffer&nbsp;object</span><span style=color:green><br></span><span style=color:#000>IDirectSoundNotify8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_notify;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;notification&nbsp;object</span><span style=color:green><br></span><span style=color:#000><br>HANDLE&nbsp;&nbsp;g_thread_handle;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;thread&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;&nbsp;&nbsp;g_thread_id;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;thread&nbsp;id</span><span style=color:green><br></span><span style=color:#000>HANDLE&nbsp;&nbsp;g_events[</span><span style=color:#000>4</span><span style=color:#000>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;notification&nbsp;handles</span><span style=color:green><br></span><span style=color:#000>FILE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;g_fp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;.WAV&nbsp;file&nbsp;handle</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_size;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directsound&nbsp;data&nbsp;buffer&nbsp;size</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_pos;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;current&nbsp;directsound&nbsp;buffer&nbsp;position</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;leave&nbsp;directsound&nbsp;buffer&nbsp;data&nbsp;needed&nbsp;to&nbsp;be&nbsp;played<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Create&nbsp;wave&nbsp;header&nbsp;information&nbsp;from&nbsp;wave&nbsp;file.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>IDirectSoundBuffer8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;Create_Buffer_From_WAV(FILE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;fp,&nbsp;WAVE_HEADER</span><span style=color:#000>*</span><span style=color:#000>&nbsp;wave_header)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;IDirectSoundBuffer</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_primary;<br>&nbsp;&nbsp;&nbsp;&nbsp;IDirectSoundBuffer8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_second;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;DSBUFFERDESC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc;<br>&nbsp;&nbsp;&nbsp;&nbsp;WAVEFORMATEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wave_format;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;read&nbsp;in&nbsp;the&nbsp;header&nbsp;from&nbsp;beginning&nbsp;of&nbsp;file</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;fseek(fp,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;SEEK_SET);<br>&nbsp;&nbsp;&nbsp;&nbsp;fread(wave_header,&nbsp;</span><span style=color:#000>1</span><span style=color:#000>,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WAVE_HEADER),&nbsp;fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;check&nbsp;the&nbsp;sig&nbsp;fields.&nbsp;returning&nbsp;if&nbsp;an&nbsp;error.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(memcmp(wave_header</span><span style=color:#000>-></span><span style=color:#000>riff_sig,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>RIFF</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>4</span><span style=color:#000>)&nbsp;</span><span style=color:#000>||</span><span style=color:#000>&nbsp;memcmp(wave_header</span><span style=color:#000>-></span><span style=color:#000>wave_sig,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>WAVE</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>4</span><span style=color:#000>)&nbsp;</span><span style=color:#000>||</span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcmp(wave_header</span><span style=color:#000>-></span><span style=color:#000>format_sig,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>fmt&nbsp;</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>4</span><span style=color:#000>)&nbsp;</span><span style=color:#000>||</span><span style=color:#000>&nbsp;memcmp(wave_header</span><span style=color:#000>-></span><span style=color:#000>data_sig,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>data</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>4</span><span style=color:#000>))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;playback&nbsp;format</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>wave_format,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WAVEFORMATEX));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.wFormatTag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;WAVE_FORMAT_PCM;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nChannels&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_header</span><span style=color:#000>-></span><span style=color:#000>channels;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nSamplesPerSec&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_header</span><span style=color:#000>-></span><span style=color:#000>sample_rate;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.wBitsPerSample&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_header</span><span style=color:#000>-></span><span style=color:#000>bits_per_sample;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nBlockAlign&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_format.wBitsPerSample&nbsp;</span><span style=color:#000>/</span><span style=color:#000>&nbsp;</span><span style=color:#000>8</span><span style=color:#000>&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;wave_format.nChannels;<br>&nbsp;&nbsp;&nbsp;&nbsp;wave_format.nAvgBytesPerSec&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_format.nSamplesPerSec&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;wave_format.nBlockAlign;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;sound&nbsp;buffer&nbsp;using&nbsp;the&nbsp;header&nbsp;data</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_desc,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DSBUFFERDESC));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DSBUFFERDESC);<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwFlags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DSBCAPS_CTRLVOLUME&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;DSBCAPS_CTRLPOSITIONNOTIFY&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;DSBCAPS_LOCSOFTWARE;<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.dwBufferBytes&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>65536</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_desc.lpwfxFormat&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>&</span><span style=color:#000>wave_format;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;main&nbsp;sound&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_ds</span><span style=color:#000>-></span><span style=color:#000>CreateSoundBuffer(</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_desc,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_primary,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;newer&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(ds_buffer_primary</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IDirectSoundBuffer8,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>ds_buffer_second)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer_primary</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;the&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;ds_buffer_second;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Load&nbsp;sound&nbsp;data&nbsp;from&nbsp;second&nbsp;directsound&nbsp;buffer.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Load_Sound_Data(IDirectSoundBuffer8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;ds_buffer,&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;lock_pos,&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;lock_size,&nbsp;FILE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;fp)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;BYTE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;ptr1;<br>&nbsp;&nbsp;&nbsp;&nbsp;BYTE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;ptr2;<br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;size1,&nbsp;size2;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(lock_size&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;lock&nbsp;the&nbsp;sound&nbsp;buffer&nbsp;at&nbsp;position&nbsp;specified</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Lock(lock_pos,&nbsp;lock_size,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>ptr1,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>size1,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>ptr2,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>size2,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;read&nbsp;in&nbsp;the&nbsp;data</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;fread(ptr1,&nbsp;</span><span style=color:#000>1</span><span style=color:#000>,&nbsp;size1,&nbsp;fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(ptr2&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fread(ptr2,&nbsp;</span><span style=color:#000>1</span><span style=color:#000>,&nbsp;size2,&nbsp;fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;unlock&nbsp;it</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Unlock(ptr1,&nbsp;size1,&nbsp;ptr2,&nbsp;size2);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Handle&nbsp;directsound&nbsp;nofification&nbsp;evenet,&nbsp;just&nbsp;stream&nbsp;load&nbsp;sound&nbsp;buffer.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;Handle_Notifications(LPVOID&nbsp;thread_data)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(</span><span style=color:#000>1</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;wait&nbsp;for&nbsp;a&nbsp;message<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;when&nbsp;any&nbsp;one&nbsp;or&nbsp;all&nbsp;of&nbsp;the&nbsp;specified&nbsp;objects&nbsp;are&nbsp;in&nbsp;the&nbsp;signaled&nbsp;state&nbsp;or&nbsp;the&nbsp;time-out&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;interval&nbsp;elapses.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;result&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;MsgWaitForMultipleObjects(</span><span style=color:#000>4</span><span style=color:#000>,&nbsp;g_events,&nbsp;FALSE,&nbsp;INFINITE,&nbsp;QS_ALLEVENTS);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;notification&nbsp;#</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;thread_index&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;result&nbsp;</span><span style=color:#000>-</span><span style=color:#000>&nbsp;WAIT_OBJECT_0;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;check&nbsp;for&nbsp;update&nbsp;#</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(thread_index&nbsp;</span><span style=color:#000>>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>&nbsp;</span><span style=color:#000>&&</span><span style=color:#000>&nbsp;thread_index&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;</span><span style=color:#000>4</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;stop&nbsp;sound&nbsp;and&nbsp;quit&nbsp;thread&nbsp;if&nbsp;no&nbsp;more</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_ds_leave&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExitThread(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;seek&nbsp;to&nbsp;read&nbsp;position&nbsp;in&nbsp;file</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fseek(g_fp,&nbsp;g_ds_pos,&nbsp;SEEK_SET);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;stream&nbsp;in&nbsp;data&nbsp;based&nbsp;on&nbsp;amount&nbsp;of&nbsp;data&nbsp;left</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_ds_leave&nbsp;</span><span style=color:#000>&lt;=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;if&nbsp;this&nbsp;is&nbsp;reached,&nbsp;then&nbsp;end&nbsp;of&nbsp;sound&nbsp;is&nbsp;coming&nbsp;up.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Load_Sound_Data(g_ds_buffer,&nbsp;thread_index&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>,&nbsp;g_ds_leave,&nbsp;g_fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>else</span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Load_Sound_Data(g_ds_buffer,&nbsp;thread_index&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>,&nbsp;</span><span style=color:#000>65536</span><span style=color:#000>,&nbsp;g_fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;reset&nbsp;directsound&nbsp;buffer&nbsp;leave&nbsp;and&nbsp;current&nbsp;position</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave&nbsp;</span><span style=color:#000>-=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_pos&nbsp;&nbsp;&nbsp;</span><span style=color:#000>+=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Play&nbsp;WAVE&nbsp;file&nbsp;sound&nbsp;which&nbsp;specified&nbsp;by&nbsp;filename.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Play_Stream_Sound(</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;filename)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;DSBPOSITIONNOTIFY&nbsp;&nbsp;&nbsp;pos_notify[</span><span style=color:#000>4</span><span style=color:#000>];<br>&nbsp;&nbsp;&nbsp;&nbsp;WAVE_HEADER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wave_header;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;open&nbsp;the&nbsp;source&nbsp;file</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((g_fp&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;fopen(filename,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>rb</span><span style=color:#000>"</span><span style=color:#000>))&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;a&nbsp;2&nbsp;second&nbsp;buffer&nbsp;to&nbsp;stream&nbsp;in&nbsp;wave</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((g_ds_buffer&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Create_Buffer_From_WAV(g_fp,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>wave_header))&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fclose(g_fp);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;streaming&nbsp;size&nbsp;and&nbsp;pointer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_size&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;wave_header.data_size;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_pos&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WAVE_HEADER);<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_ds_size;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;a&nbsp;thread&nbsp;for&nbsp;notifications</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_thread_handle&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateThread(NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPTHREAD_START_ROUTINE)&nbsp;Handle_Notifications,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_thread_id);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;failed</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_thread_handle&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;notification&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IDirectSoundNotify8,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_ds_notify)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;event&nbsp;handles&nbsp;and&nbsp;set&nbsp;the&nbsp;notifications</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;</span><span style=color:#000>4</span><span style=color:#000>;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;an&nbsp;unnamed&nbsp;event&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_events[i]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateEvent(NULL,&nbsp;FALSE,&nbsp;FALSE,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos_notify[i].dwOffset&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>16384</span><span style=color:#000>&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;(i</span><span style=color:#000>+</span><span style=color:#000>1</span><span style=color:#000>)&nbsp;</span><span style=color:#000>-</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos_notify[i].hEventNotify&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_events[i];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;notification&nbsp;position<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;During&nbsp;capture&nbsp;or&nbsp;playback,&nbsp;whenever&nbsp;the&nbsp;read&nbsp;or&nbsp;play&nbsp;cursor&nbsp;reached&nbsp;one&nbsp;of&nbsp;the&nbsp;specified&nbsp;offsets,<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;the&nbsp;associated&nbsp;event&nbsp;is&nbsp;signaled.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_notify</span><span style=color:#000>-></span><span style=color:#000>SetNotificationPositions(</span><span style=color:#000>4</span><span style=color:#000>,&nbsp;pos_notify);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;fill&nbsp;buffer&nbsp;completely&nbsp;with&nbsp;sound<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;advance&nbsp;file&nbsp;pointer&nbsp;to&nbsp;data&nbsp;buffer's&nbsp;head</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;fseek(g_fp,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WAVE_HEADER),&nbsp;SEEK_SET);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;load&nbsp;sound&nbsp;buffer&nbsp;data&nbsp;with&nbsp;65536&nbsp;bytes</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;Load_Sound_Data(g_ds_buffer,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>65536</span><span style=color:#000>,&nbsp;g_fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;reset&nbsp;leave&nbsp;sound&nbsp;buffer&nbsp;and&nbsp;current&nbsp;sound&nbsp;buffer&nbsp;position</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_leave&nbsp;</span><span style=color:#000>-=</span><span style=color:#000>&nbsp;</span><span style=color:#000>65536</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_pos&nbsp;&nbsp;&nbsp;</span><span style=color:#000>+=</span><span style=color:#000>&nbsp;</span><span style=color:#000>65536</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;play&nbsp;sound&nbsp;looping</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>SetCurrentPosition(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>SetVolume(DSBVOLUME_MAX);<br>&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Play(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;DSBPLAY_LOOPING);<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Window&nbsp;procedure.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;WINAPI&nbsp;Window_Proc(HWND&nbsp;hwnd,&nbsp;UINT&nbsp;msg,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(msg)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;WM_DESTROY:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostQuitMessage(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>long</span><span style=color:#000>)&nbsp;DefWindowProc(hwnd,&nbsp;msg,&nbsp;wParam,&nbsp;lParam);<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Main&nbsp;function,&nbsp;routine&nbsp;entry.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>int</span><span style=color:#000>&nbsp;WINAPI&nbsp;WinMain(HINSTANCE&nbsp;inst,&nbsp;HINSTANCE,&nbsp;LPSTR&nbsp;cmd_line,&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;cmd_show)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;WNDCLASS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;win_class;<br>&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;window&nbsp;class&nbsp;and&nbsp;register&nbsp;it</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;win_class.style&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CS_HREDRAW&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;CS_VREDRAW;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpfnWndProc&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Window_Proc;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbClsExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbWndExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DLGWINDOWEXTRA;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hInstance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;inst;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIcon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadIcon(inst,&nbsp;IDI_APPLICATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadCursor(NULL,&nbsp;IDC_ARROW);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hbrBackground&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(HBRUSH)&nbsp;(COLOR_BTNFACE&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszMenuName&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszClassName&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_class_name;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;RegisterClass(</span><span style=color:#000>&</span><span style=color:#000>win_class))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;main&nbsp;window</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_hwnd&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateDialog(inst,&nbsp;MAKEINTRESOURCE(IDD_STREAM),&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ShowWindow(g_hwnd,&nbsp;cmd_show);<br>&nbsp;&nbsp;&nbsp;&nbsp;UpdateWindow(g_hwnd);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;and&nbsp;configure&nbsp;directsound<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;an&nbsp;object&nbsp;that&nbsp;supports&nbsp;the&nbsp;IDirectSound8&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(DirectSoundCreate8(NULL,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_ds,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Unable&nbsp;to&nbsp;create&nbsp;DirectSound&nbsp;object</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;cooperative&nbsp;level&nbsp;of&nbsp;the&nbsp;application&nbsp;for&nbsp;this&nbsp;sound&nbsp;device</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_ds</span><span style=color:#000>-></span><span style=color:#000>SetCooperativeLevel(g_hwnd,&nbsp;DSSCL_NORMAL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;play&nbsp;a&nbsp;streaming&nbsp;sound</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;Play_Stream_Sound(</span><span style=color:#000>"</span><span style=color:#000>test.wav</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_ds_buffer)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;play&nbsp;sound&nbsp;looping</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>SetCurrentPosition(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;volume</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>SetVolume(DSBVOLUME_MAX);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;play&nbsp;sound</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Play(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;DSBPLAY_LOOPING);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;start&nbsp;message&nbsp;pump,&nbsp;waiting&nbsp;for&nbsp;signal&nbsp;to&nbsp;quit.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(MSG));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(msg.message&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;WM_QUIT)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(PeekMessage(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;PM_REMOVE))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;stop&nbsp;sound</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_ds_buffer)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ds_buffer</span><span style=color:#000>-></span><span style=color:#000>Stop();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;kill&nbsp;the&nbsp;thread</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_thread_handle&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;terminates&nbsp;thread</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TerminateThread(g_thread_handle,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;closes&nbsp;an&nbsp;open&nbsp;object&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(g_thread_handle);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;the&nbsp;event&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;</span><span style=color:#000>4</span><span style=color:#000>;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(g_events[i]);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;close&nbsp;.WAV&nbsp;file</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_fp)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fclose(g_fp);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;directsound&nbsp;objects</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;Safe_Release(g_ds_buffer);<br>&nbsp;&nbsp;&nbsp;&nbsp;Safe_Release(g_ds);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;UnregisterClass(g_class_name,&nbsp;inst);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>int</span><span style=color:#000>)&nbsp;msg.wParam;<br>}<br></span></div><br>运行截图：<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/r_stream.jpg><br></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
用DirectX Audio和DirectShow播放声音和音乐（4）</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-4/ title="用DirectX Audio和DirectShow播放声音和音乐（4）">https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-4/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-5/ rel=next title="用DirectX Audio和DirectShow播放声音和音乐（5）"><i class="fa fa-chevron-left"></i> 用DirectX Audio和DirectShow播放声音和音乐（5）</a></div><div class="post-nav-prev post-nav-item"><a href=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-3/ rel=prev title="用DirectX Audio和DirectShow播放声音和音乐（3）">用DirectX Audio和DirectShow播放声音和音乐（3）
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"playing-sound-and-music-with-directx-audio-and-directshow-part-4","permalink":"https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-4/","title":"用DirectX Audio和DirectShow播放声音和音乐（4）","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1761990624" defer></script></body></html>