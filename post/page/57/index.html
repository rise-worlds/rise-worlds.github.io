<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.157.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Posts"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1772265587"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>post - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>679</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>679</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>35</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>118</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2423147></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5207></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2026-02-28 15:59:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/d3d-z-buffer-example/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="D3D中的Z缓存使用示例"><meta itemprop=description content="在渲染多边形网格对象到场景中的时候，离观察者越远的对象应该越模糊，同时离观察者越近的物体应该越清楚，这就是深度排序（depth sorting）。深度排序有两种常用的方法。第一种方法称为画家算法（painter&rsquo;s algorithm）。这种方法将对象划分成不同的多边形，由后往前对这些多边形进行排序，再按照排好的顺序绘制出这些多边形。采用这种方法绘制多边形，能够确保前面的多边形总是在其后多边形之前进行绘制。深度排序的第二种方法称为z缓冲方法（z- buffer），它是图形硬件设备使用最多的方法。这种方法依赖于像素，每个像素都有一个z值（z值是像素距离观察者的距离）。当每个像素被写入时，渲染器首先检查是否已经存在一个z值更小的像素，如果不存在，这个像素就被绘制出来；如果存在，就跳过该像素。许多 3D图形加速卡都有一个内置的z缓冲，这也是深度排序选择z缓冲方法的原因。在应用程序中使用z缓冲，最容易的方法就是在创建设备对象以及设置显示方式的时候初始化z缓冲，如下所示："></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/d3d-z-buffer-example/ itemprop=url class=post-title-link>D3D中的Z缓存使用示例</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月04日 20:53:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-04 20:53:00 +0800 +0800">2007年07月04日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:22:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:22:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/d3d-z-buffer-example/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>在渲染多边形网格对象到场景中的时候，离观察者越远的对象应该越模糊，同时离观察者越近的物体应该越清楚，这就是深度排序（depth sorting）。深度排序有两种常用的方法。<br><br>第一种方法称为画家算法（painter&rsquo;s algorithm）。这种方法将对象划分成不同的多边形，由后往前对这些多边形进行排序，再按照排好的顺序绘制出这些多边形。采用这种方法绘制多边形，能够确保前面的多边形总是在其后多边形之前进行绘制。<br><br>深度排序的第二种方法称为z缓冲方法（z- buffer），它是图形硬件设备使用最多的方法。这种方法依赖于像素，每个像素都有一个z值（z值是像素距离观察者的距离）。当每个像素被写入时，渲染器首先检查是否已经存在一个z值更小的像素，如果不存在，这个像素就被绘制出来；如果存在，就跳过该像素。<br><br>许多 3D图形加速卡都有一个内置的z缓冲，这也是深度排序选择z缓冲方法的原因。在应用程序中使用z缓冲，最容易的方法就是在创建设备对象以及设置显示方式的时候初始化z缓冲，如下所示：<br><br></p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/d3d-z-buffer-example/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/d3d-particle-effect-implementation/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="D3D中粒子效果实现示例"><meta itemprop=description content="源码及素材下载大爆炸，烟雾痕迹甚至魔术飞弹尾部发出的微小火花，都是粒子(particle)所制造出来的特殊效果。在适当的时机，启用alpha混合并绘制粒子，这样粒子就能朝向观察点（使用公告板），得到的结果就是混合对象的抽象拼贴，他们可以用于创建一些奇妙的效果。粒子奇妙的地方就在于粒子的大小实际上是任意的，原因在于可以创建一个缩放矩阵，使其同粒子多边形的世界变换矩阵结合起来。也就是说，除非粒子纹理不同，否则只需要使用一个多边形来绘制所有的粒子，无论如何，多边形的数目都必须同纹理的数目保持一致。 还需要创建粒子图像，图像中心为一个实心（不透明）圆形，向图像的边缘延伸，图像逐渐变透明，如下图所示：  接着，需要设置4个顶点，这4个顶点使用了2个多边形（可以使用三角形带进行优化）。顶点的坐标表示粒子的缺省大小，稍后需要将粒子进行缩放，以适合这个大小。每个粒子都可以拥有独特的属性，包括粒子颜色（通过使用材质来实现）。接下来，将这个结构体同一个含有两个多边形（创建一个正方形）的顶点缓冲结合起来，以便将多边形渲染到3D设备上。在被绘制出来之前，每个粒子都需要通过它自己的世界矩阵进行定向（当然使用公告板）。然后将世界变换矩阵同每个粒子的缩放变换矩阵组合起来，再设置一个材质（使用 IDirect3DDevice::SetMaterial函数），用来改变粒子的颜色。最后，绘制粒子。完整源码如下所示："></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/d3d-particle-effect-implementation/ itemprop=url class=post-title-link>D3D中粒子效果实现示例</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月04日 14:52:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-04 14:52:00 +0800 +0800">2007年07月04日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:23:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:23:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/d3d-particle-effect-implementation/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><a href=http://www.cppblog.com/Files/lovedday/Particle.rar><font color=#1b1b1b>源码及素材下载</font></a><br><br>大爆炸，烟雾痕迹甚至魔术飞弹尾部发出的微小火花，都是粒子(particle)所制造出来的特殊效果。在适当的时机，启用alpha混合并绘制粒子，这样粒子就能朝向观察点（使用公告板），得到的结果就是混合对象的抽象拼贴，他们可以用于创建一些奇妙的效果。<br><br>粒子奇妙的地方就在于粒子的大小实际上是任意的，原因在于可以创建一个缩放矩阵，使其同粒子多边形的世界变换矩阵结合起来。也就是说，除非粒子纹理不同，否则只需要使用一个多边形来绘制所有的粒子，无论如何，多边形的数目都必须同纹理的数目保持一致。<br><br>还需要创建粒子图像，图像中心为一个实心（不透明）圆形，向图像的边缘延伸，图像逐渐变透明，如下图所示：<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/r_Particle.bmp><br><br>接着，需要设置4个顶点，这4个顶点使用了2个多边形（可以使用三角形带进行优化）。顶点的坐标表示粒子的缺省大小，稍后需要将粒子进行缩放，以适合这个大小。每个粒子都可以拥有独特的属性，包括粒子颜色（通过使用材质来实现）。<br><br>接下来，将这个结构体同一个含有两个多边形（创建一个正方形）的顶点缓冲结合起来，以便将多边形渲染到3D设备上。在被绘制出来之前，每个粒子都需要通过它自己的世界矩阵进行定向（当然使用公告板）。然后将世界变换矩阵同每个粒子的缩放变换矩阵组合起来，再设置一个材质（使用 IDirect3DDevice::SetMaterial函数），用来改变粒子的颜色。最后，绘制粒子。<br><br>完整源码如下所示：<br><br></p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/d3d-particle-effect-implementation/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/d3d-billboard-usage-example/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="D3D中公告板的使用示例"><meta itemprop=description content="点击下载源码和素材 公告板(billboard)是一种允许在2D对象出现在3D中的很酷的技术，公告板的原理就是通过使用世界矩阵，根据观察点来排列多边形，因为观察的角度已知（或能够获得一个观察变换矩阵），就只需要使用相反的观察角来构造矩阵。创建公告板世界矩阵的方法是从Direct3D获取当前的观察矩阵并将此矩阵转置。这个转置矩阵会将所有的东西进行恰当的定位，以朝向观察点。接着就只需应用网格的平移矩阵，在世界中正确地确定网格的位置。源码中的Setup_Mesh函数用来创建顶点缓冲和从文件取得纹理数据，其中用到了D3DXCreateTextureFromFileEx函数，来看看它的使用信息：Creates a texture from a file. This is a more advanced function than D3DXCreateTextureFromFile.SyntaxHRESULT WINAPI D3DXCreateTextureFromFileEx(LPDIRECT3DDEVICE9 pDevice,    LPCTSTR pSrcFile,    UINT Width,    UINT Height,    UINT MipLevels,    DWORD Usage,    D3DFORMAT Format,    D3DPOOL Pool,    DWORD Filter,    DWORD MipFilter,    D3DCOLOR ColorKey,    D3DXIMAGE_INFO *pSrcInfo,    PALETTEENTRY *pPalette,    LPDIRECT3DTEXTURE9 *ppTexture);ParameterspDevice[in] Pointer to an IDirect3DDevice9 interface, representing the device to be associated with the texture. pSrcFile[in] Pointer to a string that specifies the filename. If the compiler settings require Unicode, the data type LPCTSTR resolves to LPCWSTR. Otherwise, the string data type resolves to LPCSTR. See Remarks.Width[in] Width in pixels. If this value is zero or D3DX_DEFAULT, the dimensions are taken from the file and rounded up to a power of two. If the device supports non-power of 2 textures and D3DX_DEFAULT_NONPOW2 is specified, the size will not be rounded.Height[in] Height, in pixels. If this value is zero or D3DX_DEFAULT, the dimensions are taken from the file and rounded up to a power of two. If the device supports non-power of 2 textures and D3DX_DEFAULT_NONPOW2 is sepcified, the size will not be rounded.MipLevels[in] Number of mip levels requested. If this value is zero or D3DX_DEFAULT, a complete mipmap chain is created. If D3DX_FROM_FILE, the size will be taken exactly as it is in the file, and the call will fail if this violates device capabilities.Usage[in] 0, D3DUSAGE_RENDERTARGET, or D3DUSAGE_DYNAMIC. Setting this flag to D3DUSAGE_RENDERTARGET indicates that the surface is to be used as a render target. The resource can then be passed to the pNewRenderTarget parameter of the IDirect3DDevice9::SetRenderTarget method. If either D3DUSAGE_RENDERTARGET or D3DUSAGE_DYNAMIC is specified, Pool must be set to D3DPOOL_DEFAULT, and the application should check that the device supports this operation by calling IDirect3D9::CheckDeviceFormat. D3DUSAGE_DYNAMIC indicates that the surface should be handled dynamically. See Using Dynamic Textures.Format[in] Member of the D3DFORMAT enumerated type, describing the requested pixel format for the texture. The returned texture might have a different format from that specified by Format. Applications should check the format of the returned texture. If D3DFMT_UNKNOWN, the format is taken from the file. If D3DFMT_FROM_FILE, the format is taken exactly as it is in the file, and the call will fail if this violates device capabilities.Pool[in] Member of the D3DPOOL enumerated type, describing the memory class into which the texture should be placed. Filter[in] A combination of one or more D3DX_FILTER controlling how the image is filtered. Specifying D3DX_DEFAULT for this parameter is the equivalent of specifying D3DX_FILTER_TRIANGLE | D3DX_FILTER_DITHER.MipFilter[in] A combination of one or more D3DX_FILTER controlling how the image is filtered. Specifying D3DX_DEFAULT for this parameter is the equivalent of specifying D3DX_FILTER_BOX.ColorKey[in] D3DCOLOR value to replace with transparent black, or 0 to disable the color key. This is always a 32-bit ARGB color, independent of the source image format. Alpha is significant and should usually be set to FF for opaque color keys. Thus, for opaque black, the value would be equal to 0xFF000000. pSrcInfo[in, out] Pointer to a D3DXIMAGE_INFO structure to be filled in with a description of the data in the source image file, or NULL. pPalette[out] Pointer to a PALETTEENTRY structure, representing a 256-color palette to fill in, or NULL.ppTexture[out] Address of a pointer to an IDirect3DTexture9 interface, representing the created texture object. Return ValueIf the function succeeds, the return value is D3D_OK.If the function fails, the return value can be one of the following:D3DERR_INVALIDCALL The method call is invalid. For example, a method&rsquo;s parameter may have an invalid value. D3DERR_NOTAVAILABLE This device does not support the queried technique. D3DERR_OUTOFVIDEOMEMORY Direct3D does not have enough display memory to perform the operation. D3DXERR_INVALIDDATA The data is invalid. E_OUTOFMEMORY Direct3D could not allocate sufficient memory to complete the call. RemarksThe compiler setting also determines the function version. If Unicode is defined, the function call resolves to D3DXCreateTextureFromFileExW. Otherwise, the function call resolves to D3DXCreateTextureFromFileExA because ANSI strings are being used.Use D3DXCheckTextureRequirements to determine if your device can support the texture given the current state.This function supports the following file formats: .bmp, .dds, .dib, .hdr, .jpg, .pfm, .png, .ppm, and .tga. See D3DXIMAGE_FILEFORMAT.Mipmapped textures automatically have each level filled with the loaded texture. When loading images into mipmapped textures, some devices are unable to go to a 1x1 image and this function will fail. If this happens, then the images need to be loaded manually.For the best performance when using D3DXCreateTextureFromFileEx:Doing image scaling and format conversion at load time can be slow. Store images in the format and resolution they will be used. If the target hardware requires power of 2 dimensions, then create and store images using power of 2 dimensions.For mipmap image creation at load time, filter using D3DX_FILTER_BOX. A box filter is much faster than other filter types such as D3DX_FILTER_TRIANGLE.Consider using DDS files. Since DDS files can be used to represent any Microsoft DirectX 9.0 texture format, they are very easy for D3DX to read. Also, they can store mipmaps, so any mipmap-generation algorithms can be used to author the images.我们来看看Do_Frame是如何进行公告板的绘制的，以下是关键代码："></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/d3d-billboard-usage-example/ itemprop=url class=post-title-link>D3D中公告板的使用示例</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月03日 22:37:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-03 22:37:00 +0800 +0800">2007年07月03日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:24:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:24:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/d3d-billboard-usage-example/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><a href=http://www.cppblog.com/Files/lovedday/Billboard.rar><font color=#1b1b1b>点击下载源码和素材</font></a><br><br>公告板(billboard)是一种允许在2D对象出现在3D中的很酷的技术，公告板的原理就是通过使用世界矩阵，根据观察点来排列多边形，因为观察的角度已知（或能够获得一个观察变换矩阵），就只需要使用相反的观察角来构造矩阵。创建公告板世界矩阵的方法是从Direct3D获取当前的观察矩阵并将此矩阵转置。这个转置矩阵会将所有的东西进行恰当的定位，以朝向观察点。接着就只需应用网格的平移矩阵，在世界中正确地确定网格的位置。<br><br>源码中的Setup_Mesh函数用来创建顶点缓冲和从文件取得纹理数据，其中用到了D3DXCreateTextureFromFileEx函数，来看看它的使用信息：<br><br>Creates a texture from a file. This is a more advanced function than D3DXCreateTextureFromFile.<br><br><span style=font-weight:700>Syntax</span><br><br>HRESULT WINAPI D3DXCreateTextureFromFileEx(LPDIRECT3DDEVICE9 pDevice,<br>    LPCTSTR pSrcFile,<br>    UINT Width,<br>    UINT Height,<br>    UINT MipLevels,<br>    DWORD Usage,<br>    D3DFORMAT Format,<br>    D3DPOOL Pool,<br>    DWORD Filter,<br>    DWORD MipFilter,<br>    D3DCOLOR ColorKey,<br>    D3DXIMAGE_INFO *pSrcInfo,<br>    PALETTEENTRY *pPalette,<br>    LPDIRECT3DTEXTURE9 *ppTexture<br>);<br><br><span style=font-weight:700>Parameters</span><br><br>pDevice<br>[in] Pointer to an IDirect3DDevice9 interface, representing the device to be associated with the texture.<br><br>pSrcFile<br>[in] Pointer to a string that specifies the filename. If the compiler settings require Unicode, the data type LPCTSTR resolves to LPCWSTR. Otherwise, the string data type resolves to LPCSTR. See Remarks.<br><br>Width<br>[in] Width in pixels. If this value is zero or D3DX_DEFAULT, the dimensions are taken from the file and rounded up to a power of two. If the device supports non-power of 2 textures and D3DX_DEFAULT_NONPOW2 is specified, the size will not be rounded.<br><br>Height<br>[in] Height, in pixels. If this value is zero or D3DX_DEFAULT, the dimensions are taken from the file and rounded up to a power of two. If the device supports non-power of 2 textures and D3DX_DEFAULT_NONPOW2 is sepcified, the size will not be rounded.<br><br>MipLevels<br>[in] Number of mip levels requested. If this value is zero or D3DX_DEFAULT, a complete mipmap chain is created. If D3DX_FROM_FILE, the size will be taken exactly as it is in the file, and the call will fail if this violates device capabilities.<br><br>Usage<br>[in] 0, D3DUSAGE_RENDERTARGET, or D3DUSAGE_DYNAMIC. Setting this flag to D3DUSAGE_RENDERTARGET indicates that the surface is to be used as a render target. The resource can then be passed to the pNewRenderTarget parameter of the IDirect3DDevice9::SetRenderTarget method. If either D3DUSAGE_RENDERTARGET or D3DUSAGE_DYNAMIC is specified, Pool must be set to D3DPOOL_DEFAULT, and the application should check that the device supports this operation by calling IDirect3D9::CheckDeviceFormat. D3DUSAGE_DYNAMIC indicates that the surface should be handled dynamically. See Using Dynamic Textures.<br><br>Format<br>[in] Member of the D3DFORMAT enumerated type, describing the requested pixel format for the texture. The returned texture might have a different format from that specified by Format. Applications should check the format of the returned texture. If D3DFMT_UNKNOWN, the format is taken from the file. If D3DFMT_FROM_FILE, the format is taken exactly as it is in the file, and the call will fail if this violates device capabilities.<br><br>Pool<br>[in] Member of the D3DPOOL enumerated type, describing the memory class into which the texture should be placed.<br><br>Filter<br>[in] A combination of one or more D3DX_FILTER controlling how the image is filtered. Specifying D3DX_DEFAULT for this parameter is the equivalent of specifying D3DX_FILTER_TRIANGLE | D3DX_FILTER_DITHER.<br><br>MipFilter<br>[in] A combination of one or more D3DX_FILTER controlling how the image is filtered. Specifying D3DX_DEFAULT for this parameter is the equivalent of specifying D3DX_FILTER_BOX.<br><br>ColorKey<br>[in] D3DCOLOR value to replace with transparent black, or 0 to disable the color key. This is always a 32-bit ARGB color, independent of the source image format. Alpha is significant and should usually be set to FF for opaque color keys. Thus, for opaque black, the value would be equal to 0xFF000000.<br><br>pSrcInfo<br>[in, out] Pointer to a D3DXIMAGE_INFO structure to be filled in with a description of the data in the source image file, or NULL.<br><br>pPalette<br>[out] Pointer to a PALETTEENTRY structure, representing a 256-color palette to fill in, or NULL.<br><br>ppTexture<br>[out] Address of a pointer to an IDirect3DTexture9 interface, representing the created texture object.<br><br><span style=font-weight:700>Return Value</span><br><br>If the function succeeds, the return value is D3D_OK.<br><br>If the function fails, the return value can be one of the following:<br><br>D3DERR_INVALIDCALL The method call is invalid. For example, a method&rsquo;s parameter may have an invalid value.<br>D3DERR_NOTAVAILABLE This device does not support the queried technique.<br>D3DERR_OUTOFVIDEOMEMORY Direct3D does not have enough display memory to perform the operation.<br>D3DXERR_INVALIDDATA The data is invalid.<br>E_OUTOFMEMORY Direct3D could not allocate sufficient memory to complete the call.<br><br><span style=font-weight:700>Remarks</span><br><br>The compiler setting also determines the function version. If Unicode is defined, the function call resolves to D3DXCreateTextureFromFileExW. Otherwise, the function call resolves to D3DXCreateTextureFromFileExA because ANSI strings are being used.<br><br>Use D3DXCheckTextureRequirements to determine if your device can support the texture given the current state.<br><br>This function supports the following file formats: .bmp, .dds, .dib, .hdr, .jpg, .pfm, .png, .ppm, and .tga. See D3DXIMAGE_FILEFORMAT.<br><br>Mipmapped textures automatically have each level filled with the loaded texture. When loading images into mipmapped textures, some devices are unable to go to a 1x1 image and this function will fail. If this happens, then the images need to be loaded manually.<br><br>For the best performance when using D3DXCreateTextureFromFileEx:<br><br>Doing image scaling and format conversion at load time can be slow. Store images in the format and resolution they will be used. If the target hardware requires power of 2 dimensions, then create and store images using power of 2 dimensions.<br>For mipmap image creation at load time, filter using D3DX_FILTER_BOX. A box filter is much faster than other filter types such as D3DX_FILTER_TRIANGLE.<br>Consider using DDS files. Since DDS files can be used to represent any Microsoft DirectX 9.0 texture format, they are very easy for D3DX to read. Also, they can store mipmaps, so any mipmap-generation algorithms can be used to author the images.<br><br>我们来看看Do_Frame是如何进行公告板的绘制的，以下是关键代码：<br><br></p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/d3d-billboard-usage-example/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/d3d-font-rendering-example/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="D3D中的字体绘制示例"><meta itemprop=description content="技巧如下：字体的绘制需要使用ID3DXFont对象和 D3DXCreateFontIndirect函数。DirectX SDK文档对ID3DXFont做了简要的说明：The ID3DXFont interface encapsulates the textures and resources needed to render a specific font on a specific device.The ID3DXFont interface is obtained by calling D3DXCreateFont or D3DXCreateFontIndirect.我们来看看SDK文档提供的关于 D3DXCreateFontIndirect的使用说明：Creates a font object indirectly for both a device and a font.SyntaxHRESULT WINAPI D3DXCreateFontIndirect(LPDIRECT3DDEVICE9 pDevice,    CONST D3DXFONT_DESC *pDesc,    LPD3DXFONT *ppFont);ParameterspDevice[in] Pointer to an IDirect3DDevice9 interface, the device to be associated with the font object. pDesc[in] Pointer to a D3DXFONT_DESC structure, describing the attributes of the font object to create. If the compiler settings require Unicode, the data type D3DXFONT_DESC resolves to D3DXFONT_DESCW; otherwise, the data type resolves to D3DXFONT_DESCA. See Remarks.ppFont[out] Returns a pointer to an ID3DXFont interface, representing the created font object. Return ValueIf the function succeeds, the return value is D3D_OK.If the function fails, the return value can be one of the following:D3DERR_INVALIDCALL The method call is invalid. For example, a method&rsquo;s parameter may have an invalid value. E_OUTOFMEMORY Microsoft Direct3D could not allocate sufficient memory to complete the call. RemarksThe compiler setting also determines the function version. If Unicode is defined, the function call resolves to D3DXCreateFontIndirectW. Otherwise, the function call resolves to D3DXCreateFontIndirectA because ANSI strings are being used.该函数的第二个参数使用了一个结构体D3DXFONT_DESC，来看看它的具体定义：Defines the attributes of a font. Syntaxtypedef struct D3DXFONT_DESC {    INT Height;    UINT Width;    UINT Weight;    UINT MipLevels;    BOOL Italic;    BYTE CharSet;    BYTE OutputPrecision;    BYTE Quality;    BYTE PitchAndFamily;    TCHAR FaceName[LF_FACESIZE];} D3DXFONT_DESC;MembersHeightHeight, in logical units, of the font&rsquo;s character cell or character.WidthWidth, in logical units, of characters in the font.WeightWeight of the font in the range from 0 through 1000.MipLevelsNumber of mip levels requested. If this value is zero or D3DX_DEFAULT, a complete mipmap chain is created. If the value is 1, the texture space is mapped identically to the screen space.ItalicSet to TRUE for an Italic font.CharSetCharacter set.OutputPrecisionOutput precision. The output precision defines how closely the output must match the requested font height, width, character orientation, escapement, pitch, and font type.QualityOutput quality.PitchAndFamilyPitch and family of the font.FaceNameA null-terminated string or characters that specifies the typeface name of the font. The length of the string must not exceed 32 characters, including the terminating null character. If FaceName is an empty string, the first font that matches the other specified attributes will be used. If the compiler settings require Unicode, the data type TCHAR resolves to WCHAR; otherwise, the data type resolves to CHAR. See Remarks.RemarksThe compiler setting also determines the structure type. If Unicode is defined, the D3DXFONT_DESC structure type resolves to a D3DXFONT_DESCW; otherwise the structure type resolves to a D3DXFONT_DESCA.Possible values of the above members are given in the Microsoft Windows Graphics Device Interface (GDI) LOGFONT  structure.当然，在设置的时候我们不需要设置所有的属性，只要设置其中的几个主要属性就可以了。 我们可以这样设置字体的属性并创建字体："></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/d3d-font-rendering-example/ itemprop=url class=post-title-link>D3D中的字体绘制示例</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月03日 19:33:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-03 19:33:00 +0800 +0800">2007年07月03日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:24:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:24:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/d3d-font-rendering-example/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><span style=font-weight:700>技巧如下：</span><br><br>字体的绘制需要使用ID3DXFont对象和 D3DXCreateFontIndirect函数。<br><br>DirectX SDK文档对ID3DXFont做了简要的说明：<br><br>The ID3DXFont interface encapsulates the textures and resources needed to render a specific font on a specific device.<br><br>The ID3DXFont interface is obtained by calling D3DXCreateFont or D3DXCreateFontIndirect.<br><br>我们来看看SDK文档提供的关于 D3DXCreateFontIndirect的使用说明：<br><br>Creates a font object indirectly for both a device and a font.<br><br><span style=font-weight:700>Syntax</span><br><br>HRESULT WINAPI D3DXCreateFontIndirect(LPDIRECT3DDEVICE9 pDevice,<br>    CONST D3DXFONT_DESC *pDesc,<br>    LPD3DXFONT *ppFont<br>);<br><br><span style=font-weight:700>Parameters</span><br><br>pDevice<br>[in] Pointer to an IDirect3DDevice9 interface, the device to be associated with the font object.<br><br>pDesc<br>[in] Pointer to a D3DXFONT_DESC structure, describing the attributes of the font object to create. If the compiler settings require Unicode, the data type D3DXFONT_DESC resolves to D3DXFONT_DESCW; otherwise, the data type resolves to D3DXFONT_DESCA. See Remarks.<br><br>ppFont<br>[out] Returns a pointer to an ID3DXFont interface, representing the created font object.<br><br><span style=font-weight:700>Return Value</span><br><br>If the function succeeds, the return value is D3D_OK.<br><br>If the function fails, the return value can be one of the following:<br><br>D3DERR_INVALIDCALL The method call is invalid. For example, a method&rsquo;s parameter may have an invalid value.<br>E_OUTOFMEMORY Microsoft Direct3D could not allocate sufficient memory to complete the call.<br><br><span style=font-weight:700>Remarks</span><br><br>The compiler setting also determines the function version. If Unicode is defined, the function call resolves to D3DXCreateFontIndirectW. Otherwise, the function call resolves to D3DXCreateFontIndirectA because ANSI strings are being used.<br><br>该函数的第二个参数使用了一个结构体D3DXFONT_DESC，来看看它的具体定义：<br><br>Defines the attributes of a font.<br><br><span style=font-weight:700>Syntax</span><br><br>typedef struct D3DXFONT_DESC {<br>    INT Height;<br>    UINT Width;<br>    UINT Weight;<br>    UINT MipLevels;<br>    BOOL Italic;<br>    BYTE CharSet;<br>    BYTE OutputPrecision;<br>    BYTE Quality;<br>    BYTE PitchAndFamily;<br>    TCHAR FaceName[LF_FACESIZE];<br>} D3DXFONT_DESC;<br><br><span style=font-weight:700>Members</span><br><br>Height<br>Height, in logical units, of the font&rsquo;s character cell or character.<br><br>Width<br>Width, in logical units, of characters in the font.<br><br>Weight<br>Weight of the font in the range from 0 through 1000.<br><br>MipLevels<br>Number of mip levels requested. If this value is zero or D3DX_DEFAULT, a complete mipmap chain is created. If the value is 1, the texture space is mapped identically to the screen space.<br><br>Italic<br>Set to TRUE for an Italic font.<br><br>CharSet<br>Character set.<br><br>OutputPrecision<br>Output precision. The output precision defines how closely the output must match the requested font height, width, character orientation, escapement, pitch, and font type.<br><br>Quality<br>Output quality.<br><br>PitchAndFamily<br>Pitch and family of the font.<br><br>FaceName<br>A null-terminated string or characters that specifies the typeface name of the font. The length of the string must not exceed 32 characters, including the terminating null character. If FaceName is an empty string, the first font that matches the other specified attributes will be used.<br><br>If the compiler settings require Unicode, the data type TCHAR resolves to WCHAR; otherwise, the data type resolves to CHAR. See Remarks.<br><br><span style=font-weight:700>Remarks</span><br><br>The compiler setting also determines the structure type. If Unicode is defined, the D3DXFONT_DESC structure type resolves to a D3DXFONT_DESCW; otherwise the structure type resolves to a D3DXFONT_DESCA.<br><br>Possible values of the above members are given in the Microsoft Windows Graphics Device Interface (GDI) LOGFONT  structure.<br><br>当然，在设置的时候我们不需要设置所有的属性，只要设置其中的几个主要属性就可以了。<br><br>我们可以这样设置字体的属性并创建字体：<br><br></p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/d3d-font-rendering-example/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/lighting-example/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="光照示例"><meta itemprop=description content='技巧如下：在设置可变顶点格式时加入法线和漫反色，如下所示：
//&nbsp;The&nbsp;3D&nbsp;vertex&nbsp;format&nbsp;and&nbsp;descriptortypedef&nbsp;struct{&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;x,&nbsp;y,&nbsp;z;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;3D&nbsp;coordinates&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;nx,&nbsp;ny,&nbsp;nz;&nbsp;&nbsp;&nbsp;//&nbsp;normals&nbsp;&nbsp;&nbsp;&nbsp;D3DCOLOR&nbsp;diffuse;&nbsp;&nbsp;&nbsp;//&nbsp;color}&nbsp;VERTEX;#define&nbsp;VERTEX_FVF&nbsp;&nbsp;&nbsp;(D3DFVF_XYZ&nbsp;|&nbsp;D3DFVF_NORMAL&nbsp;|&nbsp;D3DFVF_DIFFUSE)开启光照和Z缓存：
&nbsp;&nbsp;&nbsp; //&nbsp;enable&nbsp;d3d&nbsp;lighting&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetRenderState(D3DRS_LIGHTING,&nbsp;TRUE);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;enable&nbsp;z-buffer&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetRenderState(D3DRS_ZENABLE,&nbsp;D3DZB_TRUE);设置光源属性并打开光源：
&nbsp;&nbsp;&nbsp; D3DLIGHT9&nbsp;light;&nbsp;&nbsp;&nbsp; //&nbsp;set&nbsp;light&nbsp;data,&nbsp;color,&nbsp;position,&nbsp;range.&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(&amp;light,&nbsp;sizeof(light));&nbsp;&nbsp;&nbsp;&nbsp;light.Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;D3DLIGHT_POINT;&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.r&nbsp;=&nbsp;light.Ambient.r&nbsp;=&nbsp;0.5;&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.g&nbsp;=&nbsp;light.Ambient.g&nbsp;=&nbsp;0.5;&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.b&nbsp;=&nbsp;light.Ambient.b&nbsp;=&nbsp;0.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.a&nbsp;=&nbsp;light.Ambient.a&nbsp;=&nbsp;1.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Range&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1000.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Attenuation0&nbsp;&nbsp;=&nbsp;0.5;&nbsp;&nbsp;&nbsp;&nbsp;light.Position.x&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;300.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Position.y&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Position.z&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;-600.0;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;set&nbsp;and&nbsp;enable&nbsp;the&nbsp;light&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetLight(0,&nbsp;&amp;light);&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->LightEnable(0,&nbsp;TRUE);完整源码如下：
/***************************************************************************************PURPOSE:&nbsp;&nbsp;&nbsp;&nbsp;Light&nbsp;DemoRequired&nbsp;libraries:&nbsp;&nbsp;WINMM.LIB,&nbsp;D3D9.LIB,&nbsp;D3DX9.LIB.&nbsp;***************************************************************************************/#include&nbsp;<windows.h>#include&nbsp;<stdio.h>#include&nbsp;"d3d9.h"#include&nbsp;"d3dx9.h"#pragma&nbsp;comment(lib,&nbsp;"winmm.lib")#pragma&nbsp;comment(lib,&nbsp;"d3d9.lib")#pragma&nbsp;comment(lib,&nbsp;"d3dx9.lib")#pragma&nbsp;warning(disable&nbsp;:&nbsp;4305)#define&nbsp;WINDOW_WIDTH&nbsp;&nbsp;&nbsp;&nbsp;400#define&nbsp;WINDOW_HEIGHT&nbsp;&nbsp;&nbsp;400#define&nbsp;Safe_Release(p)&nbsp;if((p))&nbsp;(p)->Release();//&nbsp;window&nbsp;handles,&nbsp;class&nbsp;and&nbsp;caption&nbsp;text.HWND&nbsp;g_hwnd;HINSTANCE&nbsp;g_inst;static&nbsp;char&nbsp;g_class_name[]&nbsp;=&nbsp;"LightClass";static&nbsp;char&nbsp;g_caption[]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;"Light&nbsp;Demo";//&nbsp;the&nbsp;Direct3D&nbsp;and&nbsp;device&nbsp;objectIDirect3D9*&nbsp;g_d3d&nbsp;=&nbsp;NULL;IDirect3DDevice9*&nbsp;g_d3d_device&nbsp;=&nbsp;NULL;//&nbsp;The&nbsp;3D&nbsp;vertex&nbsp;format&nbsp;and&nbsp;descriptortypedef&nbsp;struct{&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;x,&nbsp;y,&nbsp;z;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;3D&nbsp;coordinates&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;nx,&nbsp;ny,&nbsp;nz;&nbsp;&nbsp;&nbsp;//&nbsp;normals&nbsp;&nbsp;&nbsp;&nbsp;D3DCOLOR&nbsp;diffuse;&nbsp;&nbsp;&nbsp;//&nbsp;color}&nbsp;VERTEX;#define&nbsp;VERTEX_FVF&nbsp;&nbsp;&nbsp;(D3DFVF_XYZ&nbsp;|&nbsp;D3DFVF_NORMAL&nbsp;|&nbsp;D3DFVF_DIFFUSE)IDirect3DVertexBuffer9*&nbsp;g_vertex_buffer&nbsp;=&nbsp;NULL;//--------------------------------------------------------------------------------//&nbsp;Window&nbsp;procedure.//--------------------------------------------------------------------------------long&nbsp;WINAPI&nbsp;Window_Proc(HWND&nbsp;hwnd,&nbsp;UINT&nbsp;msg,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam){&nbsp;&nbsp;&nbsp;&nbsp;switch(msg)&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;WM_DESTROY:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostQuitMessage(0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(long)&nbsp;DefWindowProc(hwnd,&nbsp;msg,&nbsp;wParam,&nbsp;lParam);}//--------------------------------------------------------------------------------//&nbsp;Initialize&nbsp;d3d,&nbsp;d3d&nbsp;device,&nbsp;vertex&nbsp;buffer,&nbsp;texutre;&nbsp;set&nbsp;render&nbsp;state&nbsp;for&nbsp;d3d;//&nbsp;set&nbsp;perspective&nbsp;matrix&nbsp;and&nbsp;view&nbsp;matrix.//--------------------------------------------------------------------------------BOOL&nbsp;Do_Init(){&nbsp;&nbsp;&nbsp;&nbsp;D3DPRESENT_PARAMETERS&nbsp;present_param;&nbsp;&nbsp;&nbsp;&nbsp;D3DDISPLAYMODE&nbsp;&nbsp;display_mode;&nbsp;&nbsp;&nbsp;&nbsp;D3DXMATRIX&nbsp;mat_proj,&nbsp;mat_view;&nbsp;&nbsp;&nbsp;&nbsp;D3DLIGHT9&nbsp;light;&nbsp;&nbsp;&nbsp;&nbsp;BYTE*&nbsp;vertex_ptr;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;initialize&nbsp;vertex&nbsp;data&nbsp;&nbsp;&nbsp;&nbsp;VERTEX&nbsp;verts[]&nbsp;=&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;-100.0f,&nbsp;&nbsp;100.0f,&nbsp;-100.0f,&nbsp;0.0f,0.0f,-1.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;100.0f,&nbsp;&nbsp;100.0f,&nbsp;-100.0f,&nbsp;0.0f,0.0f,-1.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;-100.0f,&nbsp;-100.0f,&nbsp;-100.0f,&nbsp;0.0f,0.0f,-1.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;100.0f,&nbsp;-100.0f,&nbsp;-100.0f,&nbsp;0.0f,0.0f,-1.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;100.0f,&nbsp;&nbsp;100.0f,&nbsp;-100.0f,&nbsp;1.0f,0.0f,0.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;100.0f,&nbsp;&nbsp;100.0f,&nbsp;&nbsp;100.0f,&nbsp;1.0f,0.0f,0.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;100.0f,&nbsp;-100.0f,&nbsp;-100.0f,&nbsp;1.0f,0.0f,0.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;100.0f,&nbsp;-100.0f,&nbsp;&nbsp;100.0f,&nbsp;1.0f,0.0f,0.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;100.0f,&nbsp;&nbsp;100.0f,&nbsp;&nbsp;100.0f,&nbsp;0.0f,0.0f,1.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;-100.0f,&nbsp;&nbsp;100.0f,&nbsp;&nbsp;100.0f,&nbsp;0.0f,0.0f,1.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;100.0f,&nbsp;-100.0f,&nbsp;&nbsp;100.0f,&nbsp;0.0f,0.0f,1.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;-100.0f,&nbsp;-100.0f,&nbsp;&nbsp;100.0f,&nbsp;0.0f,0.0f,1.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;-100.0f,&nbsp;&nbsp;100.0f,&nbsp;&nbsp;100.0f,&nbsp;-1.0f,0.0f,0.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;-100.0f,&nbsp;&nbsp;100.0f,&nbsp;-100.0f,&nbsp;-1.0f,0.0f,0.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;-100.0f,&nbsp;-100.0f,&nbsp;&nbsp;100.0f,&nbsp;-1.0f,0.0f,0.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;-100.0f,&nbsp;-100.0f,&nbsp;-100.0f,&nbsp;-1.0f,0.0f,0.0f,&nbsp;D3DCOLOR_RGBA(255,255,255,255)&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;do&nbsp;a&nbsp;windowed&nbsp;mode&nbsp;initialization&nbsp;of&nbsp;Direct3D&nbsp;&nbsp;&nbsp;&nbsp;if((g_d3d&nbsp;=&nbsp;Direct3DCreate9(D3D_SDK_VERSION))&nbsp;==&nbsp;NULL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;retrieves&nbsp;the&nbsp;current&nbsp;display&nbsp;mode&nbsp;of&nbsp;the&nbsp;adapter&nbsp;&nbsp;&nbsp;&nbsp;if(FAILED(g_d3d->GetAdapterDisplayMode(D3DADAPTER_DEFAULT,&nbsp;&amp;display_mode)))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(&amp;present_param,&nbsp;sizeof(present_param));&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;initialize&nbsp;d3d&nbsp;presentation&nbsp;parameter&nbsp;&nbsp;&nbsp;&nbsp;present_param.Windowed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;TRUE;&nbsp;&nbsp;&nbsp;&nbsp;present_param.SwapEffect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;D3DSWAPEFFECT_DISCARD;&nbsp;&nbsp;&nbsp;&nbsp;present_param.BackBufferFormat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;display_mode.Format;&nbsp;&nbsp;&nbsp;&nbsp;present_param.EnableAutoDepthStencil&nbsp;=&nbsp;TRUE;&nbsp;&nbsp;&nbsp;&nbsp;present_param.AutoDepthStencilFormat&nbsp;=&nbsp;D3DFMT_D16;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;creates&nbsp;a&nbsp;device&nbsp;to&nbsp;represent&nbsp;the&nbsp;display&nbsp;adapter&nbsp;&nbsp;&nbsp;&nbsp;if(FAILED(g_d3d->CreateDevice(D3DADAPTER_DEFAULT,&nbsp;D3DDEVTYPE_HAL,&nbsp;g_hwnd,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D3DCREATE_SOFTWARE_VERTEXPROCESSING,&nbsp;&amp;present_param,&nbsp;&amp;g_d3d_device)))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;set&nbsp;render&nbsp;state&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;enable&nbsp;d3d&nbsp;lighting&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetRenderState(D3DRS_LIGHTING,&nbsp;TRUE);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;enable&nbsp;z-buffer&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetRenderState(D3DRS_ZENABLE,&nbsp;D3DZB_TRUE);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;and&nbsp;set&nbsp;the&nbsp;projection&nbsp;matrix&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;builds&nbsp;a&nbsp;left-handed&nbsp;perspective&nbsp;projection&nbsp;matrix&nbsp;based&nbsp;on&nbsp;a&nbsp;field&nbsp;of&nbsp;view&nbsp;&nbsp;&nbsp;&nbsp;D3DXMatrixPerspectiveFovLH(&amp;mat_proj,&nbsp;D3DX_PI/4.0,&nbsp;1.33333,&nbsp;1.0,&nbsp;1000.0);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;sets&nbsp;a&nbsp;single&nbsp;device&nbsp;transformation-related&nbsp;state&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetTransform(D3DTS_PROJECTION,&nbsp;&amp;mat_proj);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;and&nbsp;set&nbsp;the&nbsp;view&nbsp;matrix&nbsp;&nbsp;&nbsp;&nbsp;D3DXMatrixLookAtLH(&amp;mat_view,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;D3DXVECTOR3(0.0,&nbsp;0.0,&nbsp;-500.0),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;D3DXVECTOR3(0.0f,&nbsp;0.0f,&nbsp;0.0f),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;D3DXVECTOR3(0.0f,&nbsp;1.0f,&nbsp;0.0f));&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetTransform(D3DTS_VIEW,&nbsp;&amp;mat_view);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;the&nbsp;vertex&nbsp;buffer&nbsp;and&nbsp;set&nbsp;data&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->CreateVertexBuffer(sizeof(VERTEX)&nbsp;*&nbsp;16,&nbsp;0,&nbsp;VERTEX_FVF,&nbsp;D3DPOOL_DEFAULT,&nbsp;&amp;g_vertex_buffer,&nbsp;NULL);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;locks&nbsp;a&nbsp;range&nbsp;of&nbsp;vertex&nbsp;data&nbsp;and&nbsp;obtains&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;vertex&nbsp;buffer&nbsp;memory&nbsp;&nbsp;&nbsp;&nbsp;g_vertex_buffer->Lock(0,&nbsp;0,&nbsp;(void**)&amp;vertex_ptr,&nbsp;0);&nbsp;&nbsp;&nbsp;&nbsp;memcpy(vertex_ptr,&nbsp;verts,&nbsp;sizeof(verts));&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;unlocks&nbsp;vertex&nbsp;data&nbsp;&nbsp;&nbsp;&nbsp;g_vertex_buffer->Unlock();&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;set&nbsp;light&nbsp;data,&nbsp;color,&nbsp;position,&nbsp;range.&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(&amp;light,&nbsp;sizeof(light));&nbsp;&nbsp;&nbsp;&nbsp;light.Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;D3DLIGHT_POINT;&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.r&nbsp;=&nbsp;light.Ambient.r&nbsp;=&nbsp;0.5;&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.g&nbsp;=&nbsp;light.Ambient.g&nbsp;=&nbsp;0.5;&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.b&nbsp;=&nbsp;light.Ambient.b&nbsp;=&nbsp;0.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.a&nbsp;=&nbsp;light.Ambient.a&nbsp;=&nbsp;1.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Range&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1000.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Attenuation0&nbsp;&nbsp;=&nbsp;0.5;&nbsp;&nbsp;&nbsp;&nbsp;light.Position.x&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;300.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Position.y&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0.0;&nbsp;&nbsp;&nbsp;&nbsp;light.Position.z&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;-600.0;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;set&nbsp;and&nbsp;enable&nbsp;the&nbsp;light&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetLight(0,&nbsp;&amp;light);&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->LightEnable(0,&nbsp;TRUE);&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;}//--------------------------------------------------------------------------------//&nbsp;Release&nbsp;all&nbsp;d3d&nbsp;resource.//--------------------------------------------------------------------------------BOOL&nbsp;Do_Shutdown(){&nbsp;&nbsp;&nbsp;&nbsp;Safe_Release(g_vertex_buffer);&nbsp;&nbsp;&nbsp;&nbsp;Safe_Release(g_d3d_device);&nbsp;&nbsp;&nbsp;&nbsp;Safe_Release(g_d3d);&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;}//--------------------------------------------------------------------------------//&nbsp;Render&nbsp;a&nbsp;frame.//--------------------------------------------------------------------------------BOOL&nbsp;Do_Frame(){&nbsp;&nbsp;&nbsp;&nbsp;D3DXMATRIX&nbsp;mat_world;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;clear&nbsp;device&nbsp;back&nbsp;buffer&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->Clear(0,&nbsp;NULL,&nbsp;D3DCLEAR_TARGET&nbsp;|&nbsp;D3DCLEAR_ZBUFFER,&nbsp;D3DCOLOR_RGBA(0,&nbsp;0,&nbsp;0,&nbsp;255),&nbsp;1.0f,&nbsp;0);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Begin&nbsp;scene&nbsp;&nbsp;&nbsp;&nbsp;if(SUCCEEDED(g_d3d_device->BeginScene()))&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;and&nbsp;set&nbsp;the&nbsp;world&nbsp;transformation&nbsp;matrix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;rotate&nbsp;object&nbsp;along&nbsp;y-axis&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D3DXMatrixRotationY(&amp;mat_world,&nbsp;(float)&nbsp;(timeGetTime()&nbsp;/&nbsp;1000.0));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetTransform(D3DTS_WORLD,&nbsp;&amp;mat_world);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;set&nbsp;the&nbsp;vertex&nbsp;stream,&nbsp;shader.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;binds&nbsp;a&nbsp;vertex&nbsp;buffer&nbsp;to&nbsp;a&nbsp;device&nbsp;data&nbsp;stream&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetStreamSource(0,&nbsp;g_vertex_buffer,&nbsp;0,&nbsp;sizeof(VERTEX));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;set&nbsp;the&nbsp;current&nbsp;vertex&nbsp;stream&nbsp;declation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->SetFVF(VERTEX_FVF);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;draw&nbsp;the&nbsp;vertex&nbsp;buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(short&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;<&nbsp;4;&nbsp;i++)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->DrawPrimitive(D3DPT_TRIANGLESTRIP,&nbsp;i&nbsp;*&nbsp;4,&nbsp;2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;end&nbsp;the&nbsp;scene&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->EndScene();&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;present&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;next&nbsp;buffer&nbsp;in&nbsp;the&nbsp;sequence&nbsp;of&nbsp;back&nbsp;buffers&nbsp;owned&nbsp;by&nbsp;the&nbsp;device&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device->Present(NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL);&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;}//--------------------------------------------------------------------------------//&nbsp;Main&nbsp;function,&nbsp;routine&nbsp;entry.//--------------------------------------------------------------------------------int&nbsp;WINAPI&nbsp;WinMain(HINSTANCE&nbsp;inst,&nbsp;HINSTANCE,&nbsp;LPSTR&nbsp;cmd_line,&nbsp;int&nbsp;cmd_show){&nbsp;&nbsp;&nbsp;&nbsp;WNDCLASSEX&nbsp;&nbsp;win_class;&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg;&nbsp;&nbsp;&nbsp;&nbsp;g_inst&nbsp;=&nbsp;inst;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;window&nbsp;class&nbsp;and&nbsp;register&nbsp;it&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sizeof(win_class);&nbsp;&nbsp;&nbsp;&nbsp;win_class.style&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;CS_CLASSDC;&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpfnWndProc&nbsp;&nbsp;&nbsp;=&nbsp;Window_Proc;&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbClsExtra&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbWndExtra&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;win_class.hInstance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;inst;&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIcon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LoadIcon(NULL,&nbsp;IDI_APPLICATION);&nbsp;&nbsp;&nbsp;&nbsp;win_class.hCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LoadCursor(NULL,&nbsp;IDC_ARROW);&nbsp;&nbsp;&nbsp;&nbsp;win_class.hbrBackground&nbsp;=&nbsp;NULL;&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszMenuName&nbsp;&nbsp;=&nbsp;NULL;&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszClassName&nbsp;=&nbsp;g_class_name;&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIconSm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LoadIcon(NULL,&nbsp;IDI_APPLICATION);&nbsp;&nbsp;&nbsp;&nbsp;if(!&nbsp;RegisterClassEx(&amp;win_class))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;the&nbsp;main&nbsp;window&nbsp;&nbsp;&nbsp;&nbsp;g_hwnd&nbsp;=&nbsp;CreateWindow(g_class_name,&nbsp;g_caption,&nbsp;WS_CAPTION&nbsp;|&nbsp;WS_SYSMENU,&nbsp;0,&nbsp;0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WINDOW_WIDTH,&nbsp;WINDOW_HEIGHT,&nbsp;NULL,&nbsp;NULL,&nbsp;inst,&nbsp;NULL);&nbsp;&nbsp;&nbsp;&nbsp;if(g_hwnd&nbsp;==&nbsp;NULL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;ShowWindow(g_hwnd,&nbsp;SW_NORMAL);&nbsp;&nbsp;&nbsp;&nbsp;UpdateWindow(g_hwnd);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;initialize&nbsp;game&nbsp;&nbsp;&nbsp;&nbsp;if(Do_Init()&nbsp;==&nbsp;FALSE)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;start&nbsp;message&nbsp;pump,&nbsp;waiting&nbsp;for&nbsp;signal&nbsp;to&nbsp;quit.&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(&amp;msg,&nbsp;sizeof(MSG));&nbsp;&nbsp;&nbsp;&nbsp;while(msg.message&nbsp;!=&nbsp;WM_QUIT)&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(PeekMessage(&amp;msg,&nbsp;NULL,&nbsp;0,&nbsp;0,&nbsp;PM_REMOVE))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage(&amp;msg);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage(&amp;msg);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;draw&nbsp;a&nbsp;frame&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Do_Frame()&nbsp;==&nbsp;FALSE)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;run&nbsp;shutdown&nbsp;function&nbsp;&nbsp;&nbsp;&nbsp;Do_Shutdown();&nbsp;&nbsp;&nbsp;&nbsp;UnregisterClass(g_class_name,&nbsp;inst);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(int)&nbsp;msg.wParam;}效果图：'></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/lighting-example/ itemprop=url class=post-title-link>光照示例</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月03日 01:10:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-03 01:10:00 +0800 +0800">2007年07月03日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:25:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:25:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/lighting-example/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>技巧如下：<br><br>在设置可变顶点格式时加入法线和漫反色，如下所示：<br><br></p><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;The&nbsp;3D&nbsp;vertex&nbsp;format&nbsp;and&nbsp;descriptor</span><span style=color:green><br></span><span style=color:#000>typedef&nbsp;</span><span style=color:#00f>struct</span><span style=color:#000><br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>float</span><span style=color:#000>&nbsp;x,&nbsp;y,&nbsp;z;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;3D&nbsp;coordinates&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>float</span><span style=color:#000>&nbsp;nx,&nbsp;ny,&nbsp;nz;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;normals</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;D3DCOLOR&nbsp;diffuse;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;color</span><span style=color:green><br></span><span style=color:#000>}&nbsp;VERTEX;<br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;VERTEX_FVF&nbsp;&nbsp;&nbsp;(D3DFVF_XYZ&nbsp;|&nbsp;D3DFVF_NORMAL&nbsp;|&nbsp;D3DFVF_DIFFUSE)</span></div><br>开启光照和Z缓存：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>&nbsp;&nbsp;&nbsp; //</span><span style=color:green>&nbsp;enable&nbsp;d3d&nbsp;lighting</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetRenderState(D3DRS_LIGHTING,&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enable&nbsp;z-buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetRenderState(D3DRS_ZENABLE,&nbsp;D3DZB_TRUE);</span></div><br>设置光源属性并打开光源：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>&nbsp;&nbsp;&nbsp; D3DLIGHT9&nbsp;light;<br><br></span><span style=color:green>&nbsp;&nbsp;&nbsp; //</span><span style=color:green>&nbsp;set&nbsp;light&nbsp;data,&nbsp;color,&nbsp;position,&nbsp;range.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>light,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(light));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;light.Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;D3DLIGHT_POINT;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.r&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;light.Ambient.r&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.5</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.g&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;light.Ambient.g&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.5</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.b&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;light.Ambient.b&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.a&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;light.Ambient.a&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>1.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Range&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>1000.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Attenuation0&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.5</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Position.x&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>300.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Position.y&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Position.z&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>-</span><span style=color:#000>600.0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;and&nbsp;enable&nbsp;the&nbsp;light</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetLight(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>light);<br>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>LightEnable(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;TRUE);</span></div><br>完整源码如下：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>/*</span><span style=color:green>**************************************************************************************<br>PURPOSE:<br>&nbsp;&nbsp;&nbsp;&nbsp;Light&nbsp;Demo<br><br>Required&nbsp;libraries:<br>&nbsp;&nbsp;WINMM.LIB,&nbsp;D3D9.LIB,&nbsp;D3DX9.LIB.<br>&nbsp;**************************************************************************************</span><span style=color:green>*/</span><span style=color:#000><br><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>windows.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>stdio.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>"</span><span style=color:#000>d3d9.h</span><span style=color:#000>"</span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>"</span><span style=color:#000>d3dx9.h</span><span style=color:#000>"</span><span style=color:#000><br><br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>winmm.lib</span><span style=color:#000>"</span><span style=color:#000>)<br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>d3d9.lib</span><span style=color:#000>"</span><span style=color:#000>)<br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>d3dx9.lib</span><span style=color:#000>"</span><span style=color:#000>)<br><br>#pragma&nbsp;warning(disable&nbsp;:&nbsp;</span><span style=color:#000>4305</span><span style=color:#000>)<br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;WINDOW_WIDTH&nbsp;&nbsp;&nbsp;&nbsp;400</span><span style=color:#000><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;WINDOW_HEIGHT&nbsp;&nbsp;&nbsp;400</span><span style=color:#000><br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;Safe_Release(p)&nbsp;if((p))&nbsp;(p)->Release();</span><span style=color:#000><br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class&nbsp;and&nbsp;caption&nbsp;text.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br>HINSTANCE&nbsp;g_inst;<br></span><span style=color:#00f>static</span><span style=color:#000>&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>LightClass</span><span style=color:#000>"</span><span style=color:#000>;<br></span><span style=color:#00f>static</span><span style=color:#000>&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_caption[]&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Light&nbsp;Demo</span><span style=color:#000>"</span><span style=color:#000>;<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;the&nbsp;Direct3D&nbsp;and&nbsp;device&nbsp;object</span><span style=color:green><br></span><span style=color:#000>IDirect3D9</span><span style=color:#000>*</span><span style=color:#000>&nbsp;g_d3d&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>IDirect3DDevice9</span><span style=color:#000>*</span><span style=color:#000>&nbsp;g_d3d_device&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;The&nbsp;3D&nbsp;vertex&nbsp;format&nbsp;and&nbsp;descriptor</span><span style=color:green><br></span><span style=color:#000>typedef&nbsp;</span><span style=color:#00f>struct</span><span style=color:#000><br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>float</span><span style=color:#000>&nbsp;x,&nbsp;y,&nbsp;z;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;3D&nbsp;coordinates&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>float</span><span style=color:#000>&nbsp;nx,&nbsp;ny,&nbsp;nz;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;normals</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;D3DCOLOR&nbsp;diffuse;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;color</span><span style=color:green><br></span><span style=color:#000>}&nbsp;VERTEX;<br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;VERTEX_FVF&nbsp;&nbsp;&nbsp;(D3DFVF_XYZ&nbsp;|&nbsp;D3DFVF_NORMAL&nbsp;|&nbsp;D3DFVF_DIFFUSE)</span><span style=color:#000><br><br>IDirect3DVertexBuffer9</span><span style=color:#000>*</span><span style=color:#000>&nbsp;g_vertex_buffer&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Window&nbsp;procedure.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;WINAPI&nbsp;Window_Proc(HWND&nbsp;hwnd,&nbsp;UINT&nbsp;msg,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(msg)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;WM_DESTROY:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostQuitMessage(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>long</span><span style=color:#000>)&nbsp;DefWindowProc(hwnd,&nbsp;msg,&nbsp;wParam,&nbsp;lParam);<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Initialize&nbsp;d3d,&nbsp;d3d&nbsp;device,&nbsp;vertex&nbsp;buffer,&nbsp;texutre;&nbsp;set&nbsp;render&nbsp;state&nbsp;for&nbsp;d3d;<br></span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;perspective&nbsp;matrix&nbsp;and&nbsp;view&nbsp;matrix.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Do_Init()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;D3DPRESENT_PARAMETERS&nbsp;present_param;<br>&nbsp;&nbsp;&nbsp;&nbsp;D3DDISPLAYMODE&nbsp;&nbsp;display_mode;<br>&nbsp;&nbsp;&nbsp;&nbsp;D3DXMATRIX&nbsp;mat_proj,&nbsp;mat_view;<br>&nbsp;&nbsp;&nbsp;&nbsp;D3DLIGHT9&nbsp;light;<br>&nbsp;&nbsp;&nbsp;&nbsp;BYTE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;vertex_ptr;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;vertex&nbsp;data</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;VERTEX&nbsp;verts[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>-</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>-</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>-</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>-</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>1.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>1.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>1.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>1.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>1.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>1.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;&nbsp;</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>1.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>100.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>1.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>,</span><span style=color:#000>255</span><span style=color:#000>)&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;do&nbsp;a&nbsp;windowed&nbsp;mode&nbsp;initialization&nbsp;of&nbsp;Direct3D</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((g_d3d&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Direct3DCreate9(D3D_SDK_VERSION))&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;retrieves&nbsp;the&nbsp;current&nbsp;display&nbsp;mode&nbsp;of&nbsp;the&nbsp;adapter</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_d3d</span><span style=color:#000>-></span><span style=color:#000>GetAdapterDisplayMode(D3DADAPTER_DEFAULT,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>display_mode)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>present_param,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(present_param));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;d3d&nbsp;presentation&nbsp;parameter</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;present_param.Windowed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;TRUE;<br>&nbsp;&nbsp;&nbsp;&nbsp;present_param.SwapEffect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;D3DSWAPEFFECT_DISCARD;<br>&nbsp;&nbsp;&nbsp;&nbsp;present_param.BackBufferFormat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;display_mode.Format;<br>&nbsp;&nbsp;&nbsp;&nbsp;present_param.EnableAutoDepthStencil&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;TRUE;<br>&nbsp;&nbsp;&nbsp;&nbsp;present_param.AutoDepthStencilFormat&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;D3DFMT_D16;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;creates&nbsp;a&nbsp;device&nbsp;to&nbsp;represent&nbsp;the&nbsp;display&nbsp;adapter</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_d3d</span><span style=color:#000>-></span><span style=color:#000>CreateDevice(D3DADAPTER_DEFAULT,&nbsp;D3DDEVTYPE_HAL,&nbsp;g_hwnd,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D3DCREATE_SOFTWARE_VERTEXPROCESSING,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>present_param,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_d3d_device)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;render&nbsp;state<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enable&nbsp;d3d&nbsp;lighting</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetRenderState(D3DRS_LIGHTING,&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enable&nbsp;z-buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetRenderState(D3DRS_ZENABLE,&nbsp;D3DZB_TRUE);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;and&nbsp;set&nbsp;the&nbsp;projection&nbsp;matrix<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;builds&nbsp;a&nbsp;left-handed&nbsp;perspective&nbsp;projection&nbsp;matrix&nbsp;based&nbsp;on&nbsp;a&nbsp;field&nbsp;of&nbsp;view</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;D3DXMatrixPerspectiveFovLH(</span><span style=color:#000>&</span><span style=color:#000>mat_proj,&nbsp;D3DX_PI</span><span style=color:#000>/</span><span style=color:#000>4.0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>1.33333</span><span style=color:#000>,&nbsp;</span><span style=color:#000>1.0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>1000.0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;sets&nbsp;a&nbsp;single&nbsp;device&nbsp;transformation-related&nbsp;state</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetTransform(D3DTS_PROJECTION,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>mat_proj);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;and&nbsp;set&nbsp;the&nbsp;view&nbsp;matrix</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;D3DXMatrixLookAtLH(</span><span style=color:#000>&</span><span style=color:#000>mat_view,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>&</span><span style=color:#000>D3DXVECTOR3(</span><span style=color:#000>0.0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>500.0</span><span style=color:#000>),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>&</span><span style=color:#000>D3DXVECTOR3(</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>),&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>&</span><span style=color:#000>D3DXVECTOR3(</span><span style=color:#000>0.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0.0f</span><span style=color:#000>));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetTransform(D3DTS_VIEW,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>mat_view);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;vertex&nbsp;buffer&nbsp;and&nbsp;set&nbsp;data</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>CreateVertexBuffer(</span><span style=color:#00f>sizeof</span><span style=color:#000>(VERTEX)&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#000>16</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;VERTEX_FVF,&nbsp;D3DPOOL_DEFAULT,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_vertex_buffer,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;locks&nbsp;a&nbsp;range&nbsp;of&nbsp;vertex&nbsp;data&nbsp;and&nbsp;obtains&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;vertex&nbsp;buffer&nbsp;memory</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_vertex_buffer</span><span style=color:#000>-></span><span style=color:#000>Lock(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>vertex_ptr,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;memcpy(vertex_ptr,&nbsp;verts,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(verts));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;unlocks&nbsp;vertex&nbsp;data</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_vertex_buffer</span><span style=color:#000>-></span><span style=color:#000>Unlock();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;light&nbsp;data,&nbsp;color,&nbsp;position,&nbsp;range.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>light,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(light));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;light.Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;D3DLIGHT_POINT;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.r&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;light.Ambient.r&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.5</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.g&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;light.Ambient.g&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.5</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.b&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;light.Ambient.b&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Diffuse.a&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;light.Ambient.a&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>1.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Range&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>1000.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Attenuation0&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.5</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Position.x&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>300.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Position.y&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0.0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;light.Position.z&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>-</span><span style=color:#000>600.0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;and&nbsp;enable&nbsp;the&nbsp;light</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetLight(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>light);<br>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>LightEnable(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;TRUE);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Release&nbsp;all&nbsp;d3d&nbsp;resource.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Do_Shutdown()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;Safe_Release(g_vertex_buffer);<br>&nbsp;&nbsp;&nbsp;&nbsp;Safe_Release(g_d3d_device);<br>&nbsp;&nbsp;&nbsp;&nbsp;Safe_Release(g_d3d);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Render&nbsp;a&nbsp;frame.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Do_Frame()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;D3DXMATRIX&nbsp;mat_world;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clear&nbsp;device&nbsp;back&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>Clear(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL,&nbsp;D3DCLEAR_TARGET&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;D3DCLEAR_ZBUFFER,&nbsp;D3DCOLOR_RGBA(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>255</span><span style=color:#000>),&nbsp;</span><span style=color:#000>1.0f</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Begin&nbsp;scene</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>BeginScene()))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;and&nbsp;set&nbsp;the&nbsp;world&nbsp;transformation&nbsp;matrix<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;rotate&nbsp;object&nbsp;along&nbsp;y-axis</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D3DXMatrixRotationY(</span><span style=color:#000>&</span><span style=color:#000>mat_world,&nbsp;(</span><span style=color:#00f>float</span><span style=color:#000>)&nbsp;(timeGetTime()&nbsp;</span><span style=color:#000>/</span><span style=color:#000>&nbsp;</span><span style=color:#000>1000.0</span><span style=color:#000>));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetTransform(D3DTS_WORLD,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>mat_world);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;vertex&nbsp;stream,&nbsp;shader.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;binds&nbsp;a&nbsp;vertex&nbsp;buffer&nbsp;to&nbsp;a&nbsp;device&nbsp;data&nbsp;stream</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetStreamSource(</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;g_vertex_buffer,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(VERTEX));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;current&nbsp;vertex&nbsp;stream&nbsp;declation</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>SetFVF(VERTEX_FVF);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;draw&nbsp;the&nbsp;vertex&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(</span><span style=color:#00f>short</span><span style=color:#000>&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;</span><span style=color:#000>4</span><span style=color:#000>;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>DrawPrimitive(D3DPT_TRIANGLESTRIP,&nbsp;i&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#000>4</span><span style=color:#000>,&nbsp;</span><span style=color:#000>2</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;end&nbsp;the&nbsp;scene</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>EndScene();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;present&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;next&nbsp;buffer&nbsp;in&nbsp;the&nbsp;sequence&nbsp;of&nbsp;back&nbsp;buffers&nbsp;owned&nbsp;by&nbsp;the&nbsp;device</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_d3d_device</span><span style=color:#000>-></span><span style=color:#000>Present(NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Main&nbsp;function,&nbsp;routine&nbsp;entry.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>int</span><span style=color:#000>&nbsp;WINAPI&nbsp;WinMain(HINSTANCE&nbsp;inst,&nbsp;HINSTANCE,&nbsp;LPSTR&nbsp;cmd_line,&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;cmd_show)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;WNDCLASSEX&nbsp;&nbsp;win_class;<br>&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;g_inst&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;inst;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;window&nbsp;class&nbsp;and&nbsp;register&nbsp;it</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(win_class);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.style&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CS_CLASSDC;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpfnWndProc&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Window_Proc;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbClsExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbWndExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hInstance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;inst;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIcon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadIcon(NULL,&nbsp;IDI_APPLICATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadCursor(NULL,&nbsp;IDC_ARROW);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hbrBackground&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszMenuName&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszClassName&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_class_name;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIconSm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadIcon(NULL,&nbsp;IDI_APPLICATION);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;RegisterClassEx(</span><span style=color:#000>&</span><span style=color:#000>win_class))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;main&nbsp;window</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_hwnd&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateWindow(g_class_name,&nbsp;g_caption,&nbsp;WS_CAPTION&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;WS_SYSMENU,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WINDOW_WIDTH,&nbsp;WINDOW_HEIGHT,&nbsp;NULL,&nbsp;NULL,&nbsp;inst,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_hwnd&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ShowWindow(g_hwnd,&nbsp;SW_NORMAL);<br>&nbsp;&nbsp;&nbsp;&nbsp;UpdateWindow(g_hwnd);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;game</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(Do_Init()&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;FALSE)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;start&nbsp;message&nbsp;pump,&nbsp;waiting&nbsp;for&nbsp;signal&nbsp;to&nbsp;quit.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(MSG));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(msg.message&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;WM_QUIT)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(PeekMessage(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;PM_REMOVE))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;draw&nbsp;a&nbsp;frame</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(Do_Frame()&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;FALSE)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;run&nbsp;shutdown&nbsp;function</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;Do_Shutdown();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;UnregisterClass(g_class_name,&nbsp;inst);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>int</span><span style=color:#000>)&nbsp;msg.wParam;<br>}</span></div><br>效果图：<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/r_light.jpg><br></div><footer class=post-footer><div class=post-button><a class=btn href=/post/lighting-example/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/he-zuoxiu-unpopular-truths/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="何祚庥：我说出来的事实让人不高兴了"><meta itemprop=description content="       文/本报记者 邓艳玲　　摄影/本报记者 吕家佐 　　2007年06月28日青年周末　　&#8220;抓住陈晓旭一说，大家都登了，反而我的观点就出来了，说些不痛不痒的话，谁理你！&#8221;尽管上遭卫生部副部长、国家中医药管理局局长王国强怒斥&#8220;这是借人们喜爱的影视演员攻击中医药的言论，很不严肃、很不道德、很不科学！&#8221;，下遇普通网民拍砖&#8220;信口雌黄，无聊至极&#8221;，何祚庥反而认为自己借陈晓旭一事来说中医，是&#8220;非常讲策略的&#8221;，也达到了让人们注意中医存在严重问题的目的。　　5月底，当多数国人还在为&#8220;林妹妹&#8221;陈晓旭的红颜薄命扼腕叹息时，一个非常&#8220;不和谐&#8221;的声音传出：是中医害死了陈晓旭。发出这个声音的正是中国科学院院士、著名反伪斗士何祚庥。他声称自己就是根据报纸上对陈晓旭去世的报道，得出这个结论的。　　&#8220;他这不是瞎胡闹吗？&#8221;在网上，他被强烈地质疑和谩骂着。就在他几乎被唾沫淹没之时，6月14日，卫生部副部长王国强在接受采访时，对他进行了严苛的评价。第二日，几乎所有媒体都报道和转载了这一说法，何祚庥也似乎陷入了官方和民间的双重谴责永无翻身之日。但第二日，他就在网上写了一篇措辞毫不客气的文章对王国强加以反驳。　　一直以来，何祚庥就以反对伪科学和学术腐败为公众熟知，而他也因为敢于直言，在多个领域直言为引来无数争议，此次他借陈晓旭得乳腺癌致死来抨击中医甚至引来了官方人士的骂声，这个顽固的80岁老人难道真的觉得自己一点错都没有？ 　　中医就应该为陈晓旭得死负责　　报纸上的新闻报道足以让我下结论　　青年周末（以下简称为&#8220;青周&#8221;）：您是在什么情形下说&#8220;陈晓旭是中医害死的&#8221;？　　何祚庥：我参加全国科技活动周，在南宁给学生们做关于反对伪科学和学术腐败的讲座，有学生问到有关中医的问题，我就说了。　　青周：是您刻意提到了陈晓旭之死吗？　　何祚庥：学生主动问起，我在回答中也就不回避。当时，这是个非常热的事情，我在去南宁的飞机上看的几乎每份报纸上都有对她去世情况、她治病的情况的详细报道。　　青周：您只是通过看报纸也没经过严密的调查研究，就下这么一个肯定的判断，合适吗？　　何祚庥：我和陈晓旭不熟，也只在电视上看过她演的角色，我能去做什么调查研究？也没这个必要，根据各大报纸几乎相同的报道，提供的细节，足以让我下一个基本判断。 　　青周：还有不少人看完报道也认为，是陈本人因为讳疾忌医而不愿意看病导致的结果呢！怎么就单单指中医害死她呢？　　何祚庥：事实上她是看的中医，吃的中药。如果她是不愿意就医，既不愿意就中医，也不愿意就西医，因为自己的信仰而死，我没话可说。但事实上她是选择了看中医，吃中药。报道中并没有说她看的中医提醒她去做详细准确的诊断，如果中医也说过这样的话，那就是陈晓旭自己负责任了。　　像季羡林遇到的好中医太少　　青周：那这也说明，这只是陈看的那个中医有问题，怎么能因为一个人的问题进而指责整个行业呢？　　何祚庥：中医就没有癌症的概念！更谈不上有能力去治疗癌症。但相当的中医大夫都宣称自己能治癌，还有众多治癌的特殊办法，也就是&#8220;偏方&#8221;。　　中医都是这样。季羡林在《病榻杂记》说起自己治病的遭遇，他遇到的那个中医邹铭西算是一个好医生，他不能确诊，就让季羡林另请高明，但这只是极少数。季得的也只是天疱疮，还不是什么癌症之类大病。很多中医是敢宣称，专治西医都看不了的疑难杂症的。　　青周：凭什么西医都治不了的疑难杂症，中医也一定就治不了呢？　　何祚庥：那你中医先把西医能够治愈的大病先治好再说。我们来数一下，历史上的对人类影响的大病是中医治愈或者说可以治愈的？肺结核、伤寒、疟疾、鼠疫、霍乱、天花、盲肠炎（中医又称为绞肠痧）&#8230;&#8230;我不是专业医生，我数不过来，你可以到医院去问，到病人中去问嘛。　　你还可以去翻翻巴金的《家》、《春》、《秋》，林语堂的《京华烟云》，去看看鲁迅的书，太多的文学作品中都有中医怎么耽误病人的。从五四以来，太多的先进知识分子都是反对中医的：梁启超、鲁迅、傅斯年、郭沫若&#8230;&#8230;　　我自己就出生在上海一个封建大家庭，家里看病一定是找上海当时著名的老中医夏应堂。他在我们那个大家庭也是治死了不少人的。我父亲就是其中一个。我父亲26岁去世，得了伤寒。（接着马上起身拿来一本书《走出寄啸山庄》），这本书是我一个堂兄所作，讲的就是我们这个大家庭的事情，在这本书里面，他就好几处提到了夏应堂，夏应堂把他一个姐姐，得天花就没有看出来，几乎治得送命，把一个姑姑治成了傻子。　　一般的伤风、感冒、泻肚子、拉稀中医倒是可以治，但这些小病，很多时候不治也是可以痊愈的。在旧社会，如果大病中医治不了，就有这样一种说法，可以治病不能治命，得了大病命中就该死的。　　青周：西医也照样成批成批的治死人，您为什么只攻击中医，而不去说说西医的弊端呢？这能说明中医就比西医差吗？　　何祚庥：那不一样。西医也会死人，但西医能够告诉你，为什么治不好。中医不是，它治不好了，就告诉你命中该死。盲肠炎，中医叫绞肠痧，不知道怎么治，很多时候只能等死；瘟病，就是我们现在说的霍乱，也只能等死。　　夏应堂的儿子叫夏理彬，也是个名中医。夏应堂去世后，就是夏理彬给我们家人看病，就用上温度计了，他也认为温度计比用手摸要准确多了。还有一代人文大师陈寅恪，他家可是中医世家，他都说中医是要不得的。　　中医学泰斗反对中医现代化　　农民也都认疗效显著的西医　　青周：中医在我们人民心目中地位还是很高的，这种高地位恐怕也是它长期以来的疗效形成的口碑吧？　　何祚庥：那你就错了，我首先问你，有了大病的时候，你是先看西医还是中医？现在就是在农村，观念也扭转过来了。（何祚庥的爱人庆承瑞插话：我们（上个世纪）50-60年代下乡的时候，农民朋友最认的就是青霉素针，如果发烧得厉害了，他们最希望的就是医生给打一针青霉素。）1965年的时候，我在农村搞四清，有一位社员，得了胃溃疡，快要穿孔了，当时我立即做决定把这位社员紧急送到医院，做手术，治好了。社员们说，要靠中医，这位社员就完了。　　现在中医院都是靠西医在维持　　青周：说到医院，现在中医院这么多，不照样在行使治病救人的职责，如果都不能治病救人，也不可能生存下去吧？　　何祚庥：（庆承瑞：最近三个学生铊中毒，第一确诊的就是在中医院。这难道是中医能诊断出来的？分明是西医吧！现在的中医院，你去看看，那里的设备和普通的医院完全一样。）现在你去中医院的诊疗，来了以后先做的检查，那一套完全是西医的套路啊。开的中药里面掺了西药。现在很多所谓的中药里面真正起疗效的是西药成分，只不过是打着个中药的旗号，卖的却是西药。但是这些都不让说。　　完全标准的传统中医院活不下去　　青周：即便是现在中医不能治大病，不代表她不会继续发展，今后不能治大病啊，况且大病不也都是由小病发展来的么？为什么不用发展的眼光来看中医？　　何祚庥：（庆承瑞插话：中医已经存在两千年了，要发展，也早就应该发展成熟了；但问题是，现在的中医泰斗们却在那里说，中医不能变，变了就不是中医了。）他们认为中医的现代化是个错误的口号，认为中医现代化就等于消灭中医，这种认识在中医界是占主导地位的。（庆承瑞：最近在广州开了一个&#8220;挺中医&#8221;的大型研讨会，所谓&#8220;挺中医&#8221;认为现在中医院的做法是完全错误的，现在用西医的办法来改造中医也绝对是错误的。）　　对现在中医院的格局他们是坚决反对的，他们认为就应该只使用中医的望闻问切，他们倒是主张要办完全标准的传统的中医院。 这个我赞成！你办吧！所有的现代化装备都不要，连温度计也不要，你就要靠手摸！你就和普通的医院比一下，看到底谁最终能活下去！　　我只否定中医的90%　　讲10%精华还是给中医面子　　青周：说来说去，您其实就是要借陈晓旭的死来全盘否定中医罗？　　何祚庥：我没有全盘否认，我只否认90％，我说中医90%是糟粕，10%是精华。是他们说我全盘否认，是他们放大了。我没说要取消中医，但我说要反对中医的90%。现在有人硬说我何祚庥全盘否定中医，是故意歪曲我的理念。他们说不出来反对我的理由，就扣个帽子。　　青周：中医90%是糟粕，10%是精华，您怎么得出这两个数据？ 　　何祚庥：历史上的大病，对人类有影响的，天花、伤寒、疟疾、鼠疫、肺结核等等，都是西医治愈的，不但治愈了，而且把病原病理都弄得很清楚了。我数出的大病，你能治一个就是10%。还有好多人说我给出这个比例还是给中医面子呢。　　青周：您作为一个搞自然科学的人，最讲究精确的数据了，这样笼统地说90%和10%好像并不符合科学家的一贯做法？　　何祚庥：我讲过中医的阴阳五行理论是&#8220;伪科学&#8221;，阴阳五行理论只是中医的一部分，但我很遗憾，因为这是中医的指导思想，这种错误的指导思想影响的行动比较严重，所以我说它90％是糟粕。　　中西医没法结合　　青周：那10%的精华又指的是什么呢？　　何祚庥：（庆承瑞：无非就是指几千年的中国民间的医学积累了一些有用的经验，也许这可以算作精华，你要问我，精华具体表现在什么地方，我就说有一味中药叫鸦胆子可以来治孩子手上的瘊子）还有就是我小时候曾经手脱臼，是中医的手法弄好了。后来，我把这件事在网上说了，又有好多人告诉我，这在西医是入门常识，是学生在学校里就要学的初级知识，这个我就不知道，到底是西医是学了中医的，还是两家本来就有的。　　青周：您看，现在是人为地把中医和西医分成两个水火不容的体系，但事实上，中医有些东西和西医道理是相通的，那为什么要把它们弄得那么泾渭分明，水火不容呢？中西结合一起发展不好吗？　　何祚庥：发展一个医学体系，最重要的是科学的理论基础作为指引，中医的理念是不准对人体解剖，西医的解剖，要看神经血管，这两者怎么融合？这可不是我的看法。医学界很多人都这样看，举个例子，钟南山院士就说了，中西医的理论没法结合。　　中西医已经结合50年了，结合得怎么样？（50年不是太短了吗？西医好几百年，中西几千年呢？）你以为就我们关心吗？那些搞医学的人比我们关心多了，不是时间长短的问题，问中医大夫，也问中央卫生部，而是根本没法结合的问题。理论体系无法结合。　　抗击非典，都说中西医结合做出来的成就，我就问一个问题，我们因为非典牺牲了200多位医生和护士，在这群人中，有多少是中医？我2003年就在网上提了这个问题，但没人敢回答我。如果一个也不牺牲，就算重大贡献，我不相信！现在都说功劳是中西医结合，我就问中医大夫牺牲了多少位？　　治病不能靠文化　　青周：您把有用的东西就认为是西医的，中医即使有用的也是些没来由的雕虫小技，这公平吗？　　何祚庥：公不公平，推不推崇哪个，要看事实，不是人为拔高，把不好的东西非说成是好的。中医一些有用的东西是可以归到现代医学里去，大量的还是归不进去的，而且还不知道怎么回事。90%糟粕，10%精华，我已经做了定量的分析了，应该说我已经说得够到位了。　　青周：即使如您所说，您怎么就判断这10%就不是中医的主流呢？而且，那90%也许是以我们目前心智尚不能开掘出来的博大精深的内容？您的划分仅仅依靠目前历史上的大病诊疗记录就行了么？　　何祚庥：靠这个难道还不够吗?如果作为医学，绝大多数大病都不能治，那我还能说它是个先进的东西吗？它倒是宣称它可以治愈大病，但它从来不去治现在西医可以治愈的病证，都是我们可以判断的大病之外的，现在谁也不知道怎么回事的，疑难杂症，它就说它可以治了！　　中医自己说，&#8220;医者，意也&#8221;，意念的意；有时候又说，&#8220;医者，艺也&#8221;，艺术的艺；有时候又说，&#8220;医者，易也&#8221;，易经的易；就是不说，医者，科也。现在他们又说中医是文化，我倒是同意他们这种说法，但治病不能靠文化治吧。　　正式署名骂我的还就是王国强一人　　中医在癌症的诊断上就该全部否定　　青周：您怎么看待您说出对中医的看法就遭来骂声？　　何祚庥：那有什么关系，我讲的是事实，别人谩骂，事实还就是事实。包括卫生部副部长，他官大，说我&#8220;极不严肃，极不道德，极不科学&#8221;，我就真的这样了么？他说&#8220;世界上每天都有很多人去世，难道都是中医害死的？更何况，癌症的治疗是所有疾病中死亡率最高的。&#8221;我可没那样说，我说的是陈晓旭啊，说的是乳腺癌。　　多数癌症死亡率是高，但乳腺癌不是，如果早发现，80%是能够治愈的。他作为一个卫生部的副部长，就应该告诉人们，应该普及这样的常识；而且同时作为中医药管理局的局长，他应该知道中医药的短处，应该告诉人们，中医是不能治乳腺癌的，应该看西医。中医在癌症的诊断上面就该全部否定！ 　　他现在是袒护啊。而且他还说何祚庥说了这种情况之后，就是不道德。这作为一个部长说这样的话，太差劲了吧。你是对人民负责呢？还是对你手下的中医负责？　　讲出让人不高兴得事实被说不道德　　青周：您自己并不是医生，对中医的了解会多过一个管理中医药的官员？如此下结论的确不足以让人信服，感觉太武断？ 　　何祚庥：我讲的也不是什么高深的东西，常识而已。我的确不懂医学，有人比我更懂。（他起身又拿来一本杂志《抗癌之窗》最新一期2007年6月号，他非常认真地把封二上面的主管主办单位：中华人民共和国卫生部，中国医学科学院，顾问委员会主席吴阶平等人的名字读出，以示这份杂志的专业性和权威性。翻到《陈晓旭不该红颜薄命》这一篇。）写这个文章的人自己在文中称自己是乳腺癌专科医生。他在文章中所讲的，和我所讲的几乎是一个意思。这可是他卫生部主管的一份权威杂志啊，人家也是这样讲的，我把乳腺癌可以防治，早发现可以用西医方法治愈的事实讲出来了，难道不道德了吗？　　事实上是，卫生部门长期在做一些乌七八糟的事情。（翻倒杂志的另一页，《抗癌仙姑&#8220;还阳草&#8221;骗局始末》读起有关已被他划上线的句子，先是法院1991年法院对这一诈骗当事人判了6年的有期徒刑。），你看，1982年年底，经推荐，又获当时卫生部主要领导同意，王淑华的&#8220;还阳草&#8221;居然进入中国中医研究院所属的广安门医院，开始了代号为831的临床验证，最后因为无效而告终。这就可以看见这就是他们的传统，中医领导部门会支持这些没有科学根据的偏方，甚至是诈骗，宣称能够治癌。是我武断，还是我尖锐，还是我说的事实让人不高兴了呢？我说话不算尖锐。鲁迅，比我尖锐多了。他甚至说，中医是有意无意的骗子！当然鲁迅比我更有资格说这样的话，鲁迅学过现代医学。　　我坚持的是我弄懂的科学常识　　青周：为什么那么多人要站出来独独骂你呢？　　何祚庥：网上骂我的人都是匿名的，说明那些人找不到可以驳倒我的理由，只好躲在阴暗的角落里骂骂我。倒是正式署名的就是我们的王国强副部长。　　那些主张一分为二来看中医的人，也承认我讲出了一些事实的真相，中医会害人，是事实，没法回避的事实，但这个事实让他们感到不舒畅。　　青周：但也有不少网友也在说中医治好他们病的例子，为什么他们的说法您不采信呢？　　何祚庥：证明一个全称肯定的说法，孤证不立，要打倒一个全称肯定的命题，一个个案就行了。其实你真要知道情况，你应该去问问医院的大夫，治癌症的大夫，你就可以知道事实到底是什么。现在西医虽然他们在实践中发挥重要作用，但他们不敢对中医说什么，他们也没地方去说。连我这样一个中央卫生部管不着的圈外人士说了一句话，就遭到副部长的迎头痛击，在他们管辖下的西医大夫，还敢说什么批评性意见？！　　现在不是提倡创新吗?创新难道不需要怀疑精神吗?中医是不准怀疑的。谁说中医坏话，就是反对传统文化，全盘打倒传统文化，这没道理啊。　　青周：就是您说，您为什么不用一种能够让普通老百姓接受的方式方法把您认为正确的东西传达出来，而不让人反感呢？　　何祚庥：我觉得我现在的方法很好，抓住陈晓旭一说，大家都登了，反而我的观点就出来了，说些不痛不痒的话，谁理你？有人说我炒作，我炒作什么？再炒作我也不会成为著名大夫，也不会有人找我治病！牵涉到社会公众健康，我认为我讲的这种观点需要向社会公众传播。何祚庥从来没说，我的意见都科学，我也没说我什么都懂；我很多不懂，但我现在坚持的是我弄懂了的，而且是普通科学常识。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/he-zuoxiu-unpopular-truths/ itemprop=url class=post-title-link>何祚庥：我说出来的事实让人不高兴了</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年06月29日 20:24:00 CST" itemprop="dateCreated datePublished" datetime="2007-06-29 20:24:00 +0800 +0800">2007年06月29日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/tcm/ itemprop=url rel=index><span itemprop=name>TCM</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/he-zuoxiu-unpopular-truths/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><pre>       文/本报记者 邓艳玲<br>　　摄影/本报记者 吕家佐 <br>　　2007年06月28日青年周末<br><br>　　&#8220;抓住陈晓旭一说，大家都登了，反而我的观点就出来了，说些不痛不痒的<br>话，谁理你！&#8221;尽管上遭卫生部副部长、国家中医药管理局局长王国强怒斥&#8220;这<br>是借人们喜爱的影视演员攻击中医药的言论，很不严肃、很不道德、很不科<br>学！&#8221;，下遇普通网民拍砖&#8220;信口雌黄，无聊至极&#8221;，何祚庥反而认为自己借陈<br>晓旭一事来说中医，是&#8220;非常讲策略的&#8221;，也达到了让人们注意中医存在严重问<br>题的目的。<br><br>　　5月底，当多数国人还在为&#8220;林妹妹&#8221;陈晓旭的红颜薄命扼腕叹息时，一个<br>非常&#8220;不和谐&#8221;的声音传出：是中医害死了陈晓旭。发出这个声音的正是中国科<br>学院院士、著名反伪斗士何祚庥。他声称自己就是根据报纸上对陈晓旭去世的报<br>道，得出这个结论的。<br><br>　　&#8220;他这不是瞎胡闹吗？&#8221;在网上，他被强烈地质疑和谩骂着。就在他几乎被<br>唾沫淹没之时，6月14日，卫生部副部长王国强在接受采访时，对他进行了严苛<br>的评价。第二日，几乎所有媒体都报道和转载了这一说法，何祚庥也似乎陷入了<br>官方和民间的双重谴责永无翻身之日。但第二日，他就在网上写了一篇措辞毫不<br>客气的文章对王国强加以反驳。<br><br>　　一直以来，何祚庥就以反对伪科学和学术腐败为公众熟知，而他也因为敢于<br>直言，在多个领域直言为引来无数争议，此次他借陈晓旭得乳腺癌致死来抨击中<br>医甚至引来了官方人士的骂声，这个顽固的80岁老人难道真的觉得自己一点错都<br>没有？ <br><br>　　中医就应该为陈晓旭得死负责<br>　　报纸上的新闻报道足以让我下结论<br><br>　　青年周末（以下简称为&#8220;青周&#8221;）：您是在什么情形下说&#8220;陈晓旭是中医害<br>死的&#8221;？<br><br>　　何祚庥：我参加全国科技活动周，在南宁给学生们做关于反对伪科学和学术<br>腐败的讲座，有学生问到有关中医的问题，我就说了。<br><br>　　青周：是您刻意提到了陈晓旭之死吗？<br><br>　　何祚庥：学生主动问起，我在回答中也就不回避。当时，这是个非常热的事<br>情，我在去南宁的飞机上看的几乎每份报纸上都有对她去世情况、她治病的情况<br>的详细报道。<br><br>　　青周：您只是通过看报纸也没经过严密的调查研究，就下这么一个肯定的判<br>断，合适吗？<br><br>　　何祚庥：我和陈晓旭不熟，也只在电视上看过她演的角色，我能去做什么调<br>查研究？也没这个必要，根据各大报纸几乎相同的报道，提供的细节，足以让我<br>下一个基本判断。 <br><br>　　青周：还有不少人看完报道也认为，是陈本人因为讳疾忌医而不愿意看病导<br>致的结果呢！怎么就单单指中医害死她呢？<br><br>　　何祚庥：事实上她是看的中医，吃的中药。如果她是不愿意就医，既不愿意<br>就中医，也不愿意就西医，因为自己的信仰而死，我没话可说。但事实上她是选<br>择了看中医，吃中药。报道中并没有说她看的中医提醒她去做详细准确的诊断，<br>如果中医也说过这样的话，那就是陈晓旭自己负责任了。<br><br>　　像季羡林遇到的好中医太少<br><br>　　青周：那这也说明，这只是陈看的那个中医有问题，怎么能因为一个人的问<br>题进而指责整个行业呢？<br><br>　　何祚庥：中医就没有癌症的概念！更谈不上有能力去治疗癌症。但相当的中<br>医大夫都宣称自己能治癌，还有众多治癌的特殊办法，也就是&#8220;偏方&#8221;。<br><br>　　中医都是这样。季羡林在《病榻杂记》说起自己治病的遭遇，他遇到的那个<br>中医邹铭西算是一个好医生，他不能确诊，就让季羡林另请高明，但这只是极少<br>数。季得的也只是天疱疮，还不是什么癌症之类大病。很多中医是敢宣称，专治<br>西医都看不了的疑难杂症的。<br><br>　　青周：凭什么西医都治不了的疑难杂症，中医也一定就治不了呢？<br><br>　　何祚庥：那你中医先把西医能够治愈的大病先治好再说。我们来数一下，历<br>史上的对人类影响的大病是中医治愈或者说可以治愈的？肺结核、伤寒、疟疾、<br>鼠疫、霍乱、天花、盲肠炎（中医又称为绞肠痧）&#8230;&#8230;我不是专业医生，我数不<br>过来，你可以到医院去问，到病人中去问嘛。<br><br>　　你还可以去翻翻巴金的《家》、《春》、《秋》，林语堂的《京华烟云》，<br>去看看鲁迅的书，太多的文学作品中都有中医怎么耽误病人的。从五四以来，太<br>多的先进知识分子都是反对中医的：梁启超、鲁迅、傅斯年、郭沫若&#8230;&#8230;<br><br>　　我自己就出生在上海一个封建大家庭，家里看病一定是找上海当时著名的老<br>中医夏应堂。他在我们那个大家庭也是治死了不少人的。我父亲就是其中一个。<br>我父亲26岁去世，得了伤寒。（接着马上起身拿来一本书《走出寄啸山庄》），<br>这本书是我一个堂兄所作，讲的就是我们这个大家庭的事情，在这本书里面，他<br>就好几处提到了夏应堂，夏应堂把他一个姐姐，得天花就没有看出来，几乎治得<br>送命，把一个姑姑治成了傻子。<br><br>　　一般的伤风、感冒、泻肚子、拉稀中医倒是可以治，但这些小病，很多时候<br>不治也是可以痊愈的。在旧社会，如果大病中医治不了，就有这样一种说法，可<br>以治病不能治命，得了大病命中就该死的。<br><br>　　青周：西医也照样成批成批的治死人，您为什么只攻击中医，而不去说说西<br>医的弊端呢？这能说明中医就比西医差吗？<br><br>　　何祚庥：那不一样。西医也会死人，但西医能够告诉你，为什么治不好。中<br>医不是，它治不好了，就告诉你命中该死。盲肠炎，中医叫绞肠痧，不知道怎么<br>治，很多时候只能等死；瘟病，就是我们现在说的霍乱，也只能等死。<br><br>　　夏应堂的儿子叫夏理彬，也是个名中医。夏应堂去世后，就是夏理彬给我们<br>家人看病，就用上温度计了，他也认为温度计比用手摸要准确多了。还有一代人<br>文大师陈寅恪，他家可是中医世家，他都说中医是要不得的。<br><br>　　中医学泰斗反对中医现代化<br>　　农民也都认疗效显著的西医<br><br>　　青周：中医在我们人民心目中地位还是很高的，这种高地位恐怕也是它长期<br>以来的疗效形成的口碑吧？<br><br>　　何祚庥：那你就错了，我首先问你，有了大病的时候，你是先看西医还是中<br>医？现在就是在农村，观念也扭转过来了。（何祚庥的爱人庆承瑞插话：我们<br>（上个世纪）50-60年代下乡的时候，农民朋友最认的就是青霉素针，如果发烧<br>得厉害了，他们最希望的就是医生给打一针青霉素。）1965年的时候，我在农村<br>搞四清，有一位社员，得了胃溃疡，快要穿孔了，当时我立即做决定把这位社员<br>紧急送到医院，做手术，治好了。社员们说，要靠中医，这位社员就完了。<br><br>　　现在中医院都是靠西医在维持<br><br>　　青周：说到医院，现在中医院这么多，不照样在行使治病救人的职责，如果<br>都不能治病救人，也不可能生存下去吧？<br><br>　　何祚庥：（庆承瑞：最近三个学生铊中毒，第一确诊的就是在中医院。这难<br>道是中医能诊断出来的？分明是西医吧！现在的中医院，你去看看，那里的设备<br>和普通的医院完全一样。）现在你去中医院的诊疗，来了以后先做的检查，那一<br>套完全是西医的套路啊。开的中药里面掺了西药。现在很多所谓的中药里面真正<br>起疗效的是西药成分，只不过是打着个中药的旗号，卖的却是西药。但是这些都<br>不让说。<br><br>　　完全标准的传统中医院活不下去<br><br>　　青周：即便是现在中医不能治大病，不代表她不会继续发展，今后不能治大<br>病啊，况且大病不也都是由小病发展来的么？为什么不用发展的眼光来看中医？<br><br>　　何祚庥：（庆承瑞插话：中医已经存在两千年了，要发展，也早就应该发展<br>成熟了；但问题是，现在的中医泰斗们却在那里说，中医不能变，变了就不是中<br>医了。）他们认为中医的现代化是个错误的口号，认为中医现代化就等于消灭中<br>医，这种认识在中医界是占主导地位的。（庆承瑞：最近在广州开了一个&#8220;挺中<br>医&#8221;的大型研讨会，所谓&#8220;挺中医&#8221;认为现在中医院的做法是完全错误的，现在<br>用西医的办法来改造中医也绝对是错误的。）<br><br>　　对现在中医院的格局他们是坚决反对的，他们认为就应该只使用中医的望闻<br>问切，他们倒是主张要办完全标准的传统的中医院。 这个我赞成！你办吧！所<br>有的现代化装备都不要，连温度计也不要，你就要靠手摸！你就和普通的医院比<br>一下，看到底谁最终能活下去！<br><br>　　我只否定中医的90%<br>　　讲10%精华还是给中医面子<br><br>　　青周：说来说去，您其实就是要借陈晓旭的死来全盘否定中医罗？<br><br>　　何祚庥：我没有全盘否认，我只否认90％，我说中医90%是糟粕，10%是精华。<br>是他们说我全盘否认，是他们放大了。我没说要取消中医，但我说要反对中医的<br>90%。现在有人硬说我何祚庥全盘否定中医，是故意歪曲我的理念。他们说不出<br>来反对我的理由，就扣个帽子。<br><br>　　青周：中医90%是糟粕，10%是精华，您怎么得出这两个数据？ <br><br>　　何祚庥：历史上的大病，对人类有影响的，天花、伤寒、疟疾、鼠疫、肺结<br>核等等，都是西医治愈的，不但治愈了，而且把病原病理都弄得很清楚了。我数<br>出的大病，你能治一个就是10%。还有好多人说我给出这个比例还是给中医面子<br>呢。<br><br>　　青周：您作为一个搞自然科学的人，最讲究精确的数据了，这样笼统地说<br>90%和10%好像并不符合科学家的一贯做法？<br><br>　　何祚庥：我讲过中医的阴阳五行理论是&#8220;伪科学&#8221;，阴阳五行理论只是中医<br>的一部分，但我很遗憾，因为这是中医的指导思想，这种错误的指导思想影响的<br>行动比较严重，所以我说它90％是糟粕。<br><br>　　中西医没法结合<br><br>　　青周：那10%的精华又指的是什么呢？<br><br>　　何祚庥：（庆承瑞：无非就是指几千年的中国民间的医学积累了一些有用的<br>经验，也许这可以算作精华，你要问我，精华具体表现在什么地方，我就说有一<br>味中药叫鸦胆子可以来治孩子手上的瘊子）还有就是我小时候曾经手脱臼，是中<br>医的手法弄好了。后来，我把这件事在网上说了，又有好多人告诉我，这在西医<br>是入门常识，是学生在学校里就要学的初级知识，这个我就不知道，到底是西医<br>是学了中医的，还是两家本来就有的。<br><br>　　青周：您看，现在是人为地把中医和西医分成两个水火不容的体系，但事实<br>上，中医有些东西和西医道理是相通的，那为什么要把它们弄得那么泾渭分明，<br>水火不容呢？中西结合一起发展不好吗？<br><br>　　何祚庥：发展一个医学体系，最重要的是科学的理论基础作为指引，中医的<br>理念是不准对人体解剖，西医的解剖，要看神经血管，这两者怎么融合？这可不<br>是我的看法。医学界很多人都这样看，举个例子，钟南山院士就说了，中西医的<br>理论没法结合。<br><br>　　中西医已经结合50年了，结合得怎么样？（50年不是太短了吗？西医好几百<br>年，中西几千年呢？）你以为就我们关心吗？那些搞医学的人比我们关心多了，<br>不是时间长短的问题，问中医大夫，也问中央卫生部，而是根本没法结合的问题。<br>理论体系无法结合。<br><br>　　抗击非典，都说中西医结合做出来的成就，我就问一个问题，我们因为非典<br>牺牲了200多位医生和护士，在这群人中，有多少是中医？我2003年就在网上提<br>了这个问题，但没人敢回答我。如果一个也不牺牲，就算重大贡献，我不相信！<br>现在都说功劳是中西医结合，我就问中医大夫牺牲了多少位？<br><br>　　治病不能靠文化<br><br>　　青周：您把有用的东西就认为是西医的，中医即使有用的也是些没来由的雕<br>虫小技，这公平吗？<br><br>　　何祚庥：公不公平，推不推崇哪个，要看事实，不是人为拔高，把不好的东<br>西非说成是好的。中医一些有用的东西是可以归到现代医学里去，大量的还是归<br>不进去的，而且还不知道怎么回事。90%糟粕，10%精华，我已经做了定量的分析<br>了，应该说我已经说得够到位了。<br><br>　　青周：即使如您所说，您怎么就判断这10%就不是中医的主流呢？而且，那<br>90%也许是以我们目前心智尚不能开掘出来的博大精深的内容？您的划分仅仅依<br>靠目前历史上的大病诊疗记录就行了么？<br><br>　　何祚庥：靠这个难道还不够吗?如果作为医学，绝大多数大病都不能治，那<br>我还能说它是个先进的东西吗？它倒是宣称它可以治愈大病，但它从来不去治现<br>在西医可以治愈的病证，都是我们可以判断的大病之外的，现在谁也不知道怎么<br>回事的，疑难杂症，它就说它可以治了！<br><br>　　中医自己说，&#8220;医者，意也&#8221;，意念的意；有时候又说，&#8220;医者，艺也&#8221;，<br>艺术的艺；有时候又说，&#8220;医者，易也&#8221;，易经的易；就是不说，医者，科也。<br>现在他们又说中医是文化，我倒是同意他们这种说法，但治病不能靠文化治吧。<br><br>　　正式署名骂我的还就是王国强一人<br>　　中医在癌症的诊断上就该全部否定<br><br>　　青周：您怎么看待您说出对中医的看法就遭来骂声？<br><br>　　何祚庥：那有什么关系，我讲的是事实，别人谩骂，事实还就是事实。包括<br>卫生部副部长，他官大，说我&#8220;极不严肃，极不道德，极不科学&#8221;，我就真的这<br>样了么？他说&#8220;世界上每天都有很多人去世，难道都是中医害死的？更何况，癌<br>症的治疗是所有疾病中死亡率最高的。&#8221;我可没那样说，我说的是陈晓旭啊，说<br>的是乳腺癌。<br><br>　　多数癌症死亡率是高，但乳腺癌不是，如果早发现，80%是能够治愈的。他<br>作为一个卫生部的副部长，就应该告诉人们，应该普及这样的常识；而且同时作<br>为中医药管理局的局长，他应该知道中医药的短处，应该告诉人们，中医是不能<br>治乳腺癌的，应该看西医。中医在癌症的诊断上面就该全部否定！ <br><br>　　他现在是袒护啊。而且他还说何祚庥说了这种情况之后，就是不道德。这作<br>为一个部长说这样的话，太差劲了吧。你是对人民负责呢？还是对你手下的中医<br>负责？<br><br>　　讲出让人不高兴得事实被说不道德<br><br>　　青周：您自己并不是医生，对中医的了解会多过一个管理中医药的官员？如<br>此下结论的确不足以让人信服，感觉太武断？ <br><br>　　何祚庥：我讲的也不是什么高深的东西，常识而已。我的确不懂医学，有人<br>比我更懂。（他起身又拿来一本杂志《抗癌之窗》最新一期2007年6月号，他非<br>常认真地把封二上面的主管主办单位：中华人民共和国卫生部，中国医学科学院，<br>顾问委员会主席吴阶平等人的名字读出，以示这份杂志的专业性和权威性。翻到<br>《陈晓旭不该红颜薄命》这一篇。）写这个文章的人自己在文中称自己是乳腺癌<br>专科医生。他在文章中所讲的，和我所讲的几乎是一个意思。这可是他卫生部主<br>管的一份权威杂志啊，人家也是这样讲的，我把乳腺癌可以防治，早发现可以用<br>西医方法治愈的事实讲出来了，难道不道德了吗？<br><br>　　事实上是，卫生部门长期在做一些乌七八糟的事情。（翻倒杂志的另一页，<br>《抗癌仙姑&#8220;还阳草&#8221;骗局始末》读起有关已被他划上线的句子，先是法院1991<br>年法院对这一诈骗当事人判了6年的有期徒刑。），你看，1982年年底，经推荐，<br>又获当时卫生部主要领导同意，王淑华的&#8220;还阳草&#8221;居然进入中国中医研究院所<br>属的广安门医院，开始了代号为831的临床验证，最后因为无效而告终。这就可<br>以看见这就是他们的传统，中医领导部门会支持这些没有科学根据的偏方，甚至<br>是诈骗，宣称能够治癌。是我武断，还是我尖锐，还是我说的事实让人不高兴了<br>呢？我说话不算尖锐。鲁迅，比我尖锐多了。他甚至说，中医是有意无意的骗子！<br>当然鲁迅比我更有资格说这样的话，鲁迅学过现代医学。<br><br>　　我坚持的是我弄懂的科学常识<br><br>　　青周：为什么那么多人要站出来独独骂你呢？<br><br>　　何祚庥：网上骂我的人都是匿名的，说明那些人找不到可以驳倒我的理由，<br>只好躲在阴暗的角落里骂骂我。倒是正式署名的就是我们的王国强副部长。<br><br>　　那些主张一分为二来看中医的人，也承认我讲出了一些事实的真相，中医会<br>害人，是事实，没法回避的事实，但这个事实让他们感到不舒畅。<br><br>　　青周：但也有不少网友也在说中医治好他们病的例子，为什么他们的说法您<br>不采信呢？<br><br>　　何祚庥：证明一个全称肯定的说法，孤证不立，要打倒一个全称肯定的命题，<br>一个个案就行了。其实你真要知道情况，你应该去问问医院的大夫，治癌症的大<br>夫，你就可以知道事实到底是什么。现在西医虽然他们在实践中发挥重要作用，<br>但他们不敢对中医说什么，他们也没地方去说。连我这样一个中央卫生部管不着<br>的圈外人士说了一句话，就遭到副部长的迎头痛击，在他们管辖下的西医大夫，<br>还敢说什么批评性意见？！<br><br>　　现在不是提倡创新吗?创新难道不需要怀疑精神吗?中医是不准怀疑的。谁说<br>中医坏话，就是反对传统文化，全盘打倒传统文化，这没道理啊。<br><br>　　青周：就是您说，您为什么不用一种能够让普通老百姓接受的方式方法把您<br>认为正确的东西传达出来，而不让人反感呢？<br><br>　　何祚庥：我觉得我现在的方法很好，抓住陈晓旭一说，大家都登了，反而我<br>的观点就出来了，说些不痛不痒的话，谁理你？有人说我炒作，我炒作什么？再<br>炒作我也不会成为著名大夫，也不会有人找我治病！牵涉到社会公众健康，我认<br>为我讲的这种观点需要向社会公众传播。何祚庥从来没说，我的意见都科学，我<br>也没说我什么都懂；我很多不懂，但我现在坚持的是我弄懂了的，而且是普通科<br>学常识。</pre></div><footer class=post-footer><div class=post-button><a class=btn href=/post/he-zuoxiu-unpopular-truths/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/directx-graphics-interface-guide/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="DirectX 图形接口指南"><meta itemprop=description content="译者申明：这些指南是我在阅读 DirectX9.0 SDK 中逐步翻译出来的。对于初次接触 DirectX Graphics 的编程者而言，这应该是很好的上手资料。其实，本人就是从这些指南开始深入 Direct3D9.0 的；由于这是本人第一次翻译英文材料，言语不通，词不达意之处一定很多，一些术语也译得很勉强，请见谅。此外，需要转载此文者，请保留以下部分：&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;DirectX图形接口指南 译者：Rise 电子邮箱： 

    Rise.Worlds@gmail.com
    
&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;DirectX 图形接口指南：（应用于 DirectX 9.0 版 C/C++ 编程） 本区域的指南将说明如何在 C/C++ 程序中使用 Microsoft Direct3D 和 Direct3DX 完成一些普通的工作。这些工作总是被分解成若干个必要的步骤。在某些情况下，为了使表达更清楚，一些步骤还被细分成几个子步骤。 本区域提供的指南有：· 指南一：创建设备 · 指南二：演示顶点 · 指南三：使用矩阵 · 指南四：创建和使用光源 · 指南五：使用纹理映射 · 指南六：使用Mesh模型 提示：指南中出现的示例代码来自于每个指南具体提供的路径里的源文件。 这些指南中的源代码是用 C++ 写成的。如果使用C编译器，你必须适当的改变这些文件使它们能够编译通过。最少的，你需要加入 vtable 然后用它引用接口函数。 包含在示例代码中的一些注解可能与来自 Microsoft Platform Software Development Kit (SDK) 中的源代码不同。这些改变仅仅为了简化表述并且只限于注解中，这样能够防止示例程序的行为被改变。指南一：创建设备 为了使用 Microsoft Direct3D，你首先需要创建一个应用程序窗口，并紧接着创建和初始化 Direct3D 对象。你应该使用这些对象提供的 COM 接口来操纵它们，以及创建描绘一个场景所必需的其它对象。本指南包含的 CreateDevice 示例将例示并说明以下几个工作：创建 Direct3D 设备并且绘制一个简单的蓝色屏幕。 这个指南使用以下步骤：初始化 Direct3D，绘制场景，以及最后清理与关闭。 ·步骤一：创建一个窗口 ·步骤二：初始化 Direct3D ·步骤三：处理系统消息 ·步骤四：绘制与显示场景 ·步骤五：关闭与清除 注意：CreateDevice 示例程序的路径在： (SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut01_CreateDevice. 步骤一：创建一个窗口任何 Microsoft Windows 程序执行中必须要作的第一件事就是创建一个应用程序窗口并将其显示给用户。为做到这点，CreateDevice 例程将首先实现它的 WinMain 函数。以下示例代码完成了窗口的初始化。 INT WINAPI WinMain( HINSTANCE hInst, HINSTANCE, LPSTR, INT ) { // Register the window class. WNDCLASSEX wc = { sizeof(WNDCLASSEX), CS_CLASSDC, MsgProc, 0L, 0L, GetModuleHandle(NULL), NULL, NULL, NULL, NULL, &ldquo;D3D Tutorial&rdquo;, NULL }; RegisterClassEx( &amp;wc ); // Create the application&rsquo;s window. HWND hWnd = CreateWindow( &ldquo;D3D Tutorial&rdquo;, &ldquo;D3D Tutorial 01: CreateDevice&rdquo;, WS_OVERLAPPEDWINDOW, 100, 100, 300, 300, GetDesktopWindow(), NULL, wc.hInstance, NULL ); 前述示例代码是标准的 Windows 编程。例子开始时定义和注册了一个窗口类名为 &ldquo;D3D Tutorial&rdquo;。类注册以后，示例代码使用已注册的类创建了一个基本的顶层（top-level）窗口，客户区域为 300 像素宽，300 像数高。这个窗口没有菜单或子窗口。示例使用了 WS_OVERLAPPEDWINDOW 属性创建一个包括最大化，最小化，以及关闭按钮的普通窗口。（如果该例程将运行在全屏模式下，首选的窗口属性应该是WS_EX_TOPMOST，它指定创建的窗口置于并且保持在所有非最高（non-topmost）窗口之前，甚至在窗口失活的情况下。）一旦窗口创建完成，例代码调用标准的 Microsoft Win32 函数显示和更新窗口。 在应用程序窗口准备好以后，你就能开始设置具体的 Microsoft Direct3D 对象了， 请见：步骤二：初始化 Direct3D 步骤二：初始化 Direct3D CreateDevice 示例在 WinMain 中创建窗口之后，调用该程序定义的函数 InitD3D 完成 Microsoft Direct3D 初始化过程。在创建窗口之后，程序已经准备好初始化你将用来绘制场景的 Direct3D 对象了。这个过程包括创建一个 Direct3D 对象，设置Present Parameters，以及最后创建 Direct3D 设备。 创建完 Direct3D 对象之后，你可以立即使用 IDirect3D8::CreateDevice 方法创建 Direct3D 设备。你也能够使用 Direct3D 对象枚举设备，类型，模式以及其他东西。这些工作的代码段应位于使用 Direct3DCreate8 函数创建 Direct3D 对象之后。 if( NULL == ( g_pD3D = Direct3DCreate8( D3D_SDK_VERSION ) ) ) return E_FAIL; 传递给 Direct3DCreate8 的唯一参数应该始终是 D3D_SDK_VERSION，它告诉 Direct3D 当前使用的头文件信息。无论如何，头文件或者其他的变化将导致这个值增加并强制使用该值的应用程序重新编译。如果此版本不匹配，调用 Direct3DCreate8 将失败。 下一个步骤是使用 IDirect3D8::GetAdapterDisplayMode 接口找到当前的显示模式，代码如下： D3DDISPLAYMODE d3ddm; if( FAILED( g_pD3D->GetAdapterDisplayMode( D3DADAPTER_DEFAULT, &amp;d3ddm ) ) ) return E_FAIL; D3DDISPLAYMODE 结构中的 Format 变量将被用于创建 Direct3D 设备。如果是运行于窗口模式下的话，Format 参数通常用来创建一个与适配器当前模式相匹配的后背缓冲 (Back buffer)。 在给 D3DPRESENT_PARAMETERS 各参数赋值时，你必须指定你的应用程序在3D下工作的方式。本 CreateDevice 例程设置D3DPRESENT_PARAMETERS结构中 Windowed 为 TRUE，SwapEffect 为 D3DSWAPEFFECT_DISCARD，BackBufferFormat 为 d3ddm.Format。 D3DPRESENT_PARAMETERS d3dpp; ZeroMemory( &amp;d3dpp, sizeof(d3dpp) ); d3dpp.Windowed = TRUE; d3dpp.SwapEffect = D3DSWAPEFFECT_DISCARD; d3dpp.BackBufferFormat = d3ddm.Format; 最后一步，是利用 IDirect3D8::CreateDevice 函数创建 Direct3D 设备，代码如下： if( FAILED( g_pD3D->CreateDevice( D3DADAPTER_DEFAULT, D3DDEVTYPE_HAL, hWnd, D3DCREATE_SOFTWARE_VERTEXPROCESSING, &amp;d3dpp, &amp;g_pd3dDevice ) ) ) 前述代码使用 D3DADAPTER_DEFAULT 标志创建了一个使用省缺适配器的设备。在非常多数的情况下，系统只有一个适配器，除非它安装了多个图形加速卡。通过把 DeviceType 参数设成 D3DDEVTYPE_HAL，表示你希望获得一个实际硬件设备 (hardware device) 而不是软件虚拟设备 (software device)。示例代码还使用 D3DCREATE_SOFTWARE_VERTEXPROCESSING 标志通知系统使用软件顶点处理 (software vertex processing)。注意，如果你指定 D3DCREATE_HARDWARE_VERTEXPROCESSING 标志通知系统使用硬件顶点处理 (hardware vertex processing),你可以在支持硬件顶点处理的图形加速卡上得到大幅度的性能提升。 现在 Direct3D 已经初始化完毕，下一步是确保你的程序具有一个机制用来来处理系统消息， 见下文：步骤三：处理系统消息 步骤三：处理系统消息 完成创建程序窗口以及初始化 Direct3D 以后，你已经准备好绘制场景 (Render scene)。大多数情况下，Microsoft Windows 程序在它们的消息循环里监视系统消息，并且在队列里没有消息时绘制画面帧。然而，CreateDevice 例程仅仅在等到一个WM_PAINT出现在队列里时，才通知应用程序重绘窗口的所有部分。 // The message loop. MSG msg; while( GetMessage( &amp;msg, NULL, 0, 0 ) ) { TranslateMessage( &amp;msg ); DispatchMessage( &amp;msg ); } 当每循环一次，DispatchMessage 调用 MsgProc，后者负责处理队列里的消息，当 WM_PAINT 消息进队时，调用该程序自身定义的函数 Render()，它将负责重绘窗口。然后 Microsoft Win32 函数 ValidateRect 执行并将整个客户区域设为有效。 消息处理函数的例代码如下： LRESULT WINAPI MsgProc( HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam ) { switch( msg ) { case WM_DESTROY: PostQuitMessage( 0 ); return 0; case WM_PAINT: Render(); ValidateRect( hWnd, NULL ); return 0; } return DefWindowProc( hWnd, msg, wParam, lParam ); } 现在，应用程序处理了系统消息，接着的一步是绘制显示，见：步骤四：绘制与显示场景 步骤四：绘制与显示场景 为了描绘和显示需要的场景，本例程在这一步把后背缓冲 (back buffer) 填充为蓝色，然后将此后背缓冲的内容传给前景缓冲 (front buffer), 并且将前景缓冲提交至屏幕。 清除表面，应调用 IDirect3DDevice8::Clear 函数： // Clear the back buffer to a blue color g_pd3dDevice->Clear( 0, NULL, D3DCLEAR_TARGET, D3DCOLOR_XRGB(0,0,255), 1.0f, 0 ); Clear() 接受的前两个参数通知 Microsoft Direct3D 被清除的矩形区域数组的基址和大小，该矩形区域数组描述了绘制目标表面 (render target surface) 里需要清除的区域。 在大多数情况下，只使用单个矩形覆盖整个绘制目标表面。这样你只需设置第一个参数为 0 及第二个参数为 NULL。第三个参数将决定方法的行为，你可以通过设置特定的标志用来清除绘制目标表面 (render target surface)，关联的Z缓冲 (associated depth buffer)，模版缓冲 (stencil buffer)，以及任意这三者的混合。本指南不使用Z缓冲，所以仅仅使用了 D3DCLEAR_TARGET 标志。最后三个参数分别用于设置对应绘制目标表面、Z缓冲和模版缓冲的清除填充值 (reflect clearing values)。该 CreateDevice 例程将绘制目的表面的清除填充色设置为蓝色 (D3DCOLOR_XRGB(0,0,255)。由于相应的标志没有设置，最后两个参数被 Clear() 忽略。 在清除了视口 (viewport) 之后，CreateDevice 例程告知 Direct3D 绘图将要开始，然后立即通知这次绘制完成，见以下代码段： // Begin the scene. g_pd3dDevice->BeginScene(); // Rendering of scene objects happens here. // End the scene. g_pd3dDevice->EndScene(); 当绘制开始或完成时，IDirect3DDevice8::BeginScene 和 IDirect3DDevice8::EndScene 函数将用信号通知系统。你只能在这两函数之间调用其它的绘图函数。即使调用绘图函数失败，你也应该在重新调用 BeginScene 之前调用 EndScene。 绘制完之后，调用 IDirect3DDevice8::Present显示该场景： g_pd3dDevice->Present( NULL, NULL, NULL, NULL ); Present() 接受的前两个参数是原始矩形和目标矩形。在这一步，例程设置这两个参数为 NULL 并把整个后备缓冲提交到前景缓冲。第三个参数用于设置该次提交的目标窗口。因为这个参数被设为 NULL，实际使用的窗口是 D3DPRESENT_PARAMETERS 的 hWndDeviceWindow 成员。第四个是 DirtyRegion 参数，在绝大多数情况下应该设为 NULL。 本指南的最终步骤是关闭应用程序，见：步骤五：关闭与清除 步骤五：关闭与清除 在执行的若干时刻，你的应用程序必须立即关闭。关闭一个 Direct3D 应用程序中不只是意味着你必须销毁程序窗口，并且你还要释放程序中使用过的的任何 Direct3D 对象并且无效化它们的指针。当收到一个 WM_DESTROY 消息时，CreateDevice 例程通过调用一个本地定义的函数 Cleanup() 来处理这些工作。 VOID Cleanup() { if( g_pd3dDevice != NULL) g_pd3dDevice->Release(); if( g_pD3D != NULL) g_pD3D->Release(); } 上述函数对每个对象调用 IUnknown::Release 方法来释放它们自身。由于DirectX遵循 COM 规则，大多数对象当其引用计数降为0时，DirectX会自动的从内存中释放这个对象。 对于其他关闭程序情况，可能发生在程序的平常执行中——比如用户改变了桌面的参数或色深——此时你可能需要撤销和重建使用中的 Microsoft Direct3D 对象。因此一个好的主意就是将你的释放代码放到一起，以便能在需要时随时调用它。 本指南已经说明了如何创建一个设备，指南二：演示顶点(Render Vertex) ，将告诉你如何用顶点（Vertex）创建几何形体。 指南二：演示顶点(Render Vertex) Microsoft Direct3D 写的应用程序使用顶点(Vertex)构造几何物体。每一个三维空间 (3D) 场景包括一个或几个这样的几何物体。Vertices 例程构造简单的物体，一个三角形，并且将它绘制到显示屏上。 本指南说明如何采用以下步骤从顶点构造一个三角形： ·第一步：定义一个自定义顶点类型 ·第二步：设置顶点缓冲 ·第三步：绘制至显示屏 注意：Vertices 示例程序的路径为： (SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut02_Vertices. Vertices 程序的示例代码与 CreateDevice 的代码大部分相同。本“演示顶点（Render Vertex）”指南仅仅关注于那些独特的，关于顶点的代码而不包括初始化 Direct3D，处理 Microsoft Windows 消息，绘图，与清理等工作。如要得到有关这些任务的信息，请参考 指南一：创建设备。 第一步：定义一个自定义顶点类型 Vertices 例程使用三个顶点构造一个 2D 的三角形。这里提及了顶点缓冲的概念，这是用于保存和演示大量顶点的 Microsoft Direct3D 对象。通过指定一个自定义的顶点结构和相应的可变向量格式 (FVF)，顶点能够采用很多方法定义。本 Vertices 例程使用的顶点格式定义于以下代码片断中。 struct CUSTOMVERTEX { FLOAT x, y, z, rhw; // The transformed position for the vertex. DWORD color; // The vertex color. }; 上面的结构体说明了自定义顶点类型的格式。下一步是定义 FVF 以描述顶点缓冲区中的顶点内容。以下代码片段定义了一个 FVF 并符合此上建立的自定义顶点类型。 #define D3DFVF_CUSTOMVERTEX (D3DFVF_XYZRHW|D3DFVF_DIFFUSE) 可变顶点格式标记描述了使用中的自定义顶点类型。前述示例代码使用了 D3DFVF_XYZRHW 和 D3DFVF_DIFFUSE 标志，这将告诉顶点缓冲，自定义顶点类型包含一组转换过的点坐标并紧跟着一个颜色参数。 现在自定义向量格式和 FVF 已经被指定好了，下一步将使用顶点填充顶点缓冲区，请参看：第二步：设置顶点缓冲 。 注意：Vertices 例程中的顶点是转换过的。用另一句话说，它们已经在 2D 窗口坐标系下。这意味着座标点 (0,0) 位于左上角，且正的 x 半轴向右，正的 y 半轴向下。这些顶点同样也是光照过的，这说明它们的着色不通过 Direct3D 照明而由它们自己的颜色代替。 第二步：设置顶点缓冲 现在自定义顶点格式已经完成，初始化顶点的时候到了。 Vertices 例程创建了必需的 Microsoft Direct3D 对象之后调用本程序内部定义的函数 InitVB() 进行这个工作。以下代码段将初始化三个自定义顶点的值。 CUSTOMVERTEX g_Vertices[] = { { 150.0f, 50.0f, 0.5f, 1.0f, 0xffff0000, }, // x, y, z, rhw, color { 250.0f, 250.0f, 0.5f, 1.0f, 0xff00ff00, }, { 50.0f, 250.0f, 0.5f, 1.0f, 0xff00ffff, }, }; 前述代码片段采用三角形的三个顶点填充三个Vertex并指定了每个顶点的散射光的颜色。第一个顶点位于 (150,50) ，散射红色 (0xffff0000)。第二个顶点位于 (250,250) ，为绿色 (0xff00ff00)。第三点位于 (50,250) 并散射蓝绿色 (0xff00ffff)。每一点都具有相同的 0.5 Z值及 1.0 的 RHW 参数。关于这些矢量格式的其它信息见 SDK: Transformed and Lit Vertices。 下一步将调用 IDirect3DDevice8::CreateVertexBuffer 创建顶点缓冲区，如以下代码段所示： if( FAILED( g_pd3dDevice->CreateVertexBuffer( 3sizeof(CUSTOMVERTEX), 0 / Usage /, D3DFVF_CUSTOMVERTEX, D3DPOOL_DEFAULT, &amp;g_pVB ) ) ) return E_FAIL; CreateVertexBuffer 的头两个参数告诉 Direct3D 新顶点缓冲区预计的大小和用法。紧跟的两个参数指定新缓冲区的矢量格式及存储位置。这里的向量格式是 D3DFVF_CUSTOMVERTEX，就是例程先前定义的 FVF 值。D3DPOOL_DEFAULT 标记告诉 Direct3D 在最合适的位置创建此顶点缓冲区。最后一个参数返回创建完成的顶点缓冲区对象地址。 创建了顶点缓冲区之后，如以下代码段所示，开始采用自定义格式的顶点填充缓冲区中的数据。 VOID pVertices; if( FAILED( g_pVB->Lock( 0, sizeof(g_Vertices), (BYTE**)&amp;pVertices, 0 ) ) ) return E_FAIL; memcpy( pVertices, g_Vertices, sizeof(g_Vertices) ); g_pVB->Unlock(); 首先调用 IDirect3DVertexBuffer8::Lock 锁定顶点缓冲区。函数第一个参数是锁定顶点数据的偏移量，按字节计算。第二个参数是需锁定的顶点数据长度，同样按字节计算。第三个参数是一个 BYTE 类型指针的地址，用于返回指向顶点数据的地址。第四个参数告知顶点缓冲区如何锁定数据。 通过使用 memcpy，顶点被复制到顶点缓冲区里。将顶点放入缓冲区之后，调用一次 IDirect3DVertexBuffer8::Unlock 以解锁顶点缓冲区。这个锁定——解锁机制是必需的，因为正在使用的顶点缓冲区可能位于设备内存中。 现在顶点缓冲区已经填入顶点，绘制到显示的时候到了，见描述：第三步：绘制至显示屏 。 第三步：绘制至显示屏 现在缓冲区已经填入顶点，现在需要把它绘制到显示屏上。在绘制到屏幕之前，先将背景清除为蓝色并调用 BeginScene。 g_pd3dDevice->Clear( 0, NULL, D3DCLEAR_TARGET, D3DCOLOR_XRGB(0,0,255), 1.0f, 0L ); g_pd3dDevice->BeginScene(); 从顶点缓冲区绘制顶点数据需要一些步骤。首先，你需要设置流数据源；在当前情况下，使用第 0 个流 。流的数据源是通过调用 IDirect3DDevice8::SetStreamSource 设置的。 g_pd3dDevice->SetStreamSource( 0, g_pVB, sizeof(CUSTOMVERTEX) ); SetStreamSource 的第一个参数告诉 Microsoft Direct3D 设备设置数据流的索引。第二个参数是绑定在该数据流上的顶点缓冲区。第三个参数是数据单元的大小，用字节数表示。在上面的示例代码中，将使用CUSTOMVERTEX 的大小作为数据单元的大小。 下一步通过调用 IDirect3DDevice8::SetVertexShader 使 Direct3D 了解使用中的顶点处理器（Vertex Shader）。就整体而言，自定义顶点处理器是一种高级的话题，但是在绝大多数情况下顶点处理器仅仅等于 FVF 代码。这能够让 Direct3D 知道处理中的顶点类型。以下代码片段将FVF设置为当前顶点处理器： g_pd3dDevice->SetVertexShader( D3DFVF_CUSTOMVERTEX ); SetVertexShader() 唯一的参数是当前设置的顶点处理器的句柄。这个参数的值可以是从IDirect3DDevice8::CreateVertexShader 返回的句柄，或者是 FVF 代码。在这儿，使用的参数是定义为 D3DFVF_CUSTOMVERTEX 的 FVF 代码。 关于顶点处理器的更多信息，请见 SDK: Vertex Shader 一章。 下一步使用 IDirect3DDevice8::DrawPrimitive 绘制顶点缓冲区中的顶点，见以下代码片段： g_pd3dDevice->DrawPrimitive( D3DPT_TRIANGLELIST, 0, 1 ); DrawPrimitive 接受的第一个参数是一个标记，它通知 Direct3D 绘制哪种类型的物件(Primitive)。本例程使用 D3DPT_TRIANGLELIST 标记指定为三角形序列。第二个参数是第一个顶点的索引。第三个参数通知绘制的物件的数目。本例子只画一个三角形，这个值为 1。 关于不同种类物件的更多信息，可见 SDK: 3-D Primitive 最后的一步是结束场景并立即将后背缓冲提交为前景缓冲。这些写在以下代码片段中： g_pd3dDevice->EndScene(); g_pd3dDevice->Present( NULL, NULL, NULL, NULL ); 当后背缓冲被提交为前景缓冲后，客户窗口将显示出一个三个点颜色各异的三角形。 本指南已经指导你如何使用顶点构造几何外形了。指南三：使用矩阵 将介绍矩阵的概念以及如何使用它们。 指南三：使用矩阵 本指南介绍矩阵的概念及演示如何使用它们。Vertices 例程通过呈递2D的顶点画出了一个三角形。然而，在这个指南中，你将通过顶点变换在 3-D 环境下工作。矩阵和变换也同样用于设置摄影头与视口（Viewport）。 在 Matrices 例程呈递几何物体之前，它调用程序自定义函数 SetupMatrices 创建并设置用于演示 3-D 三角形的矩阵变换。作为代表，三种类型的变换同时被设置到一个 3-D 场景。创建这些典型变换的步骤如下表： ·第一步：定义世界变换矩阵 ·第二步：定义观察变换矩阵 ·第三步：定义映射变换矩阵 注意：Matrices 示例程序的路径为： (SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut03_Matrices. 创建这三种变换的顺序并不影响场景元素的输出。无论如何，Direct3D 都使用以下顺序依次将矩阵作用于场景：(1) 世界，(2) 观察，(3) 映射。 Matrices 工程的示例代码几乎与 Vertices 工程的代码相同。该“使用矩阵”指南仅仅关注那些有关矩阵的独特代码，而不重复初始化 Direct3D，处理 Microsoft Windows 消息，演示，以及清除。关于这些工作的信息，请见 指南一：创建设备 。 本指南使用自定义顶点格式和单个顶点缓冲区呈递几何模型，关于更多的有关选择自定义顶点类型以及执行顶点缓冲区的信息，见 指南二：演示顶点 。 第一步：定义世界变换矩阵（World Transformation Matrix） 世界变换矩阵定义了怎样转换、缩放、以及旋转 3-D 模拟空间中的几何物体。 以下代码片段为 Microsoft Direct3D 设备设置当前的世界变换并且使三角形绕 y-轴 旋转。 D3DXMATRIX matWorld; D3DXMatrixRotationY( &amp;matWorld, timeGetTime()/150.0f ); g_pd3dDevice->SetTransform( D3DTS_WORLD, &amp;matWorld ); 第一步是通过调用 D3DXMatrixRotationY 函数使三角形绕 y-轴 旋转。函数第一个参数是指向 D3DMATRIX 结构的指针用于返回操作结果。第二个参数是以弧度表示的旋转角度。 下一步是调用 IDirect3DDevice8::SetTransform 给 Direct3D 设备设置世界变换。SetTransform 接受的第一个参数通知 Direct3D 被设置的是哪个转换。这个例子用 D3DTS_WORLD 宏指定被设置的是世界变换。第二个参数是一个指向被设为当前变换之矩阵的指针。 关于世界变换的更多信息，见：SDK: World Transformation 定义完场景的世界变换后，你可以准备观察变换矩阵了。再一次请注意：定义任一变换的顺序不是关键。无论如何，Direct3D 采用以下顺序将这些矩阵作用于场景：(1) 世界，(2) 观察，(3) 映射。 定义观察变换矩阵请参看 第二步：定义观察变换矩阵 第二步：定义观察变换矩阵（View Transformation Matrix） 观察变换矩阵定义了观察的位置和旋转角度。此观察矩阵就相当于场景的摄影机。 以下代码片段创建了一个观察变换矩阵并将其设置为 Microsoft Direct3D 设备的当前观察矩阵。 D3DXMATRIX matView; D3DXMatrixLookAtLH( &amp;matView, &amp;D3DXVECTOR3( 0.0f, 3.0f,-5.0f ), &amp;D3DXVECTOR3( 0.0f, 0.0f, 0.0f ), &amp;D3DXVECTOR3( 0.0f, 1.0f, 0.0f ) ); g_pd3dDevice->SetTransform( D3DTS_VIEW, &amp;matView ); 第一步是通过调用 D3DXMatrixLookAtLH 定义观察矩阵。第一个参数是一个指向 D3DXMATRIX 结构的指针，用来接受操作结果。第二、三、四个参数定义了观察点、注视点、以及方向“上”。这儿设置观察点为沿 Z-轴 反方向 5 单位再往上 3 单位，注视点为原点，以及作为“上”的方向为 Y-轴。 下一步是调用 IDirect3DDevice8::SetTransform 给 Direct3D 设备设置观察矩阵。SetTransform 接受的第一个参数通知 Direct3D 哪一个变换将要被设置。该例程使用 D3DTS_VIEW 标记指定为观察矩阵。第二个参数是一个指向矩阵的指针，它被设为当前的变换。 关于观察矩阵的更多信息，见：SDK: View Transformation 定义了场景的世界变换后，你可以开始准备映射变换矩阵了。再一次提醒，定义每一变换的顺序不是关键性的。无论如何，Direct3D 总是采用以下顺序将矩阵应用于场景：(1) 世界，(2) 观察，(3) 映射。 定义映射变换矩阵的工作被描述在 第三步：定义映射变换矩阵 第三步：定义映射变换矩阵（Projection Transformation Matrix） 映射变换矩阵定义了将 3-D 观察空间转换为 2-D 视口空间的几何学方法。 以下代码片段创建映射变换矩阵并将其设为 Microsoft Direct3D 设备的当前映射变换。 D3DXMATRIX matProj; D3DXMatrixPerspectiveFovLH( &amp;matProj, D3DX_PI/4, 1.0f, 1.0f, 100.0f ); g_pd3dDevice->SetTransform( D3DTS_PROJECTION, &amp;matProj ); 第一步是调用 D3DXMatrixPerspectiveFovLH 设置映射矩阵。函数第一个参数是一个指向 D3DXMATRIX 的结构，用于接受操作的结果。第二个参数定义视场，它说明物体如何随着距离而缩小。一个典型的视场是 1/4 π，就像这个例子使用的一样。第三个参数定义了屏幕纵横比。本示例采用典型的纵横比 1。第四和第五个参数定义最近和最远剪切平面。这是用于确定位于何种距离之外的几何物体无需再绘制。本 Matrices 示例设置它的最近剪切平面为 1，最远剪切平面为 100。 下一步是调用 IDirect3DDevice8::SetTransfrom 对 Direct3D 应用变换。SetTransfrom 接受的第一个参数通知 Direct3D 何种变换被设置。本例程使用 D3DTS_PROJECTION 标志指定映射变换将被设置。第二个参数是一个指向矩阵的指针，它将被设置为当前的变换。 关于映射变换的更多信息，参见：“映射变换” 本指南已经提示你如何使用矩阵。指南四：创建和使用光源 将揭示如何在你的场景中添加光源以增加真实性。 指南四：创建和使用光源 Microsoft Direc3D 光照系统给 3-D 物体提供更多的真实性。当使用它时，每个场景中的几何对象将被照亮，基于它们的位置和使用的光源类型。这个指南的例程将介绍关于光照和材质的主题。 本指南包含以下步骤用于创建材质与光照： ·第一步：创始化场景几何 ·第二步：设置材置与光照 注意：Lights 示例程序的路径为： (SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut04_Lights. 注意：Lights 例程中的代码和 Matrices 例程的代码几乎完全一样。“创建和使用光源”指南仅仅关注于有关创建和使用光照的独特代码，而并不重复有关设置 Direct3D，处理 Microsoft Windows 消息，绘制，或者清理的内容。关于这些任务的其他信息，见：指南一：创建设备。 本指南使用自定义顶点和顶点缓冲区呈递几何形体。关于选择一个自定义顶点格式并执行顶点缓冲的更多信息，见：指南二：演示顶点。 本指南采用矩阵变换几何对象。关于矩阵和变换的更多信息，参见：指南三：使用矩阵。 第一步：创始化场景几何 使用光照的一个前提是每个表面都应该有法向量。为此，Lights 例程使用一个稍微不同的自定义顶点格式，新的自定义顶点格式具有一个 3-D 位置坐标和一个表面法向量。这个表面法向量被用于 Microsoft Direct3D 光照计算的核心。 struct CUSTOMVERTEX { D3DXVECTOR3 position; // The 3-D position for the vertex. D3DXVECTOR3 normal; // The surface normal for the vertex. }; // Custom FVF. #define D3DFVF_CUSTOMVERTEX (D3DFVF_XYZ|D3DFVF_NORMAL) 现在适当的矢量格式定义好了，Lights 例程调用 InitGeometry()，一个程序自定义的函数以创建一个圆柱体。最初的步骤是创建一个顶点缓冲区并用它保存这个圆柱体的各点，如以下例代码所示： // Create the vertex buffer. if( FAILED( g_pd3dDevice->CreateVertexBuffer( 502sizeof(CUSTOMVERTEX), 0 /* Usage /, D3DFVF_CUSTOMVERTEX, D3DPOOL_DEFAULT, &amp;g_pVB ) ) ) return E_FAIL; 下一步是使用圆柱体的顶点填充顶点缓冲区。注意下面的示例代码，每个点都被定义了一个位置和一个法向量。 for( DWORD i=0; i<50; i++ ) { FLOAT theta = (2D3DX_PIi)/(50-1); pVertices[2i+0].position = D3DXVECTOR3( sinf(theta),-1.0f, cosf(theta) ); pVertices[2i+0].normal = D3DXVECTOR3( sinf(theta), 0.0f, cosf(theta) ); pVertices[2i+1].position = D3DXVECTOR3( sinf(theta), 1.0f, cosf(theta) ); pVertices[2i+1].normal = D3DXVECTOR3( sinf(theta), 0.0f, cosf(theta) ); } 在前述例程使用圆柱体顶点填充了顶点缓冲区之后，这个顶点缓冲区已经准备好用于呈递了。但是首先，这个场景的材质与光照必须在绘制圆柱体之前被设置。这些描述在 第二步：设置材质与光照。 第二步：设置材质与光照 为了在 Microsoft Direct3D 中使用光照，你必须创建一个或多个光源。为了确定一个几何物体放射何种颜色的光线，材质必须被创建于绘制几何对象。在绘制这个场景之前，Lights 例程调用 SetupLights，一个程序自定义函数来设置材质和一个方向性光源。 创建一种材质 材质被定义为当一束光照到几何物体表面后，反射出的颜色。以下代码片段使用 D3DMATERIAL8 结构来创建一个黄色的材质。 D3DMATERIAL8 mtrl; ZeroMemory( &amp;mtrl, sizeof(D3DMATERIAL8) ); mtrl.Diffuse.r = mtrl.Ambient.r = 1.0f; mtrl.Diffuse.g = mtrl.Ambient.g = 1.0f; mtrl.Diffuse.b = mtrl.Ambient.b = 0.0f; mtrl.Diffuse.a = mtrl.Ambient.a = 1.0f; g_pd3dDevice->SetMaterial( &amp;mtrl ); 这个材质的漫射光颜色与环境光颜色都被设为黄色。对 IDirect3DDevice8::SetMaterial 函数的调用将应用此材质到用于绘制场景的 Microsoft Direct3D 设备。SetMaterial() 接受的唯一参数是设置材质的指针。在这个调用完成以后，每个物件都将使用这个材质绘制直到另一次对 SetMaterial 的调用指定了一个不同的材质为止。 现在材质已经被应用到场景，下一个步骤是创建光源。 创建一个光源 Microsoft Direct3D 里有三种可用的光源：点光源，方向形光源，与聚光灯光源。本示例代码创建一个方向形光源，它向一个方向发光，并且不停的变换发光的方向。 下列代码片段使用 D3DLIGHT8 结构创建一个方向性光源。 D3DXVECTOR3 vecDir; D3DLIGHT8 light; ZeroMemory( &amp;light, sizeof(D3DLIGHT8) ); light.Type = D3DLIGHT_DIRECTIONAL; 下列代码片设置光源的漫射光为白色。 light.Diffuse.r = 1.0f; light.Diffuse.g = 1.0f; light.Diffuse.b = 1.0f; 以下代码片在一个环内旋转光源的方向。 vecDir = D3DXVECTOR3(cosf(timeGetTime()/360.0f), 0.0f, sinf(timeGetTime()/360.0f) ); D3DXVec3Normalize( (D3DXVECTOR3)&amp;light.Direction, &amp;vecDir ); 对 D3DXVec3Normalize 函数的调用将归一化方向矢量并初始化光源的方向。 可以设置一个范围告诉 Direct3D 此光源能影响多远的距离。这个成员参数对方向性光源无效。以下代码片指定此光源的范围为 1000 单位。 light.Range = 1000.0f; 下面的代码片将这个光源分配到当前的 Direct3D 设备，通过调用 IDirect3DDevice8::SetLight。 g_pd3dDevice->SetLight( 0, &amp;light ); SetLight 接受的第一个参数是此光源被分配的索引号。注意如果在此索引已存在一个光源，它将被新光源覆盖。第二个参数是一个指向新定义光源数据结构的指针。本 Lights 例程设置这个光源位于 0 号索引。 下列代码片激活这个光源，通过调用 IDirect3DDevice8::LightEnable。 g_pd3dDevice->LightEnable( 0, TRUE); LightEnable 接受的第一个参数是激活光源的索引。第二个参数是一个布尔量通知此光源是开 (TRUE) 还是闭 (FALSE)。在上面的例程中，索引 0 上的光源被打开。 以下代码片通知 Direct3D 呈递此光源，通过调用 IDirect3DDevice8::SetRenderState。 g_pd3dDevice->SetRenderState( D3DRS_LIGHTING, TRUE ); SetRenderState 接受的头两个参数是哪一个设备状态变量被改写以及写入何种值。本例程设置 D3DRS_LIGHTING 设备变量为 TRUE，这将使设备能够演示光照效果。 本例程的最后一步是通过再一次调用 SetRenderState 打开环境照明光。 g_pd3dDevice->SetRenderState( D3DRS_AMBIENT, 0x00202020 ); 当前代码段设置 D3DRS_AMBIENT 设备变量为一种浅灰色 (0x00202020)。环境照明将使用所给的颜色照亮所有的物体。 关于照明及材质的更多信息，参见 SDK: Lights and Materials。 本例程向你说明了如何使用照明与材质。指南五：使用纹理映射 将向你说明如何将纹理添加到物体表面上。 指南五：使用纹理映射 尽管光照和材质大大增加了场景的真实感，但没有比在表面上添加纹理更能增加真实感的了。纹理能够被想象为一层紧紧包装在表面的贴纸。你能在一个立方体上放置一层木质纹理使它看起来就象用木头制成的一样。本 Texture 例程将在 指南四：创建和使用光照 中构造的圆柱上添加一幅类似香蕉的纹理。此指南介绍的内容包括如何载入纹理，设置纹理，与呈递带有纹理的物体。 本指南采用以下步骤实现纹理： ·第一步：定义一个定制顶点格式 ·第二步：初始化屏幕几何 ·第三步：演示场景 注意：Texture 示例程序的路径为： (SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut05_Textures. 注意：除了 Texture 示例不创建材质和光照以外，Texture 工程中的示例代码与 Lights 工程的几乎完全一样。本“使用纹理映射”指南仅仅关注于有关于纹理的独特代码，而并不重复有关初始化 Microsoft Direct3D，处理 Microsoft Windows 消息，演示，或清理的内容。关于这些工作的信息，见：指南一：创建设备。 本指南使用自定义顶点和顶点缓冲区显示几何物体。关于选择一个自定义顶点格式并执行顶点缓冲的更多信息，见：指南二：演示顶点。 本指南采用矩阵进行几何变换。关于矩阵和变换的更多信息，参见：指南三：使用矩阵。 第一步：定义一个定制顶点格式 在使用纹理以前，必须使用包含纹理坐标的自定义顶点格式。纹理坐标告诉 Microsoft Direct3D 在物件上如何将纹理定位于每个顶点上。纹理坐标范围从 0.0 到 1.0，(0.0, 0.0) 的位置代表纹理贴图的左上角而 (1.0, 1.0) 代表纹理贴图的右下角。 以下示例代码说明了 Texture 例程是如何通过设置它的自定义顶点格式来包含纹理坐标的。 struct CUSTOMVERTEX { D3DXVECTOR3 position; // The position. D3DCOLOR color; // The color. FLOAT tu, tv; // The texture coordinates. }; // The custom FVF, which describes the custom vertex structure. #define D3DFVF_CUSTOMVERTEX (D3DFVF_XYZ|D3DFVF_DIFFUSE|D3DFVF_TEX1) 关于纹理坐标的进一步信息，参见 SDK: Texture Coordinates 一章。 现在自定义顶点格式已经准备好了，下一步将是载入一幅纹理并创建一个圆柱体，见 第二步：初始化屏幕几何。 第二步：初始化屏幕几何 在绘制之前，Texture 例程调用 InitGeometry，一个程序自定义的函数用于创建一幅纹理并初始化圆柱体的几何参数。 纹理是由基于文件的图像构造的。以下示例代码使用 D3DXCreateTextureFromFile 从 Banana.bmp 文件创建一幅纹理并用它覆盖圆柱的表面。 if( FAILED( D3DXCreateTextureFromFile( g_pd3dDevice, &ldquo;Banana.bmp&rdquo;, &amp;g_pTexture ) ) ) return E_FAIL; D3DXCreateTextureFromFile 接受的第一个参数是一个指向 Microsoft Direct3D 设备的指针，这个设备将用于绘制纹理。第二个参数是一个指向 ANSI 字符串的指针，它指定用于创建纹理的文件名。本例程指定从此文件：“Banana.bmp” 来装载图像。第三个参数是一个指向纹理对象指针的地址。 当这个类似香蕉的纹理被装载并准备好之后，下一个步骤是创建圆柱体。以下示例代码用一个圆柱体填充顶点缓冲区。注意每一点都具备了纹理坐标 (tu, tv)。 for( DWORD i=0; i<50; i++ ) { FLOAT theta = (2D3DX_PIi)/(50-1); pVertices[2i+0].position = D3DXVECTOR3( sinf(theta),-1.0, cosf(theta) ); pVertices[2i+0].color = 0xffffffff; pVertices[2i+0].tu = ((FLOAT)i)/(50-1); pVertices[2i+0].tv = 1.0f; pVertices[2i+1].position = D3DXVECTOR3( sinf(theta), 1.0, cosf(theta) ); pVertices[2i+1].color = 0xff808080; pVertices[2i+1].tu = ((FLOAT)i)/(50-1); pVertices[2i+1].tv = 0.0f; } 每一个顶点包括位置，颜色，以及纹理坐标。上面的例程给每一点设置了纹理坐标并使此纹理能够平滑的包裹在圆柱体周围。 现在纹理和顶点缓冲区已经准备好用于演示了，现在能够呈递和着色图形了，参见 第三步：演示场景。 第三步：演示场景 在场景几何被初始化之后，应该是绘制场景的时候了。为了绘制一个带有纹理的物体，使用的纹理必须要设置成当前纹理中的一个。下一步将是设置纹存储器的状态。纹理存储器状态使你能够定义一个或者多个纹理被呈递的方式。比如说，你能将多个纹理混合在一起。 现在 Texture 示例开始设置需要使用的纹理。以下代码段使用 IDirect3DDevice8::SetTexture 设置 Microsoft Direct3D 设备用于绘制的纹理。 g_pd3dDevice->SetTexture( 0, g_pTexture ); SetTexture 接受的第一个参数是设置纹理存储器的标示符。一个设备能够支持八个已初始化的纹理，所以这儿的最大值是 7。本 Texture 示例仅仅使用一个纹理并且把它设置在存储器 0。第二个参数是一个指向纹理对象的指针。在这儿，Texture 示例使用由它的程序自定义函数 InitGeometry 创建的纹理。 以下代码片设置纹理存储器状态的值，通过调用 IDirect3DDevice8::SetTextureStageState 方法。 g_pd3dDevice->SetTextureStageState( 0, D3DTSS_COLOROP, D3DTOP_MODULATE ); g_pd3dDevice->SetTextureStageState( 0, D3DTSS_COLORARG1, D3DTA_TEXTURE ); g_pd3dDevice->SetTextureStageState( 0, D3DTSS_COLORARG2, D3DTA_DIFFUSE ); g_pd3dDevice->SetTextureStageState( 0, D3DTSS_ALPHAOP, D3DTOP_DISABLE ); SetTextureState 的第一个参数是需要改变状态的存储器的索引。本示例代码改变位于存储器 0 的纹理，所以这儿置为 0。下一个参数是要设置的纹理状态。关于所有有效的纹理状态以及它们的意义，见 &ldquo;SDK: D3DTEXTURESTAGESTATETYPE&rdquo;。再下一个参数是设置为此纹理状态的参数。你放置这儿的值应取决于你要改变的纹理存储器状态。 在设置完每个纹理存储器状态的合适值之后，这个圆柱体可以被呈递了，现在纹理将被添加在它的表面上。 使用纹理坐标的其他方法是使它们自动的生成。这是用一种纹理坐标索引 (TCI) 实现的。TCI 使用一个纹理矩阵来变换 (x,y,z) TCI 坐标为 (tu, tv) 纹理坐标。在 Texture 例程中，位于摄像机空间中的顶点位置被用来产生纹理坐标。 第一步是创建用于转换的矩阵，示范在以下代码片段中： D3DXMATRIX mat; mat._11 = 0.25f; mat._12 = 0.00f; mat._13 = 0.00f; mat._14 = 0.00f; mat._21 = 0.00f; mat._22 =-0.25f; mat._23 = 0.00f; mat._24 = 0.00f; mat._31 = 0.00f; mat._32 = 0.00f; mat._33 = 1.00f; mat._34 = 0.00f; mat._41 = 0.50f; mat._42 = 0.50f; mat._43 = 0.00f; mat._44 = 1.00f; 在矩阵创建好之后，它必须通过调用 IDirect3DDevice8::SetTransform 来设置它，如以下代码段所示： g_pd3dDevice->SetTransform( D3DTS_TEXTURE0, &amp;mat ); D3DTS_TEXTURE0 标志告诉 Direct3D 应用此变换到位于纹理存储器 0 的纹理。本示例的下一步是设置其他的存储器状态值，以得到所需的效果。这些处理在以下代码段中。 g_pd3dDevice->SetTextureStageState( 0, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_COUNT2 ); g_pd3dDevice->SetTextureStageState( 0, D3DTSS_TEXCOORDINDEX, D3DTSS_TCI_CAMERASPACEPOSITION ); 纹理坐标被设置后，现在此场景已准备好被呈递了。注意到现在的坐标是自动设置到圆柱上的。这样精确的设置使几何物体被演示时纹理好象是覆盖在绘制的屏幕上。 关于纹理的更多信息，见 SDK: Texture 一章。 本指南已经向你说明了如何给表面添加纹理。指南六：使用Mesh模型 将告诉你如何应用Mesh模型呈递复杂的几何形体。 指南六：使用Mesh模型 复杂的几何形状常常使用 3-D 建模软件构造模型并保存为文件。一个例子就是 .x 文件格式。Microsoft Direct3D 使用Mesh对象从文件装载这些物体。Mesh对象稍微有点复杂，但是 Microsoft Direct3DX 包含的函数使应用Mesh对象变的简单。Meshed 例程介绍关于Mesh的话题并展示如何装载，演示，以及卸载一个Mesh对象。 本指南使用以下步骤说明如何装载，演示，以及卸载一个Mesh对象： ·第一步：装载一个Mesh对象 ·第二步：演示一个Mesh对象 ·第三步：卸载一个Mesh对象 注意：Methes 示例程序的路径为： (SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut06_Meshes. 注意：除了 Meshes 工程中的示例代码不创建材值与光照以外，此工程的示例代码与 Lights 工程几乎完全一样。“使用Mesh模型”指南仅仅关注于有关于Mesh对象的独特代码，而并不重复有关设置 Microsoft Direct3D，处理 Microsoft Windows 消息，演示，或清理的工作。关于这些工作的信息，见：指南一：创建设备。 本指南使用自定义顶点和顶点缓冲区显示几何物体。关于选择一个自定义顶点格式并执行顶点缓冲的更多信息，见：指南二：演示顶点。 本指南采用矩阵进行几何变换。关于矩阵和变换的更多信息，参见：指南三：使用矩阵。 本指南使用纹理覆盖Mesh模型的表面。关于装载和使用纹理的更多信息，参见：指南五：使用纹理映射。 第一步：装载一个Mesh对象 在使用之前，Microsoft Direct3D 应用程序必须先装载一个Mesh对象。Meshes 例程通过调用 InitGeometry，一个该程序自定义的函数，装载一只虎的Mesh模型，当然这是在已经装载了必需的 Direct3D 对象以后。 一个Mesh对象需要用一个材质缓冲保存所有将要用到的材质与纹理。所以该函数最初定义了一个材质缓冲，如以下代码段所示： LPD3DXBUFFER pD3DXMtrlBuffer; 以下代码段使用 D3DXLoadMethFromX 函数装载Mesh对象。 // Load the mesh from the specified file. if( FAILED( D3DXLoadMeshFromX( &ldquo;tiger.x&rdquo;, D3DXMESH_SYSTEMMEM, g_pd3dDevice, NULL, &amp;pD3DXMtrlBuffer, &amp;g_dwNumMaterials, &amp;g_pMesh ) ) ) return E_FAIL; D3DXLoadMeshFromX 接受的第一个参数是一个指向字符串的指针告诉 Microsoft Direct3D 要装载的文件。本例程从 Tiger.x 读取一只虎的Mesh模型。 第二个参数通知 Direct3D 如何创建Mesh对象。本示例采用 D3DXMESH_SYSTEMMEM 标记，它等于同时指定 D3DXMESH_VB_SYSTEMMEM 与 D3DXMESH_IB_SYSTEMMEM，这两个参数告诉 Direct3D 把Mesh对象的索引缓冲区和顶点缓冲区都放到系统内存中。 第三个参数是指向将被用于绘制Mesh对象的 Direct3D 设备的指针。 第四个参数是一个指向 ID3DXBuffer 对象的指针。这个对象装入关于各个面相邻与否的信息。在本例程中此信息是不需要的，所以这个参数被设为 NULL。 第五个参数同样取得一个指向 ID3DXBuffer 的指针。在函数执行完以后，此对象将被填入该Mesh对象使用的 D3DXMATERIAL 结构。 第六个参数是一个指针，指向函数执行结束后，返回的置入 ppMaterials 队列中的 D3DXMATERIAL 结构数目。 第七个参数是一个Mesh对象指针的地址，返回装载的Mesh对象。 在装载了这个Mesh对象和相关材质信息之后，你需要从材质缓冲区中分解出材质属性及纹理名称。 本 Mesh 例程先需要得到材质缓冲区指针才能处理这些事情。以下代码段使用 ID3DXBuffer::GetBufferPointer 函数得到这个指针。 D3DXMATERIAL* d3dxMaterials = (D3DXMATERIAL*)pD3DXMtrlBuffer->GetBufferPointer(); 以下代码段创建了一个新的Mesh和纹理对象基于Mesh对象中材质的最大数目。 g_pMeshMaterials = new D3DMATERIAL8[g_dwNumMaterials]; g_pMeshTextures = new LPDIRECT3DTEXTURE8[g_dwNumMaterials]; 对于每个Mesh对象里的材质都必须进行以下步骤。 第一步是拷贝材质，如以下代码段所示. g_pMeshMaterials[i] = d3dxMaterials[i].MatD3D; 第二步是设置材值的环境色，见以下代码段。 g_pMeshMaterials[i].Ambient = g_pMeshMaterials[i].Diffuse; 最后一步是为该材质创建纹理，如以下代码段。 // Create the texture. if( FAILED( D3DXCreateTextureFromFile( g_pd3dDevice, d3dxMaterials[i].pTextureFilename, &amp;g_pMeshTextures[i] ) ) ) g_pMeshTextures[i] = NULL; } 装载了每个材质以后，你使用完毕了这个材质缓冲区，必须调用 IUnknown::Release 来释放它。 pD3DXMtrlBuffer->Release(); 现在，Mesh对象，连同其相应的材质与纹理都已经装载好了。这个Mesh物体已准备好呈递到屏幕上，参看 第二步：演示一个Mesh对象。 第二步：演示一个Mesh对象 在第一步中，Mesh对象已经准备号被呈递了。该对象被Mesh对象装载的每个材质分成若干个子集。为了绘制每个子集，应该在一个循环中绘制此Mesh对象。循环的第一步是为每个子集设置材质，如以下代码段所示： g_pd3dDevice->SetMaterial( &amp;g_pMeshMaterials[i] ); 循环的第二步是给每个子集设置纹理，如以下代码段所示。 g_pd3dDevice->SetTexture( 0, g_pMeshTextures[i] ); 在给每个子集设置完材质与纹理之后，子集被 ID3DXBaseMesh::DrawSubset 函数所绘制，如以下代码段所示。 g_pMesh->DrawSubset( i ); DrawSubset 函数带有一个 DWORD 参数用于指定Mesh对象的哪个子集被绘制。本例程使这个参数的值每循环一次就被加一。 在使用完Mesh对象之后，重要的事是要将此Mesh对象完全移出内存，参见 第三步：卸载一个Mesh对象。 第三步：卸载一个Mesh对象 在任何 Microsoft Direct3D 程序结束前，它有必要解构它使用的所有 DirectX 对象并且使指向它们的指针无效。本例程使用的Mesh对象同样需要被解构。当它接收到一个 WM_DESTROY 消息时，Meshes 例程调用 Cleanup，一个该程序自定义的函数，来处理此事。 以下代码段删除材质队列。 if( g_pMeshMaterials ) delete[] g_pMeshMaterials; 以下代码解构每个装载过的单独纹理并删除纹理队列。 if( g_pMeshTextures ) { for( DWORD i = 0; i < g_dwNumMaterials; i++ ) { if( g_pMeshTextures[i] ) g_pMeshTextures[i]->Release(); } delete[] g_pMeshTextures; 以下代码段解构Mesh对象。 Delete the mesh object if( g_pMesh ) g_pMesh->Release(); 本指南已经向你说明了如何装载和绘制Mesh对象。这是此区域最后一个指南。如果需要了解一个典型的 Direc3D 应用程序是如何写成的，见：&ldquo;SDK: DirectX Graphics C/C++ Samples&rdquo; 。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/directx-graphics-interface-guide/ itemprop=url class=post-title-link>DirectX 图形接口指南</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年06月25日 12:28:00 CST" itemprop="dateCreated datePublished" datetime="2007-06-25 12:28:00 +0800 +0800">2007年06月25日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/directx-graphics-interface-guide/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><font size=2>译者申明：<br><br>这些指南是我在阅读 DirectX9.0 SDK 中逐步翻译出来的。对于初次接触 DirectX Graphics 的编程者而言，这应该是很好的上手资料。其实，本人就是从这些指南开始深入 Direct3D9.0 的；由于这是本人第一次翻译英文材料，言语不通，词不达意之处一定很多，一些术语也译得很勉强，请见谅。<br><br>此外，需要转载此文者，请保留以下部分：<br><br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br><br>DirectX图形接口指南 译者：Rise 电子邮箱： <a href=mailto:Rise.Worlds@gmail.com><a href=mailto:Rise.Worlds@gmail.com title=Rise.Worlds@gmail.com>Rise.Worlds@gmail.com</a></a><br><br>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;<br><br>DirectX 图形接口指南：（应用于 DirectX 9.0 版 C/C++ 编程） <br>本区域的指南将说明如何在 C/C++ 程序中使用 Microsoft Direct3D 和 Direct3DX 完成一些普通的工作。这些工作总是被分解成若干个必要的步骤。在某些情况下，为了使表达更清楚，一些步骤还被细分成几个子步骤。 <br><br>本区域提供的指南有：<br><br><br>· 指南一：创建设备 <br><br>· 指南二：演示顶点 <br><br>· 指南三：使用矩阵 <br><br>· 指南四：创建和使用光源 <br><br>· 指南五：使用纹理映射 <br><br>· 指南六：使用Mesh模型 <br><br><br>提示：指南中出现的示例代码来自于每个指南具体提供的路径里的源文件。 <br><br><br>这些指南中的源代码是用 C++ 写成的。如果使用C编译器，你必须适当的改变这些文件使它们能够编译通过。最少的，你需要加入 vtable 然后用它引用接口函数。 <br><br>包含在示例代码中的一些注解可能与来自 Microsoft Platform Software Development Kit (SDK) 中的源代码不同。这些改变仅仅为了简化表述并且只限于注解中，这样能够防止示例程序的行为被改变。<br><br><br>指南一：创建设备 <br><br>为了使用 Microsoft Direct3D，你首先需要创建一个应用程序窗口，并紧接着创建和初始化 Direct3D 对象。你应该使用这些对象提供的 COM 接口来操纵它们，以及创建描绘一个场景所必需的其它对象。本指南包含的 CreateDevice 示例将例示并说明以下几个工作：创建 Direct3D 设备并且绘制一个简单的蓝色屏幕。 <br><br>这个指南使用以下步骤：初始化 Direct3D，绘制场景，以及最后清理与关闭。 <br><br><br>·步骤一：创建一个窗口 <br><br>·步骤二：初始化 Direct3D <br><br>·步骤三：处理系统消息 <br><br>·步骤四：绘制与显示场景 <br><br>·步骤五：关闭与清除 <br><br><br>注意：CreateDevice 示例程序的路径在： <br><br>(SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut01_CreateDevice. <br><br><br>步骤一：创建一个窗口<br><br>任何 Microsoft Windows 程序执行中必须要作的第一件事就是创建一个应用程序窗口并将其显示给用户。为做到这点，CreateDevice 例程将首先实现它的 WinMain 函数。以下示例代码完成了窗口的初始化。 <br><br>INT WINAPI WinMain( HINSTANCE hInst, HINSTANCE, LPSTR, INT ) <br><br>{ <br><br>// Register the window class. <br><br>WNDCLASSEX wc = { sizeof(WNDCLASSEX), CS_CLASSDC, MsgProc, 0L, 0L, <br><br>GetModuleHandle(NULL), NULL, NULL, NULL, NULL, <br><br>&ldquo;D3D Tutorial&rdquo;, NULL }; <br><br>RegisterClassEx( &amp;wc ); <br><br><br>// Create the application&rsquo;s window. <br><br>HWND hWnd = CreateWindow( &ldquo;D3D Tutorial&rdquo;, &ldquo;D3D Tutorial 01: CreateDevice&rdquo;, <br><br>WS_OVERLAPPEDWINDOW, 100, 100, 300, 300, <br><br>GetDesktopWindow(), NULL, wc.hInstance, NULL ); <br><br><br>前述示例代码是标准的 Windows 编程。例子开始时定义和注册了一个窗口类名为 &ldquo;D3D Tutorial&rdquo;。类注册以后，示例代码使用已注册的类创建了一个基本的顶层（top-level）窗口，客户区域为 300 像素宽，300 像数高。这个窗口没有菜单或子窗口。示例使用了 WS_OVERLAPPEDWINDOW 属性创建一个包括最大化，最小化，以及关闭按钮的普通窗口。（如果该例程将运行在全屏模式下，首选的窗口属性应该是WS_EX_TOPMOST，它指定创建的窗口置于并且保持在所有非最高（non-topmost）窗口之前，甚至在窗口失活的情况下。）一旦窗口创建完成，例代码调用标准的 Microsoft Win32 函数显示和更新窗口。 <br><br><br>在应用程序窗口准备好以后，你就能开始设置具体的 Microsoft Direct3D 对象了， <br><br>请见：步骤二：初始化 Direct3D <br><br><br>步骤二：初始化 Direct3D <br><br>CreateDevice 示例在 WinMain 中创建窗口之后，调用该程序定义的函数 InitD3D 完成 Microsoft Direct3D 初始化过程。在创建窗口之后，程序已经准备好初始化你将用来绘制场景的 Direct3D 对象了。这个过程包括创建一个 Direct3D 对象，设置Present Parameters，以及最后创建 Direct3D 设备。 <br><br>创建完 Direct3D 对象之后，你可以立即使用 IDirect3D8::CreateDevice 方法创建 Direct3D 设备。你也能够使用 Direct3D 对象枚举设备，类型，模式以及其他东西。这些工作的代码段应位于使用 Direct3DCreate8 函数创建 Direct3D 对象之后。 <br><br>if( NULL == ( g_pD3D = Direct3DCreate8( D3D_SDK_VERSION ) ) ) <br><br>return E_FAIL; <br><br><br>传递给 Direct3DCreate8 的唯一参数应该始终是 D3D_SDK_VERSION，它告诉 Direct3D 当前使用的头文件信息。无论如何，头文件或者其他的变化将导致这个值增加并强制使用该值的应用程序重新编译。如果此版本不匹配，调用 Direct3DCreate8 将失败。 <br><br><br>下一个步骤是使用 IDirect3D8::GetAdapterDisplayMode 接口找到当前的显示模式，代码如下： <br><br><br>D3DDISPLAYMODE d3ddm; <br><br>if( FAILED( g_pD3D->GetAdapterDisplayMode( D3DADAPTER_DEFAULT, &amp;d3ddm ) ) ) <br><br>return E_FAIL; <br><br><br>D3DDISPLAYMODE 结构中的 Format 变量将被用于创建 Direct3D 设备。如果是运行于窗口模式下的话，Format 参数通常用来创建一个与适配器当前模式相匹配的后背缓冲 (Back buffer)。 <br><br><br>在给 D3DPRESENT_PARAMETERS 各参数赋值时，你必须指定你的应用程序在3D下工作的方式。本 CreateDevice 例程设置D3DPRESENT_PARAMETERS结构中 Windowed 为 TRUE，SwapEffect 为 D3DSWAPEFFECT_DISCARD，BackBufferFormat 为 d3ddm.Format。 <br><br><br>D3DPRESENT_PARAMETERS d3dpp; <br><br>ZeroMemory( &amp;d3dpp, sizeof(d3dpp) ); <br><br>d3dpp.Windowed = TRUE; <br><br>d3dpp.SwapEffect = D3DSWAPEFFECT_DISCARD; <br><br>d3dpp.BackBufferFormat = d3ddm.Format; <br><br><br>最后一步，是利用 IDirect3D8::CreateDevice 函数创建 Direct3D 设备，代码如下： <br><br>if( FAILED( g_pD3D->CreateDevice( D3DADAPTER_DEFAULT, D3DDEVTYPE_HAL, hWnd, <br><br>D3DCREATE_SOFTWARE_VERTEXPROCESSING, <br><br>&amp;d3dpp, &amp;g_pd3dDevice ) ) ) <br><br><br>前述代码使用 D3DADAPTER_DEFAULT 标志创建了一个使用省缺适配器的设备。在非常多数的情况下，系统只有一个适配器，除非它安装了多个图形加速卡。通过把 DeviceType 参数设成 D3DDEVTYPE_HAL，表示你希望获得一个实际硬件设备 (hardware device) 而不是软件虚拟设备 (software device)。示例代码还使用 D3DCREATE_SOFTWARE_VERTEXPROCESSING 标志通知系统使用软件顶点处理 (software vertex processing)。注意，如果你指定 D3DCREATE_HARDWARE_VERTEXPROCESSING 标志通知系统使用硬件顶点处理 (hardware vertex processing),你可以在支持硬件顶点处理的图形加速卡上得到大幅度的性能提升。 <br><br><br>现在 Direct3D 已经初始化完毕，下一步是确保你的程序具有一个机制用来来处理系统消息， <br><br>见下文：步骤三：处理系统消息 <br><br><br>步骤三：处理系统消息 <br><br>完成创建程序窗口以及初始化 Direct3D 以后，你已经准备好绘制场景 (Render scene)。大多数情况下，Microsoft Windows 程序在它们的消息循环里监视系统消息，并且在队列里没有消息时绘制画面帧。然而，CreateDevice 例程仅仅在等到一个WM_PAINT出现在队列里时，才通知应用程序重绘窗口的所有部分。 <br><br>// The message loop. <br><br>MSG msg; <br><br>while( GetMessage( &amp;msg, NULL, 0, 0 ) ) <br><br>{ <br><br>TranslateMessage( &amp;msg ); <br><br>DispatchMessage( &amp;msg ); <br><br>} <br><br>当每循环一次，DispatchMessage 调用 MsgProc，后者负责处理队列里的消息，当 WM_PAINT 消息进队时，调用该程序自身定义的函数 Render()，它将负责重绘窗口。然后 Microsoft Win32 函数 ValidateRect 执行并将整个客户区域设为有效。 <br><br>消息处理函数的例代码如下： <br><br>LRESULT WINAPI MsgProc( HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam ) <br><br>{ <br><br>switch( msg ) <br><br>{ <br><br>case WM_DESTROY: <br><br>PostQuitMessage( 0 ); <br><br>return 0; <br><br>case WM_PAINT: <br><br>Render(); <br><br>ValidateRect( hWnd, NULL ); <br><br>return 0; <br><br>} <br><br>return DefWindowProc( hWnd, msg, wParam, lParam ); <br><br>} <br><br><br>现在，应用程序处理了系统消息，接着的一步是绘制显示，见：步骤四：绘制与显示场景 <br><br>步骤四：绘制与显示场景 <br><br>为了描绘和显示需要的场景，本例程在这一步把后背缓冲 (back buffer) 填充为蓝色，然后将此后背缓冲的内容传给前景缓冲 (front buffer), 并且将前景缓冲提交至屏幕。 <br><br>清除表面，应调用 IDirect3DDevice8::Clear 函数： <br><br>// Clear the back buffer to a blue color <br><br>g_pd3dDevice->Clear( 0, NULL, D3DCLEAR_TARGET, D3DCOLOR_XRGB(0,0,255), 1.0f, 0 ); <br><br>Clear() 接受的前两个参数通知 Microsoft Direct3D 被清除的矩形区域数组的基址和大小，该矩形区域数组描述了绘制目标表面 (render target surface) 里需要清除的区域。 <br><br>在大多数情况下，只使用单个矩形覆盖整个绘制目标表面。这样你只需设置第一个参数为 0 及第二个参数为 NULL。第三个参数将决定方法的行为，你可以通过设置特定的标志用来清除绘制目标表面 (render target surface)，关联的Z缓冲 (associated depth buffer)，模版缓冲 (stencil buffer)，以及任意这三者的混合。本指南不使用Z缓冲，所以仅仅使用了 D3DCLEAR_TARGET 标志。最后三个参数分别用于设置对应绘制目标表面、Z缓冲和模版缓冲的清除填充值 (reflect clearing values)。该 CreateDevice 例程将绘制目的表面的清除填充色设置为蓝色 (D3DCOLOR_XRGB(0,0,255)。由于相应的标志没有设置，最后两个参数被 Clear() 忽略。 <br><br>在清除了视口 (viewport) 之后，CreateDevice 例程告知 Direct3D 绘图将要开始，然后立即通知这次绘制完成，见以下代码段： <br><br>// Begin the scene. <br><br>g_pd3dDevice->BeginScene(); <br><br>// Rendering of scene objects happens here. <br><br>// End the scene. <br><br>g_pd3dDevice->EndScene(); <br><br>当绘制开始或完成时，IDirect3DDevice8::BeginScene 和 IDirect3DDevice8::EndScene 函数将用信号通知系统。你只能在这两函数之间调用其它的绘图函数。即使调用绘图函数失败，你也应该在重新调用 BeginScene 之前调用 EndScene。 <br><br>绘制完之后，调用 IDirect3DDevice8::Present显示该场景： <br><br>g_pd3dDevice->Present( NULL, NULL, NULL, NULL ); <br><br>Present() 接受的前两个参数是原始矩形和目标矩形。在这一步，例程设置这两个参数为 NULL 并把整个后备缓冲提交到前景缓冲。第三个参数用于设置该次提交的目标窗口。因为这个参数被设为 NULL，实际使用的窗口是 D3DPRESENT_PARAMETERS 的 hWndDeviceWindow 成员。第四个是 DirtyRegion 参数，在绝大多数情况下应该设为 NULL。 <br><br>本指南的最终步骤是关闭应用程序，见：步骤五：关闭与清除 <br><br>步骤五：关闭与清除 <br><br>在执行的若干时刻，你的应用程序必须立即关闭。关闭一个 Direct3D 应用程序中不只是意味着你必须销毁程序窗口，并且你还要释放程序中使用过的的任何 Direct3D 对象并且无效化它们的指针。当收到一个 WM_DESTROY 消息时，CreateDevice 例程通过调用一个本地定义的函数 Cleanup() 来处理这些工作。 <br><br>VOID Cleanup() <br><br>{ <br><br>if( g_pd3dDevice != NULL) <br><br>g_pd3dDevice->Release(); <br><br>if( g_pD3D != NULL) <br><br>g_pD3D->Release(); <br><br>} <br><br>上述函数对每个对象调用 IUnknown::Release 方法来释放它们自身。由于DirectX遵循 COM 规则，大多数对象当其引用计数降为0时，DirectX会自动的从内存中释放这个对象。 <br><br>对于其他关闭程序情况，可能发生在程序的平常执行中——比如用户改变了桌面的参数或色深——此时你可能需要撤销和重建使用中的 Microsoft Direct3D 对象。因此一个好的主意就是将你的释放代码放到一起，以便能在需要时随时调用它。 <br><br>本指南已经说明了如何创建一个设备，指南二：演示顶点(Render Vertex) ，将告诉你如何用顶点（Vertex）创建几何形体。 <br><br>指南二：演示顶点(Render Vertex) <br><br>Microsoft Direct3D 写的应用程序使用顶点(Vertex)构造几何物体。每一个三维空间 (3D) 场景包括一个或几个这样的几何物体。Vertices 例程构造简单的物体，一个三角形，并且将它绘制到显示屏上。 <br><br>本指南说明如何采用以下步骤从顶点构造一个三角形： <br><br><br>·第一步：定义一个自定义顶点类型 <br><br>·第二步：设置顶点缓冲 <br><br>·第三步：绘制至显示屏 <br><br>注意：Vertices 示例程序的路径为： <br><br>(SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut02_Vertices. <br><br>Vertices 程序的示例代码与 CreateDevice 的代码大部分相同。本“演示顶点（Render Vertex）”指南仅仅关注于那些独特的，关于顶点的代码而不包括初始化 Direct3D，处理 Microsoft Windows 消息，绘图，与清理等工作。如要得到有关这些任务的信息，请参考 指南一：创建设备。 <br><br>第一步：定义一个自定义顶点类型 <br><br>Vertices 例程使用三个顶点构造一个 2D 的三角形。这里提及了顶点缓冲的概念，这是用于保存和演示大量顶点的 Microsoft Direct3D 对象。通过指定一个自定义的顶点结构和相应的可变向量格式 (FVF)，顶点能够采用很多方法定义。本 Vertices 例程使用的顶点格式定义于以下代码片断中。 <br><br>struct CUSTOMVERTEX <br><br>{ <br><br>FLOAT x, y, z, rhw; // The transformed position for the vertex. <br><br>DWORD color; // The vertex color. <br><br>}; <br><br>上面的结构体说明了自定义顶点类型的格式。下一步是定义 FVF 以描述顶点缓冲区中的顶点内容。以下代码片段定义了一个 FVF 并符合此上建立的自定义顶点类型。 <br><br>#define D3DFVF_CUSTOMVERTEX (D3DFVF_XYZRHW|D3DFVF_DIFFUSE) <br><br>可变顶点格式标记描述了使用中的自定义顶点类型。前述示例代码使用了 D3DFVF_XYZRHW 和 D3DFVF_DIFFUSE 标志，这将告诉顶点缓冲，自定义顶点类型包含一组转换过的点坐标并紧跟着一个颜色参数。 <br><br>现在自定义向量格式和 FVF 已经被指定好了，下一步将使用顶点填充顶点缓冲区，请参看：第二步：设置顶点缓冲 。 <br><br>注意：Vertices 例程中的顶点是转换过的。用另一句话说，它们已经在 2D 窗口坐标系下。这意味着座标点 (0,0) 位于左上角，且正的 x 半轴向右，正的 y 半轴向下。这些顶点同样也是光照过的，这说明它们的着色不通过 Direct3D 照明而由它们自己的颜色代替。 <br><br>第二步：设置顶点缓冲 <br><br>现在自定义顶点格式已经完成，初始化顶点的时候到了。 Vertices 例程创建了必需的 Microsoft Direct3D 对象之后调用本程序内部定义的函数 InitVB() 进行这个工作。以下代码段将初始化三个自定义顶点的值。 <br><br>CUSTOMVERTEX g_Vertices[] = <br><br>{ <br><br>{ 150.0f, 50.0f, 0.5f, 1.0f, 0xffff0000, }, // x, y, z, rhw, color <br><br>{ 250.0f, 250.0f, 0.5f, 1.0f, 0xff00ff00, }, <br><br>{ 50.0f, 250.0f, 0.5f, 1.0f, 0xff00ffff, }, <br><br>}; <br><br>前述代码片段采用三角形的三个顶点填充三个Vertex并指定了每个顶点的散射光的颜色。第一个顶点位于 (150,50) ，散射红色 (0xffff0000)。第二个顶点位于 (250,250) ，为绿色 (0xff00ff00)。第三点位于 (50,250) 并散射蓝绿色 (0xff00ffff)。每一点都具有相同的 0.5 Z值及 1.0 的 RHW 参数。关于这些矢量格式的其它信息见 SDK: Transformed and Lit Vertices。 <br><br>下一步将调用 IDirect3DDevice8::CreateVertexBuffer 创建顶点缓冲区，如以下代码段所示： <br><br>if( FAILED( g_pd3dDevice->CreateVertexBuffer( 3<em>sizeof(CUSTOMVERTEX), <br><br>0 /</em> Usage <em>/, D3DFVF_CUSTOMVERTEX, <br><br>D3DPOOL_DEFAULT, &amp;g_pVB ) ) ) <br><br>return E_FAIL; <br><br>CreateVertexBuffer 的头两个参数告诉 Direct3D 新顶点缓冲区预计的大小和用法。紧跟的两个参数指定新缓冲区的矢量格式及存储位置。这里的向量格式是 D3DFVF_CUSTOMVERTEX，就是例程先前定义的 FVF 值。D3DPOOL_DEFAULT 标记告诉 Direct3D 在最合适的位置创建此顶点缓冲区。最后一个参数返回创建完成的顶点缓冲区对象地址。 <br><br>创建了顶点缓冲区之后，如以下代码段所示，开始采用自定义格式的顶点填充缓冲区中的数据。 <br><br>VOID</em> pVertices; <br><br>if( FAILED( g_pVB->Lock( 0, sizeof(g_Vertices), (BYTE**)&amp;pVertices, 0 ) ) ) <br><br>return E_FAIL; <br><br>memcpy( pVertices, g_Vertices, sizeof(g_Vertices) ); <br><br>g_pVB->Unlock(); <br><br><br>首先调用 IDirect3DVertexBuffer8::Lock 锁定顶点缓冲区。函数第一个参数是锁定顶点数据的偏移量，按字节计算。第二个参数是需锁定的顶点数据长度，同样按字节计算。第三个参数是一个 BYTE 类型指针的地址，用于返回指向顶点数据的地址。第四个参数告知顶点缓冲区如何锁定数据。 <br><br>通过使用 memcpy，顶点被复制到顶点缓冲区里。将顶点放入缓冲区之后，调用一次 IDirect3DVertexBuffer8::Unlock 以解锁顶点缓冲区。这个锁定——解锁机制是必需的，因为正在使用的顶点缓冲区可能位于设备内存中。 <br><br>现在顶点缓冲区已经填入顶点，绘制到显示的时候到了，见描述：第三步：绘制至显示屏 。 <br><br>第三步：绘制至显示屏 <br><br>现在缓冲区已经填入顶点，现在需要把它绘制到显示屏上。在绘制到屏幕之前，先将背景清除为蓝色并调用 BeginScene。 <br><br>g_pd3dDevice->Clear( 0, NULL, D3DCLEAR_TARGET, D3DCOLOR_XRGB(0,0,255), 1.0f, 0L ); <br><br>g_pd3dDevice->BeginScene(); <br><br>从顶点缓冲区绘制顶点数据需要一些步骤。首先，你需要设置流数据源；在当前情况下，使用第 0 个流 。流的数据源是通过调用 IDirect3DDevice8::SetStreamSource 设置的。 <br><br>g_pd3dDevice->SetStreamSource( 0, g_pVB, sizeof(CUSTOMVERTEX) ); <br><br>SetStreamSource 的第一个参数告诉 Microsoft Direct3D 设备设置数据流的索引。第二个参数是绑定在该数据流上的顶点缓冲区。第三个参数是数据单元的大小，用字节数表示。在上面的示例代码中，将使用CUSTOMVERTEX 的大小作为数据单元的大小。 <br><br>下一步通过调用 IDirect3DDevice8::SetVertexShader 使 Direct3D 了解使用中的顶点处理器（Vertex Shader）。就整体而言，自定义顶点处理器是一种高级的话题，但是在绝大多数情况下顶点处理器仅仅等于 FVF 代码。这能够让 Direct3D 知道处理中的顶点类型。以下代码片段将FVF设置为当前顶点处理器： <br><br>g_pd3dDevice->SetVertexShader( D3DFVF_CUSTOMVERTEX ); <br><br>SetVertexShader() 唯一的参数是当前设置的顶点处理器的句柄。这个参数的值可以是从IDirect3DDevice8::CreateVertexShader 返回的句柄，或者是 FVF 代码。在这儿，使用的参数是定义为 D3DFVF_CUSTOMVERTEX 的 FVF 代码。 <br><br>关于顶点处理器的更多信息，请见 SDK: Vertex Shader 一章。 <br><br>下一步使用 IDirect3DDevice8::DrawPrimitive 绘制顶点缓冲区中的顶点，见以下代码片段： <br><br>g_pd3dDevice->DrawPrimitive( D3DPT_TRIANGLELIST, 0, 1 ); <br><br><br>DrawPrimitive 接受的第一个参数是一个标记，它通知 Direct3D 绘制哪种类型的物件(Primitive)。本例程使用 D3DPT_TRIANGLELIST 标记指定为三角形序列。第二个参数是第一个顶点的索引。第三个参数通知绘制的物件的数目。本例子只画一个三角形，这个值为 1。 <br><br>关于不同种类物件的更多信息，可见 SDK: 3-D Primitive <br><br>最后的一步是结束场景并立即将后背缓冲提交为前景缓冲。这些写在以下代码片段中： <br><br>g_pd3dDevice->EndScene(); <br><br>g_pd3dDevice->Present( NULL, NULL, NULL, NULL ); <br><br>当后背缓冲被提交为前景缓冲后，客户窗口将显示出一个三个点颜色各异的三角形。 <br><br>本指南已经指导你如何使用顶点构造几何外形了。指南三：使用矩阵 将介绍矩阵的概念以及如何使用它们。 <br><br><br>指南三：使用矩阵 <br><br>本指南介绍矩阵的概念及演示如何使用它们。Vertices 例程通过呈递2D的顶点画出了一个三角形。然而，在这个指南中，你将通过顶点变换在 3-D 环境下工作。矩阵和变换也同样用于设置摄影头与视口（Viewport）。 <br><br>在 Matrices 例程呈递几何物体之前，它调用程序自定义函数 SetupMatrices 创建并设置用于演示 3-D 三角形的矩阵变换。作为代表，三种类型的变换同时被设置到一个 3-D 场景。创建这些典型变换的步骤如下表： <br><br>·第一步：定义世界变换矩阵 <br><br>·第二步：定义观察变换矩阵 <br><br>·第三步：定义映射变换矩阵 <br><br>注意：Matrices 示例程序的路径为： <br><br>(SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut03_Matrices. <br><br><br>创建这三种变换的顺序并不影响场景元素的输出。无论如何，Direct3D 都使用以下顺序依次将矩阵作用于场景：(1) 世界，(2) 观察，(3) 映射。 <br><br>Matrices 工程的示例代码几乎与 Vertices 工程的代码相同。该“使用矩阵”指南仅仅关注那些有关矩阵的独特代码，而不重复初始化 Direct3D，处理 Microsoft Windows 消息，演示，以及清除。关于这些工作的信息，请见 指南一：创建设备 。 <br><br>本指南使用自定义顶点格式和单个顶点缓冲区呈递几何模型，关于更多的有关选择自定义顶点类型以及执行顶点缓冲区的信息，见 指南二：演示顶点 。 <br><br>第一步：定义世界变换矩阵（World Transformation Matrix） <br><br>世界变换矩阵定义了怎样转换、缩放、以及旋转 3-D 模拟空间中的几何物体。 <br><br>以下代码片段为 Microsoft Direct3D 设备设置当前的世界变换并且使三角形绕 y-轴 旋转。 <br><br>D3DXMATRIX matWorld; <br><br>D3DXMatrixRotationY( &amp;matWorld, timeGetTime()/150.0f ); <br><br>g_pd3dDevice->SetTransform( D3DTS_WORLD, &amp;matWorld ); <br><br>第一步是通过调用 D3DXMatrixRotationY 函数使三角形绕 y-轴 旋转。函数第一个参数是指向 D3DMATRIX 结构的指针用于返回操作结果。第二个参数是以弧度表示的旋转角度。 <br><br><br>下一步是调用 IDirect3DDevice8::SetTransform 给 Direct3D 设备设置世界变换。SetTransform 接受的第一个参数通知 Direct3D 被设置的是哪个转换。这个例子用 D3DTS_WORLD 宏指定被设置的是世界变换。第二个参数是一个指向被设为当前变换之矩阵的指针。 <br><br><br>关于世界变换的更多信息，见：SDK: World Transformation <br><br><br>定义完场景的世界变换后，你可以准备观察变换矩阵了。再一次请注意：定义任一变换的顺序不是关键。无论如何，Direct3D 采用以下顺序将这些矩阵作用于场景：(1) 世界，(2) 观察，(3) 映射。 <br><br><br>定义观察变换矩阵请参看 第二步：定义观察变换矩阵 <br><br><br>第二步：定义观察变换矩阵（View Transformation Matrix） <br><br><br>观察变换矩阵定义了观察的位置和旋转角度。此观察矩阵就相当于场景的摄影机。 <br><br><br>以下代码片段创建了一个观察变换矩阵并将其设置为 Microsoft Direct3D 设备的当前观察矩阵。 <br><br>D3DXMATRIX matView; <br><br>D3DXMatrixLookAtLH( &amp;matView, &amp;D3DXVECTOR3( 0.0f, 3.0f,-5.0f ), <br><br>&amp;D3DXVECTOR3( 0.0f, 0.0f, 0.0f ), <br><br>&amp;D3DXVECTOR3( 0.0f, 1.0f, 0.0f ) ); <br><br>g_pd3dDevice->SetTransform( D3DTS_VIEW, &amp;matView ); <br><br><br>第一步是通过调用 D3DXMatrixLookAtLH 定义观察矩阵。第一个参数是一个指向 D3DXMATRIX 结构的指针，用来接受操作结果。第二、三、四个参数定义了观察点、注视点、以及方向“上”。这儿设置观察点为沿 Z-轴 反方向 5 单位再往上 3 单位，注视点为原点，以及作为“上”的方向为 Y-轴。 <br><br>下一步是调用 IDirect3DDevice8::SetTransform 给 Direct3D 设备设置观察矩阵。SetTransform 接受的第一个参数通知 Direct3D 哪一个变换将要被设置。该例程使用 D3DTS_VIEW 标记指定为观察矩阵。第二个参数是一个指向矩阵的指针，它被设为当前的变换。 <br><br><br>关于观察矩阵的更多信息，见：SDK: View Transformation <br><br><br>定义了场景的世界变换后，你可以开始准备映射变换矩阵了。再一次提醒，定义每一变换的顺序不是关键性的。无论如何，Direct3D 总是采用以下顺序将矩阵应用于场景：(1) 世界，(2) 观察，(3) 映射。 <br><br>定义映射变换矩阵的工作被描述在 第三步：定义映射变换矩阵 <br><br><br>第三步：定义映射变换矩阵（Projection Transformation Matrix） <br><br>映射变换矩阵定义了将 3-D 观察空间转换为 2-D 视口空间的几何学方法。 <br><br>以下代码片段创建映射变换矩阵并将其设为 Microsoft Direct3D 设备的当前映射变换。 <br><br>D3DXMATRIX matProj; <br><br>D3DXMatrixPerspectiveFovLH( &amp;matProj, D3DX_PI/4, 1.0f, 1.0f, 100.0f ); <br><br>g_pd3dDevice->SetTransform( D3DTS_PROJECTION, &amp;matProj ); <br><br><br>第一步是调用 D3DXMatrixPerspectiveFovLH 设置映射矩阵。函数第一个参数是一个指向 D3DXMATRIX 的结构，用于接受操作的结果。第二个参数定义视场，它说明物体如何随着距离而缩小。一个典型的视场是 1/4 π，就像这个例子使用的一样。第三个参数定义了屏幕纵横比。本示例采用典型的纵横比 1。第四和第五个参数定义最近和最远剪切平面。这是用于确定位于何种距离之外的几何物体无需再绘制。本 Matrices 示例设置它的最近剪切平面为 1，最远剪切平面为 100。 <br><br><br>下一步是调用 IDirect3DDevice8::SetTransfrom 对 Direct3D 应用变换。SetTransfrom 接受的第一个参数通知 Direct3D 何种变换被设置。本例程使用 D3DTS_PROJECTION 标志指定映射变换将被设置。第二个参数是一个指向矩阵的指针，它将被设置为当前的变换。 <br><br>关于映射变换的更多信息，参见：“映射变换” <br><br>本指南已经提示你如何使用矩阵。指南四：创建和使用光源 将揭示如何在你的场景中添加光源以增加真实性。 <br><br>指南四：创建和使用光源 <br><br>Microsoft Direc3D 光照系统给 3-D 物体提供更多的真实性。当使用它时，每个场景中的几何对象将被照亮，基于它们的位置和使用的光源类型。这个指南的例程将介绍关于光照和材质的主题。 <br><br>本指南包含以下步骤用于创建材质与光照： <br><br><br>·第一步：创始化场景几何 <br><br>·第二步：设置材置与光照 <br><br>注意：Lights 示例程序的路径为： <br><br>(SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut04_Lights. <br><br>注意：Lights 例程中的代码和 Matrices 例程的代码几乎完全一样。“创建和使用光源”指南仅仅关注于有关创建和使用光照的独特代码，而并不重复有关设置 Direct3D，处理 Microsoft Windows 消息，绘制，或者清理的内容。关于这些任务的其他信息，见：指南一：创建设备。 <br><br>本指南使用自定义顶点和顶点缓冲区呈递几何形体。关于选择一个自定义顶点格式并执行顶点缓冲的更多信息，见：指南二：演示顶点。 <br><br>本指南采用矩阵变换几何对象。关于矩阵和变换的更多信息，参见：指南三：使用矩阵。 <br><br>第一步：创始化场景几何 <br><br><br>使用光照的一个前提是每个表面都应该有法向量。为此，Lights 例程使用一个稍微不同的自定义顶点格式，新的自定义顶点格式具有一个 3-D 位置坐标和一个表面法向量。这个表面法向量被用于 Microsoft Direct3D 光照计算的核心。 <br><br>struct CUSTOMVERTEX <br><br>{ <br><br>D3DXVECTOR3 position; // The 3-D position for the vertex. <br><br>D3DXVECTOR3 normal; // The surface normal for the vertex. <br><br>}; <br><br><br>// Custom FVF. <br><br>#define D3DFVF_CUSTOMVERTEX (D3DFVF_XYZ|D3DFVF_NORMAL) <br><br>现在适当的矢量格式定义好了，Lights 例程调用 InitGeometry()，一个程序自定义的函数以创建一个圆柱体。最初的步骤是创建一个顶点缓冲区并用它保存这个圆柱体的各点，如以下例代码所示： <br><br>// Create the vertex buffer. <br><br>if( FAILED( g_pd3dDevice->CreateVertexBuffer( 50<em>2</em>sizeof(CUSTOMVERTEX), <br><br>0 /* Usage <em>/, D3DFVF_CUSTOMVERTEX, <br><br>D3DPOOL_DEFAULT, &amp;g_pVB ) ) ) <br><br>return E_FAIL; <br><br><br>下一步是使用圆柱体的顶点填充顶点缓冲区。注意下面的示例代码，每个点都被定义了一个位置和一个法向量。 <br><br><br>for( DWORD i=0; i&lt;50; i++ ) <br><br>{ <br><br>FLOAT theta = (2</em>D3DX_PI<em>i)/(50-1); <br><br>pVertices[2</em>i+0].position = D3DXVECTOR3( sinf(theta),-1.0f, cosf(theta) ); <br><br>pVertices[2<em>i+0].normal = D3DXVECTOR3( sinf(theta), 0.0f, cosf(theta) ); <br><br>pVertices[2</em>i+1].position = D3DXVECTOR3( sinf(theta), 1.0f, cosf(theta) ); <br><br>pVertices[2<em>i+1].normal = D3DXVECTOR3( sinf(theta), 0.0f, cosf(theta) ); <br><br>} <br><br><br>在前述例程使用圆柱体顶点填充了顶点缓冲区之后，这个顶点缓冲区已经准备好用于呈递了。但是首先，这个场景的材质与光照必须在绘制圆柱体之前被设置。这些描述在 第二步：设置材质与光照。 <br><br><br>第二步：设置材质与光照 <br><br><br>为了在 Microsoft Direct3D 中使用光照，你必须创建一个或多个光源。为了确定一个几何物体放射何种颜色的光线，材质必须被创建于绘制几何对象。在绘制这个场景之前，Lights 例程调用 SetupLights，一个程序自定义函数来设置材质和一个方向性光源。 <br><br><br>创建一种材质 <br><br><br>材质被定义为当一束光照到几何物体表面后，反射出的颜色。以下代码片段使用 D3DMATERIAL8 结构来创建一个黄色的材质。 <br><br><br>D3DMATERIAL8 mtrl; <br><br>ZeroMemory( &amp;mtrl, sizeof(D3DMATERIAL8) ); <br><br>mtrl.Diffuse.r = mtrl.Ambient.r = 1.0f; <br><br>mtrl.Diffuse.g = mtrl.Ambient.g = 1.0f; <br><br>mtrl.Diffuse.b = mtrl.Ambient.b = 0.0f; <br><br>mtrl.Diffuse.a = mtrl.Ambient.a = 1.0f; <br><br>g_pd3dDevice->SetMaterial( &amp;mtrl ); <br><br><br>这个材质的漫射光颜色与环境光颜色都被设为黄色。对 IDirect3DDevice8::SetMaterial 函数的调用将应用此材质到用于绘制场景的 Microsoft Direct3D 设备。SetMaterial() 接受的唯一参数是设置材质的指针。在这个调用完成以后，每个物件都将使用这个材质绘制直到另一次对 SetMaterial 的调用指定了一个不同的材质为止。 <br><br><br>现在材质已经被应用到场景，下一个步骤是创建光源。 <br><br><br>创建一个光源 <br><br>Microsoft Direct3D 里有三种可用的光源：点光源，方向形光源，与聚光灯光源。本示例代码创建一个方向形光源，它向一个方向发光，并且不停的变换发光的方向。 <br><br>下列代码片段使用 D3DLIGHT8 结构创建一个方向性光源。 <br><br><br>D3DXVECTOR3 vecDir; <br><br>D3DLIGHT8 light; <br><br>ZeroMemory( &amp;light, sizeof(D3DLIGHT8) ); <br><br>light.Type = D3DLIGHT_DIRECTIONAL; <br><br><br>下列代码片设置光源的漫射光为白色。 <br><br>light.Diffuse.r = 1.0f; <br><br>light.Diffuse.g = 1.0f; <br><br>light.Diffuse.b = 1.0f; <br><br><br>以下代码片在一个环内旋转光源的方向。 <br><br>vecDir = D3DXVECTOR3(cosf(timeGetTime()/360.0f), <br><br>0.0f, <br><br>sinf(timeGetTime()/360.0f) ); <br><br>D3DXVec3Normalize( (D3DXVECTOR3</em>)&amp;light.Direction, &amp;vecDir ); <br><br>对 D3DXVec3Normalize 函数的调用将归一化方向矢量并初始化光源的方向。 <br><br>可以设置一个范围告诉 Direct3D 此光源能影响多远的距离。这个成员参数对方向性光源无效。以下代码片指定此光源的范围为 1000 单位。 <br><br><br>light.Range = 1000.0f; <br><br><br>下面的代码片将这个光源分配到当前的 Direct3D 设备，通过调用 IDirect3DDevice8::SetLight。 <br><br><br>g_pd3dDevice->SetLight( 0, &amp;light ); <br><br><br>SetLight 接受的第一个参数是此光源被分配的索引号。注意如果在此索引已存在一个光源，它将被新光源覆盖。第二个参数是一个指向新定义光源数据结构的指针。本 Lights 例程设置这个光源位于 0 号索引。 <br><br><br>下列代码片激活这个光源，通过调用 IDirect3DDevice8::LightEnable。 <br><br><br>g_pd3dDevice->LightEnable( 0, TRUE); <br><br><br>LightEnable 接受的第一个参数是激活光源的索引。第二个参数是一个布尔量通知此光源是开 (TRUE) 还是闭 (FALSE)。在上面的例程中，索引 0 上的光源被打开。 <br><br><br>以下代码片通知 Direct3D 呈递此光源，通过调用 IDirect3DDevice8::SetRenderState。 <br><br><br>g_pd3dDevice->SetRenderState( D3DRS_LIGHTING, TRUE ); <br><br><br>SetRenderState 接受的头两个参数是哪一个设备状态变量被改写以及写入何种值。本例程设置 D3DRS_LIGHTING 设备变量为 TRUE，这将使设备能够演示光照效果。 <br><br><br>本例程的最后一步是通过再一次调用 SetRenderState 打开环境照明光。 <br><br><br>g_pd3dDevice->SetRenderState( D3DRS_AMBIENT, 0x00202020 ); <br><br><br>当前代码段设置 D3DRS_AMBIENT 设备变量为一种浅灰色 (0x00202020)。环境照明将使用所给的颜色照亮所有的物体。 <br><br><br>关于照明及材质的更多信息，参见 SDK: Lights and Materials。 <br><br><br>本例程向你说明了如何使用照明与材质。指南五：使用纹理映射 将向你说明如何将纹理添加到物体表面上。 <br><br><br><br>指南五：使用纹理映射 <br><br><br>尽管光照和材质大大增加了场景的真实感，但没有比在表面上添加纹理更能增加真实感的了。纹理能够被想象为一层紧紧包装在表面的贴纸。你能在一个立方体上放置一层木质纹理使它看起来就象用木头制成的一样。本 Texture 例程将在 指南四：创建和使用光照 中构造的圆柱上添加一幅类似香蕉的纹理。此指南介绍的内容包括如何载入纹理，设置纹理，与呈递带有纹理的物体。 <br><br><br>本指南采用以下步骤实现纹理： <br><br><br>·第一步：定义一个定制顶点格式 <br><br>·第二步：初始化屏幕几何 <br><br>·第三步：演示场景 <br><br>注意：Texture 示例程序的路径为： <br><br>(SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut05_Textures. <br><br><br>注意：除了 Texture 示例不创建材质和光照以外，Texture 工程中的示例代码与 Lights 工程的几乎完全一样。本“使用纹理映射”指南仅仅关注于有关于纹理的独特代码，而并不重复有关初始化 Microsoft Direct3D，处理 Microsoft Windows 消息，演示，或清理的内容。关于这些工作的信息，见：指南一：创建设备。 <br><br>本指南使用自定义顶点和顶点缓冲区显示几何物体。关于选择一个自定义顶点格式并执行顶点缓冲的更多信息，见：指南二：演示顶点。 <br><br><br>本指南采用矩阵进行几何变换。关于矩阵和变换的更多信息，参见：指南三：使用矩阵。 <br><br><br>第一步：定义一个定制顶点格式 <br><br><br>在使用纹理以前，必须使用包含纹理坐标的自定义顶点格式。纹理坐标告诉 Microsoft Direct3D 在物件上如何将纹理定位于每个顶点上。纹理坐标范围从 0.0 到 1.0，(0.0, 0.0) 的位置代表纹理贴图的左上角而 (1.0, 1.0) 代表纹理贴图的右下角。 <br><br><br>以下示例代码说明了 Texture 例程是如何通过设置它的自定义顶点格式来包含纹理坐标的。 <br><br>struct CUSTOMVERTEX <br><br>{ <br><br>D3DXVECTOR3 position; // The position. <br><br>D3DCOLOR color; // The color. <br><br>FLOAT tu, tv; // The texture coordinates. <br><br>}; <br><br><br>// The custom FVF, which describes the custom vertex structure. <br><br>#define D3DFVF_CUSTOMVERTEX (D3DFVF_XYZ|D3DFVF_DIFFUSE|D3DFVF_TEX1) <br><br><br>关于纹理坐标的进一步信息，参见 SDK: Texture Coordinates 一章。 <br><br><br>现在自定义顶点格式已经准备好了，下一步将是载入一幅纹理并创建一个圆柱体，见 第二步：初始化屏幕几何。 <br><br><br>第二步：初始化屏幕几何 <br><br><br>在绘制之前，Texture 例程调用 InitGeometry，一个程序自定义的函数用于创建一幅纹理并初始化圆柱体的几何参数。 <br><br><br>纹理是由基于文件的图像构造的。以下示例代码使用 D3DXCreateTextureFromFile 从 Banana.bmp 文件创建一幅纹理并用它覆盖圆柱的表面。 <br><br><br>if( FAILED( D3DXCreateTextureFromFile( g_pd3dDevice, &ldquo;Banana.bmp&rdquo;, <br><br>&amp;g_pTexture ) ) ) <br><br>return E_FAIL; <br><br><br>D3DXCreateTextureFromFile 接受的第一个参数是一个指向 Microsoft Direct3D 设备的指针，这个设备将用于绘制纹理。第二个参数是一个指向 ANSI 字符串的指针，它指定用于创建纹理的文件名。本例程指定从此文件：“Banana.bmp” 来装载图像。第三个参数是一个指向纹理对象指针的地址。 <br><br>当这个类似香蕉的纹理被装载并准备好之后，下一个步骤是创建圆柱体。以下示例代码用一个圆柱体填充顶点缓冲区。注意每一点都具备了纹理坐标 (tu, tv)。 <br><br><br>for( DWORD i=0; i&lt;50; i++ ) <br><br>{ <br><br>FLOAT theta = (2<em>D3DX_PI</em>i)/(50-1); <br><br><br>pVertices[2<em>i+0].position = D3DXVECTOR3( sinf(theta),-1.0, cosf(theta) ); <br><br>pVertices[2</em>i+0].color = 0xffffffff; <br><br>pVertices[2<em>i+0].tu = ((FLOAT)i)/(50-1); <br><br>pVertices[2</em>i+0].tv = 1.0f; <br><br><br>pVertices[2<em>i+1].position = D3DXVECTOR3( sinf(theta), 1.0, cosf(theta) ); <br><br>pVertices[2</em>i+1].color = 0xff808080; <br><br>pVertices[2<em>i+1].tu = ((FLOAT)i)/(50-1); <br><br>pVertices[2</em>i+1].tv = 0.0f; <br><br>} <br><br><br><br>每一个顶点包括位置，颜色，以及纹理坐标。上面的例程给每一点设置了纹理坐标并使此纹理能够平滑的包裹在圆柱体周围。 <br><br><br>现在纹理和顶点缓冲区已经准备好用于演示了，现在能够呈递和着色图形了，参见 第三步：演示场景。 <br><br><br>第三步：演示场景 <br><br><br>在场景几何被初始化之后，应该是绘制场景的时候了。为了绘制一个带有纹理的物体，使用的纹理必须要设置成当前纹理中的一个。下一步将是设置纹存储器的状态。纹理存储器状态使你能够定义一个或者多个纹理被呈递的方式。比如说，你能将多个纹理混合在一起。 <br><br><br>现在 Texture 示例开始设置需要使用的纹理。以下代码段使用 IDirect3DDevice8::SetTexture 设置 Microsoft Direct3D 设备用于绘制的纹理。 <br><br><br>g_pd3dDevice->SetTexture( 0, g_pTexture ); <br><br><br>SetTexture 接受的第一个参数是设置纹理存储器的标示符。一个设备能够支持八个已初始化的纹理，所以这儿的最大值是 7。本 Texture 示例仅仅使用一个纹理并且把它设置在存储器 0。第二个参数是一个指向纹理对象的指针。在这儿，Texture 示例使用由它的程序自定义函数 InitGeometry 创建的纹理。 <br><br><br><br>以下代码片设置纹理存储器状态的值，通过调用 IDirect3DDevice8::SetTextureStageState 方法。 <br><br><br>g_pd3dDevice->SetTextureStageState( 0, D3DTSS_COLOROP, D3DTOP_MODULATE ); <br><br>g_pd3dDevice->SetTextureStageState( 0, D3DTSS_COLORARG1, D3DTA_TEXTURE ); <br><br>g_pd3dDevice->SetTextureStageState( 0, D3DTSS_COLORARG2, D3DTA_DIFFUSE ); <br><br>g_pd3dDevice->SetTextureStageState( 0, D3DTSS_ALPHAOP, D3DTOP_DISABLE ); <br><br><br><br>SetTextureState 的第一个参数是需要改变状态的存储器的索引。本示例代码改变位于存储器 0 的纹理，所以这儿置为 0。下一个参数是要设置的纹理状态。关于所有有效的纹理状态以及它们的意义，见 &ldquo;SDK: D3DTEXTURESTAGESTATETYPE&rdquo;。再下一个参数是设置为此纹理状态的参数。你放置这儿的值应取决于你要改变的纹理存储器状态。 <br><br><br>在设置完每个纹理存储器状态的合适值之后，这个圆柱体可以被呈递了，现在纹理将被添加在它的表面上。 <br><br><br>使用纹理坐标的其他方法是使它们自动的生成。这是用一种纹理坐标索引 (TCI) 实现的。TCI 使用一个纹理矩阵来变换 (x,y,z) TCI 坐标为 (tu, tv) 纹理坐标。在 Texture 例程中，位于摄像机空间中的顶点位置被用来产生纹理坐标。 <br><br><br>第一步是创建用于转换的矩阵，示范在以下代码片段中： <br><br><br>D3DXMATRIX mat; <br><br>mat._11 = 0.25f; mat._12 = 0.00f; mat._13 = 0.00f; mat._14 = 0.00f; <br><br>mat._21 = 0.00f; mat._22 =-0.25f; mat._23 = 0.00f; mat._24 = 0.00f; <br><br>mat._31 = 0.00f; mat._32 = 0.00f; mat._33 = 1.00f; mat._34 = 0.00f; <br><br>mat._41 = 0.50f; mat._42 = 0.50f; mat._43 = 0.00f; mat._44 = 1.00f; <br><br><br><br>在矩阵创建好之后，它必须通过调用 IDirect3DDevice8::SetTransform 来设置它，如以下代码段所示： <br><br><br>g_pd3dDevice->SetTransform( D3DTS_TEXTURE0, &amp;mat ); <br><br><br>D3DTS_TEXTURE0 标志告诉 Direct3D 应用此变换到位于纹理存储器 0 的纹理。本示例的下一步是设置其他的存储器状态值，以得到所需的效果。这些处理在以下代码段中。 <br><br><br>g_pd3dDevice->SetTextureStageState( 0, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_COUNT2 ); <br><br>g_pd3dDevice->SetTextureStageState( 0, D3DTSS_TEXCOORDINDEX, D3DTSS_TCI_CAMERASPACEPOSITION ); <br><br><br>纹理坐标被设置后，现在此场景已准备好被呈递了。注意到现在的坐标是自动设置到圆柱上的。这样精确的设置使几何物体被演示时纹理好象是覆盖在绘制的屏幕上。 <br><br><br>关于纹理的更多信息，见 SDK: Texture 一章。 <br><br><br>本指南已经向你说明了如何给表面添加纹理。指南六：使用Mesh模型 将告诉你如何应用Mesh模型呈递复杂的几何形体。 <br><br><br><br>指南六：使用Mesh模型 <br><br><br>复杂的几何形状常常使用 3-D 建模软件构造模型并保存为文件。一个例子就是 .x 文件格式。Microsoft Direct3D 使用Mesh对象从文件装载这些物体。Mesh对象稍微有点复杂，但是 Microsoft Direct3DX 包含的函数使应用Mesh对象变的简单。Meshed 例程介绍关于Mesh的话题并展示如何装载，演示，以及卸载一个Mesh对象。 <br><br><br>本指南使用以下步骤说明如何装载，演示，以及卸载一个Mesh对象： <br><br><br>·第一步：装载一个Mesh对象 <br><br>·第二步：演示一个Mesh对象 <br><br>·第三步：卸载一个Mesh对象 <br><br>注意：Methes 示例程序的路径为： <br><br>(SDK root)\Samples\Multimedia\Direct3D\Tutorials\Tut06_Meshes. <br><br><br>注意：除了 Meshes 工程中的示例代码不创建材值与光照以外，此工程的示例代码与 Lights 工程几乎完全一样。“使用Mesh模型”指南仅仅关注于有关于Mesh对象的独特代码，而并不重复有关设置 Microsoft Direct3D，处理 Microsoft Windows 消息，演示，或清理的工作。关于这些工作的信息，见：指南一：创建设备。 <br><br><br>本指南使用自定义顶点和顶点缓冲区显示几何物体。关于选择一个自定义顶点格式并执行顶点缓冲的更多信息，见：指南二：演示顶点。 <br><br><br>本指南采用矩阵进行几何变换。关于矩阵和变换的更多信息，参见：指南三：使用矩阵。 <br><br><br>本指南使用纹理覆盖Mesh模型的表面。关于装载和使用纹理的更多信息，参见：指南五：使用纹理映射。 <br><br><br>第一步：装载一个Mesh对象 <br><br><br>在使用之前，Microsoft Direct3D 应用程序必须先装载一个Mesh对象。Meshes 例程通过调用 InitGeometry，一个该程序自定义的函数，装载一只虎的Mesh模型，当然这是在已经装载了必需的 Direct3D 对象以后。 <br><br><br>一个Mesh对象需要用一个材质缓冲保存所有将要用到的材质与纹理。所以该函数最初定义了一个材质缓冲，如以下代码段所示： <br><br><br>LPD3DXBUFFER pD3DXMtrlBuffer; <br><br><br>以下代码段使用 D3DXLoadMethFromX 函数装载Mesh对象。 <br><br><br>// Load the mesh from the specified file. <br><br>if( FAILED( D3DXLoadMeshFromX( &ldquo;tiger.x&rdquo;, D3DXMESH_SYSTEMMEM, <br><br>g_pd3dDevice, NULL, <br><br>&amp;pD3DXMtrlBuffer, &amp;g_dwNumMaterials, <br><br>&amp;g_pMesh ) ) ) <br><br>return E_FAIL; <br><br><br>D3DXLoadMeshFromX 接受的第一个参数是一个指向字符串的指针告诉 Microsoft Direct3D 要装载的文件。本例程从 Tiger.x 读取一只虎的Mesh模型。 <br><br><br>第二个参数通知 Direct3D 如何创建Mesh对象。本示例采用 D3DXMESH_SYSTEMMEM 标记，它等于同时指定 D3DXMESH_VB_SYSTEMMEM 与 D3DXMESH_IB_SYSTEMMEM，这两个参数告诉 Direct3D 把Mesh对象的索引缓冲区和顶点缓冲区都放到系统内存中。 <br><br><br>第三个参数是指向将被用于绘制Mesh对象的 Direct3D 设备的指针。 <br><br><br>第四个参数是一个指向 ID3DXBuffer 对象的指针。这个对象装入关于各个面相邻与否的信息。在本例程中此信息是不需要的，所以这个参数被设为 NULL。 <br><br><br>第五个参数同样取得一个指向 ID3DXBuffer 的指针。在函数执行完以后，此对象将被填入该Mesh对象使用的 D3DXMATERIAL 结构。 <br><br><br>第六个参数是一个指针，指向函数执行结束后，返回的置入 ppMaterials 队列中的 D3DXMATERIAL 结构数目。 <br><br><br>第七个参数是一个Mesh对象指针的地址，返回装载的Mesh对象。 <br><br><br>在装载了这个Mesh对象和相关材质信息之后，你需要从材质缓冲区中分解出材质属性及纹理名称。 <br><br><br>本 Mesh 例程先需要得到材质缓冲区指针才能处理这些事情。以下代码段使用 ID3DXBuffer::GetBufferPointer 函数得到这个指针。 <br><br><br>D3DXMATERIAL* d3dxMaterials = <br><br>(D3DXMATERIAL*)pD3DXMtrlBuffer->GetBufferPointer(); <br><br><br>以下代码段创建了一个新的Mesh和纹理对象基于Mesh对象中材质的最大数目。 <br><br><br>g_pMeshMaterials = new D3DMATERIAL8[g_dwNumMaterials]; <br><br>g_pMeshTextures = new LPDIRECT3DTEXTURE8[g_dwNumMaterials]; <br><br><br>对于每个Mesh对象里的材质都必须进行以下步骤。 <br><br><br>第一步是拷贝材质，如以下代码段所示. <br><br>g_pMeshMaterials[i] = d3dxMaterials[i].MatD3D; <br><br><br>第二步是设置材值的环境色，见以下代码段。 <br><br><br>g_pMeshMaterials[i].Ambient = g_pMeshMaterials[i].Diffuse; <br><br><br>最后一步是为该材质创建纹理，如以下代码段。 <br><br><br>// Create the texture. <br><br>if( FAILED( D3DXCreateTextureFromFile( g_pd3dDevice, <br><br>d3dxMaterials[i].pTextureFilename, <br><br>&amp;g_pMeshTextures[i] ) ) ) <br><br>g_pMeshTextures[i] = NULL; <br><br>} <br><br><br>装载了每个材质以后，你使用完毕了这个材质缓冲区，必须调用 IUnknown::Release 来释放它。 <br><br><br>pD3DXMtrlBuffer->Release(); <br><br><br>现在，Mesh对象，连同其相应的材质与纹理都已经装载好了。这个Mesh物体已准备好呈递到屏幕上，参看 第二步：演示一个Mesh对象。 <br><br><br>第二步：演示一个Mesh对象 <br><br><br>在第一步中，Mesh对象已经准备号被呈递了。该对象被Mesh对象装载的每个材质分成若干个子集。为了绘制每个子集，应该在一个循环中绘制此Mesh对象。循环的第一步是为每个子集设置材质，如以下代码段所示： <br><br><br>g_pd3dDevice->SetMaterial( &amp;g_pMeshMaterials[i] ); <br><br><br>循环的第二步是给每个子集设置纹理，如以下代码段所示。 <br><br><br>g_pd3dDevice->SetTexture( 0, g_pMeshTextures[i] ); <br><br><br>在给每个子集设置完材质与纹理之后，子集被 ID3DXBaseMesh::DrawSubset 函数所绘制，如以下代码段所示。 <br><br><br>g_pMesh->DrawSubset( i ); <br><br><br>DrawSubset 函数带有一个 DWORD 参数用于指定Mesh对象的哪个子集被绘制。本例程使这个参数的值每循环一次就被加一。 <br><br><br>在使用完Mesh对象之后，重要的事是要将此Mesh对象完全移出内存，参见 第三步：卸载一个Mesh对象。 <br><br><br>第三步：卸载一个Mesh对象 <br><br><br>在任何 Microsoft Direct3D 程序结束前，它有必要解构它使用的所有 DirectX 对象并且使指向它们的指针无效。本例程使用的Mesh对象同样需要被解构。当它接收到一个 WM_DESTROY 消息时，Meshes 例程调用 Cleanup，一个该程序自定义的函数，来处理此事。 <br><br><br>以下代码段删除材质队列。 <br><br><br>if( g_pMeshMaterials ) <br><br>delete[] g_pMeshMaterials; <br><br><br>以下代码解构每个装载过的单独纹理并删除纹理队列。 <br><br><br>if( g_pMeshTextures ) <br><br>{ <br><br>for( DWORD i = 0; i &lt; g_dwNumMaterials; i++ ) <br><br>{ <br><br>if( g_pMeshTextures[i] ) <br><br>g_pMeshTextures[i]->Release(); <br><br>} <br><br>delete[] g_pMeshTextures; <br><br><br>以下代码段解构Mesh对象。 <br><br><br>Delete the mesh object <br><br>if( g_pMesh ) <br><br>g_pMesh->Release(); <br><br><br>本指南已经向你说明了如何装载和绘制Mesh对象。这是此区域最后一个指南。如果需要了解一个典型的 Direc3D 应用程序是如何写成的，见：&ldquo;SDK: DirectX Graphics C/C++ Samples&rdquo; 。</font></p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/directx-graphics-interface-guide/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/chinese-medicine-theory-criticism/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="中医理论质疑文章集锦"><meta itemprop=description content="

    【ZT】再论所谓“国医”
    
      摘要: 8月5日我在《大公报·星期论文》一栏中发表了一篇文章，叫做“所谓国医”，引起了一群“所谓国医”的攻击，并有几个南京的记者，在那里胡言乱道一阵，肆 力作个人攻击。和国医谈科学，和如此一流的记者谈伦理，皆所谓对驴弹琴，白费精神，我所不取。然《大公报》上的两篇宣扬国医的文字由我引起，理宜再申说我 的意思一下。且前一文中，我犹未尽之意，亦应再补充说几句。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/chinese-medicine-theory-criticism/ itemprop=url class=post-title-link>中医理论质疑文章集锦</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年06月20日 21:34:00 CST" itemprop="dateCreated datePublished" datetime="2007-06-20 21:34:00 +0800 +0800">2007年06月20日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/tcm/ itemprop=url rel=index><span itemprop=name>TCM</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/chinese-medicine-theory-criticism/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><a href=http://www.cppblog.com/lovedday/archive/2007/06/19/26599.html title=【ZT】再论所谓“国医” rel="noopener external nofollow noreferrer" target=_blank class=exturl>【ZT】再论所谓“国医”
</a>     摘要: 8月5日我在《大公报·星期论文》一栏中发表了一篇文章，叫做“所谓国医”，引起了一群“所谓国医”的攻击，并有几个南京的记者，在那里胡言乱道一阵，肆 力作个人攻击。和国医谈科学，和如此一流的记者谈伦理，皆所谓对驴弹琴，白费精神，我所不取。然《大公报》上的两篇宣扬国医的文字由我引起，理宜再申说我 的意思一下。且前一文中，我犹未尽之意，亦应再补充说几句。</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/chinese-medicine-theory-criticism/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/programmers-blind-spot-dont-forget-your-goals/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="程序员的灯下黑：不要忘记你的目标"><meta itemprop=description content="有一位程序员，喜欢新东西，经常引入新方法新思路试图改变现状。
有一次，他觉得部门在测试手段太依赖手工测试了，于是就想引入自动测试。他调研试用了几种工具以后，选择了某大公司的产品作为主要工具。
他计算了一下，一共有1000条测试用例需要自动化，于是他定下计划：一个人一天可以写5个测试用例，所以需要200个人天；计划要在一个季度完成，按一个人一季度共60个人天的话，需要4个人还有余。这样，全部用例做好以后，他估计，至少减少一半测试工作量。
于是，这老兄报告给总经理，总经理同意了。于是就给他招了4个人，成立了自动测试组，风风火火就干起来了。
他的做法是，手工测试有多少条用例，他就用自动测试工具实现多少条。
一个季度下来了，全部测试用例完成了。当然大家敲锣打鼓的庆祝。但接下来，却遇到了意想不到的问题。
第一、所有的测试人员都认为自动测试组写出来的脚本没有用。为什么呢？因为自动测试组的员工都是新招的，对产品不熟；因此他们只好对照着手工测试用例一条条的做，就像做翻译一样把手工测试用例变成自动脚本。但测试人员说，手工测试用例本身就不够完善，很多测试的验证点是凭经验的，这样翻译出来的用例当然不过关。
第二、新产品特性已经改变了，写出得脚本过期了。因为是比照着手工用例，自动测试组使用的用例是产品的上一个版本的，这样写出来的用例当然不适合现状。
第三、短期内投入产出比很低。手工测试一天能走100个测试用例，1000个用例10天走完。但4个自动测试工程师3个月才完成1000个用例的开发，也就是花了4×3×20=240个人天，就算测试用例100%可用，也需要240÷10=24轮才能在成本上持平，如果每个版本测3轮的话，相当于8个版本。而8个版本，产品还在不在都难说了。
&nbsp;
程序员做了反省，发现自己犯的最大错误是：自己提出问题的初衷是减少测试工作量，但执行的时候却把“翻译”完所有的测试作为了目的，而忘记了最初的目标。因为只顾着往前赶数量，从来没有请手工测试的工程师来看看，是不是可以100%替代手工测试；也没有在小模块上试试，看看开发人员有什么意见。
&nbsp;
这样，程序员改变了做法。和开发、手工测试和手下沟通后，他决定把自动测试工程师分散到模块去，和相应模块的开发，测试成为一个工作小组。开发人员设计编码的时候，他们就设计自动测试用例，充分听取手工测试工程师的经验，并且每天都运行一遍。这样，自动测试的脚本就完全和产品同步。他们把自动测试用例和产品代码签入到同一个代码库，同样的版本具有同样的标签，这样，每个版本的产品都有了自动测试的脚本。
&nbsp;
这样，又过了一个季度，团队开始接受自动测试了。而且有了一个意外的收获，开发人员现在乐于用自动脚本做单元测试，居然开发效率和质量都提高了。
&nbsp;
程序员得出一个经验，目标在最初的设定，一般都会比较清楚的，但在漫长的实现过程中很容易忘了原来的目标是什么，而把一些表面的指标当成重要的东西。因此，经常看看今天所做的努力和原先的目标是否一致，和能否一致，是很重要的。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/programmers-blind-spot-dont-forget-your-goals/ itemprop=url class=post-title-link>程序员的灯下黑：不要忘记你的目标</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年06月16日 18:21:00 CST" itemprop="dateCreated datePublished" datetime="2007-06-16 18:21:00 +0800 +0800">2007年06月16日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/capricethink/ itemprop=url rel=index><span itemprop=name>CapriceThink</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/programmers-blind-spot-dont-forget-your-goals/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><div style=text-indent:18pt><font size=4>有一位程序员，喜欢新东西，经常引入新方法新思路试图改变现状。</font></div><div style=text-indent:18pt><font size=4>有一次，他觉得部门在测试手段太依赖手工测试了，于是就想引入自动测试。他调研试用了几种工具以后，选择了某大公司的产品作为主要工具。</font></div><div style=text-indent:18pt><font size=4>他计算了一下，一共有1000条测试用例需要自动化，于是他定下计划：一个人一天可以写5个测试用例，所以需要200个人天；计划要在一个季度完成，按一个人一季度共60个人天的话，需要4个人还有余。这样，全部用例做好以后，他估计，至少减少一半测试工作量。</font></div><div style=text-indent:18pt><font size=4>于是，这老兄报告给总经理，总经理同意了。于是就给他招了4个人，成立了自动测试组，风风火火就干起来了。</font></div><div style=text-indent:18pt><font size=4>他的做法是，手工测试有多少条用例，他就用自动测试工具实现多少条。</font></div><div style=text-indent:18pt><font size=4>一个季度下来了，全部测试用例完成了。当然大家敲锣打鼓的庆祝。但接下来，却遇到了意想不到的问题。</font></div><div style=text-indent:18pt><font size=4>第一、所有的测试人员都认为自动测试组写出来的脚本没有用。为什么呢？因为自动测试组的员工都是新招的，对产品不熟；因此他们只好对照着手工测试用例一条条的做，就像做翻译一样把手工测试用例变成自动脚本。但测试人员说，手工测试用例本身就不够完善，很多测试的验证点是凭经验的，这样翻译出来的用例当然不过关。</font></div><div style=text-indent:18pt><font size=4>第二、新产品特性已经改变了，写出得脚本过期了。因为是比照着手工用例，自动测试组使用的用例是产品的上一个版本的，这样写出来的用例当然不适合现状。</font></div><div style=text-indent:18pt><font size=4>第三、短期内投入产出比很低。手工测试一天能走100个测试用例，1000个用例10天走完。但4个自动测试工程师3个月才完成1000个用例的开发，也就是花了4×3×20=240个人天，就算测试用例100%可用，也需要240÷10=24轮才能在成本上持平，如果每个版本测3轮的话，相当于8个版本。而8个版本，产品还在不在都难说了。</font></div><div style=text-indent:18pt><font size=4></font>&nbsp;</div><div style=text-indent:18pt><font size=4>程序员做了反省，发现自己犯的最大错误是：自己提出问题的初衷是减少测试工作量，但执行的时候却把“翻译”完所有的测试作为了目的，而忘记了最初的目标。因为只顾着往前赶数量，从来没有请手工测试的工程师来看看，是不是可以100%替代手工测试；也没有在小模块上试试，看看开发人员有什么意见。</font></div><div style=text-indent:18pt><font size=4></font>&nbsp;</div><div style=text-indent:18pt><font size=4>这样，程序员改变了做法。和开发、手工测试和手下沟通后，他决定把自动测试工程师分散到模块去，和相应模块的开发，测试成为一个工作小组。开发人员设计编码的时候，他们就设计自动测试用例，充分听取手工测试工程师的经验，并且每天都运行一遍。这样，自动测试的脚本就完全和产品同步。他们把自动测试用例和产品代码签入到同一个代码库，同样的版本具有同样的标签，这样，每个版本的产品都有了自动测试的脚本。</font></div><div style=text-indent:18pt><font size=4></font>&nbsp;</div><div style=text-indent:18pt><font size=4>这样，又过了一个季度，团队开始接受自动测试了。而且有了一个意外的收获，开发人员现在乐于用自动脚本做单元测试，居然开发效率和质量都提高了。</font></div><div style=text-indent:18pt><font size=4></font>&nbsp;</div><div style=text-indent:18pt><font size=4>程序员得出一个经验，目标在最初的设定，一般都会比较清楚的，但在漫长的实现过程中很容易忘了原来的目标是什么，而把一些表面的指标当成重要的东西。因此，经常看看今天所做的努力和原先的目标是否一致，和能否一致，是很重要的。</font></div></div><footer class=post-footer><div class=post-button><a class=btn href=/post/programmers-blind-spot-dont-forget-your-goals/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/programmers-blind-spot-not-learning-to-be-happy/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="程序员的灯下黑：没学会快乐"><meta itemprop=description content="某公司启动了一个大项目。
这个项目对公司很重要，于是，研发部门开动马力，辛辛苦苦干了3个月，顺利结项了。
项目经理很高兴，就向老总申请庆祝会。老总说：“项目虽然结了，不过客户还没给钱。大的庆祝会安排在客户给钱以后；现在我先给你1000块钱，你可以安排一个小的庆祝会，给大家开开香槟。”
项目经理同意了，找了几个活跃分子，买香槟，水果，点心，彩球，统计报告，还安排了谜语小游戏……一个小会场搞得生气盎然。到了时间，公司放起来轻音乐，程序员们款款步入会场……一切似乎都那么完美。项目经理高兴极了。
不料，接下去，项目经理傻眼了。
象这样的开场，当然先领导讲话。老总讲完话后，走了。
于是，项目经理说：“我们给大家安排了香槟水果点心和游戏，还有一些项目中的资料，大家可以边吃边看边玩……”，谁料到，随着项目经理话声落下，几十个工程师一拥而上，抢水果，拿点心，在项目经理：“唉！唉！慢点”的声音中不一会就盘空食尽。通通把吃的拿回自己的座位上享受去了。
香槟，没来得及开。
字谜，没人猜。
资料，当然，更没人看了。
只剩下几个小组组长和活跃分子陪着项目经理，站在空荡荡的会场上。
回到家，项目经理打开香槟，喝醉了。
&nbsp;
不知道中国的程序员群体，是不是中国最不快乐的群体。但是，很多程序员似乎都找不到人生乐趣。特别是被互联网泡沫熏过鼻子的一代。
他们对于团队活动的，通常是：吃饭？没意思，发钱给我吧！如果不是技术培训，通常都不参加；如果是技术培训，不管有用没用都参加。永远在诉苦。你去看招聘网站的IT企业评论版，你会发现，如果是个烂公司，臭鸡蛋臭番茄一起上；如果是个好公司，就说：很累的，性价比不高！
程序员啊，钱，比一般人多点；快乐，比常人少很多。
有人大概会拿IT企业多苦多累说事。我不相信这个茬。任何行业，想干好，不脱层皮不可能干好！去开饭店，你得5点钟出去买菜；做建筑师，半夜上工地的事有的是；什么机械化工，各有各的苦和难。有一天我加班到十一点打的回家，的哥对我羡慕得不得了：“白领啊，赚钱多；我每天开12个小时车，还没赚你一半”。
程序员不快乐还表现在喜欢发牢骚上。有时我在想这么一个有趣的事情。通常谁最占据媒体的发布权，谁就是最会发牢骚的人，通常也是最不快活的人。试看中国古代，主要的信息传播方式是著书立传，所以文人墨客是最会发牢骚的人；近代社会，报纸杂志是主流媒体，所以各种知识分子成了最会发牢骚上；当今世界，互联网为王，程序员挟近水楼台之便利，成为最会发牢骚的群体。可是，古代文人发牢骚，通常是悲叹个人命运之不济；知识分子是追求社会进步，思想自由；程序员呢？通常是怪老板给钱太少。大概是这三种人中铜臭味最足的了。
实际上，人生最重要的事情是要快乐。这大概是软件这行还太年轻的缘故吧，过高得期望值和相对较多的成功案例，刺激得人们心态失衡。希望随着时间的推移，30以上的程序员成为普遍现象的时候，人们会拿起香槟酒，在这种小的庆祝会上互相碰一下杯，很轻松的聊聊经验感受，猜猜字谜，Enjoy the life。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/programmers-blind-spot-not-learning-to-be-happy/ itemprop=url class=post-title-link>程序员的灯下黑：没学会快乐</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年06月16日 18:20:00 CST" itemprop="dateCreated datePublished" datetime="2007-06-16 18:20:00 +0800 +0800">2007年06月16日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/capricethink/ itemprop=url rel=index><span itemprop=name>CapriceThink</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/programmers-blind-spot-not-learning-to-be-happy/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><div style=text-indent:18pt><font size=4>某公司启动了一个大项目。</font></div><div style=text-indent:18pt><font size=4>这个项目对公司很重要，于是，研发部门开动马力，辛辛苦苦干了3个月，顺利结项了。</font></div><div style=text-indent:18pt><font size=4>项目经理很高兴，就向老总申请庆祝会。老总说：“项目虽然结了，不过客户还没给钱。大的庆祝会安排在客户给钱以后；现在我先给你1000块钱，你可以安排一个小的庆祝会，给大家开开香槟。”</font></div><div style=text-indent:18pt><font size=4>项目经理同意了，找了几个活跃分子，买香槟，水果，点心，彩球，统计报告，还安排了谜语小游戏……一个小会场搞得生气盎然。到了时间，公司放起来轻音乐，程序员们款款步入会场……一切似乎都那么完美。项目经理高兴极了。</font></div><div style=text-indent:18pt><font size=4>不料，接下去，项目经理傻眼了。</font></div><div style=text-indent:18pt><font size=4>象这样的开场，当然先领导讲话。老总讲完话后，走了。</font></div><div style=text-indent:18pt><font size=4>于是，项目经理说：“我们给大家安排了香槟水果点心和游戏，还有一些项目中的资料，大家可以边吃边看边玩……”，谁料到，随着项目经理话声落下，几十个工程师一拥而上，抢水果，拿点心，在项目经理：“唉！唉！慢点”的声音中不一会就盘空食尽。通通把吃的拿回自己的座位上享受去了。</font></div><div style=text-indent:18pt><font size=4>香槟，没来得及开。</font></div><div style=text-indent:18pt><font size=4>字谜，没人猜。</font></div><div style=text-indent:18pt><font size=4>资料，当然，更没人看了。</font></div><div style=text-indent:18pt><font size=4>只剩下几个小组组长和活跃分子陪着项目经理，站在空荡荡的会场上。</font></div><div style=text-indent:18pt><font size=4>回到家，项目经理打开香槟，喝醉了。</font></div><div style=text-indent:18pt><font size=4></font>&nbsp;</div><div style=text-indent:18pt><font size=4>不知道中国的程序员群体，是不是中国最不快乐的群体。但是，很多程序员似乎都找不到人生乐趣。特别是被互联网泡沫熏过鼻子的一代。</font></div><div style=text-indent:18pt><font size=4>他们对于团队活动的，通常是：吃饭？没意思，发钱给我吧！如果不是技术培训，通常都不参加；如果是技术培训，不管有用没用都参加。永远在诉苦。你去看招聘网站的IT企业评论版，你会发现，如果是个烂公司，臭鸡蛋臭番茄一起上；如果是个好公司，就说：很累的，性价比不高！</font></div><div style=text-indent:18pt><font size=4>程序员啊，钱，比一般人多点；快乐，比常人少很多。</font></div><div style=text-indent:18pt><font size=4>有人大概会拿IT企业多苦多累说事。我不相信这个茬。任何行业，想干好，不脱层皮不可能干好！去开饭店，你得5点钟出去买菜；做建筑师，半夜上工地的事有的是；什么机械化工，各有各的苦和难。有一天我加班到十一点打的回家，的哥对我羡慕得不得了：“白领啊，赚钱多；我每天开12个小时车，还没赚你一半”。</font></div><div style=text-indent:18pt><font size=4>程序员不快乐还表现在喜欢发牢骚上。有时我在想这么一个有趣的事情。通常谁最占据媒体的发布权，谁就是最会发牢骚的人，通常也是最不快活的人。试看中国古代，主要的信息传播方式是著书立传，所以文人墨客是最会发牢骚的人；近代社会，报纸杂志是主流媒体，所以各种知识分子成了最会发牢骚上；当今世界，互联网为王，程序员挟近水楼台之便利，成为最会发牢骚的群体。可是，古代文人发牢骚，通常是悲叹个人命运之不济；知识分子是追求社会进步，思想自由；程序员呢？通常是怪老板给钱太少。大概是这三种人中铜臭味最足的了。</font></div><div style=text-indent:18pt><font size=4>实际上，人生最重要的事情是要快乐。这大概是软件这行还太年轻的缘故吧，过高得期望值和相对较多的成功案例，刺激得人们心态失衡。希望随着时间的推移，30以上的程序员成为普遍现象的时候，人们会拿起香槟酒，在这种小的庆祝会上互相碰一下杯，很轻松的聊聊经验感受，猜猜字谜，Enjoy the life。</font></div></div><footer class=post-footer><div class=post-button><a class=btn href=/post/programmers-blind-spot-not-learning-to-be-happy/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><nav class=pagination><a class="extend prev" rel=prev href=/post/page/56/><i class="fa fa-angle-left"></i>
</a><a class=page-number href=/post/page/53/>53</a>
<a class=page-number href=/post/page/54/>54</a>
<a class=page-number href=/post/page/55/>55</a>
<a class=page-number href=/post/page/56/>56</a>
<span class="page-number current">57</span>
<a class=page-number href=/post/page/58/>58</a>
<a class=page-number href=/post/page/59/>59</a>
<a class=page-number href=/post/page/60/>60</a>
<a class=page-number href=/post/page/61/>61</a>
<a class="extend next" rel=next href=/post/page/58/><i class="fa fa-angle-right"></i></a></nav></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2026
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.157.0 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":false,"path":"post","permalink":"https://blogs.qipai360.cn/post/","title":"Posts","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1772265585" defer></script></body></html>