<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.157.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Posts"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="website"><meta property="og:title" content="Posts"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1772265587"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>post - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>679</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>679</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>35</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>118</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2423147></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5207></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2026-02-28 15:59:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/past-present-future-mindfulness/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="所以者何，须菩提。过去心不可得，现在心不可得，未来心不可得。"><meta itemprop=description content="【肇法师曰】闻说诸心。谓有实心。故须破遣。明三世皆空。故论云。过去已灭。未来未起。现在虚妄。三世推求。了不可得。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【疏钞云】未觉不知。随时流转。故有三世。若悟真一之心。即无过去现在未来。若有过去心可灭。即是自灭。若有未来心可生。即是自生。既有生有灭。即非常住真心。即为依他心。虚妄心。若一念有生灭心。即成六十二种邪见。九百种烦恼。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【王日休曰】常住真心。即真性也。是以自无量无数劫来。常一定而不变动。岂有过去未来现在哉。若有过去未来现在。则为妄想。此三心是也。且若饱而未欲食。则饮食之心为未来。饥而正欲食。则欲食之心为现在。食毕而放匕箸。则欲食之心为过去。是此心因事而起。事过而灭。故为妄想也。不可得者。谓无也。言此三心本来无有。乃因事而有耳。圆觉经所以言六尘缘影。为自心相者。谓众生以六种尘缘之影。为自己之心相也。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【僧若讷曰】本生心地观经云。如佛所说。唯将心法。为三界主。心法本源。不染尘秽。云何心法。染贪嗔痴。于三世法。唯说为心。过去心已灭。未来心未至。现在心不住。诸法之内性不可得。诸法之外相不可得。诸法中间都不可得。心法本来无有形相。心法本来无有住处。一切如来尚不可见心。何况余人。得见心法。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【颜丙曰】谓思念前事者。为过去心。思念今事者。为现在心。思念后事者。为未来心。三念总放下者。谓之不可得。经云。前念后念及今念。念念不被邪见染。此为三心不可得。古云。一念不生全体现。亦谓三际俱断。三念俱妄。了不可得。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【傅大士颂曰】依他一念起。俱为妄所行。便分六十二。九百乱纵横。（法华经二卷。世尊偈言。薄德少福人。众苦所逼迫。入邪见稠林。若有若无等。依止此诸见。具足六十二。毗婆沙论云。六十二见者。五蕴中各起四见。四五二十。三世各二十。通为六十。断常二见为根本。总为六十二见。且于色蕴中。即色是我。离色非我。我中有色。色中有我。五蕴中具有此四。疏钞解三心云。若一念有生灭心。即成六十二种邪见。九百种烦恼。）过此灭无灭。（一作不灭。）当来生不生。常能作此观。（去声）真妄坦然平。（晁文元公遇高士刘惟一。访以生灭之事。刘曰。人常不死。公骇之。刘曰。形死性不灭。是知此性历长存。）
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【川禅师曰】低声低声。真得鼻孔里出气。颂曰。三际求心心不见。两眼依然对两眼。不须遗剑刻舟寻。雪月风花常见面。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【未曾有经云】妙吉祥菩萨。因见一人。言我造杀业。决堕地狱。如何救度。菩萨即化一人。亦曰。我造杀业。决堕地狱。前人闻已。言我亦然。化人告之。唯佛能救。相随共诣。化人白佛。我造杀业。怖堕地狱。愿佛救度。佛即告言。如汝所说造杀业者。汝从何心而起业相。为过去耶。未来耶。现在耶。若起过去心者。过去已灭。心不可得。若起未来心者。未来未来。心不可得。若起见在心者。见在不住。心不可得。三界俱不可得故。即无起作。无起作故。于其罪相何所见耶。善男子。心无所住。不在内外中间。心无色相。非青黄赤白。心无造作。无作者故。心非幻化。本真实故。心无边际。非限量故。心无取舍。非善恶故。心无转动。非生灭故。心等空虚。无障碍故。心非染净。离一切数故。善男子作是观者。即于一切法中。求心不可得。何以故。心之自性。即诸法性。诸法性空。即真实性。由是义故。汝今不应妄生怖畏。是时化人闻佛说法。即白佛言。我今得悟罪业性空。不生怖畏。尔时实造业者。亦白佛言。我今得悟罪业性空。而不复生怖畏之心。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【李文会曰】谓三世心无性可得。故可从缘而生。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【肇法师云】闻说诸心。谓有实心。故须破遣。明三世皆空。故云过去已灭。未来未起。现在虚妄。三世推求。了不可得。故云若悟无法无相无事平常真心。即法体空寂。不生不灭。湛然清净。岂有前念今念后念可得也。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【马祖云】道不用修。但莫洿染。何谓洿染。但有生死造作趣向。皆是洿染。若欲直会其道。平常心即是道。何谓平常心。无造作。无是非。无取舍。无憎爱。无圣凡。是故经云。非凡夫行。非圣贤行。是菩萨行。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【赵州问南泉云】如何是道。泉云。平常心是道。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【圜悟禅师颂曰】欲识平常道。天真任自然。行船宜举棹。走马即加鞭。若遇饥来饭。还应困即眠。尽从缘所得。所得亦非缘。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/past-present-future-mindfulness/ itemprop=url class=post-title-link>所以者何，须菩提。过去心不可得，现在心不可得，未来心不可得。</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月20日 13:48:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-20 13:48:00 +0800 +0800">2007年09月20日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/capricethink/ itemprop=url rel=index><span itemprop=name>CapriceThink</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/past-present-future-mindfulness/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>【肇法师曰】闻说诸心。谓有实心。故须破遣。明三世皆空。故论云。过去已灭。未来未起。现在虚妄。三世推求。了不可得。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【疏钞云】未觉不知。随时流转。故有三世。若悟真一之心。即无过去现在未来。若有过去心可灭。即是自灭。若有未来心可生。即是自生。既有生有灭。即非常住真心。即为依他心。虚妄心。若一念有生灭心。即成六十二种邪见。九百种烦恼。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【王日休曰】常住真心。即真性也。是以自无量无数劫来。常一定而不变动。岂有过去未来现在哉。若有过去未来现在。则为妄想。此三心是也。且若饱而未欲食。则饮食之心为未来。饥而正欲食。则欲食之心为现在。食毕而放匕箸。则欲食之心为过去。是此心因事而起。事过而灭。故为妄想也。不可得者。谓无也。言此三心本来无有。乃因事而有耳。圆觉经所以言六尘缘影。为自心相者。谓众生以六种尘缘之影。为自己之心相也。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【僧若讷曰】本生心地观经云。如佛所说。唯将心法。为三界主。心法本源。不染尘秽。云何心法。染贪嗔痴。于三世法。唯说为心。过去心已灭。未来心未至。现在心不住。诸法之内性不可得。诸法之外相不可得。诸法中间都不可得。心法本来无有形相。心法本来无有住处。一切如来尚不可见心。何况余人。得见心法。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【颜丙曰】谓思念前事者。为过去心。思念今事者。为现在心。思念后事者。为未来心。三念总放下者。谓之不可得。经云。前念后念及今念。念念不被邪见染。此为三心不可得。古云。一念不生全体现。亦谓三际俱断。三念俱妄。了不可得。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【傅大士颂曰】依他一念起。俱为妄所行。便分六十二。九百乱纵横。（法华经二卷。世尊偈言。薄德少福人。众苦所逼迫。入邪见稠林。若有若无等。依止此诸见。具足六十二。毗婆沙论云。六十二见者。五蕴中各起四见。四五二十。三世各二十。通为六十。断常二见为根本。总为六十二见。且于色蕴中。即色是我。离色非我。我中有色。色中有我。五蕴中具有此四。疏钞解三心云。若一念有生灭心。即成六十二种邪见。九百种烦恼。）过此灭无灭。（一作不灭。）当来生不生。常能作此观。（去声）真妄坦然平。（晁文元公遇高士刘惟一。访以生灭之事。刘曰。人常不死。公骇之。刘曰。形死性不灭。是知此性历长存。）</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【川禅师曰】低声低声。真得鼻孔里出气。颂曰。三际求心心不见。两眼依然对两眼。不须遗剑刻舟寻。雪月风花常见面。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【未曾有经云】妙吉祥菩萨。因见一人。言我造杀业。决堕地狱。如何救度。菩萨即化一人。亦曰。我造杀业。决堕地狱。前人闻已。言我亦然。化人告之。唯佛能救。相随共诣。化人白佛。我造杀业。怖堕地狱。愿佛救度。佛即告言。如汝所说造杀业者。汝从何心而起业相。为过去耶。未来耶。现在耶。若起过去心者。过去已灭。心不可得。若起未来心者。未来未来。心不可得。若起见在心者。见在不住。心不可得。三界俱不可得故。即无起作。无起作故。于其罪相何所见耶。善男子。心无所住。不在内外中间。心无色相。非青黄赤白。心无造作。无作者故。心非幻化。本真实故。心无边际。非限量故。心无取舍。非善恶故。心无转动。非生灭故。心等空虚。无障碍故。心非染净。离一切数故。善男子作是观者。即于一切法中。求心不可得。何以故。心之自性。即诸法性。诸法性空。即真实性。由是义故。汝今不应妄生怖畏。是时化人闻佛说法。即白佛言。我今得悟罪业性空。不生怖畏。尔时实造业者。亦白佛言。我今得悟罪业性空。而不复生怖畏之心。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【李文会曰】谓三世心无性可得。故可从缘而生。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【肇法师云】闻说诸心。谓有实心。故须破遣。明三世皆空。故云过去已灭。未来未起。现在虚妄。三世推求。了不可得。故云若悟无法无相无事平常真心。即法体空寂。不生不灭。湛然清净。岂有前念今念后念可得也。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【马祖云】道不用修。但莫洿染。何谓洿染。但有生死造作趣向。皆是洿染。若欲直会其道。平常心即是道。何谓平常心。无造作。无是非。无取舍。无憎爱。无圣凡。是故经云。非凡夫行。非圣贤行。是菩萨行。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【赵州问南泉云】如何是道。泉云。平常心是道。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 【圜悟禅师颂曰】欲识平常道。天真任自然。行船宜举棹。走马即加鞭。若遇饥来饭。还应困即眠。尽从缘所得。所得亦非缘。</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/past-present-future-mindfulness/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/vc-common-code-collection/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="VC常用代码收集"><meta itemprop=description content='根据文件句柄，获取文件名
#include&nbsp;<windows.h>
#include&nbsp;<stdio.h>
#include&nbsp;<tchar.h>
#include&nbsp;<string.h>
#include&nbsp;<psapi.h>
&nbsp;
#define&nbsp;BUFSIZE&nbsp;512
&nbsp;
BOOL&nbsp;GetFileNameFromHandle(HANDLE&nbsp;hFile)&nbsp;
{
&nbsp;&nbsp;BOOL&nbsp;bSuccess&nbsp;=&nbsp;FALSE;
&nbsp;&nbsp;TCHAR&nbsp;pszFilename[MAX_PATH+1];
&nbsp;&nbsp;HANDLE&nbsp;hFileMap;
&nbsp;
&nbsp;&nbsp;//&nbsp;Get&nbsp;the&nbsp;file&nbsp;size.
&nbsp;&nbsp;DWORD&nbsp;dwFileSizeHi&nbsp;=&nbsp;0;
&nbsp;&nbsp;DWORD&nbsp;dwFileSizeLo&nbsp;=&nbsp;GetFileSize(hFile,&nbsp;&amp;dwFileSizeHi);&nbsp;
&nbsp;
&nbsp;&nbsp;if(&nbsp;dwFileSizeLo&nbsp;==&nbsp;0&nbsp;&&&nbsp;dwFileSizeHi&nbsp;==&nbsp;0&nbsp;)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("Cannot&nbsp;map&nbsp;a&nbsp;file&nbsp;with&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.\n");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;
&nbsp;&nbsp;}
&nbsp;
&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;file&nbsp;mapping&nbsp;object.
&nbsp;&nbsp;hFileMap&nbsp;=&nbsp;CreateFileMapping(hFile,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAGE_READONLY,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL);
&nbsp;
&nbsp;&nbsp;if&nbsp;(hFileMap)&nbsp;
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Create&nbsp;a&nbsp;file&nbsp;mapping&nbsp;to&nbsp;get&nbsp;the&nbsp;file&nbsp;name.
&nbsp;&nbsp;&nbsp;&nbsp;void*&nbsp;pMem&nbsp;=&nbsp;MapViewOfFile(hFileMap,&nbsp;FILE_MAP_READ,&nbsp;0,&nbsp;0,&nbsp;1);
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pMem)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GetMappedFileName&nbsp;(GetCurrentProcess(),&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pMem,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pszFilename,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MAX_PATH))&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Translate&nbsp;path&nbsp;with&nbsp;device&nbsp;name&nbsp;to&nbsp;drive&nbsp;letters.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR&nbsp;szTemp[BUFSIZE];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;szTemp[0]&nbsp;=&nbsp;&#39;\0&#39;;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GetLogicalDriveStrings(BUFSIZE-1,&nbsp;szTemp))&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR&nbsp;szName[MAX_PATH];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR&nbsp;szDrive[3]&nbsp;=&nbsp;TEXT("&nbsp;:");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;bFound&nbsp;=&nbsp;FALSE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR*&nbsp;p&nbsp;=&nbsp;szTemp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Copy&nbsp;the&nbsp;drive&nbsp;letter&nbsp;to&nbsp;the&nbsp;template&nbsp;string
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*szDrive&nbsp;=&nbsp;*p;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Look&nbsp;up&nbsp;each&nbsp;device&nbsp;name
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(QueryDosDevice(szDrive,&nbsp;szName,&nbsp;BUFSIZE))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UINT&nbsp;uNameLen&nbsp;=&nbsp;_tcslen(szName);
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(uNameLen&nbsp;<&nbsp;MAX_PATH)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bFound&nbsp;=&nbsp;_tcsnicmp(pszFilename,&nbsp;szName,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uNameLen)&nbsp;==&nbsp;0;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bFound)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Reconstruct&nbsp;pszFilename&nbsp;using&nbsp;szTemp
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Replace&nbsp;device&nbsp;path&nbsp;with&nbsp;DOS&nbsp;path
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR&nbsp;szTempFile[MAX_PATH];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_stprintf(szTempFile,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT("%s%s"),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;szDrive,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pszFilename+uNameLen);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tcsncpy(pszFilename,&nbsp;szTempFile,&nbsp;MAX_PATH);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Go&nbsp;to&nbsp;the&nbsp;next&nbsp;NULL&nbsp;character.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(*p++);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;while&nbsp;(!bFound&nbsp;&&&nbsp;*p);&nbsp;//&nbsp;end&nbsp;of&nbsp;string
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bSuccess&nbsp;=&nbsp;TRUE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnmapViewOfFile(pMem);
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hFileMap);
&nbsp;&nbsp;}
&nbsp;&nbsp;printf("File&nbsp;name&nbsp;is&nbsp;%s\n",&nbsp;pszFilename);
&nbsp;&nbsp;return(bSuccess);
}
开机自动运行
&nbsp;&nbsp;其中strPath参数表示要设置为自运行的程序的绝对路径。当设置成功时返回true，否则返回false
BOOL&nbsp;SetAutoRun(CString&nbsp;strPath)//开机自动运行
{
&nbsp;&nbsp;&nbsp;CString&nbsp;str;
&nbsp;&nbsp;&nbsp;HKEY&nbsp;hRegKey;
&nbsp;&nbsp;&nbsp;BOOL&nbsp;bResult;
&nbsp;&nbsp;&nbsp;str=_T("Software\\Microsoft\\Windows\\CurrentVersion\\Run");
&nbsp;&nbsp;&nbsp;if(RegOpenKey(HKEY_LOCAL_MACHINE,&nbsp;str,&nbsp;&amp;hRegKey)&nbsp;!=&nbsp;ERROR_SUCCESS)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bResult=FALSE;
&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_splitpath(strPath.GetBuffer(0),NULL,NULL,str.GetBufferSetLength(MAX_PATH+1),NULL);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strPath.ReleaseBuffer();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str.ReleaseBuffer();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(::RegSetValueEx(&nbsp;hRegKey,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REG_SZ,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CONST&nbsp;BYTE&nbsp;*)strPath.GetBuffer(0),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strPath.GetLength()&nbsp;)&nbsp;!=&nbsp;ERROR_SUCCESS)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bResult=FALSE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bResult=TRUE;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strPath.ReleaseBuffer();
&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;return&nbsp;bResult;
}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;
使计算机休眠
void&nbsp;XiuMian()&nbsp;
{
&nbsp;if(MessageBox("确实要休眠吗?","关机程序",MB_YESNO|MB_DEFBUTTON2|MB_ICONQUESTION)==IDYES)
&nbsp;{
&nbsp;&nbsp;HANDLE&nbsp;hToken;
&nbsp;&nbsp;TOKEN_PRIVILEGES&nbsp;tp;
&nbsp;&nbsp;LUID&nbsp;luid;
&nbsp;&nbsp;if(::OpenProcessToken(GetCurrentProcess(),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TOKEN_ADJUST_PRIVILEGES|TOKEN_QUERY,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;hToken))
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;::LookupPrivilegeValue(NULL,SE_SHUTDOWN_NAME,&amp;luid);
&nbsp;&nbsp;&nbsp;tp.PrivilegeCount=1;
&nbsp;&nbsp;&nbsp;tp.Privileges[0].Luid&nbsp;=luid;
&nbsp;&nbsp;&nbsp;tp.Privileges[0].Attributes&nbsp;=SE_PRIVILEGE_ENABLED;
&nbsp;&nbsp;&nbsp;::AdjustTokenPrivileges(hToken,false,&amp;tp,sizeof(TOKEN_PRIVILEGES),NULL,NULL);
&nbsp;&nbsp;}
&nbsp;&nbsp;::SetSystemPowerState(false,true);&nbsp;
&nbsp;}
}'></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/vc-common-code-collection/ itemprop=url class=post-title-link>VC常用代码收集</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月20日 00:44:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-20 00:44:00 +0800 +0800">2007年09月20日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/win32dev/ itemprop=url rel=index><span itemprop=name>dev/Win32Dev</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/vc-common-code-collection/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p style=font-size:9.75pt;margin:0;color:#4d4d4d;font-family:SimSun>根据文件句柄，获取文件名</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>#include&nbsp;&lt;windows.h></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>#include&nbsp;&lt;stdio.h></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>#include&nbsp;&lt;tchar.h></p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>#include&nbsp;&lt;</span><span style=color:blue>string</span><span style=color:#000>.h></span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>#include&nbsp;&lt;psapi.h></p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:blue>#define</span><span style=color:#000>&nbsp;BUFSIZE&nbsp;512</span></p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>BOOL&nbsp;GetFileNameFromHandle(HANDLE&nbsp;hFile)&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>{</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;BOOL&nbsp;bSuccess&nbsp;=&nbsp;FALSE;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;TCHAR&nbsp;pszFilename[MAX_PATH+1];</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;HANDLE&nbsp;hFileMap;</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;</span><span style=color:green>//&nbsp;Get&nbsp;the&nbsp;file&nbsp;size.</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;DWORD&nbsp;dwFileSizeHi&nbsp;=&nbsp;0;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;DWORD&nbsp;dwFileSizeLo&nbsp;=&nbsp;GetFileSize(hFile,&nbsp;&amp;dwFileSizeHi);&nbsp;</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>(&nbsp;dwFileSizeLo&nbsp;==&nbsp;0&nbsp;&&&nbsp;dwFileSizeHi&nbsp;==&nbsp;0&nbsp;)</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("Cannot&nbsp;map&nbsp;a&nbsp;file&nbsp;with&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.\n");</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>return</span><span style=color:#000>&nbsp;FALSE;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;}</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;</span><span style=color:green>//&nbsp;Create&nbsp;a&nbsp;file&nbsp;mapping&nbsp;object.</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;hFileMap&nbsp;=&nbsp;CreateFileMapping(hFile,&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL,&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAGE_READONLY,</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1,</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL);</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>&nbsp;(hFileMap)&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//&nbsp;Create&nbsp;a&nbsp;file&nbsp;mapping&nbsp;to&nbsp;get&nbsp;the&nbsp;file&nbsp;name.</span></p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>void</span><span style=color:#000>*&nbsp;pMem&nbsp;=&nbsp;MapViewOfFile(hFileMap,&nbsp;FILE_MAP_READ,&nbsp;0,&nbsp;0,&nbsp;1);</span></p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>&nbsp;(pMem)&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>&nbsp;(GetMappedFileName&nbsp;(GetCurrentProcess(),&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pMem,&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pszFilename,</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MAX_PATH))&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//&nbsp;Translate&nbsp;path&nbsp;with&nbsp;device&nbsp;name&nbsp;to&nbsp;drive&nbsp;letters.</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR&nbsp;szTemp[BUFSIZE];</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;szTemp[0]&nbsp;=&nbsp;'\0';</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>&nbsp;(GetLogicalDriveStrings(BUFSIZE-1,&nbsp;szTemp))&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR&nbsp;szName[MAX_PATH];</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR&nbsp;szDrive[3]&nbsp;=&nbsp;TEXT("&nbsp;:");</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;bFound&nbsp;=&nbsp;FALSE;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR*&nbsp;p&nbsp;=&nbsp;szTemp;</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>do</span><span style=color:#000>&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//&nbsp;Copy&nbsp;the&nbsp;drive&nbsp;letter&nbsp;to&nbsp;the&nbsp;template&nbsp;string</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*szDrive&nbsp;=&nbsp;*p;</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//&nbsp;Look&nbsp;up&nbsp;each&nbsp;device&nbsp;name</span></p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>&nbsp;(QueryDosDevice(szDrive,&nbsp;szName,&nbsp;BUFSIZE))</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UINT&nbsp;uNameLen&nbsp;=&nbsp;_tcslen(szName);</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>&nbsp;(uNameLen&nbsp;&lt;&nbsp;MAX_PATH)&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bFound&nbsp;=&nbsp;_tcsnicmp(pszFilename,&nbsp;szName,&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uNameLen)&nbsp;==&nbsp;0;</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>&nbsp;(bFound)&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//&nbsp;Reconstruct&nbsp;pszFilename&nbsp;using&nbsp;szTemp</span></p><p style=font-size:9.75pt;margin:0;color:green;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Replace&nbsp;device&nbsp;path&nbsp;with&nbsp;DOS&nbsp;path</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCHAR&nbsp;szTempFile[MAX_PATH];</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_stprintf(szTempFile,</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT("%s%s"),</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;szDrive,</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pszFilename+uNameLen);</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_tcsncpy(pszFilename,&nbsp;szTempFile,&nbsp;MAX_PATH);</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//&nbsp;Go&nbsp;to&nbsp;the&nbsp;next&nbsp;NULL&nbsp;character.</span></p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>while</span><span style=color:#000>&nbsp;(*p++);</span></p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</span><span style=color:blue>while</span><span style=color:#000>&nbsp;(!bFound&nbsp;&&&nbsp;*p);&nbsp;</span><span style=color:green>//&nbsp;end&nbsp;of&nbsp;string</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bSuccess&nbsp;=&nbsp;TRUE;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnmapViewOfFile(pMem);</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</p><p style=font-size:10pt;margin:0;font-family:SimSun>&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hFileMap);</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;}</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;printf("File&nbsp;name&nbsp;is&nbsp;%s\n",&nbsp;pszFilename);</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;</span><span style=color:blue>return</span><span style=color:#000>(bSuccess);</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>}</p><p style=font-size:9.75pt;margin:0;color:#4d4d4d;font-family:SimSun>开机自动运行</p><p style=font-size:9.75pt;margin:0;color:#4d4d4d><span style=font-family:Tahoma>&nbsp;&nbsp;</span><span style=font-family:SimSun>其中</span><span style=font-family:Tahoma>strPath</span><span style=font-family:SimSun>参数表示要设置为自运行的程序的绝对路径。当设置成功时返回</span><span style=font-family:Tahoma>true</span><span style=font-family:SimSun>，否则返回</span><span style=font-family:Tahoma>false</span></p><p style=font-size:9.75pt;margin:0><span style=color:#000;font-family:Tahoma>BOOL&nbsp;SetAutoRun(CString&nbsp;strPath)</span><span style=color:green;font-family:Tahoma>//</span><span style=color:green;font-family:SimSun>开机自动运行</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>{</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;CString&nbsp;str;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;HKEY&nbsp;hRegKey;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;BOOL&nbsp;bResult;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;str=_T("Software\\Microsoft\\Windows\\CurrentVersion\\Run");</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>(RegOpenKey(HKEY_LOCAL_MACHINE,&nbsp;str,&nbsp;&amp;hRegKey)&nbsp;!=&nbsp;ERROR_SUCCESS)&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bResult=FALSE;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;</span><span style=color:blue>else</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_splitpath(strPath.GetBuffer(0),NULL,NULL,str.GetBufferSetLength(MAX_PATH+1),NULL);</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strPath.ReleaseBuffer();</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str.ReleaseBuffer();</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>(::RegSetValueEx(&nbsp;hRegKey,</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str,</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REG_SZ,</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CONST&nbsp;BYTE&nbsp;*)strPath.GetBuffer(0),</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strPath.GetLength()&nbsp;)&nbsp;!=&nbsp;ERROR_SUCCESS)</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bResult=FALSE;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:blue>else</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bResult=TRUE;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strPath.ReleaseBuffer();</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;}</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;</span><span style=color:blue>return</span><span style=color:#000>&nbsp;bResult;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#4d4d4d;font-family:Tahoma>&nbsp;</p><p style=font-size:9.75pt;margin:0;color:#4d4d4d;font-family:SimSun>使计算机休眠</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:blue>void</span><span style=color:#000>&nbsp;XiuMian()&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>{</p><p style=font-size:9.75pt;margin:0><span style=color:#000;font-family:Tahoma>&nbsp;</span><span style=color:blue;font-family:Tahoma>if</span><span style=color:#000;font-family:Tahoma>(MessageBox("</span><span style=color:#000;font-family:SimSun>确实要休眠吗</span><span style=color:#000;font-family:Tahoma>?","</span><span style=color:#000;font-family:SimSun>关机程序</span><span style=color:#000;font-family:Tahoma>",MB_YESNO|MB_DEFBUTTON2|MB_ICONQUESTION)==IDYES)</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;{</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;HANDLE&nbsp;hToken;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;TOKEN_PRIVILEGES&nbsp;tp;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;LUID&nbsp;luid;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;</span><span style=color:blue>if</span><span style=color:#000>(::OpenProcessToken(GetCurrentProcess(),</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TOKEN_ADJUST_PRIVILEGES|TOKEN_QUERY,</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;hToken))</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;{</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;::LookupPrivilegeValue(NULL,SE_SHUTDOWN_NAME,&amp;luid);</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;tp.PrivilegeCount=1;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;tp.Privileges[0].Luid&nbsp;=luid;</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;&nbsp;tp.Privileges[0].Attributes&nbsp;=SE_PRIVILEGE_ENABLED;</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;&nbsp;::AdjustTokenPrivileges(hToken,</span><span style=color:blue>false</span><span style=color:#000>,&amp;tp,</span><span style=color:blue>sizeof</span><span style=color:#000>(TOKEN_PRIVILEGES),NULL,NULL);</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;&nbsp;}</p><p style=font-size:9.75pt;margin:0;font-family:Tahoma><span style=color:#000>&nbsp;&nbsp;::SetSystemPowerState(</span><span style=color:blue>false</span><span style=color:#000>,</span><span style=color:blue>true</span><span style=color:#000>);&nbsp;</span></p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>&nbsp;}</p><p style=font-size:9.75pt;margin:0;color:#000;font-family:Tahoma>}</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/vc-common-code-collection/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/from-procedural-to-object-oriented/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="捅破窗户纸：如何从过程到对象—For金色的海洋以及所有为面向对象而困惑的Tx"><meta itemprop=description content="本来不想写这篇很挨打的Post，不过在最近几天的最热的几篇Post里面看到无数的Tx为了面向对象的争论，感触颇多，遂作此篇。鄙视OO的也进来鄙视我吧。望OO达人多多指正。前头有一篇关于对象持久化的。不过很多Tx，连OO都不理解，那么持久化也是空谈。我们首先抛弃千篇一律的什么对象来源于生活，是真是对象的程序表现的屁话，空洞，对于一个一接触程序就开始过程，将严谨的过程渗透到骨髓里的工程人员来说，跟他扯这个简直是对牛谈琴。所以我们从过程来讲对象，然后来看如何将过程化的思维方式转化到对象式的方法论。以及过程抽象的弊端以及为什么要在复杂系统里OO。我们不能否认，我们在描述一件事情的时候，可以按照过程的方式进行抽象。打个比方。=======================将一个表单存入数据库=======================按照过程的方式描述。1.一条条读取表单上字段的值2.根据值构建SQL语句3.创建链接4.创建命令5.执行命令6.关闭链接基本上也就6步就完成了，没有多余的步骤。同意？那么接下来我们把这个命题扩展到两个表单乃至N个表单，那么这个过程就会N倍的扩张。于是过程达人们就开始动脑筋了。于是开始了第一个迭代的抽象（根据怪怪的理论，我们认同过程的抽象）。我们把构建SQL语句的部分过程抽象出来成了单独的过程-[构建Sql语句]。再一看，我们其实对执行SQL都可以抽象，于是将3，4，5，6都抽象出来，于是SqlHelper诞生了。这就是过程抽象的方式，不可否认其实我们很多人都经历过这个阶段。而且对此很为困惑。如果所做的很简单，过程很短，那么看起来过程的抽象方式确实更加容易理解。但是我们来看看过程的噩梦在那里。我们继续扩充命题。现在我们提交一个表单需要提交到两个数据库。于是我们的N个表单又产生更多的子过程。随着单个过程的长度增加，我们抽象出来的子过程还可能抽象出子过程，结果抽象出来的子过程呈级数增加。直到你的脑袋爆掉。还有一个问题就是，我们抽象出来的子过程放哪里？C#是一个面向对象的语言，所有的过程（或者函数，方法）都是从属于类，于是就出现了一个巨大的类包含无数静态方法的怪胎。那么，我们来看面向对象。面向对象和过程有什么联系呢。其实程序最终的运行还是按照过程的，类的作用就像一个框框，指定了那个过程应该属于那个类，必须在存在对象的时候才能调用还是在类中调用。之前在过程的时候抽象出的一大堆子过程杂乱无章。但是在用面向对象的方法所抽象出来的对象确实井然有序的。对象在执行的时候是按照一定的时序和过程在执行（所以在UML里有时序图）。但是我们不能够因为计算机是按照过程在执行就否定了OO，因为OO是设计时的概念（所以只有OOA、OOD、OOP而没有OOR【面向对象执行-自我发明的词，不存在此物】），而OO的过程是在设计的时候自然而然的产生的，既然OO的语言都存在，那么在这么多年的实践中，证明OO的方法是行之有效的。下面我们来看如何OO。用一个很简单的例子，聊天室，不用数据库的，数据记录在内存。 "></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/from-procedural-to-object-oriented/ itemprop=url class=post-title-link>捅破窗户纸：如何从过程到对象—For金色的海洋以及所有为面向对象而困惑的Tx</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月20日 00:43:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-20 00:43:00 +0800 +0800">2007年09月20日
</time></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/from-procedural-to-object-oriented/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>本来不想写这篇很挨打的Post，不过在最近几天的最热的几篇Post里面看到无数的Tx为了面向对象的争论，感触颇多，遂作此篇。<br>鄙视OO的也进来鄙视我吧。望OO达人多多指正。<br><br>前头有一篇关于对象持久化的。不过很多Tx，连OO都不理解，那么持久化也是空谈。<br>我们首先抛弃千篇一律的什么对象来源于生活，是真是对象的程序表现的屁话，空洞，对于一个一接触程序就开始过程，将严谨的过程渗透到骨髓里的工程人员来说，跟他扯这个简直是对牛谈琴。所以我们从过程来讲对象，然后来看如何将过程化的思维方式转化到对象式的方法论。以及过程抽象的弊端以及为什么要在复杂系统里OO。<br>我们不能否认，我们在描述一件事情的时候，可以按照过程的方式进行抽象。打个比方。<br>=======================<br>将一个表单存入数据库<br>=======================<br>按照过程的方式描述。<br>1.一条条读取表单上字段的值<br>2.根据值构建SQL语句<br>3.创建链接<br>4.创建命令<br>5.执行命令<br>6.关闭链接<br>基本上也就6步就完成了，没有多余的步骤。同意？<br><br>那么接下来我们把这个命题扩展到两个表单乃至N个表单，那么这个过程就会N倍的扩张。于是过程达人们就开始动脑筋了。于是开始了第一个迭代的抽象（根据怪怪的理论，我们认同过程的抽象）。我们把构建SQL语句的部分过程抽象出来成了单独的过程-[构建Sql语句]。再一看，我们其实对执行SQL都可以抽象，于是将3，4，5，6都抽象出来，于是SqlHelper诞生了。<br><br>这就是过程抽象的方式，不可否认其实我们很多人都经历过这个阶段。而且对此很为困惑。如果所做的很简单，过程很短，那么看起来过程的抽象方式确实更加容易理解。但是我们来看看过程的噩梦在那里。<br><br>我们继续扩充命题。<br>现在我们提交一个表单需要提交到两个数据库。于是我们的N个表单又产生更多的子过程。随着单个过程的长度增加，我们抽象出来的子过程还可能抽象出子过程，结果抽象出来的子过程呈级数增加。直到你的脑袋爆掉。<br>还有一个问题就是，我们抽象出来的子过程放哪里？C#是一个面向对象的语言，所有的过程（或者函数，方法）都是从属于类，于是就出现了一个巨大的类包含无数静态方法的怪胎。<br><br>那么，我们来看面向对象。面向对象和过程有什么联系呢。其实程序最终的运行还是按照过程的，类的作用就像一个框框，指定了那个过程应该属于那个类，必须在存在对象的时候才能调用还是在类中调用。之前在过程的时候抽象出的一大堆子过程杂乱无章。但是在用面向对象的方法所抽象出来的对象确实井然有序的。<br>对象在执行的时候是按照一定的时序和过程在执行（所以在UML里有时序图）。但是我们不能够因为计算机是按照过程在执行就否定了OO，因为OO是设计时的概念（所以只有OOA、OOD、OOP而没有OOR【面向对象执行-自我发明的词，不存在此物】），而OO的过程是在设计的时候自然而然的产生的，既然OO的语言都存在，那么在这么多年的实践中，证明OO的方法是行之有效的。<br><br>下面我们来看如何OO。<br>用一个很简单的例子，聊天室，不用数据库的，数据记录在内存。<br> </p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/from-procedural-to-object-oriented/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/code-injection-prevention/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="防止注入的代码"><meta itemprop=description content="闲话不说了，看代码：
&nbsp;1#define&nbsp;PROTECTED_DACL_SECURITY_INFORMATION&nbsp;(0x80000000L)&nbsp;2&nbsp;3BOOL&nbsp;Lock_CurrentProcess()&nbsp;4{&nbsp;5&nbsp;&nbsp;HANDLE&nbsp;hProcess&nbsp;=&nbsp;::GetCurrentProcess();&nbsp;6&nbsp;&nbsp;SID_IDENTIFIER_AUTHORITY&nbsp;sia&nbsp;=&nbsp;SECURITY_WORLD_SID_AUTHORITY;&nbsp;7&nbsp;&nbsp;PSID&nbsp;pSid;&nbsp;8&nbsp;&nbsp;BOOL&nbsp;bSus&nbsp;=&nbsp;FALSE;&nbsp;9&nbsp;&nbsp;bSus&nbsp;=&nbsp;::AllocateAndInitializeSid(&amp;sia,1,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,&amp;pSid);10&nbsp;&nbsp;if(!bSus)&nbsp;goto&nbsp;Cleanup;11&nbsp;&nbsp;HANDLE&nbsp;hToken;12&nbsp;&nbsp;bSus&nbsp;=&nbsp;::OpenProcessToken(hProcess,TOKEN_QUERY,&amp;hToken);13&nbsp;&nbsp;if(!bSus)&nbsp;goto&nbsp;Cleanup;14&nbsp;&nbsp;DWORD&nbsp;dwReturnLength;15&nbsp;&nbsp;::GetTokenInformation(hToken,TokenUser,NULL,NULL,&amp;dwReturnLength);16&nbsp;&nbsp;if(dwReturnLength&nbsp;>&nbsp;0x400)&nbsp;goto&nbsp;Cleanup;17&nbsp;&nbsp;LPVOID&nbsp;TokenInformation;18&nbsp;&nbsp;TokenInformation&nbsp;=&nbsp;::LocalAlloc(LPTR,0x400);//这里就引用SDK的函数不引用CRT的了19&nbsp;&nbsp;DWORD&nbsp;dw;20&nbsp;&nbsp;bSus&nbsp;=&nbsp;::GetTokenInformation(hToken,TokenUser,TokenInformation,0x400,&amp;dw);21&nbsp;&nbsp;if(!bSus)&nbsp;goto&nbsp;Cleanup;22&nbsp;&nbsp;PTOKEN_USER&nbsp;pTokenUser&nbsp;=&nbsp;(PTOKEN_USER)TokenInformation;23&nbsp;&nbsp;BYTE&nbsp;Buf[0x200];24&nbsp;&nbsp;PACL&nbsp;pAcl&nbsp;=&nbsp;(PACL)&amp;Buf;25&nbsp;&nbsp;bSus&nbsp;=&nbsp;::InitializeAcl(pAcl,1024,ACL_REVISION);26&nbsp;&nbsp;if(!bSus)&nbsp;goto&nbsp;Cleanup;27&nbsp;&nbsp;bSus&nbsp;=&nbsp;::AddAccessDeniedAce(pAcl,ACL_REVISION,0x000000FA,pSid);28&nbsp;&nbsp;if(!bSus)&nbsp;goto&nbsp;Cleanup;29&nbsp;&nbsp;bSus&nbsp;=&nbsp;::AddAccessAllowedAce(pAcl,ACL_REVISION,0x00100701,pTokenUser->User.Sid);30&nbsp;&nbsp;if(!bSus)&nbsp;goto&nbsp;Cleanup;31&nbsp;&nbsp;if(::SetSecurityInfo(hProcess,SE_KERNEL_OBJECT,DACL_SECURITY_INFORMATION&nbsp;|&nbsp;PROTECTED_DACL_SECURITY_INFORMATION,NULL,NULL,pAcl,NULL)&nbsp;==&nbsp;0)32&nbsp;&nbsp;&nbsp;&nbsp;bSus&nbsp;=&nbsp;TRUE;33Cleanup:34&nbsp;&nbsp;if(hProcess&nbsp;!=&nbsp;NULL)35&nbsp;&nbsp;&nbsp;&nbsp;::CloseHandle(hProcess);36&nbsp;&nbsp;if(pSid&nbsp;!=&nbsp;NULL)37&nbsp;&nbsp;&nbsp;&nbsp;::FreeSid(pSid);38&nbsp;&nbsp;return&nbsp;bSus;39}40
这段代码就可以锁住其他进程打开本进程,当然也就防止了注入,和读写内存.
可以更绝点Denied ALL ACCESS(0xFFFFFFFF)就连结束都不可能了
::AllocateAndInitializeSid 可以换成 :: InitializeSid .因为我们并不需要初始化子Sid.另外.&nbsp; bSus = ::AddAccessDeniedAce(pAcl,ACL_REVISION,0x000000FA,pSid);&nbsp; if(!bSus) goto Cleanup;&nbsp; bSus = ::AddAccessAllowedAce(pAcl,ACL_REVISION,0x00100701,pTokenUser->User.Sid);实际上只需要下面的一句,或者干脆把它去掉,因为如果不添加Ace默认就是没有权限.既然这样上面的那句话AllocateAndInitializeSid 也可以省掉,也似乎有些多余 "></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/code-injection-prevention/ itemprop=url class=post-title-link>防止注入的代码</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月18日 16:37:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-18 16:37:00 +0800 +0800">2007年09月18日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2008年03月29日 12:05:00 CST" itemprop="dateModified dateLastmod" datetime="2008-03-29 12:05:00 +0800 +0800">2008年03月29日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/safe/ itemprop=url rel=index><span itemprop=name>dev/Safe</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/code-injection-prevention/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>闲话不说了，看代码：<br></p><div style="border-right:#ccc 1px solid;padding-right:5px;border-top:#ccc 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#ccc 1px solid;width:98%;word-break:break-all;padding-top:4px;border-bottom:#ccc 1px solid;background-color:#eee"><span style=color:teal>&nbsp;1</span><img src=/Images/OutliningIndicators/None.gif align=top><span style=color:#00f>#define</span><span style=color:#000>&nbsp;PROTECTED_DACL_SECURITY_INFORMATION&nbsp;(0x80000000L)</span><span style=color:#000><br></span><span style=color:teal>&nbsp;2</span><span style=color:#000><img src=/Images/OutliningIndicators/None.gif align=top><br></span><span style=color:teal>&nbsp;3</span><span style=color:#000><img src=/Images/OutliningIndicators/None.gif align=top>BOOL&nbsp;Lock_CurrentProcess()<br></span><span style=color:teal>&nbsp;4</span><span style=color:#000><img id=Codehighlighter1_86_1446_Open_Image onclick='this.style.display="none",Codehighlighter1_86_1446_Open_Text.style.display="none",Codehighlighter1_86_1446_Closed_Image.style.display="inline",Codehighlighter1_86_1446_Closed_Text.style.display="inline"' src=/Images/OutliningIndicators/ExpandedBlockStart.gif align=top><img id=Codehighlighter1_86_1446_Closed_Image style=display:none onclick='this.style.display="none",Codehighlighter1_86_1446_Closed_Text.style.display="none",Codehighlighter1_86_1446_Open_Image.style.display="inline",Codehighlighter1_86_1446_Open_Text.style.display="inline"' src=/Images/OutliningIndicators/ContractedBlock.gif align=top></span><span id=Codehighlighter1_86_1446_Closed_Text style="border-right:gray 1px solid;border-top:gray 1px solid;display:none;border-left:gray 1px solid;border-bottom:gray 1px solid;background-color:#fff"><img src=/Images/dot.gif></span><span id=Codehighlighter1_86_1446_Open_Text><span style=color:#000>{<br></span><span style=color:teal>&nbsp;5</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;HANDLE&nbsp;hProcess&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;::GetCurrentProcess();<br></span><span style=color:teal>&nbsp;6</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;SID_IDENTIFIER_AUTHORITY&nbsp;sia&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;SECURITY_WORLD_SID_AUTHORITY;<br></span><span style=color:teal>&nbsp;7</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;PSID&nbsp;pSid;<br></span><span style=color:teal>&nbsp;8</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;BOOL&nbsp;bSus&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;FALSE;<br></span><span style=color:teal>&nbsp;9</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;bSus&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;::AllocateAndInitializeSid(</span><span style=color:#000>&</span><span style=color:#000>sia,</span><span style=color:#000>1</span><span style=color:#000>,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,</span><span style=color:#000>&</span><span style=color:#000>pSid);<br></span><span style=color:teal>10</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>bSus)&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;Cleanup;<br></span><span style=color:teal>11</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;HANDLE&nbsp;hToken;<br></span><span style=color:teal>12</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;bSus&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;::OpenProcessToken(hProcess,TOKEN_QUERY,</span><span style=color:#000>&</span><span style=color:#000>hToken);<br></span><span style=color:teal>13</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>bSus)&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;Cleanup;<br></span><span style=color:teal>14</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;DWORD&nbsp;dwReturnLength;<br></span><span style=color:teal>15</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;::GetTokenInformation(hToken,TokenUser,NULL,NULL,</span><span style=color:#000>&</span><span style=color:#000>dwReturnLength);<br></span><span style=color:teal>16</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(dwReturnLength&nbsp;</span><span style=color:#000>></span><span style=color:#000>&nbsp;</span><span style=color:#000>0x400</span><span style=color:#000>)&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;Cleanup;<br></span><span style=color:teal>17</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;LPVOID&nbsp;TokenInformation;<br></span><span style=color:teal>18</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;TokenInformation&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;::LocalAlloc(LPTR,</span><span style=color:#000>0x400</span><span style=color:#000>);</span><span style=color:green>//</span><span style=color:green>这里就引用SDK的函数不引用CRT的了</span><span style=color:green><br></span><span style=color:teal>19</span><span style=color:green><img src=/Images/OutliningIndicators/InBlock.gif align=top></span><span style=color:#000>&nbsp;&nbsp;DWORD&nbsp;dw;<br></span><span style=color:teal>20</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;bSus&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;::GetTokenInformation(hToken,TokenUser,TokenInformation,</span><span style=color:#000>0x400</span><span style=color:#000>,</span><span style=color:#000>&</span><span style=color:#000>dw);<br></span><span style=color:teal>21</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>bSus)&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;Cleanup;<br></span><span style=color:teal>22</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;PTOKEN_USER&nbsp;pTokenUser&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(PTOKEN_USER)TokenInformation;<br></span><span style=color:teal>23</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;BYTE&nbsp;Buf[</span><span style=color:#000>0x200</span><span style=color:#000>];<br></span><span style=color:teal>24</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;PACL&nbsp;pAcl&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(PACL)</span><span style=color:#000>&</span><span style=color:#000>Buf;<br></span><span style=color:teal>25</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;bSus&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;::InitializeAcl(pAcl,</span><span style=color:#000>1024</span><span style=color:#000>,ACL_REVISION);<br></span><span style=color:teal>26</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>bSus)&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;Cleanup;<br></span><span style=color:teal>27</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;bSus&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;::AddAccessDeniedAce(pAcl,ACL_REVISION,</span><span style=color:#000>0x000000FA</span><span style=color:#000>,pSid);<br></span><span style=color:teal>28</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>bSus)&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;Cleanup;<br></span><span style=color:teal>29</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;bSus&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;::AddAccessAllowedAce(pAcl,ACL_REVISION,</span><span style=color:#000>0x00100701</span><span style=color:#000>,pTokenUser</span><span style=color:#000>-></span><span style=color:#000>User.Sid);<br></span><span style=color:teal>30</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>bSus)&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;Cleanup;<br></span><span style=color:teal>31</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(::SetSecurityInfo(hProcess,SE_KERNEL_OBJECT,DACL_SECURITY_INFORMATION&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;PROTECTED_DACL_SECURITY_INFORMATION,NULL,NULL,pAcl,NULL)&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)<br></span><span style=color:teal>32</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;&nbsp;&nbsp;bSus&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;TRUE;<br></span><span style=color:teal>33</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>Cleanup:<br></span><span style=color:teal>34</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(hProcess&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;NULL)<br></span><span style=color:teal>35</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;&nbsp;&nbsp;::CloseHandle(hProcess);<br></span><span style=color:teal>36</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(pSid&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;NULL)<br></span><span style=color:teal>37</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;&nbsp;&nbsp;::FreeSid(pSid);<br></span><span style=color:teal>38</span><span style=color:#000><img src=/Images/OutliningIndicators/InBlock.gif align=top>&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;bSus;<br></span><span style=color:teal>39</span><span style=color:#000><img src=/Images/OutliningIndicators/ExpandedBlockEnd.gif align=top>}</span></span><span style=color:#000><br></span><span style=color:teal>40</span><span style=color:#000><img src=/Images/OutliningIndicators/None.gif align=top></span></div><p><br>这段代码就可以锁住其他进程打开本进程,当然也就防止了注入,和读写内存.</p><p>可以更绝点Denied ALL ACCESS(0xFFFFFFFF)就连结束都不可能了</p><p>::AllocateAndInitializeSid 可以换成 :: InitializeSid .因为我们并不需要初始化子Sid.<br>另外.<br>&nbsp; bSus = ::AddAccessDeniedAce(pAcl,ACL_REVISION,0x000000FA,pSid);<br>&nbsp; if(!bSus) goto Cleanup;<br>&nbsp; bSus = ::AddAccessAllowedAce(pAcl,ACL_REVISION,0x00100701,pTokenUser->User.Sid);<br>实际上只需要下面的一句,或者干脆把它去掉,因为如果不添加Ace默认就是没有权限.既然这样上面的那句话AllocateAndInitializeSid 也可以省掉,也似乎有些多余<br></p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/code-injection-prevention/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/lua-5.0-reference-manual/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Lua 5.0 参考手册"><meta itemprop=description content="作者： Roberto Ierusalimschy, Luiz Henrique de Figueiredo, Waldemar Celes
Copyright © 2003 Tecgraf, PUC-Rio. All rights reserved.
译者：

    ShiningRay
    
 Nicholas @ 

    NirvanaStudio
    



    给予支持
    


1 - 绪论

Lua是一种为支持有数据描述机制的一般过程式编程语言而设计的扩展编程语言。它同样可以对面向对象语言、函数式程序设计（Functional Programming，如Lisp）以及数据驱动编程（data-driven programming）提供很好的支持。它的目标是被用作一种强大的、轻型的配置语言。Lua目前已经被实现为一个扩展库，是用_clean_ C （ANSI C/C++的一个通用子集）编写的。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/lua-5.0-reference-manual/ itemprop=url class=post-title-link>Lua 5.0 参考手册</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月18日 15:55:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-18 15:55:00 +0800 +0800">2007年09月18日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/lua/ itemprop=url rel=index><span itemprop=name>dev/Lua</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/lua-5.0-reference-manual/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>作者： Roberto Ierusalimschy, Luiz Henrique de Figueiredo, Waldemar Celes</p><p><small><a href=http://www.lua.org/copyright.html rel="noopener nofollow"></a><span size=1>Copyright © 2003 Tecgraf, PUC-Rio. All rights reserved.</span></small></p><p>译者：
<a href=http://wiki.nirvanastudio.org/wiki/ShiningRay title=ShiningRay rel="noopener external nofollow noreferrer" target=_blank class=exturl>ShiningRay
</a>Nicholas @
<a href=http://www.nirvanastudio.org/ title=NirvanaStudio rel="noopener external nofollow noreferrer" target=_blank class=exturl>NirvanaStudio</a></p><p><a href=http://www.nirvanastudio.org/about/donate/ title=给予支持 rel="noopener external nofollow noreferrer" target=_blank class=exturl>给予支持</a></p><hr><h2 id=1---绪论>1 - 绪论
<a class=header-anchor href=#1---%e7%bb%aa%e8%ae%ba></a></h2><p>Lua是一种为支持有数据描述机制的一般过程式编程语言而设计的扩展编程语言。它同样可以对面向对象语言、函数式程序设计（Functional Programming，如Lisp）以及数据驱动编程（data-driven programming）提供很好的支持。它的目标是被用作一种强大的、轻型的配置语言。Lua目前已经被实现为一个扩展库，是用_clean_ C （ANSI C/C++的一个通用子集）编写的。</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/lua-5.0-reference-manual/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/integrate-lua-in-cpp-luaplus/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="如何在C++中集成Lua脚本(LuaPlus篇)"><meta itemprop=description content="去年我作了一个Lua脚本的C++包装，有许多朋友感兴趣，并尝试使用，我感到受宠若惊。事实上，我作的包装，学习的目的比较强，它还是有许多缺陷的。为了让朋友们少走弯路，我推荐使用LuaPlus作为C++的包装。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/integrate-lua-in-cpp-luaplus/ itemprop=url class=post-title-link>如何在C++中集成Lua脚本(LuaPlus篇)</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月18日 15:47:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-18 15:47:00 +0800 +0800">2007年09月18日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年09月21日 12:11:00 CST" itemprop="dateModified dateLastmod" datetime="2007-09-21 12:11:00 +0800 +0800">2007年09月21日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/lua/ itemprop=url rel=index><span itemprop=name>dev/Lua</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/integrate-lua-in-cpp-luaplus/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>去年我作了一个Lua脚本的C++包装，有许多朋友感兴趣，并尝试使用，我感到受宠若惊。事实上，我作的包装，学习的目的比较强，它还是有许多缺陷的。为了让朋友们少走弯路，我推荐使用LuaPlus作为C++的包装。</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/integrate-lua-in-cpp-luaplus/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/tiger-crane-double-form-fist/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="虎鹤双形拳"><meta itemprop=description content="虎鹤双形拳是南海平洲人林世荣根据洪拳和佛拳改编而成一套拳术。著有《虎鹤双形》一书。他说这套拳能“以小击大，以弱击强，千斤之力得以半两消之”； 又说，能“以横克直，以弱借强，虎爪则如猛虫扑兽，鹤翅则为凌空击水，浩浩如五爪金龙，盘盘如老僧入定，极神化之妙”。自成一格，有“洪头佛尾”之称。流行于南海、番禺、顺德、肇庆、广宁、怀集等地，流行于港澳和南洋一带。它的整套动作108点，模仿虎与鹤两种形象编成。结构有慢有快，有高有低，从慢到快，快慢结合。其内容以洪家桥马、佛家快打、洪家防卫、佛家攻势兼而有之。手形是拳、掌、指、爪、钩。手法有抛、钉（钑）、挂、撞、插。步法有弓步、马步、虚步、跪步、独立步和麒麟步。身形以平稳中正为主，收腹探身为助。拳势威武雄壮，气势磅礡。要求出拳稳定有力，步法落地生根，眼睛灵活有神，身段挺拔端正。 可惜没学玩有空继续。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/tiger-crane-double-form-fist/ itemprop=url class=post-title-link>虎鹤双形拳</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月18日 15:35:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-18 15:35:00 +0800 +0800">2007年09月18日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/kungfu/ itemprop=url rel=index><span itemprop=name>Kungfu</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/tiger-crane-double-form-fist/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>虎鹤双形拳是南海平洲人林世荣根据洪拳和佛拳改编而成一套拳术。著有《虎鹤双形》一书。他说这套拳能“以小击大，以弱击强，千斤之力得以半两消之”； 又说，能“以横克直，以弱借强，虎爪则如猛虫扑兽，鹤翅则为凌空击水，浩浩如五爪金龙，盘盘如老僧入定，极神化之妙”。自成一格，有“洪头佛尾”之称。流行于南海、番禺、顺德、肇庆、广宁、怀集等地，流行于港澳和南洋一带。它的整套动作108点，模仿虎与鹤两种形象编成。结构有慢有快，有高有低，从慢到快，快慢结合。其内容以洪家桥马、佛家快打、洪家防卫、佛家攻势兼而有之。手形是拳、掌、指、爪、钩。手法有抛、钉（钑）、挂、撞、插。步法有弓步、马步、虚步、跪步、独立步和麒麟步。身形以平稳中正为主，收腹探身为助。拳势威武雄壮，气势磅礡。要求出拳稳定有力，步法落地生根，眼睛灵活有神，身段挺拔端正。<br><br><br><br><br><br>可惜没学玩有空继续。</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/tiger-crane-double-form-fist/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/integrate-lua-in-cpp-luawrapper/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="如何在C++中集成LUA脚本(LuaWrapper For C++篇)"><meta itemprop=description content='为什么要用Lua作脚本？　　使用Lua作脚本，主要是因为它小巧玲珑（体积小，运行快），而且它的语法又比较简单明了。不过，使用LuaAPI将Lua引擎集成到程序中，确实有一些不方便——用落木随风网友的话来说，就是"就象用汇编"。当然，现在你不用再这么辛苦了，因为你可以使用LuaWrapper For C++。使用这个工具，在C++中集成Lua脚本就是轻而易举的事。你原有的C++函数和类，几乎不需要任何改变，就可以与Lua脚本共享。　　我们接下来，用实例来说明，如何用LuaWrapper来集成Lua脚本到你的程序中去。1.&nbsp;&nbsp;创建Lua引擎　　LuaWrap lua; 或者 LuaWrap* lua = new LuaWrap;　　创建一个LuaWrap对象，就是创建一个Lua脚本引擎。并且根据Lua的特性，你可以创建任意多个Lua引擎，甚至可以分布在不同的线程当中。2.&nbsp;&nbsp;装载并执行脚本程序　　你可以从缓冲区中装载Lua脚本：　　lua.LoadString(　　　　"print(&#39;Hello World&#39;)"　　);　　当然，你也可以从文件中装入，并执行Lua脚本：　　Lua.LoadFile("./test.lua");　　Lua的脚本，可以是源代码，也可以经过编译后的中间代码。也许你对编译后的中间代码更感兴趣——如果你不希望让源代码赤裸裸的袒露在大家的眼前。3.&nbsp;&nbsp;获取和设置Lua变量　　能够获取和设置脚本变量的内容，是一个最基本的功能。你可以使用GetGlobal和SetGlobal函数来做到这一点：　　(1)&nbsp;&nbsp;获取变量：　　　　int a = lua.GetGlobal<int>("a");　　　　LuaTable table = lua.GetGlobal<LuaTable>("t");　　　　这里，<> 里头的类型，就是想要的变量的类型。　　(2)&nbsp;&nbsp;设置变量：　　　　lua.SetGlobal("a", a); 　　　　lua.SetGlobal("t", table);4.&nbsp;&nbsp;调用Lua函数　　使用Call函数，就可以很简单的从你的程序中调用Lua函数：　　lua.Call<void>("print", "Hello World");　　int sum = lua.Call<int>("add", 2, 3);　　这里，<> 里头的类型是返回值的类型。5.&nbsp;&nbsp;如何让Lua也能调用C++的函数　　精采的地方来了。假如有下面这样的一个函数：　　int add(int a, int b)　　{　　　　return a + b;　　}　　如果想让它能够让Lua使用，只需将它注册到Lua引擎当中就可以了：　　lua.RegisterFunc("add", int(int,int), add);　　这样，Lua中就可以用直接使用了：　　（Lua脚本）sum = add(1, 3) 　　(*) RegisterFunc的功能，就是让你把C++的函数注册到Lua中，供Lua脚本使用。　　　　第一个参数，是想要在Lua中用的函数名。　　　　第二个参数，是C++中函数的原型； C++允许函数重载的，你可以使用函数原型，来选择需要注册到Lua引擎中的那个函数。　　　　第三个参数，就是C++中函数的指针了。6.&nbsp;&nbsp;如何能让C++的类在Lua中使用　　我们先看看下面这个C++类：class MyArray{&nbsp;&nbsp;std::vector<double> array;public:&nbsp;&nbsp;void setvalue(int index, double value);&nbsp;&nbsp;double getvalue(int index);&nbsp;&nbsp;int size();&nbsp;&nbsp;const char* ToString();};　　你准备要让Lua能够自由访问并操作这个类。很简单，你只需增加几个宏定义就可以了：class MyArray{&nbsp;&nbsp;std::vector<double> array;public:&nbsp;&nbsp;void setvalue(int index, double value);&nbsp;&nbsp;double getvalue(int index);&nbsp;&nbsp;int size();&nbsp;&nbsp;const char* ToString();&nbsp;&nbsp;// 将一个 class 作为一个 Lua 对象是很容易的，只需要增加以下宏定义。&nbsp;&nbsp;DEFINE_TYPENAME("My.array");&nbsp;&nbsp;BEGIN_REGLUALIB("array")&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_create("new", MyArray )&nbsp;&nbsp;// 创建MyArray (注：由于发表的原因，create应为全部大写)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_DESTROY("del", MyArray )&nbsp;&nbsp;// 消除MyArray。&nbsp;&nbsp;END_REGLUALIB()&nbsp;&nbsp;BEGIN_REGLUALIB_MEMBER()&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_FUNC("size", int (MyArray*), &amp;MyArray::size)&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_FUNC("__getindex", double(MyArray*, int), &amp;MyArray::getvalue)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_FUNC("__newindex", void (MyArray*, int, double), &amp;MyArray::setvalue)&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_FUNC("__tostring", const char* (MyArray*), &amp;MyArray::ToString)&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_DESTROY("__gc", MyArray ) &nbsp;&nbsp;// 垃圾收集时消除对象用。&nbsp;&nbsp;END_REGLUALIB_MEMBER()};　　只要有了这些宏定义，这个类就是可以在Lua中使用的类了，我们就可以在Lua中注册这个类了：　　lua.Register<MyArray>()　　这样注册以后，我们在Lua中就可以使用这个类了：　　a = array.new()&nbsp;&nbsp;-- 创建对象，相当于 a = new Myarray　　a[1] = 10&nbsp;&nbsp;-- 调用__newindex，也就是C++中的 a->setvalue(1, 10)　　a[2] = 20&nbsp;&nbsp;-- 调用__newindex，也就是C++中的 a->setvalue(2, 20)　　print(　　　　a,&nbsp;&nbsp;-- 调用 __tostring，也就是C++中的 a->ToString()　　　　a:size(), -- 相当于C++中的 a->size()　　　　a[1], -- 调用__getindex，也就是C++中的a->getvalue(1)　　　　a[2]) --调用__getindex，也就是C++中的a->getvalue(2)　　array.del(a)&nbsp;&nbsp;-- 清除对象，相当于 delete a　　a = nil&nbsp;&nbsp;-- 清空 a，很象C++中的 a = NULL　　当然，你也可以不用del这个对象，而是等待Lua帮你自动进行垃圾回收。在Lua进行垃圾回收时，它会自动调用这个对象的 __gc ，相当于 delete。　　那么，在C++中要创建MyArray对象，并且传递给Lua全局变量怎么办？就象前面讲过的一样，使用SetGlobal：　　MyArray* a = new MyArray; 　　lua.SetGlobal("a", a);　　要获取该对象，同样的，应该使用GetGlobal：　　MyArray* a = lua.GetGlobal<MyArray>("a");　　　　对于传递给Lua的对象，就让Lua来管理该对象的生存周期好了。如果你非要删除它的话，你可以使用DelGlobalObject：　　lua.DelGlobalObject<MyArray>("a");　　不过这么做的话，你应当明白你在做什么，因为在Lua的脚本中，可能已经在多处引用了这个对象了。删除了其中一个，将导致其它引用对象失效，从而可能引致系统崩溃。　　(1)&nbsp;&nbsp;DEFINE_TYPENAME("My.array");　　　　定义类型的名称。在Lua中，这个类型名称是唯一用来识别C++类型的，你必须为不同的对象给予不同的名称。　　(2)&nbsp;&nbsp;BEGIN_REGLUALIB("array") … END_REGLUALIB()　　　　你可以为一个对象定义一个程序库，"array"就是程序库的名字。在程序库中定义的函数是全局函数，在Lua中，使用该函数，需要在函数前加上库的名字，如：array.new（）。通常，程序库会包含创建对象的方法。如：　　　　LUALIB_ITEM_create("new", MyArray )&nbsp;&nbsp;// 创建MyArray (注：由于发表的原因，create应为全部大写)　　　　这样子，你才能在Lua中创建MyArray：　　　　a = array.new()　　　　　　你也可以选择增加一个删除对象操作：　　　　LUALIB_ITEM_DESTROY("del", MyArray ) &nbsp;&nbsp;// 删除MyArray　　　　这样，你就可以直接删除一个对象了：　　　　array.del(a)　　(3)&nbsp;&nbsp;BEGIN_REGLUALIB_MEMBER() …END_REGLUALIB_MEMBER()　　　　在此处，你可以定义对象的成员函数，也可以重载对象的操作符——是的，就象C++的operator重载。例如：　　　　LUALIB_ITEM_FUNC("__newindex", void (MyArray*, int, double), &amp;MyArray::setvalue)　　　　就是重载 operator[] 操作符。Lua中可重载的操作符还有许多，如：　　　　__getindex：操作符[]，支持读取访问，如 v = a[10]　　　　__newindex：操作符[]，支持赋值访问，如 a[10] = 1.22　　　　__tostring：将变量转换成字串__add：等同于operator +　　　　__add：操作符 ＋　　　　__sub：操作符 –　　　　__mul：操作符 ×　　　　__div：操作符 ÷　　　　__pow：操作符 ^ (乘方)　　　　__unm：一元操作符 –　　　　__concat：操作符 .. (字符串连接)　　　　__eq：操作符 == (a ~= b等价于 not a == b)　　　　__lt：操作符 < (a > b 等价于 b < a)　　　　__le：操作符 <= (a >= b 等价于 b <= a，要注意的是，如果没有定义"__le"，则Lua将会尝试将a<=b 转换成 not (b < a) )　　　　__gc：在垃圾回收时调用此函数，相当于C++的析构函数。强烈建议定义此操作符，以免造成内存泄漏等情况。比如：　　　　LUALIB_ITEM_DESTROY("__gc", MyArray ) &nbsp;&nbsp;// 垃圾收集时消除对象用。　　　　(注) 这里要说明一下，在lua中，访问索引操作符是__index，不是__getindex，在luaWrapper库中，为了方便使用，将其映射为__getindex，同时，对__index的定义将会被忽略。　　　　就这么简单。假如你已经有现成的类，而你没有修改该类的权力，如何将其加入到Lua中呢？答案就是，继承它，将把派生类加入到Lua中。结束语　　LuaWrapper 需要用到boost库的支持：boost/type_traits.hpp, boost/function.hpp, boost/bind.hpp，它使用了C++的模板部份特化，因此，C++编译器如果不支持此特性，将无法编译。目前支持此特性的编译器已经有很多。在VisualStudo产品系列中，只有VC7.1能支持此特性，因此，您如果正在使用VisualStudio，请确认你用的是VisualStudio2003。　　如果你觉得 LuaWrapper For C++ 能够帮助你，我会感觉很荣幸。我很愿意将这个程序库分享给大家。顺便一提的是，如果你在使用过程中发现BUG，或是有好的建议，希望您能与我联系。你在使用过程中，请不要删除文件中的署名信息；如果你修改了程序库，请您在修改的文件中加入您的修改说明。当然，我会非常欢迎您能将修改后的程序回馈给我。我会继续优化并完善它。=============================================================File: Click Here Download: LuaWrapper For C++File: Click Here Download: LuaWrapper test program============================================================='></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/integrate-lua-in-cpp-luawrapper/ itemprop=url class=post-title-link>如何在C++中集成LUA脚本(LuaWrapper For C++篇)</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月18日 15:11:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-18 15:11:00 +0800 +0800">2007年09月18日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/lua/ itemprop=url rel=index><span itemprop=name>dev/Lua</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/integrate-lua-in-cpp-luawrapper/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>为什么要用Lua作脚本？<br>　　使用Lua作脚本，主要是因为它小巧玲珑（体积小，运行快），而且它的语法又比较简单明了。不过，使用LuaAPI将Lua引擎集成到程序中，确实有一些不方便——用落木随风网友的话来说，就是"就象用汇编"。当然，现在你不用再这么辛苦了，因为你可以使用LuaWrapper For C++。使用这个工具，在C++中集成Lua脚本就是轻而易举的事。你原有的C++函数和类，几乎不需要任何改变，就可以与Lua脚本共享。<br>　　我们接下来，用实例来说明，如何用LuaWrapper来集成Lua脚本到你的程序中去。<br><br>1.&nbsp;&nbsp;创建Lua引擎<br>　　LuaWrap lua; 或者 LuaWrap* lua = new LuaWrap;<br>　　创建一个LuaWrap对象，就是创建一个Lua脚本引擎。并且根据Lua的特性，你可以创建任意多个Lua引擎，甚至可以分布在不同的线程当中。<br><br>2.&nbsp;&nbsp;装载并执行脚本程序<br>　　你可以从缓冲区中装载Lua脚本：<br>　　lua.LoadString(<br>　　　　"print('Hello World')"<br>　　);<br>　　当然，你也可以从文件中装入，并执行Lua脚本：<br>　　Lua.LoadFile("./test.lua");<br>　　Lua的脚本，可以是源代码，也可以经过编译后的中间代码。也许你对编译后的中间代码更感兴趣——如果你不希望让源代码赤裸裸的袒露在大家的眼前。<br><br>3.&nbsp;&nbsp;获取和设置Lua变量<br>　　能够获取和设置脚本变量的内容，是一个最基本的功能。你可以使用GetGlobal和SetGlobal函数来做到这一点：<br>　　(1)&nbsp;&nbsp;获取变量：<br>　　　　int a = lua.GetGlobal&lt;int>("a");<br>　　　　LuaTable table = lua.GetGlobal&lt;LuaTable>("t");<br>　　　　这里，&lt;> 里头的类型，就是想要的变量的类型。<br>　　(2)&nbsp;&nbsp;设置变量：<br>　　　　lua.SetGlobal("a", a);<br>　　　　lua.SetGlobal("t", table);<br><br>4.&nbsp;&nbsp;调用Lua函数<br>　　使用Call函数，就可以很简单的从你的程序中调用Lua函数：<br>　　lua.Call&lt;void>("print", "Hello World");<br>　　int sum = lua.Call&lt;int>("add", 2, 3);<br>　　这里，&lt;> 里头的类型是返回值的类型。<br><br>5.&nbsp;&nbsp;如何让Lua也能调用C++的函数<br>　　精采的地方来了。假如有下面这样的一个函数：<br>　　int add(int a, int b)<br>　　{<br>　　　　return a + b;<br>　　}<br>　　如果想让它能够让Lua使用，只需将它注册到Lua引擎当中就可以了：<br>　　lua.RegisterFunc("add", int(int,int), add);<br>　　这样，Lua中就可以用直接使用了：<br>　　（Lua脚本）sum = add(1, 3)<br><br>　　(*) RegisterFunc的功能，就是让你把C++的函数注册到Lua中，供Lua脚本使用。<br>　　　　第一个参数，是想要在Lua中用的函数名。<br>　　　　第二个参数，是C++中函数的原型； C++允许函数重载的，你可以使用函数原型，来选择需要注册到Lua引擎中的那个函数。<br>　　　　第三个参数，就是C++中函数的指针了。<br><br>6.&nbsp;&nbsp;如何能让C++的类在Lua中使用<br>　　我们先看看下面这个C++类：<br>class MyArray<br>{<br>&nbsp;&nbsp;std::vector&lt;double> array;<br>public:<br>&nbsp;&nbsp;void setvalue(int index, double value);<br>&nbsp;&nbsp;double getvalue(int index);<br>&nbsp;&nbsp;int size();<br>&nbsp;&nbsp;const char* ToString();<br>};<br><br>　　你准备要让Lua能够自由访问并操作这个类。很简单，你只需增加几个宏定义就可以了：<br><br>class MyArray<br>{<br>&nbsp;&nbsp;std::vector&lt;double> array;<br>public:<br>&nbsp;&nbsp;void setvalue(int index, double value);<br>&nbsp;&nbsp;double getvalue(int index);<br>&nbsp;&nbsp;int size();<br>&nbsp;&nbsp;const char* ToString();<br>&nbsp;&nbsp;// 将一个 class 作为一个 Lua 对象是很容易的，只需要增加以下宏定义。<br>&nbsp;&nbsp;DEFINE_TYPENAME("My.array");<br>&nbsp;&nbsp;BEGIN_REGLUALIB("array")<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_create("new", MyArray )&nbsp;&nbsp;// 创建MyArray (注：由于发表的原因，create应为全部大写)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_DESTROY("del", MyArray )&nbsp;&nbsp;// 消除MyArray。<br>&nbsp;&nbsp;END_REGLUALIB()<br>&nbsp;&nbsp;BEGIN_REGLUALIB_MEMBER()<br>&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_FUNC("size", int (MyArray*), &amp;MyArray::size)<br>&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_FUNC("__getindex", double(MyArray*, int), &amp;MyArray::getvalue)&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_FUNC("__newindex", void (MyArray*, int, double), &amp;MyArray::setvalue)<br>&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_FUNC("__tostring", const char* (MyArray*), &amp;MyArray::ToString)<br>&nbsp;&nbsp;&nbsp;&nbsp;LUALIB_ITEM_DESTROY("__gc", MyArray ) &nbsp;&nbsp;// 垃圾收集时消除对象用。<br>&nbsp;&nbsp;END_REGLUALIB_MEMBER()<br>};<br><br>　　只要有了这些宏定义，这个类就是可以在Lua中使用的类了，我们就可以在Lua中注册这个类了：<br>　　lua.Register&lt;MyArray>()<br><br>　　这样注册以后，我们在Lua中就可以使用这个类了：<br>　　a = array.new()&nbsp;&nbsp;-- 创建对象，相当于 a = new Myarray<br>　　a[1] = 10&nbsp;&nbsp;-- 调用__newindex，也就是C++中的 a->setvalue(1, 10)<br>　　a[2] = 20&nbsp;&nbsp;-- 调用__newindex，也就是C++中的 a->setvalue(2, 20)<br>　　print(<br>　　　　a,&nbsp;&nbsp;-- 调用 __tostring，也就是C++中的 a->ToString()<br>　　　　a:size(), -- 相当于C++中的 a->size()<br>　　　　a[1], -- 调用__getindex，也就是C++中的a->getvalue(1)<br>　　　　a[2]) --调用__getindex，也就是C++中的a->getvalue(2)<br>　　array.del(a)&nbsp;&nbsp;-- 清除对象，相当于 delete a<br>　　a = nil&nbsp;&nbsp;-- 清空 a，很象C++中的 a = NULL<br><br>　　当然，你也可以不用del这个对象，而是等待Lua帮你自动进行垃圾回收。在Lua进行垃圾回收时，它会自动调用这个对象的 __gc ，相当于 delete。<br><br>　　那么，在C++中要创建MyArray对象，并且传递给Lua全局变量怎么办？就象前面讲过的一样，使用SetGlobal：<br>　　MyArray* a = new MyArray;<br>　　lua.SetGlobal("a", a);<br>　　要获取该对象，同样的，应该使用GetGlobal：<br>　　MyArray* a = lua.GetGlobal&lt;MyArray>("a");<br>　　<br>　　对于传递给Lua的对象，就让Lua来管理该对象的生存周期好了。如果你非要删除它的话，你可以使用DelGlobalObject：<br>　　lua.DelGlobalObject&lt;MyArray>("a");<br>　　不过这么做的话，你应当明白你在做什么，因为在Lua的脚本中，可能已经在多处引用了这个对象了。删除了其中一个，将导致其它引用对象失效，从而可能引致系统崩溃。<br><br>　　(1)&nbsp;&nbsp;DEFINE_TYPENAME("My.array");<br>　　　　定义类型的名称。在Lua中，这个类型名称是唯一用来识别C++类型的，你必须为不同的对象给予不同的名称。<br><br>　　(2)&nbsp;&nbsp;BEGIN_REGLUALIB("array") … END_REGLUALIB()<br>　　　　你可以为一个对象定义一个程序库，"array"就是程序库的名字。在程序库中定义的函数是全局函数，在Lua中，使用该函数，需要在函数前加上库的名字，如：array.new（）。通常，程序库会包含创建对象的方法。如：<br>　　　　LUALIB_ITEM_create("new", MyArray )&nbsp;&nbsp;// 创建MyArray (注：由于发表的原因，create应为全部大写)<br>　　　　这样子，你才能在Lua中创建MyArray：<br>　　　　a = array.new()<br>　　<br>　　　　你也可以选择增加一个删除对象操作：<br>　　　　LUALIB_ITEM_DESTROY("del", MyArray ) &nbsp;&nbsp;// 删除MyArray<br>　　　　这样，你就可以直接删除一个对象了：<br>　　　　array.del(a)<br><br>　　(3)&nbsp;&nbsp;BEGIN_REGLUALIB_MEMBER() …END_REGLUALIB_MEMBER()<br>　　　　在此处，你可以定义对象的成员函数，也可以重载对象的操作符——是的，就象C++的operator重载。例如：<br>　　　　LUALIB_ITEM_FUNC("__newindex", void (MyArray*, int, double), &amp;MyArray::setvalue)<br>　　　　就是重载 operator[] 操作符。Lua中可重载的操作符还有许多，如：<br><br>　　　　__getindex：操作符[]，支持读取访问，如 v = a[10]<br>　　　　__newindex：操作符[]，支持赋值访问，如 a[10] = 1.22<br>　　　　__tostring：将变量转换成字串__add：等同于operator +<br>　　　　__add：操作符 ＋<br>　　　　__sub：操作符 –<br>　　　　__mul：操作符 ×<br>　　　　__div：操作符 ÷<br>　　　　__pow：操作符 ^ (乘方)<br>　　　　__unm：一元操作符 –<br>　　　　__concat：操作符 .. (字符串连接)<br>　　　　__eq：操作符 == (a ~= b等价于 not a == b)<br>　　　　__lt：操作符 &lt; (a > b 等价于 b &lt; a)<br>　　　　__le：操作符 &lt;= (a >= b 等价于 b &lt;= a，要注意的是，如果没有定义"__le"，则Lua将会尝试将a&lt;=b 转换成 not (b &lt; a) )<br><br>　　　　__gc：在垃圾回收时调用此函数，相当于C++的析构函数。强烈建议定义此操作符，以免造成内存泄漏等情况。比如：<br>　　　　LUALIB_ITEM_DESTROY("__gc", MyArray ) &nbsp;&nbsp;// 垃圾收集时消除对象用。<br><br>　　　　(注) 这里要说明一下，在lua中，访问索引操作符是__index，不是__getindex，在luaWrapper库中，为了方便使用，将其映射为__getindex，同时，对__index的定义将会被忽略。<br><br>　　　　就这么简单。假如你已经有现成的类，而你没有修改该类的权力，如何将其加入到Lua中呢？答案就是，继承它，将把派生类加入到Lua中。<br><br>结束语<br>　　LuaWrapper 需要用到boost库的支持：boost/type_traits.hpp, boost/function.hpp, boost/bind.hpp，它使用了C++的模板部份特化，因此，C++编译器如果不支持此特性，将无法编译。目前支持此特性的编译器已经有很多。在VisualStudo产品系列中，只有VC7.1能支持此特性，因此，您如果正在使用VisualStudio，请确认你用的是VisualStudio2003。<br>　　如果你觉得 LuaWrapper For C++ 能够帮助你，我会感觉很荣幸。我很愿意将这个程序库分享给大家。顺便一提的是，如果你在使用过程中发现BUG，或是有好的建议，希望您能与我联系。你在使用过程中，请不要删除文件中的署名信息；如果你修改了程序库，请您在修改的文件中加入您的修改说明。当然，我会非常欢迎您能将修改后的程序回馈给我。我会继续优化并完善它。<br><br>=============================================================<br><br><a href=http://www.d2-life.com/lbs/attachments/month_200407/22_1xp4LuaWrapper.zip><img src=http://www.d2-life.com/lbs/images/icon_save.gif align=absMiddle border=0><b>File:</b> Click Here Download: LuaWrapper For C++</a><br><a href=http://www.d2-life.com/lbs/attachments/month_200407/22_85waTestLua.zip><img src=http://www.d2-life.com/lbs/images/icon_save.gif align=absMiddle border=0><b>File:</b> Click Here Download: LuaWrapper test program</a><br><br>=============================================================</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/integrate-lua-in-cpp-luawrapper/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/a-real-computer-geek/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="真正的电脑高手"><meta itemprop=description content="
很久以前，那还是我用win98的时候有次我系统崩溃了，因为我是电脑白吃，我朋友给我介绍了一个高手来帮我修电脑。

他看了一下电脑，问我有没有98的盘，我说没有。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/a-real-computer-geek/ itemprop=url class=post-title-link>真正的电脑高手</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月18日 09:36:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-18 09:36:00 +0800 +0800">2007年09月18日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/capricethink/ itemprop=url rel=index><span itemprop=name>CapriceThink</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/a-real-computer-geek/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><ol><li>很久以前，那还是我用win98的时候有次我系统崩溃了，因为我是电脑白吃，我朋友给我介绍了一个高手来帮我修电脑。</li></ol><p>他看了一下电脑，问我有没有98的盘，我说没有。</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/a-real-computer-geek/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/how-to-focus-attention/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="如何集中注意力"><meta itemprop=description content="注意力的集中作为一种特殊的素质和能力，需要通过训练来获得。那么，训练自己注意力、提高自己专心致志素质的方法有哪些呢？  方法之一：运用积极目标的力量           这种方法的含义是什么？就是当你给自己设定了一个要自觉提高自己注意力和专心能力的目标时，你就会发现，你在非常短的时间内，集中注意力这种能力有了迅速的发展和变化。           同学们要在训练中完成这个进步。要有一个目标，就是从现在开始我比过去善于集中注意力。不论做任何事情，一旦进入，能够迅速地不受干扰。这是非常重要的。比如，你今天如果对自己有这个要求，我要在高度注意力集中的情况下，将这一讲的内容基本上一次都记忆下来。当你有了这样一个训练目标时，你的注意力本身就会高度集中，你就会排除干扰。           同学们知道，在军事上把兵力漫无目的地分散开，被敌人各个围歼，是败军之将。这与我们在学习、工作和事业中一样，将自己的精力漫无目标地散漫一片，永远是一个失败的人物。学会在需要的任何时候将自己的力量集中起来，注意力集中起来，这是一个成功者的天才品质。培养这种品质的第一个方法，是要有这样的目标。  方法之二：培养对专心素质的兴趣           有了这种兴趣，你们就会给自己设置很多训练的科目，训练的方式，训练的手段。你们就会在很短的时间内，甚至完全有可能通过一个暑期的自我训练，发现自己和书上所赞扬的那些大科学家、大思想家、大文学家、大政治家、大军事家一样，有了令人称赞的注意力集中的能力。           同学们在休息和玩耍中可以散漫自在，一旦开始做一件事情，如何迅速集中自己的注意力，这是一个才能。就像一个军事家迅速集中自己的兵力，在一个点上歼灭敌人，这是军事天才。我们知道，在军事上，要集中自己的兵力而不被敌人觉察，要战胜各种空间、地理、时间的困难，要战胜军队的疲劳状态，要调动方方面面的因素，需要各种集中兵力的具体手段。同学们集中自己的精力，注意力，也要掌握各种各样的手段。这些都值得探讨，是很有兴趣的事情。  方法之三：要有对专心素质的自信           千万不要受自己和他人的不良暗示。有的家长从小就这样说孩子：我的孩子注意力不集中。在很多场合都听到家长说：我的孩子上课时精力不集中。有的同学自己可能也这样认为。不要这样认为，因为这种状态可以改变。           如果你现在比较善于集中注意力，那么，肯定那些天才的科学家、思想家、事业家、艺术家在这方面还有值得你学习的地方，你还有不及他们的差距，你就要想办法超过他们。           对于绝大多数同学，只要你有这个自信心，相信自己可以具备迅速提高注意力集中的能力，能够掌握专心这样一种方法，你就能具备这种素质。我们都是正常人、健康人，只要我们下定决心，不受干扰，排除干扰，我们肯定可以做到高度的注意力集中。希望同学们对自己实行训练。经过这样的训练，能够发生一个飞跃。  方法之四：善于排除外界干扰           要在排除干扰中训练排除干扰的能力。毛泽东在年轻的时候为了训练自己注意力集中的能力，曾经给自己立下这样一个训练科目，到城门洞里、车水马龙之处读书。为了什么？就是为了训练自己的抗干扰能力。同学们一定知道，一些优秀的军事家在炮火连天的情况下，依然能够非常沉静地、注意力高度集中地在指挥中心判断战略战术的选择和取向。生死的危险就悬在头上，可是还要能够排除这种威胁对你的干扰，来判断军事上如何部署。这种抗拒环境干扰的能力，需要训练。           我在你们这么大的年纪时曾有意做过这种训练。就是不管环境多么嘈杂，当我进入我要阅读和学习的科目时，对周围的一切因素置若罔闻。这是可以训练成功的。  方法之五：善于排除内心的干扰           在这里要排除的不是环境的干扰，而是内心的干扰。环境可能很安静，在课堂上，周围的同学都坐得很好，但是，自己内心可能有一种骚动，有一种干扰自己的情绪活动，有一种与这个学习不相关的兴奋。对各种各样的情绪活动，要善于将它们放下来，予以排除。这时候，同学们要学会将自己的身体坐端正，将身体放松下来，将整个面部表情放松下来，也就是将内心各种情绪的干扰随同这个身体的放松都放到一边。常常内心的干扰比环境的干扰更严重。"></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/how-to-focus-attention/ itemprop=url class=post-title-link>如何集中注意力</a></h2><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年09月17日 11:19:00 CST" itemprop="dateCreated datePublished" datetime="2007-09-17 11:19:00 +0800 +0800">2007年09月17日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年09月17日 11:20:00 CST" itemprop="dateModified dateLastmod" datetime="2007-09-17 11:20:00 +0800 +0800">2007年09月17日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/capricethink/ itemprop=url rel=index><span itemprop=name>CapriceThink</span>
</a></span></span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/how-to-focus-attention/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p>注意力的集中作为一种特殊的素质和能力，需要通过训练来获得。那么，训练自己注意力、提高自己专心致志素质的方法有哪些呢？  <br><br><strong>方法之一：运用积极目标的力量</strong>  <br><br>         这种方法的含义是什么？就是当你给自己设定了一个要自觉提高自己注意力和专心能力的目标时，你就会发现，你在非常短的时间内，集中注意力这种能力有了迅速的发展和变化。  <br><br>         同学们要在训练中完成这个进步。要有一个目标，就是从现在开始我比过去善于集中注意力。不论做任何事情，一旦进入，能够迅速地不受干扰。这是非常重要的。比如，你今天如果对自己有这个要求，我要在高度注意力集中的情况下，将这一讲的内容基本上一次都记忆下来。当你有了这样一个训练目标时，你的注意力本身就会高度集中，你就会排除干扰。  <br><br>         同学们知道，在军事上把兵力漫无目的地分散开，被敌人各个围歼，是败军之将。这与我们在学习、工作和事业中一样，将自己的精力漫无目标地散漫一片，永远是一个失败的人物。学会在需要的任何时候将自己的力量集中起来，注意力集中起来，这是一个成功者的天才品质。培养这种品质的第一个方法，是要有这样的目标。  <br><br><strong>方法之二：培养对专心素质的兴趣</strong>  <br><br>         有了这种兴趣，你们就会给自己设置很多训练的科目，训练的方式，训练的手段。你们就会在很短的时间内，甚至完全有可能通过一个暑期的自我训练，发现自己和书上所赞扬的那些大科学家、大思想家、大文学家、大政治家、大军事家一样，有了令人称赞的注意力集中的能力。  <br><br>         同学们在休息和玩耍中可以散漫自在，一旦开始做一件事情，如何迅速集中自己的注意力，这是一个才能。就像一个军事家迅速集中自己的兵力，在一个点上歼灭敌人，这是军事天才。我们知道，在军事上，要集中自己的兵力而不被敌人觉察，要战胜各种空间、地理、时间的困难，要战胜军队的疲劳状态，要调动方方面面的因素，需要各种集中兵力的具体手段。同学们集中自己的精力，注意力，也要掌握各种各样的手段。这些都值得探讨，是很有兴趣的事情。  <br><br><strong>方法之三：要有对专心素质的自信</strong>  <br><br>         千万不要受自己和他人的不良暗示。有的家长从小就这样说孩子：我的孩子注意力不集中。在很多场合都听到家长说：我的孩子上课时精力不集中。有的同学自己可能也这样认为。不要这样认为，因为这种状态可以改变。  <br><br>         如果你现在比较善于集中注意力，那么，肯定那些天才的科学家、思想家、事业家、艺术家在这方面还有值得你学习的地方，你还有不及他们的差距，你就要想办法超过他们。  <br><br>         对于绝大多数同学，只要你有这个自信心，相信自己可以具备迅速提高注意力集中的能力，能够掌握专心这样一种方法，你就能具备这种素质。我们都是正常人、健康人，只要我们下定决心，不受干扰，排除干扰，我们肯定可以做到高度的注意力集中。希望同学们对自己实行训练。经过这样的训练，能够发生一个飞跃。  <br><br><strong>方法之四：善于排除外界干扰</strong>  <br><br>         要在排除干扰中训练排除干扰的能力。毛泽东在年轻的时候为了训练自己注意力集中的能力，曾经给自己立下这样一个训练科目，到城门洞里、车水马龙之处读书。为了什么？就是为了训练自己的抗干扰能力。同学们一定知道，一些优秀的军事家在炮火连天的情况下，依然能够非常沉静地、注意力高度集中地在指挥中心判断战略战术的选择和取向。生死的危险就悬在头上，可是还要能够排除这种威胁对你的干扰，来判断军事上如何部署。这种抗拒环境干扰的能力，需要训练。  <br><br>         我在你们这么大的年纪时曾有意做过这种训练。就是不管环境多么嘈杂，当我进入我要阅读和学习的科目时，对周围的一切因素置若罔闻。这是可以训练成功的。  <br><br><strong>方法之五：善于排除内心的干扰</strong>  <br><br>         在这里要排除的不是环境的干扰，而是内心的干扰。环境可能很安静，在课堂上，周围的同学都坐得很好，但是，自己内心可能有一种骚动，有一种干扰自己的情绪活动，有一种与这个学习不相关的兴奋。对各种各样的情绪活动，要善于将它们放下来，予以排除。这时候，同学们要学会将自己的身体坐端正，将身体放松下来，将整个面部表情放松下来，也就是将内心各种情绪的干扰随同这个身体的放松都放到一边。常常内心的干扰比环境的干扰更严重。</p></div><footer class=post-footer><div class=post-button><a class=btn href=/post/how-to-focus-attention/#more rel=contents>阅读全文 &#187;</a></div><div class=post-eof></div></footer></article></div><nav class=pagination><a class="extend prev" rel=prev href=/post/page/47/><i class="fa fa-angle-left"></i>
</a><a class=page-number href=/post/page/44/>44</a>
<a class=page-number href=/post/page/45/>45</a>
<a class=page-number href=/post/page/46/>46</a>
<a class=page-number href=/post/page/47/>47</a>
<span class="page-number current">48</span>
<a class=page-number href=/post/page/49/>49</a>
<a class=page-number href=/post/page/50/>50</a>
<a class=page-number href=/post/page/51/>51</a>
<a class=page-number href=/post/page/52/>52</a>
<a class="extend next" rel=next href=/post/page/49/><i class="fa fa-angle-right"></i></a></nav></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2026
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.157.0 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":false,"path":"post","permalink":"https://blogs.qipai360.cn/post/","title":"Posts","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1772265585" defer></script></body></html>