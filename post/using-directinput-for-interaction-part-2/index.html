<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.157.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="使用DirectInput进行交互（2）"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="使用DirectInput进行交互（2）"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/using-directinput-for-interaction-part-2/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2007-07-24 21:50:00 +0800 +0800"><meta property="article:modified_time" content="2007-08-27 17:20:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1772265590"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>使用DirectInput进行交互（2） - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>679</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>679</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>35</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>118</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2423147></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5207></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2026-02-28 15:59:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/using-directinput-for-interaction-part-2/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="使用DirectInput进行交互（2）"><meta itemprop=description content="设置数据格式每种设备都有一种用于读取数据的特定数据格式，需要考虑的东西也很多，包括键、鼠标按键、轴等。因此要使程序从设备读取数据，首先必须告诉DirectInput读取这种数据所采用的格式。通过 IDirectInputDevice8::SetDataFormat函数即可满足上述要求。Sets the data format for the Microsoft DirectInput device.SyntaxHRESULT SetDataFormat(LPCDIDATAFORMAT lpdf);ParameterslpdfAddress of a structure that describes the format of the data that the DirectInputDevice should return. An application can define its own DIDATAFORMAT structure or use one of the following predefined global variables: c_dfDIKeyboardc_dfDIMousec_dfDIMouse2c_dfDIJoystickc_dfDIJoystick2Return ValueIf the method succeeds, the return value is DI_OK.If the method fails, the return value can be one of the following error values:DIERR_ACQUIRED The operation cannot be performed while the device is acquired.DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value.DIERR_NOTINITIALIZED The object has not been initialized.RemarksThe data format must be set before the device can be acquired by using the IDirectInputDevice8::Acquire method. It is necessary to set the data format only once. The data format cannot be changed while the device is acquired.If the application is using action mapping, the data format is set instead by the call to IDirectInputDevice8::SetActionMap.SetDataFormat函数只有一个参数，这个参数是一个指向DIDATAFORMAT结构体的指针，此结构体的定义如下：Describes a device&rsquo;s data format. This structure is used with the IDirectInputDevice8::SetDataFormat method.Syntaxtypedef struct DIDATAFORMAT {     DWORD dwSize;     DWORD dwObjSize;     DWORD dwFlags;     DWORD dwDataSize;     DWORD dwNumObjs;     LPDIOBJECTDATAFORMAT rgodf; } DIDATAFORMAT, *LPDIDATAFORMAT; typedef const DIDATAFORMAT *LPCDIDATAFORMAT;MembersdwSizeSize of this structure, in bytes. dwObjSizeSize of the DIOBJECTDATAFORMAT structure, in bytes. dwFlagsFlags describing other attributes of the data format. This value can be one of the following: DIDF_ABSAXISThe axes are in absolute mode. Setting this flag in the data format is equivalent to manually setting the axis mode property, using the IDirectInputDevice8::SetProperty method. This cannot be combined with DIDF_RELAXIS flag. DIDF_RELAXISThe axes are in relative mode. Setting this flag in the data format is equivalent to manually setting the axis mode property using the IDirectInputDevice8::SetProperty method. This cannot be combined with the DIDF_ABSAXIS flag. dwDataSizeSize of a data packet returned by the device, in bytes. This value must be a multiple of 4 and must exceed the largest offset value for an object&rsquo;s data within the data packet. dwNumObjsNumber of objects in the rgodf array.rgodfAddress to an array of DIOBJECTDATAFORMAT structures. Each structure describes how one object&rsquo;s data should be reported in the device data. Typical errors include placing two pieces of information in the same location and placing one piece of information in more than one location. RemarksApplications do not typically need to create a DIDATAFORMAT structure. An application can use one of the predefined global data format variables, c_dfDIMouse, c_dfDIMouse2, c_dfDIKeyboard, c_dfDIJoystick, or c_dfDIJoystick2.Applications that need to create a DIDATAFORMAT structure must first call IDirectInputDevice8::EnumObjects to determine the available objects for the current device. This is because the IDirectInputDevice8::SetDataFormat method will return DIERR_INVALIDPARAM if an an object is described in the DIDATAFORMAT structure but does not exist on the current device.设置协作级别首先必须面对一个事实，那就是每个程序都会使用许多输入设备。几乎每个程序都会使用键盘和鼠标，同时某些程序还会使用游戏杆。在处理的时候，必须同其他可能仍在运行的应用程序共享对这些设备的访问，或者应用程序独占对设备的所有访问，这样除非该应用程序结束了对设备的访问，否则就不允许其他应用程序控制这些设备。设置协作级别的函数是IDirectInputDevice8::SetCooperativeLevel。Establishes the cooperative level for this instance of the device. The cooperative level determines how this instance of the device interacts with other instances of the device and the rest of the system.SyntaxHRESULT SetCooperativeLevel(HWND hwnd,    DWORD dwFlags);ParametershwndWindow handle to be associated with the device. This parameter must be a valid top-level window handle that belongs to the process. The window associated with the device must not be destroyed while it is still active in a Microsoft DirectInput device. dwFlagsFlags that describe the cooperative level associated with the device. The following flags are defined: DISCL_BACKGROUNDThe application requires background access. If background access is granted, the device can be acquired at any time, even when the associated window is not the active window. DISCL_EXCLUSIVEThe application requires exclusive access. If exclusive access is granted, no other instance of the device can obtain exclusive access to the device while it is acquired. However, nonexclusive access to the device is always permitted, even if another application has obtained exclusive access. An application that acquires the mouse or keyboard device in exclusive mode should always unacquire the devices when it receives WM_ENTERSIZEMOVE and WM_ENTERMENULOOP messages. Otherwise, the user cannot manipulate the menu or move and resize the window. DISCL_FOREGROUNDThe application requires foreground access. If foreground access is granted, the device is automatically unacquired when the associated window moves to the background. DISCL_NONEXCLUSIVEThe application requires nonexclusive access. Access to the device does not interfere with other applications that are accessing the same device. DISCL_NOWINKEYDisable the Microsoft Windows logo key. Setting this flag ensures that the user cannot inadvertently break out of the application. Note, however, that DISCL_NOWINKEY has no effect when the default action mapping user interface (UI) is displayed, and the Windows logo key will operate normally as long as that UI is present. Return ValueIf the method succeeds, the return value is DI_OK.If the method fails, the return value can be one of the following error values:DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value. DIERR_NOTINITIALIZED The object has not been initialized. E_HANDLE The HWND parameter is not a valid top-level window that belongs to the process. RemarksApplications must specify either DISCL_FOREGROUND or DISCL_BACKGROUND; it is an error to specify both or neither. Similarly, applications must specify either DISCL_EXCLUSIVE or DISCL_NONEXCLUSIVE.If the system mouse is acquired in exclusive mode, the pointer is removed from the screen until the device is unacquired. This applies only to a mouse created by passing GUID_SysMouse to IDirectInput8::CreateDevice.Applications that select the background exclusive mode cooperative level are not guaranteed to retain access to the device if another application requests exclusive access. When a background exclusive mode application loses access, calls to DirectInput device methods will fail and return DIERR_NOTACQUIRED. The application can regain access to the device by manually unacquiring the device and reaquiring it.Applications must call this method before acquiring the device by using the IDirectInputDevice8::Acquire method.设置特殊属性设置设备的特殊属性，包括轴模式（axis mode），缓冲区（buffering）以及最大最小范围。对于轴模式，有两个选择：相对和绝对。绝对模式基于一个中心坐标来报告坐标。位于这个点左边或上面的值都报告成负值，同时位于这个点右边或下面的值都报告成正值。相对坐标就是当前位置同上一个位置之间的距离差。最后一个特殊性属性是设备的最小和最大范围设置。举例来说，将游戏杆推动到最左边就会产生最小值，而推动到最右边就会产生最大值。这两边产生何种值取决于具体的设置，只有游戏杆才会涉及到最小和最大范围设置。用于设置特殊属性的函数是 IDirectInputDevice8::SetProperty。Sets properties that define the device behavior. These properties include input buffer size and axis mode.SyntaxHRESULT SetProperty(REFGUID rguidProp,    LPCDIPROPHEADER pdiph);ParametersrguidPropReference to (C++) or address of (C) the globally unique identifier (GUID) identifying the property to be set. This can be one of the predefined values, or a pointer to a GUID that identifies the property. The following property values are predefined for an input device: DIPROP_APPDATASets the application-defined value associated with an in-game action, as a DIPROPPOINTER. DIPROP_AUTOCENTERSpecifies whether device objects are self centering. This setting applies to the entire device, rather than to any particular object, so the dwHow member of the associated DIPROPDWORD structure must be DIPH_DEVICE. The dwData member can be one of the following values. DIPROPAUTOCENTER_OFF: The device should not automatically center when the user releases the device. An application that uses force feedback should disable autocentering before playing effects. DIPROPAUTOCENTER_ON: The device should automatically center when the user releases the device. Not all devices support the autocenter property. DIPROP_AXISMODESets the axis mode. The value being set (DIPROPAXISMODE_ABS or DIPROPAXISMODE_REL) must be specified in the dwData member of the associated DIPROPDWORD structure. See the description of the pdiph parameter for more information. This setting applies to the entire device, so the dwHow member of the associated DIPROPDWORD structure must be set to DIPH_DEVICE. DIPROP_BUFFERSIZESets the input buffer size. The value being set must be specified in the dwData member of the associated DIPROPDWORD structure. See Remarks. This setting applies to the entire device, so the dwHow member of the associated DIPROPDWORD structure must be set to DIPH_DEVICE. DIPROP_CALIBRATIONPredefined property that allows the application to access the information that Microsoft DirectInput uses to manipulate axes that require calibration. This property exists primarily for applications of the control panel type. Normal applications should not need to deal with calibration information. You can access the calibration mode property for an axis by setting the dwHow member of the DIPROPHEADER structure to DIPH_BYID or to DIPH_BYOFFSET and setting the dwObj member to the object identifier (ID) or offset, respectively. Control panel applications that set new calibration data must also invoke the IDirectInputJoyConfig::SendNotify method to notify other applications of the change in calibration. For more information about IDirectInputJoyConfig::SendNotify, see the Microsoft DirectX Driver Development Kit (DDK). DIPROP_CALIBRATIONMODEEnables the application to specify whether DirectInput should retrieve calibrated or uncalibrated data from an axis. By default, DirectInput retrieves calibrated data. Setting the calibration mode for the entire device is equivalent to setting it for each axis individually. The dwData member of the DIPROPDWORD structure can be one of the following values: DIPROPCALIBRATIONMODE_COOKED: DirectInput should return data after applying calibration information. This is the default mode. DIPROPCALIBRATIONMODE_RAW: DirectInput should return raw, uncalibrated data. This mode is typically used only by applications of the control panel type. Note that raw data might include negative values. Setting a device into raw mode causes the dead zone, saturation, and range settings to be ignored. DIPROP_CPOINTSSets calibration points used for the adjustment of incoming raw data. The values being set must be specified as CPOINT types in the cp array of the associated DIPROPCPOINTS structure. This setting applies to individual device objects, so the dwHow member of the associated DIPROPHEADER structure must be set to either DIPH_BYID or DIPH_BYOFFSET. DIPROP_DEADZONESets the value for the dead zone of a joystick, in the range from 0 through 10,000, where 0 indicates that there is no dead zone, 5,000 indicates that the dead zone extends over 50 percent of the physical range of the axis on both sides of center, and 10,000 indicates that the entire physical range of the axis is dead. When the axis is within the dead zone, it is reported as being at the center of its range. This setting can be applied to either the entire device or to a specific axis. DIPROP_FFGAINSets the gain for the device. This setting applies to the entire device, rather than to any particular object, so the dwHow member of the associated DIPROPDWORD structure must be DIPH_DEVICE. The dwData member contains a gain value that is applied to all effects created on the device. The value is an integer in the range from 0 through 10,000, specifying the amount by which effect magnitudes should be scaled for the device. For example, a value of 10,000 indicates that all effect magnitudes are to be taken at face value. A value of 9,000 indicates that all effect magnitudes are to be reduced to 90 percent of their nominal magnitudes. DirectInput always checks the gain value before setting the gain property. If the gain is outside of the range (less than zero or greater than 10,000), IDirectInputDevice8::SetProperty will return DIERR_INVALIDPARAM. Otherwise, if successful, it will return DI_OK, even if the device does not support force feedback.Setting a gain value is useful when an application wants to scale down the strength of all force-feedback effects uniformly, based on user preferences. Unlike other properties, the gain can be set when the device is in an acquired state. DIPROP_INSTANCENAMEThis property exists for advanced applications that want to change the friendly instance name of a device (as returned in the tszInstanceName member of the DIDEVICEINSTANCE structure) to distinguish it from similar devices that are plugged in simultaneously. Most applications should have no need to change the friendly name. This setting applies to the entire device, so the dwHow member of the associated DIPROPDWORD structure must be set to DIPH_DEVICE. The pdiph parameter must be a pointer to the diph member of a DIPROPSTRING structure. DIPROP_PRODUCTNAMEThis property exists for advanced applications that want to change the friendly product name of a device (as returned in the tszProductName member of the DIDEVICEINSTANCE structure) to distinguish it from similar devices which are plugged in simultaneously. Most applications should have no need to change the friendly name. This setting applies to the entire device, so the dwHow member of the associated DIPROPDWORD structure must be set to DIPH_DEVICE. The pdiph parameter must be a pointer to the diph member of a DIPROPSTRING structure. Setting the product name is only useful for changing the user-defined name of an analog joystick on Microsoft Windows 98,Windows 2000, and Windows Millennium Edition (Windows Me) computers. In other cases, attempting to set this property will still return DI_OK. However, the name is not stored in a location used by IDirectInputDevice8::GetProperty. DIPROP_RANGESets the range of values an object can possibly report. The minimum and maximum values are taken from the lMin and lMax members of the associated DIPROPRANGE structure. For some devices, this is a read-only property. You cannot set a reverse range; lMax must be greater than lMin. DIPROP_SATURATIONSets the value for the saturation zones of a joystick, in the range from 0 through 10,000. The saturation level is the point at which the axis is considered to be at its most extreme position. For example, if the saturation level is set to 9,500, the axis reaches the extreme of its range when it has moved 95 percent of the physical distance from its center position (or from the dead zone). This setting can be applied to either the entire device or a specific axis. pdiphAddress of the DIPROPHEADER structure contained within the type-specific property structure. Return ValueIf the method succeeds, the return value is DI_OK or DI_PROPNOEFFECT.If the method fails, the return value can be one of the following error values.DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value. DIERR_NOTINITIALIZED The object has not been initialized. DIERR_OBJECTNOTFOUND The requested object does not exist. DIERR_UNSUPPORTED The function called is not supported at this time. This value is equal to the E_NOTIMPL standard COM return value. RemarksThe buffer size determines the amount of data that the buffer can hold between calls to the IDirectInputDevice8::GetDeviceData method before data is lost. This value may be set to 0 to indicate that the application does not read buffered data from the device. If the buffer size in the dwData member of the DIPROPDWORD structure is too large for the device to support it, then the largest possible buffer size is set. 在调用SetProperty函数时始终要使用的DIPROPHEADER结构体定义如下：Serves as a header for all property structures.Syntaxtypedef struct DIPROPHEADER {     DWORD    dwSize;     DWORD    dwHeaderSize;     DWORD    dwObj;     DWORD    dwHow; } DIPROPHEADER, *LPDIPROPHEADER;  typedef const DIPROPHEADER *LPCDIPROPHEADER;MembersdwSizeSize of the enclosing structure. This member must be initialized before the structure is used. dwHeaderSizeSize of the DIPROPHEADER structure. dwObjObject for which the property is to be accessed. The value set for this member depends on the value specified in the dwHow member.dwHowValue that specifies how the dwObj member should be interpreted. This value can be one of the following: DIPH_DEVICEThe dwObj member must be 0. DIPH_BYOFFSETThe dwObj member is the offset into the current data format of the object whose property is being accessed. DIPH_BYUSAGEThe dwObj member is the HID usage page and usage values in packed form. DIPH_BYIDThe dwObj member is the object type/instance identifier. This identifier is returned in the dwType member of the DIDEVICEOBJECTINSTANCE structure returned from a previous call to the IDirectInputDevice8::EnumObjects member. 获得设备在使用任何设备之前，首先必须获得设备。只有获得了设备才能确保程序能够访问设备，以及同其他程序共享访问还是完全控制设备。要注意的是其他程序可能会争夺并抢走对设备的控制权，要补救这种情况就必须重新获得设备。何时必须获得设备？第一种情况就是在创建接口的时候，原因在于使用设备之前必须首先获得它。另一种情况就是当另一个程序抢走了对设备的控制，同时 DirectInput通知了程序时。调用IDirectInputDevice8::Acquire函数即可获得设备。Obtains access to the input device.SyntaxHRESULT Acquire(VOID);Return ValueIf the method succeeds, the return value is DI_OK, or S_FALSE if the device was already acquired.If the method fails, the return value can be one of the following error values.DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value. DIERR_NOTINITIALIZED The object has not been initialized. DIERR_OTHERAPPHASPRIO Another application has a higher priority level, preventing this call from succeeding. This value is equal to the E_ACCESSDENIED standard COM return value. This error can be returned when an application has only foreground access to a device but is attempting to acquire the device while in the background. RemarksBefore a device can be acquired, a data format must be set by using the IDirectInputDevice8::SetDataFormat method or IDirectInputDevice8::SetActionMap method. If the data format has not been set, IDirectInputDevice8::Acquire returns DIERR_INVALIDPARAM.Devices must be acquired before calling the IDirectInputDevice8::GetDeviceState or IDirectInputDevice8::GetDeviceData methods for that device.Device acquisition does not use a reference count. Therefore, if an application calls the IDirectInputDevice8::Acquire method twice, then calls the IDirectInputDevice8::Unacquire method once, the device is unacquired.If IDirectInputDevice8::BuildActionMap succeeds but no actions have been mapped, a subsequent call to IDirectInputDevice8::SetActionMap will return DI_OK but a call to IDirectInputDevice8::Acquire will fail with DIERR_INVALIDPARAM.轮询设备轮询可以准备设备并在合适的情况下读取设备数据，因为数据可能具有临界时间。游戏杆就是这样的设备，要从设备读取数据，计算机需要发送一个电子脉冲给它。虽然轮询对于游戏杆输入而言是必须的，但是对键盘或鼠标来说却并不需要轮询。轮询设备需要使用IDirectInputDevice8::Poll函数。Retrieves data from polled objects on a Microsoft DirectInput device. If the device does not require polling, calling this method has no effect. If a device that requires polling is not polled periodically, no new data is received from the device. Calling this method causes DirectInput to update the device state, generate input events (if buffered data is enabled), and set notification events (if notification is enabled).SyntaxHRESULT Poll(VOID);Return ValueIf the method succeeds, the return value is DI_OK, or DI_NOEFFECT if the device does not require polling.If the method fails, the return value can be one of the following error values:DIERR_INPUTLOST Access to the input device has been lost. It must be reacquired. DIERR_NOTACQUIRED The operation cannot be performed unless the device is acquired. DIERR_NOTINITIALIZED The object has not been initialized. RemarksBefore a device data can be polled, the data format must be set by using the IDirectInputDevice8::SetDataFormat or IDirectInputDevice8::SetActionMap method, and the device must be acquired by using the IDirectInputDevice8::Acquire method.读取数据经过以上的步骤，就剩下最后一步了，那就是使用 IDirectInputDevice8::GetDeviceState函数读取设备数据。为了存储设备的信息，必须传递一个数据缓冲区给此函数，这样程序才能使用设备的信息，每种设备的数据各不相同。Retrieves immediate data from the device.SyntaxHRESULT GetDeviceState(DWORD cbData,    LPVOID lpvData);ParameterscbDataSize of the buffer in the lpvData parameter, in bytes. lpvDataAddress of a structure that receives the current state of the device. The format of the data is established by a prior call to the IDirectInputDevice8::SetDataFormat method. Return ValueIf the method succeeds, the return value is DI_OK.If the method fails, the return value can be one of the following error values:DIERR_INPUTLOST Access to the input device has been lost. It must be reacquired. DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value. DIERR_NOTACQUIRED The operation cannot be performed unless the device is acquired. DIERR_NOTINITIALIZED The object has not been initialized. E_PENDING Data is not yet available. RemarksBefore device data can be obtained, set the cooperative level by using the IDirectInputDevice8::SetCooperativeLevel method, then set the data format by using IDirectInputDevice8::SetDataFormat, and acquire the device by using the IDirectInputDevice8::Acquire method.The five predefined data formats require corresponding device state structures according to the following table:Data format State structure c_dfDIMouse DIMOUSESTATE c_dfDIMouse2 DIMOUSESTATE2 c_dfDIKeyboard array of 256 bytes c_dfDIJoystick DIJOYSTATE c_dfDIJoystick2 DIJOYSTATE2 For example, if you passed the c_dfDIMouse format to the IDirectInputDevice8::SetDataFormat method, you must pass a DIMOUSESTATE structure to the IDirectInputDevice8::GetDeviceState method.无论是哪种设备，下面的代码都能读取其数据。它们考虑了丢失设备并在适当的时刻重新获得设备的情况，必须传递一个指向缓冲区的指针给下面这个函数，缓冲区的大小要能够保存设备信息以及读取的数据量。"></span><header class=post-header><h1 class=post-title itemprop="name headline">使用DirectInput进行交互（2）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月24日 21:50:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-24 21:50:00 +0800 +0800">2007年07月24日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:20:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:20:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>17464</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>35分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/using-directinput-for-interaction-part-2/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><span style=font-weight:700>设置数据格式</span><br><br>每种设备都有一种用于读取数据的特定数据格式，需要考虑的东西也很多，包括键、鼠标按键、轴等。因此要使程序从设备读取数据，首先必须告诉DirectInput读取这种数据所采用的格式。通过 IDirectInputDevice8::SetDataFormat函数即可满足上述要求。<br><br>Sets the data format for the Microsoft DirectInput device.<br><br><span style=font-weight:700;color:#256429>Syntax</span><br><br>HRESULT SetDataFormat(LPCDIDATAFORMAT lpdf);<br><br><span style=font-weight:700;color:#256429>Parameters</span><br><br>lpdf<br>Address of a structure that describes the format of the data that the DirectInputDevice should return. An application can define its own DIDATAFORMAT structure or use one of the following predefined global variables:<br> <br>c_dfDIKeyboard<br>c_dfDIMouse<br>c_dfDIMouse2<br>c_dfDIJoystick<br>c_dfDIJoystick2<br><br><span style=font-weight:700;color:#256429>Return Value</span><br><br>If the method succeeds, the return value is DI_OK.<br><br>If the method fails, the return value can be one of the following error values:<br><br>DIERR_ACQUIRED The operation cannot be performed while the device is acquired.<br>DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value.<br>DIERR_NOTINITIALIZED The object has not been initialized.<br><br><span style=font-weight:700;color:#256429>Remarks</span><br><br>The data format must be set before the device can be acquired by using the IDirectInputDevice8::Acquire method. It is necessary to set the data format only once. The data format cannot be changed while the device is acquired.<br><br>If the application is using action mapping, the data format is set instead by the call to IDirectInputDevice8::SetActionMap.<br><br>SetDataFormat函数只有一个参数，这个参数是一个指向DIDATAFORMAT结构体的指针，此结构体的定义如下：<br><br>Describes a device&rsquo;s data format. This structure is used with the IDirectInputDevice8::SetDataFormat method.<br><br><span style=font-weight:700;color:#256429>Syntax</span><br><br>typedef struct DIDATAFORMAT {<br>    DWORD dwSize;<br>    DWORD dwObjSize;<br>    DWORD dwFlags;<br>    DWORD dwDataSize;<br>    DWORD dwNumObjs;<br>    LPDIOBJECTDATAFORMAT rgodf;<br>} DIDATAFORMAT, *LPDIDATAFORMAT;<br> <br>typedef const DIDATAFORMAT *LPCDIDATAFORMAT;<br><br><span style=font-weight:700;color:#256429>Members</span><br><br>dwSize<br>Size of this structure, in bytes.<br><br>dwObjSize<br>Size of the DIOBJECTDATAFORMAT structure, in bytes.<br><br>dwFlags<br>Flags describing other attributes of the data format. This value can be one of the following:<br><br>DIDF_ABSAXIS<br>The axes are in absolute mode. Setting this flag in the data format is equivalent to manually setting the axis mode property, using the IDirectInputDevice8::SetProperty method. This cannot be combined with DIDF_RELAXIS flag.<br><br>DIDF_RELAXIS<br>The axes are in relative mode. Setting this flag in the data format is equivalent to manually setting the axis mode property using the IDirectInputDevice8::SetProperty method. This cannot be combined with the DIDF_ABSAXIS flag.<br><br>dwDataSize<br>Size of a data packet returned by the device, in bytes. This value must be a multiple of 4 and must exceed the largest offset value for an object&rsquo;s data within the data packet.<br><br>dwNumObjs<br>Number of objects in the rgodf array.<br><br>rgodf<br>Address to an array of DIOBJECTDATAFORMAT structures. Each structure describes how one object&rsquo;s data should be reported in the device data. Typical errors include placing two pieces of information in the same location and placing one piece of information in more than one location.<br><br><span style=font-weight:700;color:#256429>Remarks</span><br><br>Applications do not typically need to create a DIDATAFORMAT structure. An application can use one of the predefined global data format variables, c_dfDIMouse, c_dfDIMouse2, c_dfDIKeyboard, c_dfDIJoystick, or c_dfDIJoystick2.<br><br>Applications that need to create a DIDATAFORMAT structure must first call IDirectInputDevice8::EnumObjects to determine the available objects for the current device. This is because the IDirectInputDevice8::SetDataFormat method will return DIERR_INVALIDPARAM if an an object is described in the DIDATAFORMAT structure but does not exist on the current device.<br><br><span style=font-weight:700>设置协作级别</span><br><br>首先必须面对一个事实，那就是每个程序都会使用许多输入设备。几乎每个程序都会使用键盘和鼠标，同时某些程序还会使用游戏杆。在处理的时候，必须同其他可能仍在运行的应用程序共享对这些设备的访问，或者应用程序独占对设备的所有访问，这样除非该应用程序结束了对设备的访问，否则就不允许其他应用程序控制这些设备。<br><br>设置协作级别的函数是IDirectInputDevice8::SetCooperativeLevel。<br><br>Establishes the cooperative level for this instance of the device. The cooperative level determines how this instance of the device interacts with other instances of the device and the rest of the system.<br><br><span style=font-weight:700;color:#256429>Syntax</span><br><br>HRESULT SetCooperativeLevel(HWND hwnd,<br>    DWORD dwFlags<br>);<br><br><span style=font-weight:700;color:#256429>Parameters</span><br><br><span style=font-weight:700>hwnd</span><br>Window handle to be associated with the device. This parameter must be a valid top-level window handle that belongs to the process. The window associated with the device must not be destroyed while it is still active in a Microsoft DirectInput device.<br><br><span style=font-weight:700>dwFlags</span><br>Flags that describe the cooperative level associated with the device. The following flags are defined:<br><br>DISCL_BACKGROUND<br>The application requires background access. If background access is granted, the device can be acquired at any time, even when the associated window is not the active window.<br><br>DISCL_EXCLUSIVE<br>The application requires exclusive access. If exclusive access is granted, no other instance of the device can obtain exclusive access to the device while it is acquired. However, nonexclusive access to the device is always permitted, even if another application has obtained exclusive access.<br><br>An application that acquires the mouse or keyboard device in exclusive mode should always unacquire the devices when it receives WM_ENTERSIZEMOVE and WM_ENTERMENULOOP messages. Otherwise, the user cannot manipulate the menu or move and resize the window.<br><br>DISCL_FOREGROUND<br>The application requires foreground access. If foreground access is granted, the device is automatically unacquired when the associated window moves to the background.<br><br>DISCL_NONEXCLUSIVE<br>The application requires nonexclusive access. Access to the device does not interfere with other applications that are accessing the same device.<br><br>DISCL_NOWINKEY<br>Disable the Microsoft Windows logo key. Setting this flag ensures that the user cannot inadvertently break out of the application. Note, however, that DISCL_NOWINKEY has no effect when the default action mapping user interface (UI) is displayed, and the Windows logo key will operate normally as long as that UI is present.<br><br><span style=font-weight:700;color:#256429>Return Value</span><br><br>If the method succeeds, the return value is DI_OK.<br><br>If the method fails, the return value can be one of the following error values:<br><br>DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value.<br>DIERR_NOTINITIALIZED The object has not been initialized.<br>E_HANDLE The HWND parameter is not a valid top-level window that belongs to the process.<br><br><span style=font-weight:700;color:#256429>Remarks</span><br><br>Applications must specify either DISCL_FOREGROUND or DISCL_BACKGROUND; it is an error to specify both or neither. Similarly, applications must specify either DISCL_EXCLUSIVE or DISCL_NONEXCLUSIVE.<br><br>If the system mouse is acquired in exclusive mode, the pointer is removed from the screen until the device is unacquired. This applies only to a mouse created by passing GUID_SysMouse to IDirectInput8::CreateDevice.<br><br>Applications that select the background exclusive mode cooperative level are not guaranteed to retain access to the device if another application requests exclusive access. When a background exclusive mode application loses access, calls to DirectInput device methods will fail and return DIERR_NOTACQUIRED. The application can regain access to the device by manually unacquiring the device and reaquiring it.<br><br>Applications must call this method before acquiring the device by using the IDirectInputDevice8::Acquire method.<br><br><span style=font-weight:700>设置特殊属性</span><br><br>设置设备的特殊属性，包括轴模式（axis mode），缓冲区（buffering）以及最大最小范围。对于轴模式，有两个选择：相对和绝对。绝对模式基于一个中心坐标来报告坐标。位于这个点左边或上面的值都报告成负值，同时位于这个点右边或下面的值都报告成正值。相对坐标就是当前位置同上一个位置之间的距离差。<br><br>最后一个特殊性属性是设备的最小和最大范围设置。举例来说，将游戏杆推动到最左边就会产生最小值，而推动到最右边就会产生最大值。这两边产生何种值取决于具体的设置，只有游戏杆才会涉及到最小和最大范围设置。<br><br>用于设置特殊属性的函数是 IDirectInputDevice8::SetProperty。<br><br>Sets properties that define the device behavior. These properties include input buffer size and axis mode.<br><br><span style=font-weight:700;color:#256429>Syntax</span><br><br>HRESULT SetProperty(REFGUID rguidProp,<br>    LPCDIPROPHEADER pdiph<br>);<br><br><span style=font-weight:700;color:#256429>Parameters</span><br><br><span style=font-weight:700>rguidProp</span><br>Reference to (C++) or address of (C) the globally unique identifier (GUID) identifying the property to be set. This can be one of the predefined values, or a pointer to a GUID that identifies the property. The following property values are predefined for an input device:<br><br>DIPROP_APPDATA<br>Sets the application-defined value associated with an in-game action, as a DIPROPPOINTER.<br><br>DIPROP_AUTOCENTER<br>Specifies whether device objects are self centering. This setting applies to the entire device, rather than to any particular object, so the dwHow member of the associated DIPROPDWORD structure must be DIPH_DEVICE.<br>The dwData member can be one of the following values.<br><br>DIPROPAUTOCENTER_OFF: The device should not automatically center when the user releases the device. An application that uses force feedback should disable autocentering before playing effects.<br><br>DIPROPAUTOCENTER_ON: The device should automatically center when the user releases the device.<br><br>Not all devices support the autocenter property.<br><br>DIPROP_AXISMODE<br>Sets the axis mode. The value being set (DIPROPAXISMODE_ABS or DIPROPAXISMODE_REL) must be specified in the dwData member of the associated DIPROPDWORD structure. See the description of the pdiph parameter for more information.<br><br>This setting applies to the entire device, so the dwHow member of the associated DIPROPDWORD structure must be set to DIPH_DEVICE.<br><br>DIPROP_BUFFERSIZE<br>Sets the input buffer size. The value being set must be specified in the dwData member of the associated DIPROPDWORD structure. See Remarks. This setting applies to the entire device, so the dwHow member of the associated DIPROPDWORD structure must be set to DIPH_DEVICE.<br><br>DIPROP_CALIBRATION<br>Predefined property that allows the application to access the information that Microsoft DirectInput uses to manipulate axes that require calibration. This property exists primarily for applications of the control panel type. Normal applications should not need to deal with calibration information.<br>You can access the calibration mode property for an axis by setting the dwHow member of the DIPROPHEADER structure to DIPH_BYID or to DIPH_BYOFFSET and setting the dwObj member to the object identifier (ID) or offset, respectively.<br><br>Control panel applications that set new calibration data must also invoke the IDirectInputJoyConfig::SendNotify method to notify other applications of the change in calibration. For more information about IDirectInputJoyConfig::SendNotify, see the Microsoft DirectX Driver Development Kit (DDK).<br><br>DIPROP_CALIBRATIONMODE<br>Enables the application to specify whether DirectInput should retrieve calibrated or uncalibrated data from an axis. By default, DirectInput retrieves calibrated data.<br>Setting the calibration mode for the entire device is equivalent to setting it for each axis individually.<br><br>The dwData member of the DIPROPDWORD structure can be one of the following values:<br><br>DIPROPCALIBRATIONMODE_COOKED: DirectInput should return data after applying calibration information. This is the default mode.<br>DIPROPCALIBRATIONMODE_RAW: DirectInput should return raw, uncalibrated data. This mode is typically used only by applications of the control panel type. Note that raw data might include negative values.<br><br>Setting a device into raw mode causes the dead zone, saturation, and range settings to be ignored.<br><br>DIPROP_CPOINTS<br>Sets calibration points used for the adjustment of incoming raw data. The values being set must be specified as CPOINT types in the cp array of the associated DIPROPCPOINTS structure. This setting applies to individual device objects, so the dwHow member of the associated DIPROPHEADER structure must be set to either DIPH_BYID or DIPH_BYOFFSET.<br><br>DIPROP_DEADZONE<br>Sets the value for the dead zone of a joystick, in the range from 0 through 10,000, where 0 indicates that there is no dead zone, 5,000 indicates that the dead zone extends over 50 percent of the physical range of the axis on both sides of center, and 10,000 indicates that the entire physical range of the axis is dead. When the axis is within the dead zone, it is reported as being at the center of its range. This setting can be applied to either the entire device or to a specific axis.<br><br>DIPROP_FFGAIN<br>Sets the gain for the device. This setting applies to the entire device, rather than to any particular object, so the dwHow member of the associated DIPROPDWORD structure must be DIPH_DEVICE.<br>The dwData member contains a gain value that is applied to all effects created on the device. The value is an integer in the range from 0 through 10,000, specifying the amount by which effect magnitudes should be scaled for the device. For example, a value of 10,000 indicates that all effect magnitudes are to be taken at face value. A value of 9,000 indicates that all effect magnitudes are to be reduced to 90 percent of their nominal magnitudes.<br><br>DirectInput always checks the gain value before setting the gain property. If the gain is outside of the range (less than zero or greater than 10,000), IDirectInputDevice8::SetProperty will return DIERR_INVALIDPARAM. Otherwise, if successful, it will return DI_OK, even if the device does not support force feedback.<br><br>Setting a gain value is useful when an application wants to scale down the strength of all force-feedback effects uniformly, based on user preferences.<br><br>Unlike other properties, the gain can be set when the device is in an acquired state.<br><br>DIPROP_INSTANCENAME<br>This property exists for advanced applications that want to change the friendly instance name of a device (as returned in the tszInstanceName member of the DIDEVICEINSTANCE structure) to distinguish it from similar devices that are plugged in simultaneously. Most applications should have no need to change the friendly name.<br>This setting applies to the entire device, so the dwHow member of the associated DIPROPDWORD structure must be set to DIPH_DEVICE.<br><br>The pdiph parameter must be a pointer to the diph member of a DIPROPSTRING structure.<br><br>DIPROP_PRODUCTNAME<br>This property exists for advanced applications that want to change the friendly product name of a device (as returned in the tszProductName member of the DIDEVICEINSTANCE structure) to distinguish it from similar devices which are plugged in simultaneously. Most applications should have no need to change the friendly name.<br>This setting applies to the entire device, so the dwHow member of the associated DIPROPDWORD structure must be set to DIPH_DEVICE.<br><br>The pdiph parameter must be a pointer to the diph member of a DIPROPSTRING structure.<br><br>Setting the product name is only useful for changing the user-defined name of an analog joystick on Microsoft Windows 98,Windows 2000, and Windows Millennium Edition (Windows Me) computers. In other cases, attempting to set this property will still return DI_OK. However, the name is not stored in a location used by IDirectInputDevice8::GetProperty.<br><br>DIPROP_RANGE<br>Sets the range of values an object can possibly report. The minimum and maximum values are taken from the lMin and lMax members of the associated DIPROPRANGE structure.<br>For some devices, this is a read-only property.<br><br>You cannot set a reverse range; lMax must be greater than lMin.<br><br>DIPROP_SATURATION<br>Sets the value for the saturation zones of a joystick, in the range from 0 through 10,000. The saturation level is the point at which the axis is considered to be at its most extreme position. For example, if the saturation level is set to 9,500, the axis reaches the extreme of its range when it has moved 95 percent of the physical distance from its center position (or from the dead zone). This setting can be applied to either the entire device or a specific axis.<br><br><span style=font-weight:700>pdiph</span><br>Address of the DIPROPHEADER structure contained within the type-specific property structure.<br><br><span style=font-weight:700;color:#256429>Return Value</span><br><br>If the method succeeds, the return value is DI_OK or DI_PROPNOEFFECT.<br><br>If the method fails, the return value can be one of the following error values.<br><br>DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value.<br>DIERR_NOTINITIALIZED The object has not been initialized.<br>DIERR_OBJECTNOTFOUND The requested object does not exist.<br>DIERR_UNSUPPORTED The function called is not supported at this time. This value is equal to the E_NOTIMPL standard COM return value.<br><br><span style=font-weight:700;color:#256429>Remarks</span><br><br>The buffer size determines the amount of data that the buffer can hold between calls to the IDirectInputDevice8::GetDeviceData method before data is lost. This value may be set to 0 to indicate that the application does not read buffered data from the device. If the buffer size in the dwData member of the DIPROPDWORD structure is too large for the device to support it, then the largest possible buffer size is set.<br><br>在调用SetProperty函数时始终要使用的DIPROPHEADER结构体定义如下：<br><br>Serves as a header for all property structures.<br><br><span style=font-weight:700;color:#256429>Syntax</span><br><br>typedef struct DIPROPHEADER {<br>    DWORD    dwSize;<br>    DWORD    dwHeaderSize;<br>    DWORD    dwObj;<br>    DWORD    dwHow;<br>} DIPROPHEADER, *LPDIPROPHEADER;<br> <br>typedef const DIPROPHEADER *LPCDIPROPHEADER;<br><br><span style=font-weight:700;color:#256429>Members</span><br><br>dwSize<br>Size of the enclosing structure. This member must be initialized before the structure is used.<br><br>dwHeaderSize<br>Size of the DIPROPHEADER structure.<br><br>dwObj<br>Object for which the property is to be accessed. The value set for this member depends on the value specified in the dwHow member.<br><br>dwHow<br>Value that specifies how the dwObj member should be interpreted. This value can be one of the following:<br><br>DIPH_DEVICE<br>The dwObj member must be 0.<br><br>DIPH_BYOFFSET<br>The dwObj member is the offset into the current data format of the object whose property is being accessed.<br><br>DIPH_BYUSAGE<br>The dwObj member is the HID usage page and usage values in packed form.<br><br>DIPH_BYID<br>The dwObj member is the object type/instance identifier. This identifier is returned in the dwType member of the DIDEVICEOBJECTINSTANCE structure returned from a previous call to the IDirectInputDevice8::EnumObjects member.<br><br><span style=font-weight:700>获得设备</span><br><br>在使用任何设备之前，首先必须获得设备。只有获得了设备才能确保程序能够访问设备，以及同其他程序共享访问还是完全控制设备。要注意的是其他程序可能会争夺并抢走对设备的控制权，要补救这种情况就必须重新获得设备。何时必须获得设备？第一种情况就是在创建接口的时候，原因在于使用设备之前必须首先获得它。另一种情况就是当另一个程序抢走了对设备的控制，同时 DirectInput通知了程序时。<br><br>调用IDirectInputDevice8::Acquire函数即可获得设备。<br><br>Obtains access to the input device.<br><br><span style=font-weight:700;color:#256429>Syntax</span><br><br>HRESULT Acquire(VOID);<br><br><span style=font-weight:700;color:#256429>Return Value</span><br><br>If the method succeeds, the return value is DI_OK, or S_FALSE if the device was already acquired.<br><br>If the method fails, the return value can be one of the following error values.<br><br>DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value.<br>DIERR_NOTINITIALIZED The object has not been initialized.<br>DIERR_OTHERAPPHASPRIO Another application has a higher priority level, preventing this call from succeeding. This value is equal to the E_ACCESSDENIED standard COM return value. This error can be returned when an application has only foreground access to a device but is attempting to acquire the device while in the background.<br><br><span style=font-weight:700;color:#256429>Remarks</span><br><br>Before a device can be acquired, a data format must be set by using the IDirectInputDevice8::SetDataFormat method or IDirectInputDevice8::SetActionMap method. If the data format has not been set, IDirectInputDevice8::Acquire returns DIERR_INVALIDPARAM.<br><br>Devices must be acquired before calling the IDirectInputDevice8::GetDeviceState or IDirectInputDevice8::GetDeviceData methods for that device.<br><br>Device acquisition does not use a reference count. Therefore, if an application calls the IDirectInputDevice8::Acquire method twice, then calls the IDirectInputDevice8::Unacquire method once, the device is unacquired.<br><br>If IDirectInputDevice8::BuildActionMap succeeds but no actions have been mapped, a subsequent call to IDirectInputDevice8::SetActionMap will return DI_OK but a call to IDirectInputDevice8::Acquire will fail with DIERR_INVALIDPARAM.<br><br><span style=font-weight:700>轮询设备</span><br><br>轮询可以准备设备并在合适的情况下读取设备数据，因为数据可能具有临界时间。游戏杆就是这样的设备，要从设备读取数据，计算机需要发送一个电子脉冲给它。虽然轮询对于游戏杆输入而言是必须的，但是对键盘或鼠标来说却并不需要轮询。<br><br>轮询设备需要使用IDirectInputDevice8::Poll函数。<br><br>Retrieves data from polled objects on a Microsoft DirectInput device. If the device does not require polling, calling this method has no effect. If a device that requires polling is not polled periodically, no new data is received from the device. Calling this method causes DirectInput to update the device state, generate input events (if buffered data is enabled), and set notification events (if notification is enabled).<br><br><span style=font-weight:700;color:#256429>Syntax</span><br><br>HRESULT Poll(VOID);<br><br><span style=font-weight:700;color:#256429>Return Value</span><br><br>If the method succeeds, the return value is DI_OK, or DI_NOEFFECT if the device does not require polling.<br><br>If the method fails, the return value can be one of the following error values:<br><br>DIERR_INPUTLOST Access to the input device has been lost. It must be reacquired.<br>DIERR_NOTACQUIRED The operation cannot be performed unless the device is acquired.<br>DIERR_NOTINITIALIZED The object has not been initialized.<br><br><span style=font-weight:700;color:#256429>Remarks</span><br><br>Before a device data can be polled, the data format must be set by using the IDirectInputDevice8::SetDataFormat or IDirectInputDevice8::SetActionMap method, and the device must be acquired by using the IDirectInputDevice8::Acquire method.<br><br><span style=font-weight:700>读取数据</span><br><br>经过以上的步骤，就剩下最后一步了，那就是使用 IDirectInputDevice8::GetDeviceState函数读取设备数据。为了存储设备的信息，必须传递一个数据缓冲区给此函数，这样程序才能使用设备的信息，每种设备的数据各不相同。<br><br>Retrieves immediate data from the device.<br><br><span style=font-weight:700;color:#256429>Syntax</span><br><br>HRESULT GetDeviceState(DWORD cbData,<br>    LPVOID lpvData<br>);<br><br><span style=font-weight:700;color:#256429>Parameters</span><br><br>cbData<br>Size of the buffer in the lpvData parameter, in bytes.<br><br>lpvData<br>Address of a structure that receives the current state of the device. The format of the data is established by a prior call to the IDirectInputDevice8::SetDataFormat method.<br><br><span style=font-weight:700;color:#256429>Return Value</span><br><br>If the method succeeds, the return value is DI_OK.<br><br>If the method fails, the return value can be one of the following error values:<br><br>DIERR_INPUTLOST Access to the input device has been lost. It must be reacquired.<br><br>DIERR_INVALIDPARAM An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard Component Object Model (COM) return value.<br><br>DIERR_NOTACQUIRED The operation cannot be performed unless the device is acquired.<br><br>DIERR_NOTINITIALIZED The object has not been initialized.<br><br>E_PENDING Data is not yet available.<br><br><span style=font-weight:700;color:#256429>Remarks</span><br><br>Before device data can be obtained, set the cooperative level by using the IDirectInputDevice8::SetCooperativeLevel method, then set the data format by using IDirectInputDevice8::SetDataFormat, and acquire the device by using the IDirectInputDevice8::Acquire method.<br><br>The five predefined data formats require corresponding device state structures according to the following table:<br><br>Data format State structure<br>c_dfDIMouse DIMOUSESTATE<br>c_dfDIMouse2 DIMOUSESTATE2<br>c_dfDIKeyboard array of 256 bytes<br>c_dfDIJoystick DIJOYSTATE<br>c_dfDIJoystick2 DIJOYSTATE2<br><br>For example, if you passed the c_dfDIMouse format to the IDirectInputDevice8::SetDataFormat method, you must pass a DIMOUSESTATE structure to the IDirectInputDevice8::GetDeviceState method.<br><br>无论是哪种设备，下面的代码都能读取其数据。它们考虑了丢失设备并在适当的时刻重新获得设备的情况，必须传递一个指向缓冲区的指针给下面这个函数，缓冲区的大小要能够保存设备信息以及读取的数据量。<br><br></p><a id=more></a><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>BOOL&nbsp;Read_Device(IDirectInputDevice8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;directinput_device,&nbsp;</span><span style=color:#00f>void</span><span style=color:#000>*</span><span style=color:#000>&nbsp;buffer,&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;buffer_size)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;rv;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(</span><span style=color:#000>1</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;poll&nbsp;device</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_directinput_device</span><span style=color:#000>-></span><span style=color:#000>Poll();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;read&nbsp;in&nbsp;state</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(rv&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_directinput_device</span><span style=color:#000>-></span><span style=color:#000>GetDeviceState(buffer_size,&nbsp;buffer)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;when&nbsp;an&nbsp;unknown&nbsp;error</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(rv&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;DIERR_INPUTLOST&nbsp;</span><span style=color:#000>||</span><span style=color:#000>&nbsp;rv&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;DIERR_NOTACQUIRED)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;re-acquire&nbsp;and&nbsp;try&nbsp;again</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_directinput_device</span><span style=color:#000>-></span><span style=color:#000>Acquire()))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}</span></div><br><span style=font-weight:700>使用DirectInput处理键盘</span><br><br>如果调用成功，下面的初始化函数则返回一个指向新创建的IDirectInputDevice8对象的指针；反之当函数调用失败时，返回NULL。只需给此函数传递父窗口的句柄和与定义的DirectInput对象即可。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Initialize&nbsp;keyboard&nbsp;interface,&nbsp;return&nbsp;a&nbsp;keyboad&nbsp;interface&nbsp;pointer.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>IDirectInputDevice8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;Init_Keyboard(HWND&nbsp;hwnd,&nbsp;IDirectInput8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;directinput)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;IDirectInputDevice8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;directinput_device;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;device&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(directinput</span><span style=color:#000>-></span><span style=color:#000>CreateDevice(GUID_SysKeyboard,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>directinput_device,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;data&nbsp;format</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(directinput_device</span><span style=color:#000>-></span><span style=color:#000>SetDataFormat(</span><span style=color:#000>&</span><span style=color:#000>c_dfDIKeyboard)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;directinput_device</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;coooperative&nbsp;mode</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(directinput_device</span><span style=color:#000>-></span><span style=color:#000>SetCooperativeLevel(hwnd,&nbsp;DISCL_FOREGROUND&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;DISCL_NONEXCLUSIVE)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;directinput_device</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;acquire&nbsp;the&nbsp;device&nbsp;for&nbsp;use</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(directinput_device</span><span style=color:#000>-></span><span style=color:#000>Acquire()))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;directinput_device</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;everything&nbsp;well,&nbsp;so&nbsp;return&nbsp;a&nbsp;vaild&nbsp;pointer.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;directinput_device;<br>}</span></div><br>要存储键盘数据，必须使用一个大小为256字节的数组，每个字节存储一个键的状态，这样就给出了保存256个键的空间。每个字节存储键当前的状态信息，即键是否被按下。要得到键的状态，就要检查高位（字节），如果置位，键就被按下；如果清零，键就未被按下。在DirectInput 中，每个键都有一个属于自己的宏，这些宏都以DIK_为前缀。A键定义为DIK_A，ESC为DIK_ESCAPE等。查阅DX SDK或DInput.h可以得到其他键的宏。<br><br><a href=http://www.cppblog.com/Files/lovedday/Keyboard.rar><font color=#1b1b1b>点击下载源码和工程</font></a><br><br>完整源码如下：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>/*</span><span style=color:green>**************************************************************************************<br>PURPOSE:<br>&nbsp;&nbsp;&nbsp;&nbsp;Keyboard&nbsp;device&nbsp;Demo<br>&nbsp;**************************************************************************************</span><span style=color:green>*/</span><span style=color:#000><br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;DIRECTINPUT_VERSION&nbsp;0x0800</span><span style=color:#000><br><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>windows.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>stdio.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>dinput.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>"</span><span style=color:#000>resource.h</span><span style=color:#000>"</span><span style=color:#000><br><br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dxguid.lib</span><span style=color:#000>"</span><span style=color:#000>)<br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dinput8.lib</span><span style=color:#000>"</span><span style=color:#000>)<br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;Safe_Release(p)&nbsp;if((p))&nbsp;(p)->Release();</span><span style=color:#000><br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class&nbsp;and&nbsp;caption&nbsp;text.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br></span><span style=color:#00f>static</span><span style=color:#000>&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>KeyboardClass</span><span style=color:#000>"</span><span style=color:#000>;<br><br>IDirectInput8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;g_directinput;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directinput&nbsp;component</span><span style=color:green><br></span><span style=color:#000>IDirectInputDevice8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;g_directinput_device;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;keyboard&nbsp;device<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Window&nbsp;procedure.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;WINAPI&nbsp;Window_Proc(HWND&nbsp;hwnd,&nbsp;UINT&nbsp;msg,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(msg)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;WM_DESTROY:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostQuitMessage(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>long</span><span style=color:#000>)&nbsp;DefWindowProc(hwnd,&nbsp;msg,&nbsp;wParam,&nbsp;lParam);<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Initialize&nbsp;keyboard&nbsp;interface,&nbsp;return&nbsp;a&nbsp;keyboad&nbsp;interface&nbsp;pointer.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>IDirectInputDevice8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;Init_Keyboard(HWND&nbsp;hwnd,&nbsp;IDirectInput8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;directinput)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;IDirectInputDevice8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;directinput_device;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;device&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(directinput</span><span style=color:#000>-></span><span style=color:#000>CreateDevice(GUID_SysKeyboard,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>directinput_device,&nbsp;NULL)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;data&nbsp;format</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(directinput_device</span><span style=color:#000>-></span><span style=color:#000>SetDataFormat(</span><span style=color:#000>&</span><span style=color:#000>c_dfDIKeyboard)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;directinput_device</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;coooperative&nbsp;mode</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(directinput_device</span><span style=color:#000>-></span><span style=color:#000>SetCooperativeLevel(hwnd,&nbsp;DISCL_FOREGROUND&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;DISCL_NONEXCLUSIVE)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;directinput_device</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;acquire&nbsp;the&nbsp;device&nbsp;for&nbsp;use</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(directinput_device</span><span style=color:#000>-></span><span style=color:#000>Acquire()))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;directinput_device</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;everything&nbsp;well,&nbsp;so&nbsp;return&nbsp;a&nbsp;vaild&nbsp;pointer.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;directinput_device;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Read&nbsp;keyboard&nbsp;buffer.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Read_Device(IDirectInputDevice8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;directinput_device,&nbsp;</span><span style=color:#00f>void</span><span style=color:#000>*</span><span style=color:#000>&nbsp;buffer,&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;buffer_size)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;rv;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(</span><span style=color:#000>1</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;poll&nbsp;device</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_directinput_device</span><span style=color:#000>-></span><span style=color:#000>Poll();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;read&nbsp;in&nbsp;state</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(rv&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_directinput_device</span><span style=color:#000>-></span><span style=color:#000>GetDeviceState(buffer_size,&nbsp;buffer)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;when&nbsp;an&nbsp;unknown&nbsp;error</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(rv&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;DIERR_INPUTLOST&nbsp;</span><span style=color:#000>||</span><span style=color:#000>&nbsp;rv&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;DIERR_NOTACQUIRED)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;re-acquire&nbsp;and&nbsp;try&nbsp;again</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_directinput_device</span><span style=color:#000>-></span><span style=color:#000>Acquire()))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Main&nbsp;function,&nbsp;routine&nbsp;entry.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>int</span><span style=color:#000>&nbsp;WINAPI&nbsp;WinMain(HINSTANCE&nbsp;inst,&nbsp;HINSTANCE,&nbsp;LPSTR&nbsp;cmd_line,&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;cmd_show)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;WNDCLASS&nbsp;&nbsp;&nbsp;&nbsp;win_class;<br>&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key_state_buffer[</span><span style=color:#000>256</span><span style=color:#000>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;window&nbsp;class&nbsp;and&nbsp;register&nbsp;it</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;win_class.style&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CS_HREDRAW&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;CS_VREDRAW;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpfnWndProc&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Window_Proc;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbClsExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbWndExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DLGWINDOWEXTRA;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hInstance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;inst;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIcon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadIcon(inst,&nbsp;IDI_APPLICATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadCursor(NULL,&nbsp;IDC_ARROW);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hbrBackground&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(HBRUSH)&nbsp;(COLOR_BTNFACE&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszMenuName&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszClassName&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_class_name;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;RegisterClass(</span><span style=color:#000>&</span><span style=color:#000>win_class))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;main&nbsp;window</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_hwnd&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateDialog(inst,&nbsp;MAKEINTRESOURCE(IDD_KEYBOARD),&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ShowWindow(g_hwnd,&nbsp;cmd_show);<br>&nbsp;&nbsp;&nbsp;&nbsp;UpdateWindow(g_hwnd);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;directinput&nbsp;and&nbsp;get&nbsp;keyboard&nbsp;device</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DirectInput8Create(inst,&nbsp;DIRECTINPUT_VERSION,&nbsp;IID_IDirectInput8,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>&nbsp;</span><span style=color:#000>**</span><span style=color:#000>)&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_directinput,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;keyboard</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_directinput_device&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Init_Keyboard(g_hwnd,&nbsp;g_directinput);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;start&nbsp;message&nbsp;pump,&nbsp;waiting&nbsp;for&nbsp;signal&nbsp;to&nbsp;quit.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(MSG));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(msg.message&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;WM_QUIT)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(PeekMessage(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;PM_REMOVE))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;read&nbsp;in&nbsp;keyboard&nbsp;and&nbsp;break&nbsp;if&nbsp;ESCAPE&nbsp;pressed</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Read_Device(g_directinput_device,&nbsp;key_state_buffer,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(key_state_buffer));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(key_state_buffer[DIK_ESCAPE]&nbsp;</span><span style=color:#000>&</span><span style=color:#000>&nbsp;</span><span style=color:#000>0x80</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;directinput&nbsp;objects</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_directinput_device</span><span style=color:#000>-></span><span style=color:#000>Unacquire();<br>&nbsp;&nbsp;&nbsp;&nbsp;g_directinput_device</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;g_directinput</span><span style=color:#000>-></span><span style=color:#000>Release();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;UnregisterClass(g_class_name,&nbsp;inst);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>int</span><span style=color:#000>)&nbsp;msg.wParam;<br>}<br><br></span></div><br>运行效果：<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/r_keyboard1.jpg><br></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
使用DirectInput进行交互（2）</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/using-directinput-for-interaction-part-2/ title=使用DirectInput进行交互（2）>https://blogs.qipai360.cn/post/using-directinput-for-interaction-part-2/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/using-directinput-for-interaction-part-3/ rel=next title=使用DirectInput进行交互（3）><i class="fa fa-chevron-left"></i> 使用DirectInput进行交互（3）</a></div><div class="post-nav-prev post-nav-item"><a href=/post/the-patriotic-calligrapher-and-his-fans/ rel=prev title=“爱国书法家”和他的粉丝>“爱国书法家”和他的粉丝
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2026
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.157.0 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"using-directinput-for-interaction-part-2","permalink":"https://blogs.qipai360.cn/post/using-directinput-for-interaction-part-2/","title":"使用DirectInput进行交互（2）","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1772265585" defer></script></body></html>