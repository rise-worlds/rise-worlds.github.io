<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（7）"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="用DirectX Audio和DirectShow播放声音和音乐（7）"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-7/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2007-08-04 18:18:00 +0800 +0800"><meta property="article:modified_time" content="2007-08-27 17:16:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1761990628"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>用DirectX Audio和DirectShow播放声音和音乐（7） - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>678</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>678</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2418817></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5198></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-01 14:55:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-7/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（7）"><meta itemprop=description content="加入到MP3的革命中MP3是一种音频压缩格式，它通过删除或修改音乐中不易被人耳察觉的部分来使音乐更小，占用的存储空间更少。在项目中使用MP3（.MP3文件）需要使用DirectX中的 DirectShow组件，在这个组件的帮助下，只需几行短短的代码，就能使用任意的MP3文件了（DirectShow也支持其他的媒体文件，比如 WMA，AVI，MPG等）。当然要想使用更多的媒体文件，必须已经在操作系统中安装了解码器。解码器（codec）是一个程序，用于解码或编码一些指定的格式（比如MP3解码器专门解码.MP3文件）。通常可以从发明或者创建这种格式的公司中获取这种格式的解码器。比如，MP3解码器来自于Fraunhofer Insitute。幸运的是，MP3解码器等几种比较流行的解码器已经被集成到操作系统中（比如.mp3，.avi，.mpg等），而无需另外从 internet下载这些格式的解码器了。要在项目中使用DirectShow，需要包含dshow.h头文件，并且在链接库中加入strmiids.lib。使用DirectShowDirectX是一组COM接口组件，DirectShow也不例外，DirectShow中经常使用的组件如下：IGraphBuilder：  帮助建立滤波图，滤波过滤图是一组对象或接口的集合，用于处理某种媒体文件。IMediaControl：控制数据在滤波图中的流程，使用该接口控制音乐的回放。IMediaEvents：   从滤波图中获取事件及通告，当希望知道在滤波图中发生了什么的时候这个对象很有用，比如希望知道一个音乐是否仍然在播放或者已经停止播放。其中第一个接口IGraphBuilder是比较重要的对象，其他对象都依赖于它，或者靠它创建。它创建滤波器，用于处理媒体问题，另外很多有用的功能也是依靠这个对象。使用DirectShow播放MP3的第一步是调用 CoCreateInstance函数创建滤波图对象IGraphBuilder。"></span><header class=post-header><h1 class=post-title itemprop="name headline">用DirectX Audio和DirectShow播放声音和音乐（7）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年08月04日 18:18:00 CST" itemprop="dateCreated datePublished" datetime="2007-08-04 18:18:00 +0800 +0800">2007年08月04日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:16:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:16:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>17744</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>36分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-7/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><span style=font-weight:700;color:#397498>加入到MP3的革命中</span><br><br>MP3是一种音频压缩格式，它通过删除或修改音乐中不易被人耳察觉的部分来使音乐更小，占用的存储空间更少。在项目中使用MP3（.MP3文件）需要使用DirectX中的 DirectShow组件，在这个组件的帮助下，只需几行短短的代码，就能使用任意的MP3文件了（DirectShow也支持其他的媒体文件，比如 WMA，AVI，MPG等）。当然要想使用更多的媒体文件，必须已经在操作系统中安装了解码器。<br><br>解码器（codec）是一个程序，用于解码或编码一些指定的格式（比如MP3解码器专门解码.MP3文件）。通常可以从发明或者创建这种格式的公司中获取这种格式的解码器。比如，MP3解码器来自于Fraunhofer Insitute。幸运的是，MP3解码器等几种比较流行的解码器已经被集成到操作系统中（比如.mp3，.avi，.mpg等），而无需另外从 internet下载这些格式的解码器了。<br><br>要在项目中使用DirectShow，需要包含dshow.h头文件，并且在链接库中加入strmiids.lib。<br><br><span style=font-weight:700;color:#397498>使用DirectShow</span><br><br>DirectX是一组COM接口组件，DirectShow也不例外，DirectShow中经常使用的组件如下：<br><br>IGraphBuilder：  帮助建立滤波图，滤波过滤图是一组对象或接口的集合，用于处理某种媒体文件。<br>IMediaControl：控制数据在滤波图中的流程，使用该接口控制音乐的回放。<br>IMediaEvents：   从滤波图中获取事件及通告，当希望知道在滤波图中发生了什么的时候这个对象很有用，比如希望知道一个音乐是否仍然在播放或者已经停止播放。<br><br>其中第一个接口IGraphBuilder是比较重要的对象，其他对象都依赖于它，或者靠它创建。它创建滤波器，用于处理媒体问题，另外很多有用的功能也是依靠这个对象。<br><br>使用DirectShow播放MP3的第一步是调用 CoCreateInstance函数创建滤波图对象IGraphBuilder。<br><br></p><a id=more></a><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>&nbsp;&nbsp;&nbsp; //</span><span style=color:green>&nbsp;initialize&nbsp;COM<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;the&nbsp;COM&nbsp;library&nbsp;on&nbsp;the&nbsp;current&nbsp;thread&nbsp;and&nbsp;identifies&nbsp;the&nbsp;concurrency&nbsp;model&nbsp;as&nbsp;single-thread<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;apartment&nbsp;(STA).</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;CoInitialize(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;DirectMusic&nbsp;performance&nbsp;object<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;creates&nbsp;a&nbsp;single&nbsp;uninitialized&nbsp;object&nbsp;of&nbsp;the&nbsp;class&nbsp;associated&nbsp;with&nbsp;a&nbsp;specified&nbsp;CLSID.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(CoCreateInstance(CLSID_FilterGraph,&nbsp;NULL,&nbsp;CLSCTX_INPROC_SERVER,&nbsp;IID_IGraphBuilder,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_graph_builder)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Unable&nbsp;to&nbsp;create&nbsp;DirectShow&nbsp;Graph&nbsp;Builder&nbsp;object.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br>&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><br>一旦创建对象IGraphBuilder成功，就可以请求另两个接口了：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;Query&nbsp;for&nbsp;the&nbsp;media&nbsp;control&nbsp;and&nbsp;event&nbsp;objects</span><span style=color:green><br></span><span style=color:#000>g_graph_builder</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IMediaControl,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_media_control);<br>g_graph_builder</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IMediaEvent,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_media_event);</span></div><br><span style=font-weight:700;color:#397498>加载媒体文件</span><br>&nbsp;<br>实际上， DirectShow并不加载媒体文件，而是创建一个DirectShow滤波器到文件的连接。数据在解码的时候被流化，这样可以减少在播放过程中的内存使用，创建连接的过程叫做渲染（rendering）。渲染一个文件，需要调用IGraphBuilder::RenderFile函数。<br><br><p>Builds a filter graph that renders the specified file.</p><p class=ref>Syntax</p><blockquote><pre><strong>HRESULT</strong> <strong>RenderFile(</strong><br> <strong>LPCWSTR</strong> <em>lpwstrFile</em><strong>,</strong><br> <strong>LPCWSTR</strong> <em>lpwstrPlayList</em><br><strong>);</strong> </pre></blockquote><p class=ref>Parameters</p><blockquote><dl><dt><em>lpwstrFile</em><dd>[in] Pointer to the name of the file containing the data to be rendered.<dt><em>lpwstrPlayList</em><dd>[in] Pointer to the playlist name. Reserved; must be NULL. (This parameter is currently unimplemented.)</dd></dl></blockquote><p class=ref>Return Value</p><blockquote><p>Returns an HRESULT value, which can include one of the following:</p><ul><li>VFW_S_AUDIO_NOT_RENDERED<li>VFW_S_DUPLICATE_NAME<li>VFW_S_PARTIAL_RENDER<li>VFW_S_RPZA<li>VFW_S_VIDEO_NOT_RENDERED</li></ul></blockquote><p class=ref>Remarks</p><blockquote><p>If the <em>lpwstrPlayList</em> parameter is NULL, this method would use the default playlist, which typically renders the entire file.</p></blockquote><span style=font-weight:700;color:#397498>控制音乐的播放</span><br><br>在媒体文件被渲染之后，就可以使用另外两个接口 IMediaControl和IMediaEvent进行播放或者对播放进行控制了。<br><br>第一个接口 IMediaControl用于播放和各种播放相关的操作，这个接口有三个函数：IMediaControl::Run，IMediaControl:: Pause，IMediaControl::Stop。<br><br>如果要开始播放一段音乐，调用 IMediaControl::Run就可以了。<br><br><p>Switches the entire filter graph into a running state.</p><p class=ref>Syntax</p><blockquote><pre><strong>HRESULT</strong> <strong>Run(void);</strong> </pre></blockquote><p class=ref>Return Value</p><blockquote><p>Returns S_OK if the graph is actually running.</p><p>Returns S_FALSE if the graph is preparing to run (the graph will run automatically when it's ready). Call GetState to wait for the transition to the running state to complete or to check if the transition has completed. If the method returns S_FALSE, subsequent calls to GetState will return a value of State_Running when the graph is actually running. If the transition to the running state is not complete GetState can return a return code of VFW_S_STATE_INTERMEDIATE.</p><p>Returns an HRESULT error code if the graph could not run and is now stopped.</p></blockquote><p class=ref>Remarks</p><blockquote><p>In a running state, data is pushed down the filter graph and rendered. The graph remains in a running state until it is stopped by the IMediaControl::Pause or IMediaControl::Stop method. The graph remains in a running state even after notifying the application of completion (that is, the EC_COMPLETE notification is sent to the application). This allows the application to determine whether to pause or stop after completion.</p><p>If the filter graph is in the stopped state, this method first pauses the graph before running.</p><p>If an error value is returned, some filters within the graph might have successfully entered the running state. In a multistream graph, entire streams might be playing successfully. The application must determine whether to stop running or not.</p></blockquote>一旦播放开始，就可以随时暂停播放或者停止播放，如果希望暂停播放，调用IMediaControl::Pause函数。<br><br><p>Pauses all the filters in the filter graph.</p><p class=ref>Syntax</p><blockquote><pre><strong>HRESULT</strong> <strong>Pause(void);</strong><br></pre></blockquote><p class=ref>Return Value</p><blockquote><p>Returns S_OK if the graph is actually paused.</p><p>Returns S_FALSE if the graph is in paused state but some filters have not completed the transition to pause. Call GetState to wait for the transition to the paused state to complete or to check if the transition has completed. If the method returns S_FALSE, subsequent calls to GetState will return a value of State_Paused when the graph is paused. If the transition to paused is not complete GetState can return a return code of VFW_S_STATE_INTERMEDIATE.</p><p>Returns an HRESULT error code if the graph could not transition to paused state and is now stopped.</p></blockquote><p class=ref>Remarks</p><blockquote><p>In the paused state, filters process data but do not render it. Data is pushed down the filter graph and is processed by <span class=Glossary title="Glossary entry" onclick=Glossary(this) dataid=transform_filter filename=../../gloss/gloss_T.htm>transform filters</span> as far as buffering permits. No data is rendered (except that media types capable of being rendered statically, such as video, have a static, poster frame rendered in paused mode). Therefore, putting a filter graph into a paused state cues the graph for immediate rendering when put into a running state.</p></blockquote>开始播放之后，可以随时调用IMediaContrl::Stop函数来停止播放。<br><br><p>Switches all filters in the filter graph to a stopped state.</p><p class=ref>Syntax</p><blockquote><pre><strong>HRESULT</strong> <strong>Stop(void);</strong> </pre></blockquote><p class=ref>Return Value</p><blockquote><p>Returns an HRESULT value.</p></blockquote><p class=ref>Remarks</p><blockquote><p>In this mode, filters release resources and no data is processed. If the filters are in a running state, this method pauses them before stopping them. This allows video renderers to make a copy of the current frame for poster frame display while stopped.</p></blockquote>以下代码演示了如何播放MP3文件。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Play&nbsp;mp3&nbsp;which&nbsp;specified&nbsp;by&nbsp;filename.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Play_MP3(</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;filename)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;convert&nbsp;filename&nbsp;to&nbsp;wide-character&nbsp;string</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;WCHAR&nbsp;w_filename[MAX_PATH]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;{</span><span style=color:#000>0</span><span style=color:#000>};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;mbstowcs(w_filename,&nbsp;filename,&nbsp;MAX_PATH);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;render&nbsp;the&nbsp;file</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_graph_builder</span><span style=color:#000>-></span><span style=color:#000>RenderFile(w_filename,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;play&nbsp;the&nbsp;file,&nbsp;switches&nbsp;the&nbsp;entire&nbsp;filter&nbsp;graph&nbsp;into&nbsp;a&nbsp;running&nbsp;state.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_media_control</span><span style=color:#000>-></span><span style=color:#000>Run();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}</span></div><br><span style=font-weight:700;color:#397498>检测播放事件</span><br><br>我们主要感兴趣的IMediaEvent函数大概有三个：GetEvent，FreeEventParams，WaitForCompletion。<br><br>第一个函数GetEvent可能是使用最多的函数，它用于找回通知播放状态的事件。<br><br><p>Retrieves the next notification event.</p><p class=ref>Syntax</p><blockquote><pre><strong>HRESULT</strong> <strong>GetEvent(</strong><br> <strong>long</strong> <em>*lEventCode</em><strong>,</strong><br> <strong>long</strong> <em>*lParam1</em><strong>,</strong><br> <strong>long</strong> <em>*lParam2</em><strong>,</strong><br> <strong>long</strong> <em>msTimeout</em><br><strong>);</strong> </pre></blockquote><p class=ref>Parameters</p><blockquote><dl><dt><em>IEventCode</em><dd>[out] Pointer to the next event notification.<dt><em>lParam1</em><dd>[out] Pointer to the first parameter of the event.<dt><em>lParam2</em><dd>[out] Pointer to the second parameter of the event.<dt><em>msTimeout</em><dd>[in] Time, in milliseconds, to wait before assuming that there are no events.</dd></dl></blockquote><p class=ref>Return Value</p><blockquote><p>Returns an HRESULT value that depends on the implementation of the interface. If the time-out is zero and no event is waiting, or if the time-out elapses before an event appears, this method returns E_ABORT.</p></blockquote><p class=ref>Remarks</p><blockquote><p>The application can pass a time-out value of INFINITE to indicate that the method should block until there is an event; however, applications should avoid using INFINITE. Threads cannot process any messages while waiting in <strong>GetEvent</strong>. If you call <strong>GetEvent</strong> from the thread that processes Windows messages, specify only small wait times on the call in order to remain responsive to user input. This is most important when streaming data from a source such as the Internet, because state transitions can take significantly more time to complete.</p><p>After calling <strong>GetEvent</strong>, applications should always call FreeEventParams to release any resource associated with the event.</p><p>For a list of notification codes and event parameter values, see Event Notification Codes.</p></blockquote>一般我们最希望获取到的事件是播放完成，这个事件的值是EC_COMPLETE。如果调用GetEvent函数之后，lEventCode的值是 EC_COMPLETE，说明播放完成了。<br><br>当获取并处理了GetEvent产生的事件后，必须把事件所占用的资源释放，释放资源使用IMediaEvent::FreeEventParams函数。<br><br><p>Frees resources associated with the parameters of an event.</p><p class=ref>Syntax</p><blockquote><pre><strong>HRESULT</strong> <strong>FreeEventParams(</strong><br> <strong>long</strong> <em>lEventCode</em><strong>,</strong><br> <strong>long</strong> <em>lParam1</em><strong>,</strong><br> <strong>long</strong> <em>lParam2</em><br><strong>);</strong> </pre></blockquote><p class=ref>Parameters</p><blockquote><dl><dt><em>lEventCode</em><dd>[in] Next event notification.<dt><em>lParam1</em><dd>[in] First parameter of the event.<dt><em>lParam2</em><dd>[in] Second parameter of the event.</dd></dl></blockquote><p class=ref>Return Value</p><blockquote><p>Returns an HRESULT value.</p></blockquote><p class=ref>Remarks</p><blockquote><p>Event parameters can be of type LONG or BSTR. If a <strong>BSTR</strong> is passed as an event, it will have been allocated by the task allocator and should be freed using this method. No reference-counted interfaces are passed to an application using IMediaEvent::GetEvent, because these cannot be overridden by IMediaEvent::CancelDefaultHandling. Therefore, do not use this method to release interfaces.</p></blockquote>以下代码演示了如何捕捉事件并释放事件所占用的资源:<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; //</span><span style=color:green>&nbsp;get&nbsp;th&nbsp;status&nbsp;of&nbsp;the&nbsp;song,&nbsp;it&nbsp;if&nbsp;is&nbsp;done,&nbsp;exit&nbsp;program.</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;event_code,&nbsp;param1,&nbsp;param2;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;retrieves&nbsp;the&nbsp;next&nbsp;notification&nbsp;event</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(g_media_event</span><span style=color:#000>-></span><span style=color:#000>GetEvent(</span><span style=color:#000>&</span><span style=color:#000>event_code,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>param1,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>param2,&nbsp;</span><span style=color:#000>1</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(event_code&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;EC_COMPLETE)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;frees&nbsp;resources&nbsp;associated&nbsp;with&nbsp;the&nbsp;parameters&nbsp;of&nbsp;an&nbsp;events.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_media_event</span><span style=color:#000>-></span><span style=color:#000>FreeEventParams(event_code,&nbsp;param1,&nbsp;param2);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><br>在需要逐帧连续监视事件的时候，用GetEvent和FreeEventParams组合是很有用的，它能帮助我们获取事件并作恰当的处理。但当我们需要连续播放而不希望连续监视播放过程的时候，另外一个函数就会很有用，即WaitForCompletion函数。它可以一直播放，在播放完成的时候，会把控制权交给我们。<br><br><p>Blocks execution of the application thread until the graph's operation finishes.</p><p class=ref>Syntax</p><blockquote><pre><strong>HRESULT</strong> <strong>WaitForCompletion(</strong><br> <strong>long</strong> <em>msTimeout</em><strong>,</strong><br> <strong>long</strong> <em>*pEvCode</em><br><strong>);</strong> </pre></blockquote><p class=ref>Parameters</p><blockquote><dl><dt><em>msTimeout</em><dd>[in] Duration of the time-out, in milliseconds. Pass zero to return immediately. To block indefinitely, pass INFINITE.<dt><em>pEvCode</em><dd>[out] Pointer to the event that terminated the wait. This value can be one of the following:<table><tbody><tr><td>EC_COMPLETE</td><td>Operation completed.</td></tr><tr><td>EC_ERRORABORT</td><td>Error. Playback can't continue.</td></tr><tr><td>EC_USERABORT</td><td>User terminated the operation.</td></tr><tr><td>Zero</td><td>Operation has not completed.</td></tr></tbody></table></dd></dl></blockquote><p class=ref>Return Value</p><blockquote><p>Returns one of the following HRESULT values.<table><tbody><tr><td>E_ABORT</td><td>Function timed out before the operation completed. This is equivalent to a zero <em>pEvCode</em> value.</td></tr><tr><td>S_OK</td><td>Operation completed.</td></tr></tbody></table></p></blockquote><p class=ref>Remarks</p><blockquote><p>This method is the equivalent of blocking until the event notification EC_COMPLETE, EC_ERRORABORT, or EC_USERABORT is received, or the time-out occurs.</p><p>When this method returns, the filter graph is still running. This method assumes that separate calls to the IMediaEvent interface are not being made. The method fails if the graph is not in, or transitioning into, a running state.</p><p>The time-out parameter (<em>msTimeout</em>) specifies the length of time to wait for completion. To test whether the operation completed, specify a zero <em>msTimeout</em> value and check the event code value (<em>pEvCode</em>) for zero, indicating that the operation has not completed.</p></blockquote><span style=font-weight:700;color:#397498>释放DirectShow资源</span><br><br>一旦播放完成，就要关闭和释放所有占用的DirectShow资源。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>&nbsp;&nbsp;&nbsp; //</span><span style=color:green>&nbsp;stop&nbsp;music&nbsp;and&nbsp;relaese&nbsp;DirectShow&nbsp;objects<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;switches&nbsp;all&nbsp;filters&nbsp;in&nbsp;the&nbsp;filter&nbsp;graph&nbsp;to&nbsp;a&nbsp;stopped&nbsp;state.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_media_control</span><span style=color:#000>-></span><span style=color:#000>Stop();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;g_media_event</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;g_media_event&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;g_media_control</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;g_media_control&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;g_graph_builder</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;g_graph_builder&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;</span></div><br>下面给出完整的代码示例，<span style=font-weight:700>由于DirectX9已经将DirectShow移除，所以需要安装DirectX8 SDK，并在Vistual Studio中设置头文件目录。</span><br><br><a href=http://www.cppblog.com/Files/lovedday/Mp3Play.rar><font color=#1b1b1b>点击下载源码和工程</font></a><br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>/*</span><span style=color:green>**************************************************************************************<br>PURPOSE:<br>&nbsp;&nbsp;&nbsp;&nbsp;MP3&nbsp;Playing&nbsp;Demo<br>&nbsp;**************************************************************************************</span><span style=color:green>*/</span><span style=color:#000><br><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>windows.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>stdio.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>dshow.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>"</span><span style=color:#000>resource.h</span><span style=color:#000>"</span><span style=color:#000><br><br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dxguid.lib</span><span style=color:#000>"</span><span style=color:#000>)<br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>strmiids.lib</span><span style=color:#000>"</span><span style=color:#000>)<br><br>#pragma&nbsp;warning(disable&nbsp;:&nbsp;</span><span style=color:#000>4996</span><span style=color:#000>)<br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;Safe_Release(p)&nbsp;if((p))&nbsp;(p)->Release();</span><span style=color:#000><br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br></span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>MP3PlayClass</span><span style=color:#000>"</span><span style=color:#000>;<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;DirectShows&nbsp;components</span><span style=color:green><br></span><span style=color:#000>IGraphBuilder</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;g_graph_builder&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>IMediaControl</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;g_media_control&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>IMediaEvent</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_media_event&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Play&nbsp;mp3&nbsp;which&nbsp;specified&nbsp;by&nbsp;filename.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Play_MP3(</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;filename)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;convert&nbsp;filename&nbsp;to&nbsp;wide-character&nbsp;string</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;WCHAR&nbsp;w_filename[MAX_PATH]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;{</span><span style=color:#000>0</span><span style=color:#000>};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;mbstowcs(w_filename,&nbsp;filename,&nbsp;MAX_PATH);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;render&nbsp;the&nbsp;file</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_graph_builder</span><span style=color:#000>-></span><span style=color:#000>RenderFile(w_filename,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;play&nbsp;the&nbsp;file,&nbsp;switches&nbsp;the&nbsp;entire&nbsp;filter&nbsp;graph&nbsp;into&nbsp;a&nbsp;running&nbsp;state.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_media_control</span><span style=color:#000>-></span><span style=color:#000>Run();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Window&nbsp;procedure.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;WINAPI&nbsp;Window_Proc(HWND&nbsp;hwnd,&nbsp;UINT&nbsp;msg,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(msg)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;WM_DESTROY:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostQuitMessage(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>long</span><span style=color:#000>)&nbsp;DefWindowProc(hwnd,&nbsp;msg,&nbsp;wParam,&nbsp;lParam);<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Main&nbsp;function,&nbsp;routine&nbsp;entry.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>int</span><span style=color:#000>&nbsp;WINAPI&nbsp;WinMain(HINSTANCE&nbsp;inst,&nbsp;HINSTANCE,&nbsp;LPSTR&nbsp;cmd_line,&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;cmd_show)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;WNDCLASS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;win_class;<br>&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;window&nbsp;class&nbsp;and&nbsp;register&nbsp;it</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;win_class.style&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CS_HREDRAW&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;CS_VREDRAW;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpfnWndProc&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Window_Proc;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbClsExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbWndExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DLGWINDOWEXTRA;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hInstance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;inst;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIcon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadIcon(inst,&nbsp;IDI_APPLICATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadCursor(NULL,&nbsp;IDC_ARROW);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hbrBackground&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(HBRUSH)&nbsp;(COLOR_BTNFACE&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszMenuName&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszClassName&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_class_name;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;RegisterClass(</span><span style=color:#000>&</span><span style=color:#000>win_class))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;main&nbsp;window</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_hwnd&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateDialog(inst,&nbsp;MAKEINTRESOURCE(IDD_MP3PLAY),&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ShowWindow(g_hwnd,&nbsp;cmd_show);<br>&nbsp;&nbsp;&nbsp;&nbsp;UpdateWindow(g_hwnd);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;COM<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;the&nbsp;COM&nbsp;library&nbsp;on&nbsp;the&nbsp;current&nbsp;thread&nbsp;and&nbsp;identifies&nbsp;the&nbsp;concurrency&nbsp;model&nbsp;as&nbsp;single-thread<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;apartment&nbsp;(STA).</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;CoInitialize(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;DirectMusic&nbsp;performance&nbsp;object<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;creates&nbsp;a&nbsp;single&nbsp;uninitialized&nbsp;object&nbsp;of&nbsp;the&nbsp;class&nbsp;associated&nbsp;with&nbsp;a&nbsp;specified&nbsp;CLSID.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(CoCreateInstance(CLSID_FilterGraph,&nbsp;NULL,&nbsp;CLSCTX_INPROC_SERVER,&nbsp;IID_IGraphBuilder,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_graph_builder)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Unable&nbsp;to&nbsp;create&nbsp;DirectShow&nbsp;Graph&nbsp;Builder&nbsp;object.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Query&nbsp;for&nbsp;the&nbsp;media&nbsp;control&nbsp;and&nbsp;event&nbsp;objects</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_graph_builder</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IMediaControl,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_media_control);<br>&nbsp;&nbsp;&nbsp;&nbsp;g_graph_builder</span><span style=color:#000>-></span><span style=color:#000>QueryInterface(IID_IMediaEvent,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_media_event);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;play&nbsp;mp3</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;Play_MP3(</span><span style=color:#000>"</span><span style=color:#000>escape.mp3</span><span style=color:#000>"</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;start&nbsp;message&nbsp;pump,&nbsp;waiting&nbsp;for&nbsp;signal&nbsp;to&nbsp;quit.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(MSG));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(msg.message&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;WM_QUIT)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(PeekMessage(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;PM_REMOVE))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;th&nbsp;status&nbsp;of&nbsp;the&nbsp;song,&nbsp;it&nbsp;if&nbsp;is&nbsp;done,&nbsp;exit&nbsp;program.</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>long</span><span style=color:#000>&nbsp;event_code,&nbsp;param1,&nbsp;param2;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;retrieves&nbsp;the&nbsp;next&nbsp;notification&nbsp;event</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(g_media_event</span><span style=color:#000>-></span><span style=color:#000>GetEvent(</span><span style=color:#000>&</span><span style=color:#000>event_code,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>param1,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>param2,&nbsp;</span><span style=color:#000>1</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(event_code&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;EC_COMPLETE)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;frees&nbsp;resources&nbsp;associated&nbsp;with&nbsp;the&nbsp;parameters&nbsp;of&nbsp;an&nbsp;events.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_media_event</span><span style=color:#000>-></span><span style=color:#000>FreeEventParams(event_code,&nbsp;param1,&nbsp;param2);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;frees&nbsp;resources&nbsp;associated&nbsp;with&nbsp;the&nbsp;parameters&nbsp;of&nbsp;an&nbsp;events.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_media_event</span><span style=color:#000>-></span><span style=color:#000>FreeEventParams(event_code,&nbsp;param1,&nbsp;param2);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;stop&nbsp;music&nbsp;and&nbsp;relaese&nbsp;DirectShow&nbsp;objects<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;switches&nbsp;all&nbsp;filters&nbsp;in&nbsp;the&nbsp;filter&nbsp;graph&nbsp;to&nbsp;a&nbsp;stopped&nbsp;state.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_media_control</span><span style=color:#000>-></span><span style=color:#000>Stop();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;g_media_event</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;g_media_event&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;g_media_control</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;g_media_control&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;g_graph_builder</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;g_graph_builder&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;UnregisterClass(g_class_name,&nbsp;inst);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;COM&nbsp;system<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Closes&nbsp;the&nbsp;COM&nbsp;library&nbsp;on&nbsp;the&nbsp;current&nbsp;thread,&nbsp;unloads&nbsp;all&nbsp;DLLs&nbsp;loaded&nbsp;by&nbsp;the&nbsp;thread,&nbsp;frees&nbsp;any&nbsp;other<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;resources&nbsp;that&nbsp;the&nbsp;thread&nbsp;maintains,&nbsp;and&nbsp;forces&nbsp;all&nbsp;RPC&nbsp;connections&nbsp;on&nbsp;the&nbsp;thread&nbsp;to&nbsp;close.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;CoUninitialize();<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>int</span><span style=color:#000>)&nbsp;msg.wParam;<br>}<br></span></div><br>运行截图：<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/r_mp3_play.jpg><br></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
用DirectX Audio和DirectShow播放声音和音乐（7）</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-7/ title="用DirectX Audio和DirectShow播放声音和音乐（7）">https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-7/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/directx9-tutorial-id3dxsprite-repost/ rel=next title=DirectX9.0教程之ID3DXSprite篇[转载]><i class="fa fa-chevron-left"></i> DirectX9.0教程之ID3DXSprite篇[转载]</a></div><div class="post-nav-prev post-nav-item"><a href=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-6/ rel=prev title="用DirectX Audio和DirectShow播放声音和音乐（6）">用DirectX Audio和DirectShow播放声音和音乐（6）
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"playing-sound-and-music-with-directx-audio-and-directshow-part-7","permalink":"https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-7/","title":"用DirectX Audio和DirectShow播放声音和音乐（7）","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1761990624" defer></script></body></html>