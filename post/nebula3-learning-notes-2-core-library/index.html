<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="Nebula3学习笔记(2)： 核心库"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="Nebula3学习笔记(2)： 核心库"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/nebula3-learning-notes-2-core-library/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2008-12-14 21:22:00 +0800 +0800"><meta property="article:modified_time" content="2008-12-14 21:23:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1761990628"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>Nebula3学习笔记(2)： 核心库 - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>678</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>678</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2418817></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5198></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-01 14:55:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/nebula3-learning-notes-2-core-library/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Nebula3学习笔记(2)： 核心库"><meta itemprop=description content="核心子系统  核心库(Core namespace)实现了这些特性:   一个实现了引用计数的RefCounted基类  一个运行时类型信息系统(RTTI)  一个模板智能指针, 用于处理RefCounted对象的生命周期  一个由类名创建C++对象实例的工厂机制  一个中央Server对象用于建立基本的Nebula3运行环境 对象模型  Nebula3在C++对象模型的基础之上实现了下面这些新特性:   基于引用计数和智能指针的生命周期管理  基于类名或四字符编码的对象创建  一个运行时类型信息系统  实现一个新的Nebula3类  当实现一个新的类时首先要考虑它是一个传统的C++类还是要从Core::RefCounted继承. 以下几点可以帮你找到答案:   如果这个类需要使用Nebula3的扩展对象特性, 如引用计数, RTTI等, 则它必须从Core::RefCounted继承.  如果这个类是一个典型的小工具类, 如动态数组, 数学向量, 或其它相似的东西, 那么它从Core::RefCounted 继承也没有什么意义. 从Core::RefCounted类继承有一些限制:   RefCounted派生类不应该在栈上创建对象, 因为栈对象的生命周期是由C++来管理的(他们会在离开当前上下文时被销毁, 从而绕过了Nebula3的引用计数生命周期 管理)  RefCounted的派生类只有一个默认的构造函数.  RefCounted的派生类必须有一个虚析构函数.  RefCounted的派生类不能进行拷贝, 因为这样会造成引用计数机制混乱. 要使用Nebula3的对象模型特性, 除了需要从Core::RefCounted继承外, 还需要在头文件新类的声明中进行额外的标注:  一个标准的RefCounted派生类一般这样声明:  1: namespace MyNamespace  2: {  3: class MyClass : public Core::RefCounted  4: {  5: DeclareClass(MyClass);  6: public:  7: /// constructor  8:&nbsp;&nbsp;&nbsp;&nbsp; MyClass();  9: /// destructor  10: virtual ~MyClass();  11: ...  12: };  13: RegisterClass(MyClass);  注意DeclareClass()宏, 构造函数, 析构函数还有类外面的RegisterClass()宏. DeclareClass()宏加入了RTTI和工厂机制所需的最小代价的信息, 它隐藏了Nebula3的对象模型, 希望可以在不影响已有类的基础进上进行内部机制的变更. RegisterClass()宏是可选的, 它把当前类在中央工厂进行注册. 如果你知道这个类永远不会由类名或四字符编码进行创建, 这个宏可以省略.  在这个类的.cpp文件里需要包含Nebula3特有的信息:  1: namespace MyNamespace  2: {  3: ImplementClass(MyNamespace::MyClass, 'MYCL', Core::RefCounted);  4:  5: }  ImplementClass()宏注册类的RTTI机制, 第一个参数描述了类的名字(注意命名空间必须包含). 第二个参数是类的四字符编码, 它必须是所有类中唯一的(如果有重复, 你会在启动程序时得到一个错误提示). 第三个参数是父类的名字, 用于RTTI系统去构造类的关系树.  引用计数和智能指针  Nebula3使用传统的引用计数来管理对象的生命周期. 一个模板智能指针类Ptr<>对程序员隐藏了引用计数的实现细节. 一般来说, 应该一直使用智能指针指向RefCounted的派生对象, 除非你能肯定在给出的代码块中这个对象的引用计数不会发生变化.  智能指针相对于一般指针有很多好处:   访问一个空指针会给你一个断言警告而不是一个内存错误  你不需要对引用计数的对象调用AddRef()或Release() (事实上如果你调了, 会了发生严重的错误)  智能指针可以在容器类里良好地工作, 一个智能指针的数组会消除所有的一般指针需要的生命周期管理, 你永远不需要考虑去释放指针所指针的对象, 数组包含的像是真正的C++对象一样  用智能指针不需要考虑指针的所属, 不需要为谁delete对象而烦恼 智能指针也有一些缺点:   性能: 拷贝和赋值会引起对象的引用计数的变化, 解除引用会引起指针的断言检查. 这导致的性能消耗一般是可以忽略的, 但是你最好保证它不在内部循环中发生.  应该销毁的对象还存在: 因为智能指针管理的对象只有在最后一个引用放弃时才会销毁, 这样会使对象存在超过预订的时间. 这经常会导致一个BUG的产生. 不过引用计数泄露(程序退出时还仍然存在的对象)时Nebula3会提醒你.  创建Nebula3对象  从Core::RefCounted继承的类可以通过3种不同的方式进行创建:  直接通过静态的Create方法:  1: Ptr<MyClass> myObj = MyClass::Create();  静态的Create()方法是之前提到的DeclareClass()宏加入的, 相对于new操作符来说, 它并没有多做什么. 注意正确使用智能指针来保存新建的对象.  另一种创建方式是通过类名:  1: using namespace Core;  2: Ptr<MyClass> myObj = (MyClass*)Factory::Instance()->Create(&#34;MyNamespace::MyClass&#34;);  当你在运行时通过类名来创建十分有用, 特别是对象的反序列化和脚本接口的使用. 注意类型转换是必须的, 因为工厂的Creat()方法返回的是RefCounted指针.  由类名创建的变种是根据四字符编码进行创建:  1: using namespace Core;  2: using namespace Util;  3: Ptr<MyClass> myObj = (MyClass*) Factory::Instance()->Create(FourCC('MYCL'));  这个方法看上去没有那个直观, 但是它比类名创建快得多. 并且四字符编码比类名占用的空间更少, 这更利于对象写入二进制流或从中读取.  运行时类型信息系统  Nebula3的RTTI系统可以让你在运行时访问对象的类型, 检查一个对象是不是某个类的实例, 或者某个派生类的实例. 你也可以直接获得一个对象的类名和四字符编码. 所有这些功能是由DeclareClass() 和 ImplementClass() 宏在背后实现的.  这时有示例程序:  1:&nbsp;&nbsp;&nbsp;&nbsp; using namespace Util;  2:&nbsp;&nbsp;&nbsp;&nbsp; using namespace Core;  3:  4: // check whether an object is instance of a specific class  5: if (myObj->IsInstanceOf(MyClass::RTTI))  6: {  7: // it's a MyClass object  8: }  9:  10: // check whether an object is instance of a derived class  11: if (myObj->IsA(RefCounted::RTTI))  12: {  13: // it's a RefCounted instance or some RefCounted-derived instance  14: }  15:  16: // get the class name of my object, this yields &#34;MyNamespace::MyClass&#34;  17: const String& className = myObj->GetClassName();  18:  19: // get the fourcc class identifier of my object, this yields 'MYCL'  20: const FourCC& fourcc = myObj->GetClassFourCC();  你也可以向中央工厂查询一个类是否已经注册:  1:&nbsp;&nbsp;&nbsp;&nbsp; using namespace Core;  2:  3: // check if a class has been registered by class name  4: if (Factory::Instance()->ClassExists(&#34;MyNamespace::MyClass&#34;))  5: {  6: // yep, the class exists  7: }  8:  9: // check if a class has been registered by class fourcc code  10: if (Factory::Instance()->ClassExists(FourCC('MYCL')))  11: {  12: // yep, the class exists  13: }  Nebula3单件  很多Nebula3的核心对象都是单件, 就是只存在一个实例, 并且所有其它对象都知道它.  你可以通过静态方法Instance()来访问单件, 它返回唯一实例的一个指针. 返回的指针保证是合法的. 如果在调用Instance()方法时对象实例不存在, 一个断点会被抛出:  1: // obtain a pointer to the Core::Server singleton  2:&nbsp;&nbsp;&nbsp;&nbsp; Ptr<Core::Server> coreServer = Core::Server::Instance();  你也可以检查单件是否存在:  1: // does the Core::Server object exist?  2: if (Core::Server::HasInstance())  3: {  4: // yep, the core server exists  5: }  Nebula3提供了一些辅助的宏来实现单件:  1: // declare a singleton class  2: class MySingletonClass : public Core::RefCounted  3: {  4: DeclareClass(MySingletonClass);  5: DeclareSingleton(MySingletonClass);  6: public:  7: /// constructor  8:&nbsp;&nbsp;&nbsp;&nbsp; MySingletonClass();  9: /// destructor  10: virtual ~MySingletonClass();  11: ...  12: };  13:  14: // implement the singleton class  15: ImplementClass(MyNamespace::MySingletonClass, 'MYSC', Core::RefCounted);  16: ImplementSingleton(MyNamespace::MySingletonClass);  17:  18: //------------------------------------------------------------------------------  19: /**  20: &nbsp;&nbsp;&nbsp; Implements the Singleton constructor.  21: */  22: MySingletonClass::MySingletonClass()  23: {  24: ConstructSingleton;  25: }  26:  27: //------------------------------------------------------------------------------  28: /**  29: &nbsp;&nbsp;&nbsp; Implements the Singleton destructor.  30: */  31: MySingletonClass:~MySingletonClass()  32: {  33: DestructSingleton;  34: }  DeclareSingleton()和ImplementSingleton()宏跟DeclareClass()和ImplementClass()宏差不多.它们在类中添加了一些静态方法(也就是Instance()和HasInstance()). 类的构造函数和析构函数必须包含ConstructSingleton和DestructSingleton宏. ContructSingleton初始化了一个私有的单件指针并保证没有其它的类实例存在(如果不是, 会抛出断言). DestructSingleton让私有的单件指针无效化.  单件的访问默认是只有本地线程. 这意味着在一个线程中创建的单件无法被其他线程访问. 这使得”并行Nebula”大大简化了多线程编程. “并行Nebula”的基本思想是, 一个典型的Nebula3应用程序包含一些”Fat线程”, 每一个Fat线程都是运行在一个单独的CPU核心上. Fat线程可以用于实现异步IO, 渲染, 物理等等. 每一个Fat线程都初始化了它们自己的Nebula3运行环境, 它们执行特性任务所需的最少依赖. 这基本上消除了大部分Nebula3代码的同步问题, 并且把线程相关的代码集中到一个明确定义的代码区域中. “并行Nebula”的另一个好处就是, 程序员在多线程环境中编程时不需要关心太多. 大多数Nebula3代码看起来就像单线程代码一样, 但是它们却运行在各自的Fat线程中.  性能与内存占用的考虑  Nebula3核心层的一个设计目标就是减少底层代码的内存占用, 来更好的适应微型平台, 像手持设备. 这里有一些已经完成的目标:   RefCounted 类在每个实例中只增加了4byte用于引用计数.  RTTI机制在开头增加了30 到 60 byte, 但是这是对于每个类来说的, 而是不是每个实例.  一个智能指针仅仅4 byte, 就像普通指针一样.  一些监控结构只会在debug模型下创建，　特别是用来检测引擎计数泄露的RefCountedList. 这里一些用三种不种的创建方法创建一百万个RefCounted 对象所需的时间信息. 这些时间信息是在台Intel Pentium 800 MHz的笔记本上得出的.&nbsp;&nbsp;  Create(): 0.29 seconds  FourCC: 0.65 seconds  类名: 1.45 seconds "></span><header class=post-header><h1 class=post-title itemprop="name headline">Nebula3学习笔记(2)： 核心库</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2008年12月14日 21:22:00 CST" itemprop="dateCreated datePublished" datetime="2008-12-14 21:22:00 +0800 +0800">2008年12月14日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2008年12月14日 21:23:00 CST" itemprop="dateModified dateLastmod" datetime="2008-12-14 21:23:00 +0800 +0800">2008年12月14日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>3498</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>7分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/nebula3-learning-notes-2-core-library/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><strong>核心子系统</strong><p>核心库(Core namespace)实现了这些特性:<ul><li>一个实现了引用计数的RefCounted基类<li>一个运行时类型信息系统(RTTI)<li>一个模板智能指针, 用于处理RefCounted对象的生命周期<li>一个由类名创建C++对象实例的工厂机制<li>一个中央Server对象用于建立基本的Nebula3运行环境</li></ul><p><strong>对象模型</strong><p>Nebula3在C++对象模型的基础之上实现了下面这些新特性:<ul><li>基于引用计数和智能指针的生命周期管理<li>基于类名或四字符编码的对象创建<li>一个运行时类型信息系统</li></ul><p><strong>实现一个新的Nebula3类</strong><p>当实现一个新的类时首先要考虑它是一个传统的C++类还是要从Core::RefCounted继承. 以下几点可以帮你找到答案:<ul><li>如果这个类需要使用Nebula3的扩展对象特性, 如引用计数, RTTI等, 则它必须从Core::RefCounted继承.<li>如果这个类是一个典型的小工具类, 如动态数组, 数学向量, 或其它相似的东西, 那么它从Core::RefCounted 继承也没有什么意义.</li></ul><p>从Core::RefCounted类继承有一些限制:<ul><li>RefCounted派生类不应该在栈上创建对象, 因为栈对象的生命周期是由C++来管理的(他们会在离开当前上下文时被销毁, 从而绕过了Nebula3的引用计数生命周期 管理)<li>RefCounted的派生类只有一个默认的构造函数.<li>RefCounted的派生类必须有一个虚析构函数.<li>RefCounted的派生类不能进行拷贝, 因为这样会造成引用计数机制混乱.</li></ul><p>要使用Nebula3的对象模型特性, 除了需要从Core::RefCounted继承外, 还需要在头文件新类的声明中进行额外的标注:<p>一个标准的RefCounted派生类一般这样声明:<p>1: namespace MyNamespace<p>2: <strong>{</strong><p>3: <strong>class</strong> MyClass : <strong>public</strong> Core::RefCounted<p>4: <strong>{</strong><p>5: DeclareClass<strong>(</strong>MyClass<strong>);</strong><p>6: <strong>public</strong>:<p>7: <em>/// constructor</em><p>8:&nbsp;&nbsp;&nbsp;&nbsp; MyClass<strong>();</strong><p>9: <em>/// destructor</em><p>10: <strong>virtual</strong> ~MyClass<strong>();</strong><p>11: <strong>.</strong>..<p>12: <strong>};</strong><p>13: RegisterClass<strong>(</strong>MyClass<strong>);</strong><p>注意DeclareClass()宏, 构造函数, 析构函数还有类外面的RegisterClass()宏. DeclareClass()宏加入了RTTI和工厂机制所需的最小代价的信息, 它隐藏了Nebula3的对象模型, 希望可以在不影响已有类的基础进上进行内部机制的变更. RegisterClass()宏是可选的, 它把当前类在中央工厂进行注册. 如果你知道这个类永远不会由类名或四字符编码进行创建, 这个宏可以省略.<p>在这个类的.cpp文件里需要包含Nebula3特有的信息:<p>1: namespace MyNamespace<p>2: <strong>{</strong><p>3: ImplementClass<strong>(</strong>MyNamespace::MyClass<strong>,</strong> 'MYCL'<strong>,</strong> Core::RefCounted<strong>);</strong><p>4:<p>5: <strong>}</strong><p>ImplementClass()宏注册类的RTTI机制, 第一个参数描述了类的名字(注意命名空间必须包含). 第二个参数是类的四字符编码, 它必须是所有类中唯一的(如果有重复, 你会在启动程序时得到一个错误提示). 第三个参数是父类的名字, 用于RTTI系统去构造类的关系树.<p><strong>引用计数和智能指针</strong><p>Nebula3使用传统的引用计数来管理对象的生命周期. 一个模板智能指针类Ptr&lt;>对程序员隐藏了引用计数的实现细节. 一般来说, 应该一直使用智能指针指向RefCounted的派生对象, 除非你能肯定在给出的代码块中这个对象的引用计数不会发生变化.<p>智能指针相对于一般指针有很多好处:<ul><li>访问一个空指针会给你一个断言警告而不是一个内存错误<li>你不需要对引用计数的对象调用AddRef()或Release() (事实上如果你调了, 会了发生严重的错误)<li>智能指针可以在容器类里良好地工作, 一个智能指针的数组会消除所有的一般指针需要的生命周期管理, 你永远不需要考虑去释放指针所指针的对象, 数组包含的像是真正的C++对象一样<li>用智能指针不需要考虑指针的所属, 不需要为谁delete对象而烦恼</li></ul><p>智能指针也有一些缺点:<ul><li>性能: 拷贝和赋值会引起对象的引用计数的变化, 解除引用会引起指针的断言检查. 这导致的性能消耗一般是可以忽略的, 但是你最好保证它不在内部循环中发生.<li>应该销毁的对象还存在: 因为智能指针管理的对象只有在最后一个引用放弃时才会销毁, 这样会使对象存在超过预订的时间. 这经常会导致一个BUG的产生. 不过引用计数泄露(程序退出时还仍然存在的对象)时Nebula3会提醒你.</li></ul><p><strong>创建Nebula3对象</strong><p>从Core::RefCounted继承的类可以通过3种不同的方式进行创建:<p>直接通过静态的Create方法:<p>1: Ptr&lt;MyClass> myObj = MyClass::Create<strong>();</strong><p>静态的Create()方法是之前提到的DeclareClass()宏加入的, 相对于new操作符来说, 它并没有多做什么. 注意正确使用智能指针来保存新建的对象.<p>另一种创建方式是通过类名:<p>1: using namespace Core<strong>;</strong><p>2: Ptr&lt;MyClass> myObj = <strong>(</strong>MyClass*<strong>)</strong>Factory::Instance<strong>()</strong>->Create<strong>(</strong>"MyNamespace::MyClass"<strong>);</strong><p>当你在运行时通过类名来创建十分有用, 特别是对象的反序列化和脚本接口的使用. 注意类型转换是必须的, 因为工厂的Creat()方法返回的是RefCounted指针.<p>由类名创建的变种是根据四字符编码进行创建:<p>1: using namespace Core<strong>;</strong><p>2: using namespace Util<strong>;</strong><p>3: Ptr&lt;MyClass> myObj = <strong>(</strong>MyClass*<strong>)</strong> Factory::Instance<strong>()</strong>->Create<strong>(</strong>FourCC<strong>(</strong>'MYCL'<strong>));</strong><p>这个方法看上去没有那个直观, 但是它比类名创建快得多. 并且四字符编码比类名占用的空间更少, 这更利于对象写入二进制流或从中读取.<p><strong>运行时类型信息系统</strong><p>Nebula3的RTTI系统可以让你在运行时访问对象的类型, 检查一个对象是不是某个类的实例, 或者某个派生类的实例. 你也可以直接获得一个对象的类名和四字符编码. 所有这些功能是由DeclareClass() 和 ImplementClass() 宏在背后实现的.<p>这时有示例程序:<p>1:&nbsp;&nbsp;&nbsp;&nbsp; using namespace Util<strong>;</strong><p>2:&nbsp;&nbsp;&nbsp;&nbsp; using namespace Core<strong>;</strong><p>3:<p>4: <em>// check whether an object is instance of a specific class</em><p>5: <strong>if</strong> <strong>(</strong>myObj->IsInstanceOf<strong>(</strong>MyClass::RTTI<strong>))</strong><p>6: <strong>{</strong><p>7: <em>// it's a MyClass object</em><p>8: <strong>}</strong><p>9:<p>10: <em>// check whether an object is instance of a derived class</em><p>11: <strong>if</strong> <strong>(</strong>myObj->IsA<strong>(</strong>RefCounted::RTTI<strong>))</strong><p>12: <strong>{</strong><p>13: <em>// it's a RefCounted instance or some RefCounted-derived instance</em><p>14: <strong>}</strong><p>15:<p>16: <em>// get the class name of my object, this yields "MyNamespace::MyClass"</em><p>17: <strong>const</strong> String& className = myObj->GetClassName<strong>();</strong><p>18:<p>19: <em>// get the fourcc class identifier of my object, this yields 'MYCL'</em><p>20: <strong>const</strong> FourCC& fourcc = myObj->GetClassFourCC<strong>();</strong><p>你也可以向中央工厂查询一个类是否已经注册:<p>1:&nbsp;&nbsp;&nbsp;&nbsp; using namespace Core<strong>;</strong><p>2:<p>3: <em>// check if a class has been registered by class name</em><p>4: <strong>if</strong> <strong>(</strong>Factory::Instance<strong>()</strong>->ClassExists<strong>(</strong>"MyNamespace::MyClass"<strong>))</strong><p>5: <strong>{</strong><p>6: <em>// yep, the class exists</em><p>7: <strong>}</strong><p>8:<p>9: <em>// check if a class has been registered by class fourcc code</em><p>10: <strong>if</strong> <strong>(</strong>Factory::Instance<strong>()</strong>->ClassExists<strong>(</strong>FourCC<strong>(</strong>'MYCL'<strong>)))</strong><p>11: <strong>{</strong><p>12: <em>// yep, the class exists</em><p>13: <strong>}</strong><p><strong>Nebula3单件</strong><p>很多Nebula3的核心对象都是单件, 就是只存在一个实例, 并且所有其它对象都知道它.<p>你可以通过静态方法Instance()来访问单件, 它返回唯一实例的一个指针. 返回的指针保证是合法的. 如果在调用Instance()方法时对象实例不存在, 一个断点会被抛出:<p>1: <em>// obtain a pointer to the Core::Server singleton</em><p>2:&nbsp;&nbsp;&nbsp;&nbsp; Ptr&lt;Core::Server> coreServer = Core::Server::Instance<strong>();</strong><p>你也可以检查单件是否存在:<p>1: <em>// does the Core::Server object exist?</em><p>2: <strong>if</strong> <strong>(</strong>Core::Server::HasInstance<strong>())</strong><p>3: <strong>{</strong><p>4: <em>// yep, the core server exists</em><p>5: <strong>}</strong><p>Nebula3提供了一些辅助的宏来实现单件:<p>1: <em>// declare a singleton class</em><p>2: <strong>class</strong> MySingletonClass : <strong>public</strong> Core::RefCounted<p>3: <strong>{</strong><p>4: DeclareClass<strong>(</strong>MySingletonClass<strong>);</strong><p>5: DeclareSingleton<strong>(</strong>MySingletonClass<strong>);</strong><p>6: <strong>public</strong>:<p>7: <em>/// constructor</em><p>8:&nbsp;&nbsp;&nbsp;&nbsp; MySingletonClass<strong>();</strong><p>9: <em>/// destructor</em><p>10: <strong>virtual</strong> ~MySingletonClass<strong>();</strong><p>11: <strong>.</strong>..<p>12: <strong>};</strong><p>13:<p>14: <em>// implement the singleton class</em><p>15: ImplementClass<strong>(</strong>MyNamespace::MySingletonClass<strong>,</strong> 'MYSC'<strong>,</strong> Core::RefCounted<strong>);</strong><p>16: ImplementSingleton<strong>(</strong>MyNamespace::MySingletonClass<strong>);</strong><p>17:<p>18: <em>//------------------------------------------------------------------------------</em><p>19: <em>/**</em><p>20: <em>&nbsp;&nbsp;&nbsp; Implements the Singleton constructor.</em><p>21: <em>*/</em><p>22: MySingletonClass::MySingletonClass<strong>()</strong><p>23: <strong>{</strong><p>24: ConstructSingleton<strong>;</strong><p>25: <strong>}</strong><p>26:<p>27: <em>//------------------------------------------------------------------------------</em><p>28: <em>/**</em><p>29: <em>&nbsp;&nbsp;&nbsp; Implements the Singleton destructor.</em><p>30: <em>*/</em><p>31: MySingletonClass:~MySingletonClass<strong>()</strong><p>32: <strong>{</strong><p>33: DestructSingleton<strong>;</strong><p>34: <strong>}</strong><p>DeclareSingleton()和ImplementSingleton()宏跟DeclareClass()和ImplementClass()宏差不多.它们在类中添加了一些静态方法(也就是Instance()和HasInstance()). 类的构造函数和析构函数必须包含<strong>ConstructSingleton</strong>和<strong>DestructSingleton</strong>宏. ContructSingleton初始化了一个私有的单件指针并保证没有其它的类实例存在(如果不是, 会抛出断言). DestructSingleton让私有的单件指针无效化.<p>单件的访问默认是只有本地线程. 这意味着在一个线程中创建的单件无法被其他线程访问. 这使得”并行Nebula”大大简化了多线程编程. “并行Nebula”的基本思想是, 一个典型的Nebula3应用程序包含一些”Fat线程”, 每一个Fat线程都是运行在一个单独的CPU核心上. Fat线程可以用于实现异步IO, 渲染, 物理等等. 每一个Fat线程都初始化了它们自己的Nebula3运行环境, 它们执行特性任务所需的最少依赖. 这基本上消除了大部分Nebula3代码的同步问题, 并且把线程相关的代码集中到一个明确定义的代码区域中. “并行Nebula”的另一个好处就是, 程序员在多线程环境中编程时不需要关心太多. 大多数Nebula3代码看起来就像单线程代码一样, 但是它们却运行在各自的Fat线程中.<p><strong>性能与内存占用的考虑</strong><p>Nebula3核心层的一个设计目标就是减少底层代码的内存占用, 来更好的适应微型平台, 像手持设备. 这里有一些已经完成的目标:<ul><li>RefCounted 类在每个实例中只增加了4byte用于引用计数.<li>RTTI机制在开头增加了30 到 60 byte, 但是这是对于每个类来说的, 而是不是每个实例.<li>一个智能指针仅仅4 byte, 就像普通指针一样.<li>一些监控结构只会在debug模型下创建，　特别是用来检测引擎计数泄露的RefCountedList.</li></ul><p>这里一些用三种不种的创建方法创建一百万个RefCounted 对象所需的时间信息. 这些时间信息是在台Intel Pentium 800 MHz的笔记本上得出的.&nbsp;&nbsp;<ul><li>Create(): 0.29 seconds<li>FourCC: 0.65 seconds<li>类名: 1.45 seconds</li></ul><a id=more></a></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
Nebula3学习笔记(2)： 核心库</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/nebula3-learning-notes-2-core-library/ title="Nebula3学习笔记(2)： 核心库">https://blogs.qipai360.cn/post/nebula3-learning-notes-2-core-library/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/nebula3-learning-notes-3-tools-library/ rel=next title="Nebula3学习笔记(3)： 工具库"><i class="fa fa-chevron-left"></i> Nebula3学习笔记(3)： 工具库</a></div><div class="post-nav-prev post-nav-item"><a href=/post/nebula3-learning-notes-1-intro/ rel=prev title="Nebula3学习笔记(1)： 序">Nebula3学习笔记(1)： 序
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"nebula3-learning-notes-2-core-library","permalink":"https://blogs.qipai360.cn/post/nebula3-learning-notes-2-core-library/","title":"Nebula3学习笔记(2)： 核心库","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1761990624" defer></script></body></html>