<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="使用DirectPlay进行网络互联（4）"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="使用DirectPlay进行网络互联（4）"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/networking-with-directplay-part-4/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2007-08-13 22:36:00 +0800 +0800"><meta property="article:modified_time" content="2007-08-27 17:14:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1761990628"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>使用DirectPlay进行网络互联（4） - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>678</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>678</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2418817></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5198></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-01 14:55:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/networking-with-directplay-part-4/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="使用DirectPlay进行网络互联（4）"><meta itemprop=description content="客户端的处理客户端并不像服务器端那么复杂，它通常只使用两种消息，即接收数据和终止会话消息，以及需要连接和保持单一连接（服务器端）。另外最主要的就是客户端应用程序必须指定其玩家的位置，以便主机能够检索它们。设置玩家的信息是通过首先将相关数据填入一个DPN_PLAYER_INFO结构体，然后再调用IDirectPlay8Client:: SetClientInfo函数来实现。"></span><header class=post-header><h1 class=post-title itemprop="name headline">使用DirectPlay进行网络互联（4）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年08月13日 22:36:00 CST" itemprop="dateCreated datePublished" datetime="2007-08-13 22:36:00 +0800 +0800">2007年08月13日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:14:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:14:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>71992</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>144分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/networking-with-directplay-part-4/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><span style=font-weight:700;color:#2d6a24>客户端的处理</span><br><br>客户端并不像服务器端那么复杂，它通常只使用两种消息，即接收数据和终止会话消息，以及需要连接和保持单一连接（服务器端）。另外最主要的就是客户端应用程序必须指定其玩家的位置，以便主机能够检索它们。设置玩家的信息是通过首先将相关数据填入一个DPN_PLAYER_INFO结构体，然后再调用IDirectPlay8Client:: SetClientInfo函数来实现。<br><br></p><a id=more></a><p><font face="Segoe UI">Sets the static settings of a client with an application. Call this method before connecting to relay basic player information to the application. Once the client successfully connects with the application, the server can retrieve information obtained through this method by calling the <strong>IDirectPlay8Server::GetClientInfo</strong> method.</font></p><pre class=syntax><font face="Segoe UI"><strong>HRESULT SetClientInfo(<br>const DPN_PLAYER_INFO *const</strong> <em><a class=synParam onclick=showTip(this)>pdpnPlayerInfo</a></em>,<br><strong>PVOID const</strong> <em><a class=synParam onclick=showTip(this)>pvAsyncContext</a></em>,<br><strong>DPNHANDLE *const</strong> <em><a class=synParam onclick=showTip(this)>phAsyncHandle</a></em>,<br><strong>const DWORD</strong> <em><a class=synParam onclick=showTip(this)>dwFlags</a></em><br><strong>);</strong></font></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4><font face="Segoe UI">Parameters</font></h4><dl><dt><font face="Segoe UI"><em>pdpnPlayerInfo</em></font><dd><font face="Segoe UI">[in] Pointer to a <strong>DPN_PLAYER_INFO</strong> structure that contains the client information to set.</font><dt><font face="Segoe UI"><em>pvAsyncContext</em></font><dd><font face="Segoe UI">[in] Pointer to the user-supplied context, which is returned in the <strong>pvUserContext</strong> member of the <strong>DPN_MSGID_ASYNC_OP_COMPLETE</strong> system message.</font><dt><font face="Segoe UI"><em>phAsyncHandle</em></font><dd><font face="Segoe UI">[in,out] A <strong>DPNHANDLE</strong>. A value will be returned. However, Microsoft® DirectPlay® 8.1 does not permit cancellation of this operation, so the value cannot be used.</font><dt><font face="Segoe UI"><em>dwFlags</em></font><dd><font face="Segoe UI">[in] Flag that controls how this method is processed. The following flag can be set for this method.</font><dl><dt><font face="Segoe UI">DPNSETCLIENTINFO_SYNC</font><dd><font face="Segoe UI">Causes the method to process synchronously.</font></dd></dl></dd></dl><h4><font face="Segoe UI">Return Values</font></h4><p><font face="Segoe UI">Returns S_OK if this method is processed synchronously and is successful. If the request is processed asynchronously, S_OK can return if the method is instantly processed. By default, this method is run asynchronously and generally returns DPNSUCCESS_PENDING or one of the following error values.</font></p><table><tbody><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_NOCONNECTION</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDFLAGS</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDPARAM</font></td></tr></tbody></table>&nbsp;<h4><font face="Segoe UI">Remarks</font></h4><p><font face="Segoe UI">This method can be called at any time during the session.</font></p><p><font face="Segoe UI">The <strong>dwPlayerFlags</strong> member of the <strong>DPN_PLAYER_INFO</strong> structure must be set to zero.</font></p><p><font face="Segoe UI">Transmission of nonstatic information should be handled with the <strong>IDirectPlay8Client::Send</strong> method because of the high cost of using the <strong>IDirectPlay8Client::SetClientInfo</strong> method.</font></p><p><font face="Segoe UI">You can modify the client information with this method after connecting to the application. Calling this method after connection generates a <strong>DPN_MSGID_CLIENT_INFO</strong> system message to all players, informing them that data has been updated.</font></p><br>服务器端和客户端都使用相同的应用程序GUID，这样它们才能相互识别。网络应用程序不能连接的主要原因就是没有这样做，所以一定要确保使用相同的应用程序GUID。<br><br>设置好客户端的信息后，需要与服务器端建立连接，可以调用 IDirectPlay6Client::Connect来实现。<br><br><p><font face="Segoe UI">Establishes the connection to the server. After a connection is established, the communication channel on the interface is open and the application should expect messages to arrive immediately. No messages can be sent by means of the <strong>IDirectPlay8Client::Send</strong> method until the connection has completed.</font></p><p><font face="Segoe UI">Before this method is called, you can obtain an application description by calling <strong>IDirectPlay8Client::EnumHosts</strong>. When you call <strong>EnumHosts</strong>, DPN_MSGID_ENUM_HOSTS_RESPONSE messages are sent to your message handler with the <strong>IDirectPlay8Address</strong> objects and the <strong>DPN_APPLICATION_DESC</strong> structure for each host found. This information can be passed without modification to the <strong>Connect</strong> method.</font></p><pre class=syntax><font face="Segoe UI"><strong>HRESULT Connect(<br>const DPN_APPLICATION_DESC *const</strong> <em><a class=synParam onclick=showTip(this)>pdnAppDesc</a></em>,<br><strong>IDirectPlay8Address *const</strong> <em><a class=synParam onclick=showTip(this)>pHostAddr</a></em>,<br><strong>IDirectPlay8Address *const</strong> <em><a class=synParam onclick=showTip(this)>pDeviceInfo</a></em>,<br><strong>const DPN_SECURITY_DESC *const</strong> <em><a class=synParam onclick=showTip(this)>pdnSecurity</a></em>,<br><strong>const DPN_SECURITY_CREDENTIALS *const</strong> <em><a class=synParam onclick=showTip(this)>pdnCredentials</a></em>,<br><strong>const void *const</strong> <em><a class=synParam onclick=showTip(this)>pvUserConnectData</a></em>,<br><strong>const DWORD</strong> <em><a class=synParam onclick=showTip(this)>dwUserConnectDataSize</a></em>,<br><strong>void *const</strong> <em><a class=synParam onclick=showTip(this)>pvAsyncContext</a></em>,<br><strong>DPNHANDLE *const</strong> <em><a class=synParam onclick=showTip(this)>phAsyncHandle</a></em>,<br><strong>const DWORD</strong> <em><a class=synParam onclick=showTip(this)>dwFlags</a></em><br><strong>);</strong></font></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4><font face="Segoe UI">Parameters</font></h4><dl><dt><font face="Segoe UI"><em>pdnAppDesc</em></font><dd><font face="Segoe UI">[in] Pointer to a <strong>DPN_APPLICATION_DESC</strong> structure that describes the application. The only member of this structure that you must set is the <strong>guidApplication</strong> member. Only some of the members of this structure are used by this method. The only member that you must set is <strong>guidApplication</strong>. You can also set <strong>guidInstance</strong>,<strong> pwszPassword</strong>, <strong>dwFlags</strong>, and <strong>dwSize</strong>.</font><dt><font face="Segoe UI"><em>pHostAddr</em></font><dd><font face="Segoe UI">[in] Pointer to an <strong>IDirectPlay8Address</strong> interface that specifies the addressing information to use to connect to the computer that is hosting. The user can be queried for any missing address information if you set the DPNENUMHOSTS_OKTOQUERYFORADDRESSING flag in the <em>dwFlags</em> parameter.</font><dt><font face="Segoe UI"><em>pDeviceInfo</em></font><dd><font face="Segoe UI">[in] Pointer to an <strong>IDirectPlay8Address</strong> object that specifies what network adapter (for example, NIC, modem, and so on) to use to connect to the server. Some service providers allow this parameter to be NULL or be an address object containing only the service provider component. In this case, they will use the most appropriate device to reach the designated host. If you set the DPNCONNECT_OKTOQUERYFORADDRESSING flag in <em>dwFlags</em>, the user can be queried for any missing address information.</font><dt><font face="Segoe UI"><em>pdnSecurity</em></font><dd><font face="Segoe UI">[in] Reserved. Must be NULL.</font><dt><font face="Segoe UI"><em>pdnCredentials</em></font><dd><font face="Segoe UI">[in] Reserved. Must be NULL.</font><dt><font face="Segoe UI"><em>pvUserConnectData</em></font><dd><font face="Segoe UI">[in] Pointer to application-specific data provided to the host or server to further validate the connection. DirectPlay will make a copy of this data when the method is called and therefore you can modify or destroy this data once the connection is complete. This data is sent to the <strong>DPN_MSGID_INDICATE_CONNECT</strong> message in the <strong>pvUserConnectData</strong> member. This parameter is optional and you can pass NULL to bypass the connection validation provided by the user code.</font><dt><font face="Segoe UI"><em>dwUserConnectDataSize</em></font><dd><font face="Segoe UI">[in] Variable of type <strong>DWORD </strong>that specifies the size of the data contained in <em>pvUserConnectData</em>.</font><dt><font face="Segoe UI"><em>pvAsyncContext</em></font><dd><font face="Segoe UI">[in] Pointer to the user-supplied context, which is returned in the <strong>pvUserContext</strong> member of the <strong>DPN_MSGID_CONNECT_COMPLETE</strong> system message. This parameter is optional and can be set to NULL.</font><dt><font face="Segoe UI"><em>phAsyncHandle</em></font><dd><font face="Segoe UI">[out] A <strong>DPNHANDLE</strong>.<strong> </strong>When the method returns, <em>phAsyncHandle</em> will point to a handle that you can pass to <strong>IDirectPlay8Client::CancelAsyncOperation</strong> to cancel the operation. This parameter must be set to NULL if you set the DPNCONNECT_SYNC flag in <em>dwFlags.</em></font><dt><font face="Segoe UI"><em>dwFlags</em></font><dd><font face="Segoe UI">[in] Flag that describes the connection mode. You can set the following flag.</font><dl><dt><font face="Segoe UI">DPNCONNECT_OKTOQUERYFORADDRESSING</font><dd><font face="Segoe UI">Setting this flag will display a standard Microsoft® DirectPlay® dialog box, which queries the user for more information if not enough information is passed in this method.</font><dt><font face="Segoe UI">DPNCONNECT_SYNC</font><dd><font face="Segoe UI">Process the connection request synchronously.</font></dd></dl></dd></dl><h4><font face="Segoe UI">Return Values</font></h4><p><font face="Segoe UI">Returns S_OK if this method is processed synchronously and is successful. If the request is processed asynchronously, S_OK will be returned if the method is instantly processed. By default, this method is run asynchronously and generally returns DPNSUCCESS_PENDING or one of the following error values.</font></p><table><tbody><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_HOSTREJECTEDCONNECTION</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDAPPLICATION</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDDEVICEADDRESS</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDFLAGS</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDHOSTADDRESS</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDINSTANCE</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDINTERFACE</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDPASSWORD</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_NOCONNECTION</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_NOTHOST</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_SESSIONFULL</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_ALREADYCONNECTED</font></td></tr></tbody></table>&nbsp;<h4><font face="Segoe UI">Remarks</font></h4><p><font face="Segoe UI">It is not required to enumerate hosts before calling <strong>Connect</strong> if you know the appropriate host and device information.</font></p><p><font face="Segoe UI">If you do call the <strong>IDirectPlay8Client::EnumHosts</strong> method and you want to ensure better network address translation (NAT) and proxy support when using the TCP/IP service provider or prevent redialing with the modem service provider, keep the enumeration active when calling <strong>Connect</strong>. To prevent the enumeration from completing, set the <em>dwEnumCount</em> parameter to INFINITE and do not use the <strong>IDirectPlay8Client::CancelAsyncOperation</strong> to terminate the enumeration before the connect operation has completed. You should also pass the <strong>pAddressSender</strong> and <strong>pAddressDevice</strong> address objects in the DPNMSG_ENUM_HOSTS_RESPONSE message without modification into the <em>pHostAddr</em> and <em>pDeviceInfo</em> parameters of the <strong>Connect</strong> method. To pass the address objects to <strong>Connect</strong> outside of the callback function, use <strong>IDirectPlay8Address::Duplicate</strong> or <strong>IDirectPlay8Address::AddRef</strong> to prevent the object from being destroyed and store the pointers using thread-safe code. DirectPlay will automatically cancel the enumeration when the connect completes with DPN_OK or when <strong>IDirectPlay8Client::Close</strong> is called.</font></p><p><font face="Segoe UI">Although multiple enumerations can be run concurrently and can be run across the duration of a connection, only one connection is allowed per interface. To establish a connection to more than one application, you must create another interface.</font></p><p><font face="Segoe UI">When this method is called, a <strong>DPN_MSGID_INDICATE_CONNECT</strong> message is posted to the server's message handler. On retrieval of this message, the host can pass back connection reply data to the <strong>Connect</strong> method. Connection reply data can send a message indicating that the host does not approve the connection. The calling application can then handle this reply appropriately.</font></p><p><font face="Segoe UI">If <strong>Connect</strong> is called synchronously, the following outcomes are possible.</font></p><ul><li><font face="Segoe UI">Connection Successful. The application will receive a <strong>DPN_MSGID_CONNECT_COMPLETE</strong> message containing the success code and the <strong>Connect</strong> method will return with DPN_OK.</font><li><font face="Segoe UI">Connection fails because the server rejects the connection. The application will receive a <strong>DPN_MSGID_CONNECT_COMPLETE</strong> message containing the DPNERR_HOSTREJECTEDCONNECTION failure code. The <strong>Connect</strong> method will also return with the error code DPNERR_HOSTREJECTEDCONNECTION. The <strong>DPN_MSGID_CONNECT_COMPLETE</strong> message provides an opportunity for the client application to inspect any data the server returns with the rejection.</font><li><font face="Segoe UI">Connection fails for any other reason. The application will not receive a <strong>DPN_MSGID_CONNECT_COMPLETE</strong> message, and the <strong>Connect</strong> method will return with the appropriate error code.</font></li></ul><p><font face="Segoe UI">If <strong>Connect</strong> is called asynchronously, the method returns immediately with DPNSUCCESS_PENDING. A <strong>DPN_MSGID_CONNECT_COMPLETE</strong> message will follow after the connection is complete, containing the result of the connection. The only time the method does not return DPNSUCCESS_PENDING is when validation of the supplied parameters fails, in which case the appropriate error code is returned.</font></p><p><font face="Segoe UI">When the connection request completes, all outstanding enumerations are canceled with the return of DPNERR_USERCANCEL.</font></p><p><font face="Segoe UI">The hResultCode on the completion will indicate S_OK if the Connect() attempt was successful, or an error otherwise. If the Host player returned anything other than S_OK from the <strong>DPN_MSGID_INDICATE_CONNECT</strong> message, the likely error code in the completion will be DPNERR_HOSTREJECTEDCONNECTION.</font></p><p><font face="Segoe UI">To close the connection established with this method, call the <strong>IDirectPlay8Client::Close</strong> method.</font></p><p><font face="Segoe UI"><strong>Note</strong>&nbsp;&nbsp;If you set the DPNCONNECT_OKTOQUERYFORADDRESSING flag in <em>dwFlags</em>, the service provider might attempt to display a dialog box to ask the user to complete the address information. You must have a visible window present when the service provider tries to display the dialog box, or your application will lock.</font></p><br>最后一个参数dwFlags告诉DirectPlay采用异步（0）还是同步（DPNCONNECT_SYNC）方式进行连接。使用异步连接方式会立即返回控制权，所以需要等待DPN_MSGID_CONNECT_COMPLETE消息来标识和服务器端的成功连接。采用同步连接方式， Connect函数就只会在出现错误或成功连接时才会返回。<br><br>下面这个函数演示了如何设置客户端属性并建立与服务器端的连接。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br></span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>ClientClass</span><span style=color:#000>"</span><span style=color:#000>;<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;application&nbsp;GUID</span><span style=color:green><br></span><span style=color:#000>GUID&nbsp;g_app_guid&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;{&nbsp;</span><span style=color:#000>0xababbe60</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x1ac0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x11d5</span><span style=color:#000>,&nbsp;{&nbsp;</span><span style=color:#000>0x90</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x89</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x44</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x45</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x53</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x54</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x1</span><span style=color:#000>&nbsp;}&nbsp;};<br><br>IDirectPlay8Client</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;DirectPlay&nbsp;Client</span><span style=color:green><br></span><span style=color:#000>DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;g_adapter_list;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_num_adapters;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;number&nbsp;of&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000><br>BOOL&nbsp;g_is_connected;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;indicates&nbsp;whether&nbsp;connection&nbsp;between&nbsp;client&nbsp;and&nbsp;server&nbsp;is&nbsp;build&nbsp;up</span><span style=color:green><br></span><span style=color:#000>DPNHANDLE&nbsp;g_async_handle;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;async&nbsp;connection&nbsp;handle<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Start&nbsp;connecting&nbsp;to&nbsp;server&nbsp;which&nbsp;GUID&nbsp;specified&nbsp;by&nbsp;adapter_guid&nbsp;and&nbsp;server&nbsp;IP<br></span><span style=color:green>//</span><span style=color:green>&nbsp;specified&nbsp;by&nbsp;ip.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Start_Session(GUID</span><span style=color:#000>*</span><span style=color:#000>&nbsp;adapter_guid,&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;ip)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Make&nbsp;sure&nbsp;there&nbsp;are&nbsp;an&nbsp;invalid&nbsp;adapter&nbsp;and&nbsp;an&nbsp;invalid&nbsp;IP&nbsp;address</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(adapter_guid&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL&nbsp;</span><span style=color:#000>||</span><span style=color:#000>&nbsp;ip&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Need&nbsp;to&nbsp;re-assign&nbsp;a&nbsp;network&nbsp;handler&nbsp;as&nbsp;quitting&nbsp;a&nbsp;previous&nbsp;session&nbsp;to&nbsp;clears&nbsp;it.<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Close&nbsp;the&nbsp;connection&nbsp;first&nbsp;before&nbsp;assigning&nbsp;a&nbsp;new&nbsp;network&nbsp;handler.<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Closes&nbsp;the&nbsp;open&nbsp;connnection&nbsp;to&nbsp;a&nbsp;session.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Close(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Initialize&nbsp;DirectPlay&nbsp;Client</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Initialize(NULL,&nbsp;Net_Msg_Handle,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Assign&nbsp;player&nbsp;information</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;player_name[</span><span style=color:#000>256</span><span style=color:#000>];<br>&nbsp;&nbsp;&nbsp;&nbsp;WCHAR&nbsp;w_player_name[</span><span style=color:#000>256</span><span style=color:#000>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;player_name,&nbsp;</span><span style=color:#000>256</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;mbstowcs(w_player_name,&nbsp;player_name,&nbsp;strlen(player_name)&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;DPN_PLAYER_INFO&nbsp;dpn_player_info;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>dpn_player_info,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DPN_PLAYER_INFO));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;dpn_player_info.dwSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DPN_PLAYER_INFO);<br>&nbsp;&nbsp;&nbsp;&nbsp;dpn_player_info.dwInfoFlags&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DPNINFO_NAME&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;DPNINFO_DATA;<br>&nbsp;&nbsp;&nbsp;&nbsp;dpn_player_info.pwszName&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;w_player_name;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;static&nbsp;settings&nbsp;of&nbsp;a&nbsp;client&nbsp;with&nbsp;an&nbsp;application,&nbsp;process&nbsp;synchronously.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>SetClientInfo(</span><span style=color:#000>&</span><span style=color:#000>dpn_player_info,&nbsp;NULL,&nbsp;NULL,&nbsp;DPNSETCLIENTINFO_SYNC);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;IDirectPlay8Address</span><span style=color:#000>*</span><span style=color:#000>&nbsp;dp_host_address;<br>&nbsp;&nbsp;&nbsp;&nbsp;IDirectPlay8Address</span><span style=color:#000>*</span><span style=color:#000>&nbsp;dp_device_address;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Create&nbsp;an&nbsp;address&nbsp;object&nbsp;and&nbsp;fill&nbsp;it&nbsp;with&nbsp;information<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;host&nbsp;address&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(CoCreateInstance(CLSID_DirectPlay8Address,&nbsp;NULL,&nbsp;CLSCTX_INPROC,&nbsp;IID_IDirectPlay8Address,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>dp_host_address)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;device&nbsp;address&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(CoCreateInstance(CLSID_DirectPlay8Address,&nbsp;NULL,&nbsp;CLSCTX_INPROC,&nbsp;IID_IDirectPlay8Address,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>dp_device_address)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Set&nbsp;the&nbsp;protocol&nbsp;to&nbsp;TCP/IP<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Sets&nbsp;the&nbsp;service&nbsp;provider&nbsp;GUID&nbsp;in&nbsp;the&nbsp;address&nbsp;object.<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;If&nbsp;a&nbsp;service&nbsp;provider&nbsp;is&nbsp;specified&nbsp;for&nbsp;this&nbsp;address,&nbsp;it&nbsp;is&nbsp;overwrittern&nbsp;by&nbsp;this&nbsp;call.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;protocol&nbsp;to&nbsp;host&nbsp;address</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(dp_host_address</span><span style=color:#000>-></span><span style=color:#000>SetSP(</span><span style=color:#000>&</span><span style=color:#000>CLSID_DP8SP_TCPIP)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;fail;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;protocol&nbsp;to&nbsp;device&nbsp;address</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(dp_device_address</span><span style=color:#000>-></span><span style=color:#000>SetSP(</span><span style=color:#000>&</span><span style=color:#000>CLSID_DP8SP_TCPIP)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;fail;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Set&nbsp;the&nbsp;port</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;port&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>21234</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Adds&nbsp;a&nbsp;component&nbsp;to&nbsp;the&nbsp;address.<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;If&nbsp;the&nbsp;component&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;address,&nbsp;it&nbsp;is&nbsp;replaced&nbsp;by&nbsp;the&nbsp;new&nbsp;value&nbsp;in&nbsp;this&nbsp;call.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Set&nbsp;port</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(dp_host_address</span><span style=color:#000>-></span><span style=color:#000>AddComponent(DPNA_KEY_PORT,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>port,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DWORD),&nbsp;DPNA_DATATYPE_DWORD)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;fail;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;WCHAR&nbsp;w_ip[</span><span style=color:#000>128</span><span style=color:#000>]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;{</span><span style=color:#000>0</span><span style=color:#000>};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;host&nbsp;name</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;mbstowcs(w_ip,&nbsp;ip,&nbsp;strlen(ip)</span><span style=color:#000>+</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>AddComponent(DPNA_KEY_HOSTNAME,&nbsp;w_ip,&nbsp;(DWORD)((wcslen(w_ip)</span><span style=color:#000>+</span><span style=color:#000>1</span><span style=color:#000>)&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WCHAR)),&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPNA_DATATYPE_STRING);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Set&nbsp;the&nbsp;adapter</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>AddComponent(DPNA_KEY_DEVICE,&nbsp;adapter_guid,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(GUID),&nbsp;DPNA_DATATYPE_GUID);<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_device_address</span><span style=color:#000>-></span><span style=color:#000>AddComponent(DPNA_KEY_DEVICE,&nbsp;adapter_guid,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(GUID),&nbsp;DPNA_DATATYPE_GUID);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;DPN_APPLICATION_DESC&nbsp;app_desc;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Describes&nbsp;the&nbsp;settings&nbsp;for&nbsp;a&nbsp;Microsoft&nbsp;DirectPlay&nbsp;application<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Setup&nbsp;the&nbsp;application&nbsp;description&nbsp;structure</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>app_desc,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DPN_APPLICATION_DESC));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;app_desc.dwSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DPN_APPLICATION_DESC);<br>&nbsp;&nbsp;&nbsp;&nbsp;app_desc.dwFlags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DPNSESSION_CLIENT_SERVER;<br>&nbsp;&nbsp;&nbsp;&nbsp;app_desc.guidApplication&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_app_guid;<br>&nbsp;&nbsp;&nbsp;&nbsp;app_desc.pwszSessionName&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;L</span><span style=color:#000>"</span><span style=color:#000>SercverSession</span><span style=color:#000>"</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Establishes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Connect(</span><span style=color:#000>&</span><span style=color:#000>app_desc,&nbsp;dp_host_address,&nbsp;dp_device_address,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_async_handle,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;fail;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;dialog&nbsp;control&nbsp;information&nbsp;&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;TRUE);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_device_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br><br>fail:<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_device_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br>}<br></span></div><br><span style=font-weight:700;color:#2d6a24>发送和接收消息</span><br><br>客户端接收消息和服务器端接收消息的处理方法是一样的，所以只需要关心消息处理函数内部的实现，发送消息需要调用IDirectPlay8Server::Send函数。<br><br><p><font face="Segoe UI">Transmits data to the server. The message can be sent synchronously or asynchronously.</font></p><pre class=syntax><font face="Segoe UI"><strong>HRESULT Send(<br>const DPN_BUFFER_DESC *const</strong> <em><a class=synParam onclick=showTip(this)>pBufferDesc</a></em>,<br><strong>const DWORD</strong> <em><a class=synParam onclick=showTip(this)>cBufferDesc</a></em>,<br><strong>const DWORD</strong> <em><a class=synParam onclick=showTip(this)>dwTimeOut</a></em>,<br><strong>void *const</strong> <em><a class=synParam onclick=showTip(this)>pvAsyncContext</a></em>,<br><strong>DPNHANDLE *const</strong> <em><a class=synParam onclick=showTip(this)>phAsyncHandle</a></em>,<br><strong>const DWORD</strong> <em><a class=synParam onclick=showTip(this)>dwFlags</a></em><br><strong>);</strong></font></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4><font face="Segoe UI">Parameters</font></h4><dl><dt><font face="Segoe UI"><em>pBufferDesc</em></font><dd><font face="Segoe UI">[in] Pointer to a <strong>DPN_BUFFER_DESC</strong> structure that describes the data to send.</font><dt><font face="Segoe UI"><em>cBufferDesc</em></font><dd><font face="Segoe UI">[in] Number of <strong>DPN_BUFFER_DESC</strong> structures pointed to by <em>pBufferDesc</em>. There can only be one buffer in this version of Microsoft® DirectPlay® .</font><dt><font face="Segoe UI"><em>dwTimeOut</em></font><dd><font face="Segoe UI">[in] Number of milliseconds to wait for the message to send. If the message has not been sent by the <em>dwTimeOut</em> value, it is deleted from the send queue. If you set this parameter to 0, the message remains in the send queue until it is sent or until the link is dropped.</font><dt><font face="Segoe UI"><em>pvAsyncContext</em></font><dd><font face="Segoe UI">[in] Pointer to the user-supplied context, which is returned in the <strong>pvUserContext</strong> member of the <strong>DPN_MSGID_SEND_COMPLETE</strong> system message.</font><dt><font face="Segoe UI"><em>phAsyncHandle</em></font><dd><font face="Segoe UI">[in,out] A <strong>DPNHANDLE</strong>.<strong> </strong>When the method returns, <em>phAsyncHandle</em> will point to a handle that you can pass to <strong>IDirectPlay8Client::CancelAsyncOperation</strong> to cancel the operation. This parameter must be set to NULL if you set the DPNSEND_SYNC flag in <em>dwFlags.</em></font><dt><font face="Segoe UI"><em>dwFlags</em></font><dd><font face="Segoe UI">[in] Flags that describe send behavior. You can set one or more of the following flags.</font><dl><dt><font face="Segoe UI">DPNSEND_SYNC</font><dd><font face="Segoe UI">Process the <strong>Send</strong> request synchronously.</font><dt><font face="Segoe UI">DPNSEND_NOCOPY</font><dd><font face="Segoe UI">Use the data in the <strong>DPN_BUFFER_DESC</strong> structure and do not make an internal copy. This may be a more efficient method of sending data to the server. However, it is less robust, because the sender might be able to modify the message before the receiver has processed it. This flag cannot be combined with DPNSEND_NOCOMPLETE.</font><dt><font face="Segoe UI">DPNSEND_NOCOMPLETE</font><dd><font face="Segoe UI">Does not send <strong>DPN_MSGID_SEND_COMPLETE</strong> to the message handler. This flag may not be used with DPNSEND_NOCOPY or DPNSEND_GUARANTEED. Additionally, when using this flag <em>pvAsyncContext</em> must be NULL.</font><dt><font face="Segoe UI">DPNSEND_COMPLETEONPROCESS</font><dd><font face="Segoe UI">Send <strong>DPN_MSGID_SEND_COMPLETE</strong> to the message handler when this message has been delivered to the target and the target's message handler returns from indicating its reception. There is additional internal message overhead when this flag is set, and the message transmission process may become significantly slower. If you set this flag, DPNSEND_GUARANTEED must also be set.</font><dt><font face="Segoe UI">DPNSEND_GUARANTEED</font><dd><font face="Segoe UI">Send the message by a guaranteed method of delivery.</font><dt><font face="Segoe UI">DPNSEND_PRIORITY_HIGH</font><dd><font face="Segoe UI">Sets the priority of the message to high. This flag cannot be used with DPNSEND_PRIORITY_LOW.</font><dt><font face="Segoe UI">DPNSEND_PRIORITY_LOW</font><dd><font face="Segoe UI">Sets the priority of the message to low. This flag cannot be used with DPNSEND_PRIORITY_HIGH.</font><dt><font face="Segoe UI">DPNSEND_NOLOOPBACK</font><dd><font face="Segoe UI">Suppress the <strong>DPN_MSGID_RECEIVE</strong> system message to your message handler if you are sending to yourself.</font><dt><font face="Segoe UI">DPNSEND_NONSEQUENTIAL</font><dd><font face="Segoe UI">If the flag is not set, messages are delivered to the target application in the order that they are sent, which may necessitate buffering out of sequence messages until the missing messages arrive. Messages are simply delivered to the target application in the order that they are received.</font></dd></dl></dd></dl><h4><font face="Segoe UI">Return Values</font></h4><p><font face="Segoe UI">Returns S_OK if this method is processed synchronously and is successful. By default, this method is run asynchronously and generally returns DPNSUCCESS_PENDING or one of the following error values.</font></p><table><tbody><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_INVALIDFLAGS</font></td></tr><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_TIMEDOUT</font></td></tr></tbody></table><font face="Segoe UI"><br></font><h4><font face="Segoe UI">Remarks</font></h4><p><font face="Segoe UI">This method generates a <strong>DPN_MSGID_RECEIVE</strong> system message in the server's message handler. The data buffer is contained in the <strong>pReceiveData</strong> member of the associated structure.</font></p><p><font face="Segoe UI">Messages can have one of three priorities: low, normal, and high. To specify a low or high priority for the message, set the appropriate flag in <em>dwFlags. </em>If neither of the priority flags is set, the message will have normal priority. See Basic Networking for a discussion of send priorities.</font></p><p><font face="Segoe UI">When the <strong>Send</strong> request is completed, a <strong>DPN_MSGID_SEND_COMPLETE</strong> system message is posted to the sender's message handler. The success or failure of the request is contained in the <strong>hResultCode</strong> member of the associate structure. You can suppress the send completion by setting the DPN_NOCOMPLETE flag in <em>dwflags</em>.</font></p><p><font face="Segoe UI">If a player joins a game and needs to send multiple messages immediately, the player should first send a message with the DPNSEND_COMPLETEONPROCESS flag set. When the DPN_MSGID_SEND_COMPLETE message is returned, the application can begin sending messages. If the player does not do this, some of the messages might need to be queued on the receiver and, if too much data arrives, the queue can grow faster than the receiver can handle the messages. This might result in lost data. After a player is established in the game, however, throttling in DirectPlay will control the data flow by using message timeouts or the <strong>GetSendQueueInfo</strong> method. For more information, see Optimizing Network Usage.</font></p><p><font face="Segoe UI">Send completions are typically posted on the source computer as soon as the message is sent. In other words, a send completion does not necessarily mean that the message has been processed on the target. It may still be in a queue. If you want to be certain that the message has been processed by the target, set the DPN_COMPLETEONPROCESS flag in <em>dwFlags. </em>This flag ensures that the send completion will not be sent until the target's message handler has processed the message, and returned.</font></p><p class=note><font face="Segoe UI"><strong>Note</strong>&nbsp;&nbsp;Do not assume that resources such as the data buffer will remain valid until the method has returned. If you call this method asynchronously, the <strong>DPN_MSGID_SEND_COMPLETE</strong> message may be received and processed by your message handler before the call has returned. If your message handler deallocates or otherwise invalidates a resource such as the data buffer, that resource may become invalid at any time after the method has been called.</font></p><br>下面这两个函数演示了如何发送和接收消息。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br></span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>ClientClass</span><span style=color:#000>"</span><span style=color:#000>;<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;application&nbsp;GUID</span><span style=color:green><br></span><span style=color:#000>GUID&nbsp;g_app_guid&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;{&nbsp;</span><span style=color:#000>0xababbe60</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x1ac0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x11d5</span><span style=color:#000>,&nbsp;{&nbsp;</span><span style=color:#000>0x90</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x89</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x44</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x45</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x53</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x54</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x1</span><span style=color:#000>&nbsp;}&nbsp;};<br><br>IDirectPlay8Client</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;DirectPlay&nbsp;Client</span><span style=color:green><br></span><span style=color:#000>DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;g_adapter_list;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_num_adapters;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;number&nbsp;of&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000><br>BOOL&nbsp;g_is_connected;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;indicates&nbsp;whether&nbsp;connection&nbsp;between&nbsp;client&nbsp;and&nbsp;server&nbsp;is&nbsp;build&nbsp;up</span><span style=color:green><br></span><span style=color:#000>DPNHANDLE&nbsp;g_async_handle;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;async&nbsp;connection&nbsp;handle<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Send&nbsp;text&nbsp;to&nbsp;all&nbsp;clients.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Send_Text_Msg(</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;text)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;DPNHANDLE&nbsp;async_handle;<br>&nbsp;&nbsp;&nbsp;&nbsp;DPN_BUFFER_DESC&nbsp;buffer_desc;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;name[</span><span style=color:#000>64</span><span style=color:#000>],&nbsp;message[</span><span style=color:#000>1024</span><span style=color:#000>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_dp_client&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;the&nbsp;name</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;name,&nbsp;</span><span style=color:#000>64</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;rebuild&nbsp;string&nbsp;based&nbsp;on&nbsp;the&nbsp;name</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;sprintf(message,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>%s>&nbsp;%s</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;name,&nbsp;text);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;build&nbsp;a&nbsp;data&nbsp;structure</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;buffer_desc.dwBufferSize&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DWORD)&nbsp;(strlen(message)&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;buffer_desc.pBufferData&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(BYTE</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;message;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Send&nbsp;message&nbsp;(async&nbsp;method&nbsp;-&nbsp;reason&nbsp;for&nbsp;handle)&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Send(</span><span style=color:#000>&</span><span style=color:#000>buffer_desc,&nbsp;</span><span style=color:#000>1</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>async_handle,&nbsp;DPNSEND_NOLOOPBACK);<br>}<br><br></span><span style=color:green>//</span><span style=color:green>----------------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Callback&nbsp;function&nbsp;that&nbsp;receives&nbsp;all&nbsp;messages&nbsp;from&nbsp;the&nbsp;client,&nbsp;and&nbsp;receives&nbsp;indications&nbsp;<br></span><span style=color:green>//</span><span style=color:green>&nbsp;of&nbsp;session&nbsp;changes&nbsp;from&nbsp;the&nbsp;IDirectPlay8Client&nbsp;interface.&nbsp;<br></span><span style=color:green>//</span><span style=color:green>----------------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>HRESULT&nbsp;WINAPI&nbsp;Net_Msg_Handle(PVOID&nbsp;user_context,&nbsp;DWORD&nbsp;message_id,&nbsp;PVOID&nbsp;msg_buffer)<br>{&nbsp;&nbsp;&nbsp; </span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;DPNMSG_RECEIVE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;receive_data;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(message_id)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Microsoft&nbsp;DirectPlay&nbsp;generates&nbsp;the&nbsp;DPN_MSGID_RECEIVE&nbsp;message&nbsp;when&nbsp;a&nbsp;message&nbsp;has&nbsp;been&nbsp;processed&nbsp;by&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;the&nbsp;receiver.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPN_MSGID_RECEIVE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;receive_data&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPNMSG_RECEIVE</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;msg_buffer;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;write&nbsp;out&nbsp;text</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(GetDlgItem(g_hwnd,&nbsp;IDC_CHATTER),&nbsp;LB_ADDSTRING,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPARAM)&nbsp;receive_data</span><span style=color:#000>-></span><span style=color:#000>pReceiveData);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;S_OK&nbsp;to&nbsp;signify&nbsp;the&nbsp;message&nbsp;was&nbsp;handled&nbsp;OK.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;S_OK;<br>}</span></div><br><span style=font-weight:700;color:#2d6a24>获得玩家的ID号</span><br><br>当连接到服务器端后，在有些情况下客户端需要使用自己的玩家ID号。要获得玩家的ID号，客户端可以解析连接完成消息（DPN_MSGID_CONNECT_COMPLETE），该消息使用以下数据结构来包含有关客户端到服务器端连接的必要信息。<br><br><p><font face="Segoe UI">Microsoft® DirectPlay® generates the DPN_MSGID_CONNECT_COMPLETE message when the connection attempt has been completed in a peer-to-peer or client/server session. This message is generated whether or not the connection was successful.</font></p><p><font face="Segoe UI">The <strong>DPNMSG_CONNECT_COMPLETE</strong> structure contains information for the DPN_MSGID_CONNECT_COMPLETE system message.</font></p><pre class=syntax><font face="Segoe UI">typedef struct _DPNMSG_CONNECT_COMPLETE{<br> DWORD <a class=synParam onclick=showTip(this)>dwSize</a>;<br> DPNHANDLE <a class=synParam onclick=showTip(this)>hAsyncOp</a>;<br> PVOID <a class=synParam onclick=showTip(this)>pvUserContext</a>;<br> HRESULT <a class=synParam onclick=showTip(this)>hResultCode</a>;<br> PVOID <a class=synParam onclick=showTip(this)>pvApplicationReplyData</a>;<br> DWORD <a class=synParam onclick=showTip(this)>dwApplicationReplyDataSize</a>;<br>} DPNMSG_CONNECT_COMPLETE, *PDPNMSG_CONNECT_COMPLETE;</font></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><dl><dt><font face="Segoe UI"><strong>dwSize</strong></font><dd><font face="Segoe UI">Size of this structure.</font><dt><font face="Segoe UI"><strong>hAsyncOp</strong></font><dd><font face="Segoe UI">Asynchronous operation handle.</font><dt><font face="Segoe UI"><strong>pvUserContext</strong></font><dd><font face="Segoe UI">User context supplied when the <strong>IDirectPlay8Peer::Connect</strong> or <strong>IDirectPlay8Client::Connect</strong> methods are called.</font><dt><font face="Segoe UI"><strong>hResultCode</strong></font><dd><font face="Segoe UI">HRESULT describing the result of the connection attempt. See the Return Values section in the <strong>IDirectPlay8Peer::Connect</strong> or <strong>IDirectPlay8Client::Connect</strong> method for more information. Additionally, DPNERR_PLAYERNOTREACHABLE will be returned if a player has tried to join a peer-to-peer session where at least one other existing player in the session cannot connect to the joining player.</font><dt><font face="Segoe UI"><strong>pvApplicationReplyData</strong></font><dd><font face="Segoe UI">Connection reply data returned from the host or server.</font><dt><font face="Segoe UI"><strong>dwApplicationReplyDataSize</strong></font><dd><font face="Segoe UI">Size of the data, in bytes, of the <strong>pvApplicationReplyData</strong> member.</font></dd></dl><h4><font face="Segoe UI">Return Values</font></h4><p><font face="Segoe UI">Return DPN_OK.</font></p><p><font face="Segoe UI"><br></font></p><p><font face="Segoe UI">当服务器端调用IDirectPlay8Server::DestroyClient来销毁玩家时，客户端会收到消息 DPN_MSGID_TERMINATE_SESSION。<br></font></p><br>下面这个函数演示了如何处理消息<span style=color:#000>DPN_MSGID_CONNECT_COMPLETE和</span><span style=color:#000>DPN_MSGID_TERMINATE_SESSION</span><span style=color:#000>。</span><br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br></span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>ClientClass</span><span style=color:#000>"</span><span style=color:#000>;<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;application&nbsp;GUID</span><span style=color:green><br></span><span style=color:#000>GUID&nbsp;g_app_guid&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;{&nbsp;</span><span style=color:#000>0xababbe60</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x1ac0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x11d5</span><span style=color:#000>,&nbsp;{&nbsp;</span><span style=color:#000>0x90</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x89</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x44</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x45</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x53</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x54</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x1</span><span style=color:#000>&nbsp;}&nbsp;};<br><br>IDirectPlay8Client</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;DirectPlay&nbsp;Client</span><span style=color:green><br></span><span style=color:#000>DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;g_adapter_list;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_num_adapters;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;number&nbsp;of&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000><br>BOOL&nbsp;g_is_connected;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;indicates&nbsp;whether&nbsp;connection&nbsp;between&nbsp;client&nbsp;and&nbsp;server&nbsp;is&nbsp;build&nbsp;up</span><span style=color:green><br></span><span style=color:#000>DPNHANDLE&nbsp;g_async_handle;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;async&nbsp;connection&nbsp;handle<br><br></span><span style=color:green>//</span><span style=color:green>----------------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Callback&nbsp;function&nbsp;that&nbsp;receives&nbsp;all&nbsp;messages&nbsp;from&nbsp;the&nbsp;client,&nbsp;and&nbsp;receives&nbsp;indications&nbsp;<br></span><span style=color:green>//</span><span style=color:green>&nbsp;of&nbsp;session&nbsp;changes&nbsp;from&nbsp;the&nbsp;IDirectPlay8Client&nbsp;interface.&nbsp;<br></span><span style=color:green>//</span><span style=color:green>----------------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>HRESULT&nbsp;WINAPI&nbsp;Net_Msg_Handle(PVOID&nbsp;user_context,&nbsp;DWORD&nbsp;message_id,&nbsp;PVOID&nbsp;msg_buffer)<br>{&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;contains&nbsp;information&nbsp;for&nbsp;the&nbsp;DPN_MSGID_CONNECT_COMPLETE&nbsp;system&nbsp;message</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DPNMSG_CONNECT_COMPLETE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;connect_complete;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;contains&nbsp;information&nbsp;for&nbsp;the&nbsp;DPN_MSGID_TERMINATE_COMPLETE&nbsp;system&nbsp;message</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DPNMSG_TERMINATE_SESSION</span><span style=color:#000>*</span><span style=color:#000>&nbsp;terminate_session;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(message_id)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPN_MSGID_CONNECT_COMPLETE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connect_complete&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPNMSG_CONNECT_COMPLETE</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;msg_buffer;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;TRUE);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Make&nbsp;sure&nbsp;connection&nbsp;complete</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(connect_complete</span><span style=color:#000>-></span><span style=color:#000>hResultCode&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;S_OK)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;dialog&nbsp;information</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;FALSE);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Disconnect</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;as&nbsp;connected</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_is_connected&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;TRUE;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>else</span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(connect_complete</span><span style=color:#000>-></span><span style=color:#000>hResultCode)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_HOSTREJECTEDCONNECTION:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Host&nbsp;reject&nbsp;this&nbsp;connection</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDAPPLICATION:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;GUID&nbsp;supplied&nbsp;for&nbsp;the&nbsp;application&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDDEVICEADDRESS:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;address&nbsp;for&nbsp;the&nbsp;local&nbsp;computer&nbsp;or&nbsp;adapter&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDFLAGS:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;flags&nbsp;passed&nbsp;to&nbsp;this&nbsp;method&nbsp;are&nbsp;invalid.&nbsp;</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDHOSTADDRESS:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;specified&nbsp;remote&nbsp;address&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDINSTANCE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;GUID&nbsp;for&nbsp;the&nbsp;application&nbsp;instance&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDINTERFACE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;interface&nbsp;parameter&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDPASSWORD:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>"</span><span style=color:#000>An&nbsp;invalid&nbsp;password&nbsp;was&nbsp;supplied&nbsp;when&nbsp;attempting&nbsp;to&nbsp;join&nbsp;a&nbsp;session&nbsp;that&nbsp;requires&nbsp;a&nbsp;password.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_NOCONNECTION:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>No&nbsp;communication&nbsp;link&nbsp;was&nbsp;established.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_NOTHOST:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>An&nbsp;attempt&nbsp;by&nbsp;the&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;a&nbsp;nonhost&nbsp;computer.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_SESSIONFULL:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;request&nbsp;to&nbsp;connect&nbsp;to&nbsp;the&nbsp;host&nbsp;or&nbsp;server&nbsp;failed&nbsp;because&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;players&nbsp;allotted&nbsp;for&nbsp;the&nbsp;session&nbsp;has&nbsp;been&nbsp;reached.&nbsp;</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_ALREADYCONNECTED:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;object&nbsp;is&nbsp;already&nbsp;connected&nbsp;to&nbsp;the&nbsp;session.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;dialog&nbsp;information</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Connect</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;as&nbsp;disconnected</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_is_connected&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;FALSE;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clear&nbsp;async&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_async_handle&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPN_MSGID_TERMINATE_SESSION:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminate_session&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPNMSG_TERMINATE_SESSION</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;msg_buffer;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;dialog&nbsp;information</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;TRUE);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Connect</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clears&nbsp;async&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_async_handle&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;as&nbsp;disconnected</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_is_connected&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;print&nbsp;a&nbsp;disconnect&nbsp;message</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(GetDlgItem(g_hwnd,&nbsp;IDC_CHATTER),&nbsp;LB_ADDSTRING,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPARAM)</span><span style=color:#000>"</span><span style=color:#000>Disconnected.</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;S_OK&nbsp;to&nbsp;signify&nbsp;the&nbsp;message&nbsp;was&nbsp;handled&nbsp;OK.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;S_OK;<br>}</span></div><br><span style=font-weight:700;color:#2d6a24>终止客户端会话</span><br><br>当客户端需要从一次会话中断开连接时，需要明确向DirectPlay传达该消息，以使其按正确的步骤关闭连接。使用IDirectPlay8Client::Close函数，就能将客户端从一次会话中断开连接。<br><br><p><font face="Segoe UI">Closes the open connection to a session. This method must be called on any object that is successfully initialized with a call to the <strong>IDirectPlay8Client::Initialize</strong> method.</font></p><pre class=syntax><font face="Segoe UI"><strong>HRESULT Close(<br>const DWORD </strong><em><a class=synParam onclick=showTip(this)>dwFlags</a></em><br><strong>);</strong></font></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4><font face="Segoe UI">Parameters</font></h4><dl><dt><font face="Segoe UI"><em>dwFlags</em></font><dd><font face="Segoe UI">[in] Reserved. Must be 0.</font></dd></dl><h4><font face="Segoe UI">Return Values</font></h4><p><font face="Segoe UI">Returns S_OK if successful, or the following error value.</font></p><table><tbody><tr valign=top><td width=100%><font face="Segoe UI">DPNERR_UNINITIALIZED</font></td></tr></tbody></table>&nbsp;<h4><font face="Segoe UI">Remarks</font></h4><p><font face="Segoe UI">Calling <strong>Close</strong> will cancel all outstanding operations, including data sent as guaranteed. To make sure all messages are sent, wait for all outstanding <strong>Send</strong> calls to complete before calling <strong>Close</strong>.</font></p><p><font face="Segoe UI">If you do not want the application to wait, the application should call <strong>IDirectPlay8Client::CancelAsyncOperation</strong> to cancel all outstanding sends prior to calling <strong>IDirectPlay8Client::Close</strong> or doing a final release call on the <strong>IDirectPlay8Client</strong> interface. Failing to do so causes unpredictable results.</font></p><br>下面给出一个完整的代码示例：<br><br><a href=http://www.cppblog.com/Files/lovedday/Client.rar><font color=#1b1b1b>点击下载源码和工程</font></a><br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>/*</span><span style=color:green>**************************************************************************************<br>PURPOSE:<br>&nbsp;&nbsp;&nbsp;&nbsp;Client&nbsp;Network&nbsp;Demo<br>&nbsp;**************************************************************************************</span><span style=color:green>*/</span><span style=color:#000><br><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>windows.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>stdio.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>dplay8.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>dpaddr.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>"</span><span style=color:#000>resource.h</span><span style=color:#000>"</span><span style=color:#000><br><br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dxguid.lib</span><span style=color:#000>"</span><span style=color:#000>)<br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dplayx.lib</span><span style=color:#000>"</span><span style=color:#000>)<br><br>#pragma&nbsp;warning(disable&nbsp;:&nbsp;</span><span style=color:#000>4996</span><span style=color:#000>)<br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;Safe_Release(p)&nbsp;if((p))&nbsp;(p)->Release();</span><span style=color:#000><br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br></span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>ClientClass</span><span style=color:#000>"</span><span style=color:#000>;<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;application&nbsp;GUID</span><span style=color:green><br></span><span style=color:#000>GUID&nbsp;g_app_guid&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;{&nbsp;</span><span style=color:#000>0xababbe60</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x1ac0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x11d5</span><span style=color:#000>,&nbsp;{&nbsp;</span><span style=color:#000>0x90</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x89</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x44</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x45</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x53</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x54</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0x1</span><span style=color:#000>&nbsp;}&nbsp;};<br><br>IDirectPlay8Client</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;DirectPlay&nbsp;Client</span><span style=color:green><br></span><span style=color:#000>DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;g_adapter_list;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000>DWORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_num_adapters;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;number&nbsp;of&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000><br>BOOL&nbsp;g_is_connected;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;indicates&nbsp;whether&nbsp;connection&nbsp;between&nbsp;client&nbsp;and&nbsp;server&nbsp;is&nbsp;build&nbsp;up</span><span style=color:green><br></span><span style=color:#000>DPNHANDLE&nbsp;g_async_handle;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;async&nbsp;connection&nbsp;handle<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Send&nbsp;text&nbsp;to&nbsp;all&nbsp;clients.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Send_Text_Msg(</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;text)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;DPNHANDLE&nbsp;async_handle;<br>&nbsp;&nbsp;&nbsp;&nbsp;DPN_BUFFER_DESC&nbsp;buffer_desc;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;name[</span><span style=color:#000>64</span><span style=color:#000>],&nbsp;message[</span><span style=color:#000>1024</span><span style=color:#000>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_dp_client&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;the&nbsp;name</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;name,&nbsp;</span><span style=color:#000>64</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;rebuild&nbsp;string&nbsp;based&nbsp;on&nbsp;the&nbsp;name</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;sprintf(message,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>%s>&nbsp;%s</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;name,&nbsp;text);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;build&nbsp;a&nbsp;data&nbsp;structure</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;buffer_desc.dwBufferSize&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DWORD)&nbsp;(strlen(message)&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;buffer_desc.pBufferData&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(BYTE</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;message;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Send&nbsp;message&nbsp;(async&nbsp;method&nbsp;-&nbsp;reason&nbsp;for&nbsp;handle)&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Send(</span><span style=color:#000>&</span><span style=color:#000>buffer_desc,&nbsp;</span><span style=color:#000>1</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>async_handle,&nbsp;DPNSEND_NOLOOPBACK);<br>}<br><br></span><span style=color:green>//</span><span style=color:green>----------------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Callback&nbsp;function&nbsp;that&nbsp;receives&nbsp;all&nbsp;messages&nbsp;from&nbsp;the&nbsp;client,&nbsp;and&nbsp;receives&nbsp;indications&nbsp;<br></span><span style=color:green>//</span><span style=color:green>&nbsp;of&nbsp;session&nbsp;changes&nbsp;from&nbsp;the&nbsp;IDirectPlay8Client&nbsp;interface.&nbsp;<br></span><span style=color:green>//</span><span style=color:green>----------------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>HRESULT&nbsp;WINAPI&nbsp;Net_Msg_Handle(PVOID&nbsp;user_context,&nbsp;DWORD&nbsp;message_id,&nbsp;PVOID&nbsp;msg_buffer)<br>{&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;contains&nbsp;information&nbsp;for&nbsp;the&nbsp;DPN_MSGID_CONNECT_COMPLETE&nbsp;system&nbsp;message</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DPNMSG_CONNECT_COMPLETE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;connect_complete;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;contains&nbsp;information&nbsp;for&nbsp;the&nbsp;DPN_MSGID_TERMINATE_COMPLETE&nbsp;system&nbsp;message</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DPNMSG_TERMINATE_SESSION</span><span style=color:#000>*</span><span style=color:#000>&nbsp;terminate_session;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;DPNMSG_RECEIVE</span><span style=color:#000>*</span><span style=color:#000>&nbsp;receive_data;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(message_id)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPN_MSGID_CONNECT_COMPLETE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connect_complete&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPNMSG_CONNECT_COMPLETE</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;msg_buffer;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;TRUE);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Make&nbsp;sure&nbsp;connection&nbsp;complete</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(connect_complete</span><span style=color:#000>-></span><span style=color:#000>hResultCode&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;S_OK)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;dialog&nbsp;information</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;FALSE);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Disconnect</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;as&nbsp;connected</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_is_connected&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;TRUE;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>else</span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(connect_complete</span><span style=color:#000>-></span><span style=color:#000>hResultCode)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_HOSTREJECTEDCONNECTION:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Host&nbsp;reject&nbsp;this&nbsp;connection</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDAPPLICATION:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;GUID&nbsp;supplied&nbsp;for&nbsp;the&nbsp;application&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDDEVICEADDRESS:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;address&nbsp;for&nbsp;the&nbsp;local&nbsp;computer&nbsp;or&nbsp;adapter&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDFLAGS:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;flags&nbsp;passed&nbsp;to&nbsp;this&nbsp;method&nbsp;are&nbsp;invalid.&nbsp;</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDHOSTADDRESS:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;specified&nbsp;remote&nbsp;address&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDINSTANCE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;GUID&nbsp;for&nbsp;the&nbsp;application&nbsp;instance&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDINTERFACE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;interface&nbsp;parameter&nbsp;is&nbsp;invalid.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_INVALIDPASSWORD:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>"</span><span style=color:#000>An&nbsp;invalid&nbsp;password&nbsp;was&nbsp;supplied&nbsp;when&nbsp;attempting&nbsp;to&nbsp;join&nbsp;a&nbsp;session&nbsp;that&nbsp;requires&nbsp;a&nbsp;password.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_NOCONNECTION:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>No&nbsp;communication&nbsp;link&nbsp;was&nbsp;established.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_NOTHOST:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>An&nbsp;attempt&nbsp;by&nbsp;the&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;a&nbsp;nonhost&nbsp;computer.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_SESSIONFULL:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;request&nbsp;to&nbsp;connect&nbsp;to&nbsp;the&nbsp;host&nbsp;or&nbsp;server&nbsp;failed&nbsp;because&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;players&nbsp;allotted&nbsp;for&nbsp;the&nbsp;session&nbsp;has&nbsp;been&nbsp;reached.&nbsp;</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPNERR_ALREADYCONNECTED:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>The&nbsp;object&nbsp;is&nbsp;already&nbsp;connected&nbsp;to&nbsp;the&nbsp;session.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;dialog&nbsp;information</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Connect</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;as&nbsp;disconnected</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_is_connected&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;FALSE;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clear&nbsp;async&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_async_handle&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPN_MSGID_TERMINATE_SESSION:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminate_session&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPNMSG_TERMINATE_SESSION</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;msg_buffer;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;dialog&nbsp;information</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;TRUE);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Connect</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clears&nbsp;async&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_async_handle&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;as&nbsp;disconnected</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_is_connected&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;print&nbsp;a&nbsp;disconnect&nbsp;message</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(GetDlgItem(g_hwnd,&nbsp;IDC_CHATTER),&nbsp;LB_ADDSTRING,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPARAM)</span><span style=color:#000>"</span><span style=color:#000>Disconnected.</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Microsoft&nbsp;DirectPlay&nbsp;generates&nbsp;the&nbsp;DPN_MSGID_RECEIVE&nbsp;message&nbsp;when&nbsp;a&nbsp;message&nbsp;has&nbsp;been&nbsp;processed&nbsp;by&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;the&nbsp;receiver.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;DPN_MSGID_RECEIVE:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;receive_data&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPNMSG_RECEIVE</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;msg_buffer;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;write&nbsp;out&nbsp;text</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(GetDlgItem(g_hwnd,&nbsp;IDC_CHATTER),&nbsp;LB_ADDSTRING,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPARAM)&nbsp;receive_data</span><span style=color:#000>-></span><span style=color:#000>pReceiveData);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;S_OK&nbsp;to&nbsp;signify&nbsp;the&nbsp;message&nbsp;was&nbsp;handled&nbsp;OK.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;S_OK;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Create&nbsp;DirectPlay&nbsp;Client&nbsp;and&nbsp;initialize&nbsp;it.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Init_DirectPlay_Client()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;DirectPlay&nbsp;client&nbsp;component</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(CoCreateInstance(CLSID_DirectPlay8Client,&nbsp;NULL,&nbsp;CLSCTX_INPROC,&nbsp;IID_IDirectPlay8Client,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_dp_client)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Assign&nbsp;a&nbsp;message&nbsp;handler&nbsp;to&nbsp;network&nbsp;component<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Registers&nbsp;an&nbsp;entry&nbsp;point&nbsp;in&nbsp;the&nbsp;client's&nbsp;code&nbsp;that&nbsp;receives&nbsp;the&nbsp;messages&nbsp;from&nbsp;the&nbsp;IDirectPlay8Client<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;interface&nbsp;and&nbsp;from&nbsp;the&nbsp;server.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Initialize(NULL,&nbsp;Net_Msg_Handle,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Enumerate&nbsp;all&nbsp;TCP/IP&nbsp;adapters.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Enum_Adapters()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;if&nbsp;no&nbsp;server&nbsp;object&nbsp;or&nbsp;GUID</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_dp_client&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;a&nbsp;handle&nbsp;of&nbsp;the&nbsp;list&nbsp;box</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;adapters_ctrl&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clear&nbsp;the&nbsp;combo-box</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(adapters_ctrl,&nbsp;CB_RESETCONTENT,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;free&nbsp;prior&nbsp;adapter&nbsp;list</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;delete[]&nbsp;g_adapter_list;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_adapter_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;g_num_adapters&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;size&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;query&nbsp;the&nbsp;required&nbsp;size&nbsp;of&nbsp;the&nbsp;data&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;rv&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>EnumServiceProviders(</span><span style=color:#000>&</span><span style=color:#000>CLSID_DP8SP_TCPIP,&nbsp;NULL,&nbsp;g_adapter_list,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>size,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_num_adapters,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(rv&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;DPNERR_BUFFERTOOSMALL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;allocate&nbsp;a&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((g_adapter_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;</span><span style=color:#00f>new</span><span style=color:#000>&nbsp;BYTE[size])&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerate&nbsp;again</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>EnumServiceProviders(</span><span style=color:#000>&</span><span style=color:#000>CLSID_DP8SP_TCPIP,&nbsp;NULL,&nbsp;g_adapter_list,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>size,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_num_adapters,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;adapter_name[</span><span style=color:#000>1024</span><span style=color:#000>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumeration&nbsp;is&nbsp;complete,&nbsp;scan&nbsp;through&nbsp;entries.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;adapter_ptr&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_adapter_list;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(DWORD&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;g_num_adapters;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;convert&nbsp;wide&nbsp;string&nbsp;into&nbsp;multi-byte&nbsp;string</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wcstombs(adapter_name,&nbsp;adapter_ptr</span><span style=color:#000>-></span><span style=color:#000>pwszName,&nbsp;</span><span style=color:#000>1024</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;add&nbsp;the&nbsp;adapter&nbsp;name&nbsp;int&nbsp;listbox</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(adapters_ctrl,&nbsp;CB_ADDSTRING,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPARAM)adapter_name);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;go&nbsp;to&nbsp;next&nbsp;servicec&nbsp;provider</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter_ptr</span><span style=color:#000>++</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Select&nbsp;first&nbsp;adapter<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;An&nbsp;application&nbsp;sends&nbsp;a&nbsp;CB_SETCURSEL&nbsp;message&nbsp;to&nbsp;select&nbsp;a&nbsp;string&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;a&nbsp;combo&nbsp;box.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;If&nbsp;necessary,&nbsp;the&nbsp;list&nbsp;scrolls&nbsp;the&nbsp;string&nbsp;into&nbsp;view.&nbsp;The&nbsp;text&nbsp;in&nbsp;the&nbsp;edit&nbsp;control&nbsp;of&nbsp;the&nbsp;combo&nbsp;box&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;changes&nbsp;to&nbsp;reflect&nbsp;the&nbsp;new&nbsp;selection,&nbsp;and&nbsp;any&nbsp;previous&nbsp;selection&nbsp;in&nbsp;the&nbsp;list&nbsp;is&nbsp;removed.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;wParam:<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;Specifies&nbsp;the&nbsp;zero-based&nbsp;index&nbsp;of&nbsp;the&nbsp;string&nbsp;to&nbsp;select.&nbsp;If&nbsp;this&nbsp;parameter&nbsp;is&nbsp;–1,&nbsp;any&nbsp;current&nbsp;selection&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;list&nbsp;is&nbsp;removed&nbsp;and&nbsp;the&nbsp;edit&nbsp;control&nbsp;is&nbsp;cleared.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;lParam:<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;parameter&nbsp;is&nbsp;not&nbsp;used.&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(adapters_ctrl,&nbsp;CB_SETCURSEL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);&nbsp;&nbsp;&nbsp;&nbsp;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Release&nbsp;all&nbsp;resource&nbsp;which&nbsp;allocated&nbsp;for&nbsp;DirectPlay.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Release_DirectPlay()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;client&nbsp;service&nbsp;provider&nbsp;list&nbsp;memory</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;delete[]&nbsp;g_adapter_list;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_adapter_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_num_adapters&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;client&nbsp;component</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_dp_client&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Closes&nbsp;the&nbsp;open&nbsp;connection&nbsp;to&nbsp;a&nbsp;session.&nbsp;This&nbsp;method&nbsp;must&nbsp;be&nbsp;called&nbsp;on&nbsp;any&nbsp;object&nbsp;that&nbsp;is&nbsp;successfully&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;IDirectPlay8Client::Initialize&nbsp;method.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Close(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Release();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Start&nbsp;connecting&nbsp;to&nbsp;server&nbsp;which&nbsp;GUID&nbsp;specified&nbsp;by&nbsp;adapter_guid&nbsp;and&nbsp;server&nbsp;IP<br></span><span style=color:green>//</span><span style=color:green>&nbsp;specified&nbsp;by&nbsp;ip.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Start_Session(GUID</span><span style=color:#000>*</span><span style=color:#000>&nbsp;adapter_guid,&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>*</span><span style=color:#000>&nbsp;ip)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Make&nbsp;sure&nbsp;there&nbsp;are&nbsp;an&nbsp;invalid&nbsp;adapter&nbsp;and&nbsp;an&nbsp;invalid&nbsp;IP&nbsp;address</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(adapter_guid&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL&nbsp;</span><span style=color:#000>||</span><span style=color:#000>&nbsp;ip&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Need&nbsp;to&nbsp;re-assign&nbsp;a&nbsp;network&nbsp;handler&nbsp;as&nbsp;quitting&nbsp;a&nbsp;previous&nbsp;session&nbsp;to&nbsp;clears&nbsp;it.<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Close&nbsp;the&nbsp;connection&nbsp;first&nbsp;before&nbsp;assigning&nbsp;a&nbsp;new&nbsp;network&nbsp;handler.<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Closes&nbsp;the&nbsp;open&nbsp;connnection&nbsp;to&nbsp;a&nbsp;session.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Close(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Initialize&nbsp;DirectPlay&nbsp;Client</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Initialize(NULL,&nbsp;Net_Msg_Handle,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Assign&nbsp;player&nbsp;information</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;player_name[</span><span style=color:#000>256</span><span style=color:#000>];<br>&nbsp;&nbsp;&nbsp;&nbsp;WCHAR&nbsp;w_player_name[</span><span style=color:#000>256</span><span style=color:#000>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;player_name,&nbsp;</span><span style=color:#000>256</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;mbstowcs(w_player_name,&nbsp;player_name,&nbsp;strlen(player_name)&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;DPN_PLAYER_INFO&nbsp;dpn_player_info;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>dpn_player_info,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DPN_PLAYER_INFO));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;dpn_player_info.dwSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DPN_PLAYER_INFO);<br>&nbsp;&nbsp;&nbsp;&nbsp;dpn_player_info.dwInfoFlags&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DPNINFO_NAME&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;DPNINFO_DATA;<br>&nbsp;&nbsp;&nbsp;&nbsp;dpn_player_info.pwszName&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;w_player_name;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;static&nbsp;settings&nbsp;of&nbsp;a&nbsp;client&nbsp;with&nbsp;an&nbsp;application,&nbsp;process&nbsp;synchronously.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>SetClientInfo(</span><span style=color:#000>&</span><span style=color:#000>dpn_player_info,&nbsp;NULL,&nbsp;NULL,&nbsp;DPNSETCLIENTINFO_SYNC);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;IDirectPlay8Address</span><span style=color:#000>*</span><span style=color:#000>&nbsp;dp_host_address;<br>&nbsp;&nbsp;&nbsp;&nbsp;IDirectPlay8Address</span><span style=color:#000>*</span><span style=color:#000>&nbsp;dp_device_address;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Create&nbsp;an&nbsp;address&nbsp;object&nbsp;and&nbsp;fill&nbsp;it&nbsp;with&nbsp;information<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;host&nbsp;address&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(CoCreateInstance(CLSID_DirectPlay8Address,&nbsp;NULL,&nbsp;CLSCTX_INPROC,&nbsp;IID_IDirectPlay8Address,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>dp_host_address)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;device&nbsp;address&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(CoCreateInstance(CLSID_DirectPlay8Address,&nbsp;NULL,&nbsp;CLSCTX_INPROC,&nbsp;IID_IDirectPlay8Address,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>dp_device_address)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Set&nbsp;the&nbsp;protocol&nbsp;to&nbsp;TCP/IP<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Sets&nbsp;the&nbsp;service&nbsp;provider&nbsp;GUID&nbsp;in&nbsp;the&nbsp;address&nbsp;object.<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;If&nbsp;a&nbsp;service&nbsp;provider&nbsp;is&nbsp;specified&nbsp;for&nbsp;this&nbsp;address,&nbsp;it&nbsp;is&nbsp;overwrittern&nbsp;by&nbsp;this&nbsp;call.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;protocol&nbsp;to&nbsp;host&nbsp;address</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(dp_host_address</span><span style=color:#000>-></span><span style=color:#000>SetSP(</span><span style=color:#000>&</span><span style=color:#000>CLSID_DP8SP_TCPIP)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;fail;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;protocol&nbsp;to&nbsp;device&nbsp;address</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(dp_device_address</span><span style=color:#000>-></span><span style=color:#000>SetSP(</span><span style=color:#000>&</span><span style=color:#000>CLSID_DP8SP_TCPIP)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;fail;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Set&nbsp;the&nbsp;port</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;port&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>21234</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Adds&nbsp;a&nbsp;component&nbsp;to&nbsp;the&nbsp;address.<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;If&nbsp;the&nbsp;component&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;address,&nbsp;it&nbsp;is&nbsp;replaced&nbsp;by&nbsp;the&nbsp;new&nbsp;value&nbsp;in&nbsp;this&nbsp;call.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Set&nbsp;port</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(dp_host_address</span><span style=color:#000>-></span><span style=color:#000>AddComponent(DPNA_KEY_PORT,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>port,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DWORD),&nbsp;DPNA_DATATYPE_DWORD)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;fail;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;WCHAR&nbsp;w_ip[</span><span style=color:#000>128</span><span style=color:#000>]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;{</span><span style=color:#000>0</span><span style=color:#000>};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;the&nbsp;host&nbsp;name</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;mbstowcs(w_ip,&nbsp;ip,&nbsp;strlen(ip)</span><span style=color:#000>+</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>AddComponent(DPNA_KEY_HOSTNAME,&nbsp;w_ip,&nbsp;(DWORD)((wcslen(w_ip)</span><span style=color:#000>+</span><span style=color:#000>1</span><span style=color:#000>)&nbsp;</span><span style=color:#000>*</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(WCHAR)),&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPNA_DATATYPE_STRING);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Set&nbsp;the&nbsp;adapter</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>AddComponent(DPNA_KEY_DEVICE,&nbsp;adapter_guid,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(GUID),&nbsp;DPNA_DATATYPE_GUID);<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_device_address</span><span style=color:#000>-></span><span style=color:#000>AddComponent(DPNA_KEY_DEVICE,&nbsp;adapter_guid,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(GUID),&nbsp;DPNA_DATATYPE_GUID);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;DPN_APPLICATION_DESC&nbsp;app_desc;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Describes&nbsp;the&nbsp;settings&nbsp;for&nbsp;a&nbsp;Microsoft&nbsp;DirectPlay&nbsp;application<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Setup&nbsp;the&nbsp;application&nbsp;description&nbsp;structure</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>app_desc,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DPN_APPLICATION_DESC));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;app_desc.dwSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DPN_APPLICATION_DESC);<br>&nbsp;&nbsp;&nbsp;&nbsp;app_desc.dwFlags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DPNSESSION_CLIENT_SERVER;<br>&nbsp;&nbsp;&nbsp;&nbsp;app_desc.guidApplication&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_app_guid;<br>&nbsp;&nbsp;&nbsp;&nbsp;app_desc.pwszSessionName&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;L</span><span style=color:#000>"</span><span style=color:#000>SercverSession</span><span style=color:#000>"</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Establishes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Connect(</span><span style=color:#000>&</span><span style=color:#000>app_desc,&nbsp;dp_host_address,&nbsp;dp_device_address,&nbsp;NULL,&nbsp;NULL,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_async_handle,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;fail;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;dialog&nbsp;control&nbsp;information&nbsp;&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;FALSE);<br>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;TRUE);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_device_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br><br>fail:<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_host_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;dp_device_address</span><span style=color:#000>-></span><span style=color:#000>Release();<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Stoping&nbsp;hosting&nbsp;server.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Stop_Session()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Close&nbsp;the&nbsp;connection</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_dp_client)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Close(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clear&nbsp;async&nbsp;handle</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_async_handle&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;setup&nbsp;the&nbsp;dialog&nbsp;controls&nbsp;information<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Enables&nbsp;combo-box&nbsp;control</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;EnableWindow(GetDlgItem(g_hwnd,&nbsp;IDC_NAME),&nbsp;TRUE);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_CONNECT),&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Connect</span><span style=color:#000>"</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;flag&nbsp;as&nbsp;disconnected</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_is_connected&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;FALSE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Window&nbsp;procedure.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;WINAPI&nbsp;Window_Proc(HWND&nbsp;hwnd,&nbsp;UINT&nbsp;msg_id,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;adapter_ptr;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;selected;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;msg[</span><span style=color:#000>256</span><span style=color:#000>],&nbsp;ip[</span><span style=color:#000>16</span><span style=color:#000>];<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(msg_id)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;WM_COMMAND:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;The&nbsp;WM_COMMAND&nbsp;message&nbsp;is&nbsp;sent&nbsp;when&nbsp;the&nbsp;user&nbsp;selects&nbsp;a&nbsp;command&nbsp;item&nbsp;from&nbsp;a&nbsp;menu,&nbsp;when&nbsp;a&nbsp;control&nbsp;sends&nbsp;a&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;notification&nbsp;message&nbsp;to&nbsp;its&nbsp;parent&nbsp;window,&nbsp;or&nbsp;when&nbsp;an&nbsp;accelerator&nbsp;keystroke&nbsp;is&nbsp;translated.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;wParam:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;high-order&nbsp;word&nbsp;specifies&nbsp;the&nbsp;notification&nbsp;code&nbsp;if&nbsp;the&nbsp;message&nbsp;is&nbsp;from&nbsp;a&nbsp;control.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;message&nbsp;is&nbsp;from&nbsp;an&nbsp;accelerator,&nbsp;this&nbsp;value&nbsp;is&nbsp;1.&nbsp;If&nbsp;the&nbsp;message&nbsp;is&nbsp;from&nbsp;a&nbsp;menu,&nbsp;this&nbsp;value&nbsp;is&nbsp;zero.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;low-order&nbsp;word&nbsp;specifies&nbsp;the&nbsp;identifier&nbsp;of&nbsp;the&nbsp;menu&nbsp;item,&nbsp;control,&nbsp;or&nbsp;accelerator.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;lParam:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handle&nbsp;to&nbsp;the&nbsp;control&nbsp;sending&nbsp;the&nbsp;message&nbsp;if&nbsp;the&nbsp;message&nbsp;is&nbsp;from&nbsp;a&nbsp;control.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;this&nbsp;parameter&nbsp;is&nbsp;NULL.&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(LOWORD(wParam))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;IDC_CONNECT:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;g_is_connected)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Get&nbsp;adapter&nbsp;to&nbsp;use&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((selected&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>int</span><span style=color:#000>)&nbsp;SendMessage(GetDlgItem(hwnd,&nbsp;IDC_ADAPTERS),&nbsp;CB_GETCURSEL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>))&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;LB_ERR)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;invalid&nbsp;selected&nbsp;item</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;IP&nbsp;address&nbsp;to&nbsp;use</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(GetDlgItem(g_hwnd,&nbsp;IDC_IP),&nbsp;ip,&nbsp;</span><span style=color:#000>16</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Make&nbsp;sure&nbsp;it's&nbsp;valid&nbsp;and&nbsp;start&nbsp;session</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(selected&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;g_num_adapters)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;pointer&nbsp;adapter&nbsp;pointer&nbsp;to&nbsp;selected&nbsp;position</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter_ptr&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_adapter_list;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter_ptr&nbsp;</span><span style=color:#000>+=</span><span style=color:#000>&nbsp;selected;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;Start_Session(</span><span style=color:#000>&</span><span style=color:#000>adapter_ptr</span><span style=color:#000>-></span><span style=color:#000>guid,&nbsp;ip))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Unable&nbsp;to&nbsp;start&nbsp;client!</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;MB_ICONEXCLAMATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>else</span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stop_Session();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;IDC_SEND:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(GetDlgItem(hwnd,&nbsp;IDC_MESSAGE),&nbsp;msg,&nbsp;</span><span style=color:#000>256</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(GetDlgItem(hwnd,&nbsp;IDC_MESSAGE),&nbsp;</span><span style=color:#000>""</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send_Text_Msg(msg);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;end&nbsp;-&nbsp;LOWORD(wParam):</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;WM_DESTROY:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stop_Session();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Release_DirectPlay();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostQuitMessage(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>break</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>default</span><span style=color:#000>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>long</span><span style=color:#000>)&nbsp;DefWindowProc(hwnd,&nbsp;msg_id,&nbsp;wParam,&nbsp;lParam);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Main&nbsp;function,&nbsp;routine&nbsp;entry.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>int</span><span style=color:#000>&nbsp;WINAPI&nbsp;WinMain(HINSTANCE&nbsp;inst,&nbsp;HINSTANCE,&nbsp;LPSTR&nbsp;cmd_line,&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;cmd_show)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;WNDCLASS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;win_class;<br>&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;window&nbsp;class&nbsp;and&nbsp;register&nbsp;it</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;win_class.style&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CS_HREDRAW&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;CS_VREDRAW;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpfnWndProc&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Window_Proc;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbClsExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbWndExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DLGWINDOWEXTRA;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hInstance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;inst;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIcon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadIcon(inst,&nbsp;IDI_APPLICATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadCursor(NULL,&nbsp;IDC_ARROW);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hbrBackground&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(HBRUSH)&nbsp;(COLOR_BTNFACE&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszMenuName&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszClassName&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_class_name;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;RegisterClass(</span><span style=color:#000>&</span><span style=color:#000>win_class))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;main&nbsp;window</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_hwnd&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateDialog(inst,&nbsp;MAKEINTRESOURCE(IDD_CLIENT),&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL);&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;COM<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;the&nbsp;COM&nbsp;library&nbsp;on&nbsp;the&nbsp;current&nbsp;thread&nbsp;and&nbsp;identifies&nbsp;the&nbsp;concurrency&nbsp;model&nbsp;as&nbsp;single-thread<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;apartment&nbsp;(STA).</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;CoInitialize(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Initialzie&nbsp;DirectPlay&nbsp;and&nbsp;enumerate&nbsp;service&nbsp;providers.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;Init_DirectPlay_Client())<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error&nbsp;initializing&nbsp;DirectPlay.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>ERROR</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;MB_ICONEXCLAMATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;exit;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerate&nbsp;all&nbsp;TCP/IP&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;Enum_Adapters();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Make&nbsp;sure&nbsp;there's&nbsp;an&nbsp;adapter&nbsp;to&nbsp;use</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_num_adapters&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(g_hwnd,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>There&nbsp;is&nbsp;no&nbsp;TCP/IP&nbsp;adapters&nbsp;to&nbsp;use!</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>ERROR</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;MB_ICONEXCLAMATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>goto</span><span style=color:#000>&nbsp;exit;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ShowWindow(g_hwnd,&nbsp;cmd_show);<br>&nbsp;&nbsp;&nbsp;&nbsp;UpdateWindow(g_hwnd);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;start&nbsp;message&nbsp;pump,&nbsp;waiting&nbsp;for&nbsp;signal&nbsp;to&nbsp;quit.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(MSG));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(msg.message&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;WM_QUIT)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(PeekMessage(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;PM_REMOVE))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>exit:<br>&nbsp;&nbsp;&nbsp;&nbsp;UnregisterClass(g_class_name,&nbsp;inst);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;COM&nbsp;system<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Closes&nbsp;the&nbsp;COM&nbsp;library&nbsp;on&nbsp;the&nbsp;current&nbsp;thread,&nbsp;unloads&nbsp;all&nbsp;DLLs&nbsp;loaded&nbsp;by&nbsp;the&nbsp;thread,&nbsp;frees&nbsp;any&nbsp;other<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;resources&nbsp;that&nbsp;the&nbsp;thread&nbsp;maintains,&nbsp;and&nbsp;forces&nbsp;all&nbsp;RPC&nbsp;connections&nbsp;on&nbsp;the&nbsp;thread&nbsp;to&nbsp;close.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;CoUninitialize();<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>int</span><span style=color:#000>)&nbsp;msg.wParam;<br>}<br></span></div><br><span style=font-weight:700>该程序必须和</span><a class=postTitle2 id=_8c640e64331_HomePageDays_DaysList_ctl00_DayItem_DayList_ctl00_TitleUrl style=font-weight:700 href=http://www.cppblog.com/lovedday/archive/2007/08/13/29927.html><font color=#1b1b1b>使用DirectPlay进行网络互联（3）</font></a><span style=font-weight:700>中提及的服务器端程序配合使用。</span><br><br>运行截图：<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/o_client.jpg><br><br></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
使用DirectPlay进行网络互联（4）</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/networking-with-directplay-part-4/ title=使用DirectPlay进行网络互联（4）>https://blogs.qipai360.cn/post/networking-with-directplay-part-4/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/win32-development-common-pitfalls/ rel=next title=Win32开发中最易踏上的地雷><i class="fa fa-chevron-left"></i> Win32开发中最易踏上的地雷</a></div><div class="post-nav-prev post-nav-item"><a href=/post/networking-with-directplay-part-3/ rel=prev title=使用DirectPlay进行网络互联（3）>使用DirectPlay进行网络互联（3）
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"networking-with-directplay-part-4","permalink":"https://blogs.qipai360.cn/post/networking-with-directplay-part-4/","title":"使用DirectPlay进行网络互联（4）","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1761990624" defer></script></body></html>