<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="使用DirectPlay进行网络互联（1）"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="使用DirectPlay进行网络互联（1）"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/networking-with-directplay-part-1/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2007-08-06 19:50:00 +0800 +0800"><meta property="article:modified_time" content="2007-08-27 17:15:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1761990628"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>使用DirectPlay进行网络互联（1） - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>678</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>678</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2418817></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5198></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-01 14:55:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/networking-with-directplay-part-1/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="使用DirectPlay进行网络互联（1）"><meta itemprop=description content="了解网络互联网络是指多台计算机互联以进行数据传输及通信的系统。除了两个或更多的计算机之外，网路还需要有网络互联软件（或一个网路操作系统）、网络适配器以及电缆。网络适配器有各种形状和大小，但是一般都采用调制解调器的形状。实际上，调制解调器就是一个网路适配器，它能够将一台计算机通过世界上最大的网络&mdash;互联网连接到数百万台计算机上。网路模型网络互联模型有三种基本类型：服务器端、客户端以及点对点。使用服务器端模型，可以建立一个中央网络互联系统。其他计算机使用客户端模型连接到服务器端后，就可以向服务器端发送数据以及从服务器端接收数据。客户端没有其他客户端的信息，不直接与它们连接，客户端都只知道服务器端的信息，而服务器端则拥有所有客户端的信息以及适合这些客户端之间的路由信息。服务器端和客户端常常成对进行描述，即服务器端/客户端（C/S）模型，但是在使用DirectPlay时，将二者分开是有必要的，因为服务器端和客户端是由两个独立的组件组成的。点对点（peer-to-peer）这种网络互联模型与服务器端模型或客户端模型正好相反，计算机相互之间直接进行连接。每一台新的计算机加入网络会话中，都会建立一个新的连接，所以每台计算机都能直接连接到其他计算机。连接到网络的时段称为会话，一次会话会有与之相关的属性，如密码、最大连接数等。游戏厅可以将游戏厅服务器看作在线玩家的会议大厅，一个游戏厅允许所有玩家登录、通信以及加入他们喜爱的一些游戏。一旦游戏厅服务器连满了玩家，就停止对游戏厅的循环（这样做是为了节省网络带宽）。网络带宽（network bandwidth）指的是一个网络连接能够轻松处理的数据量，高网络带宽连接能比低网路带宽连接更快地处理大量的网络数据。响应时间和延迟带宽引出了两个术语：响应时间和延迟。响应时间是完成一个操作所花的时间（越低越好）的量化。延迟是用来描述网络通信的迟滞的术语，即数据从发送到它被接收到所花的时间。低延迟表示网络数据迅速地被接收。高延迟（最不希望出现的事情）表示网络数据被延迟或者根本没有被发送到。延迟是一个主要问题，特别是使用了互联网时，就必须处理这个问题。通信协议网络可以有各种方式进行相互通信，但是要连接到另一个，两个系统都必须采用相同的协议。目前最流行的协议是TCP/IP协议（传输控制协议/Internet协议），它被广泛应用于互联网。通信协议也被称作服务器提供者，无论服务器提供者是一种诸如IPX、TCP/IP的协议，还是一种诸如调制解调器或者串行电缆的设备，都可以把它看作是网络互联的连接体。TCP/IP协议是一种在网络上传输数据包的方法。它将数据分割成很多小数据包，再加上发送方和接收方的地址以及包的数目，便于重组数据。信息在传输过程中丢失（频繁发生的事情），TCP/IP允许网络重发数据包。当出现延迟时，这些数据包可能以错误的顺序被接收，比如旧的数据包在新的数据包之后到达。好在无需担心，因为TCP/IP会重发丢失的包并且重组无序的包。寻址在TCP/IP协议下，一个系统被分配一个由4个数字（0 -255之间）组成的网络地址（IP地址），数字之间用点分割。一个IP地址就像下面这样：64.120.53.2IP地址对我们来说不好辨认，但是网络却可以根据每一个数值成功地传递数据。稍加运算就会发现，这4个数字的组合总共可以提供4294967296个可能的地址。为了增加地址数量，网络使用附加的称为端口的地址值，数据被传送到其上。 如果将IP地址比喻成一个邮政室（mailroom），那么该邮政室（IP地址）描述了与网络相连的单个计算机系统，并且该计算机系统只被分配了惟一的IP地址。在邮政室中有很多箱柜（端口），邮件被分类到其中。每一个箱柜（端口）属于一个特定的工作人员（一个特定的应用程序）。一些应用程序可以拥有多个端口，数据只能被一个同相应IP地址以及相应端口所匹配的系统接收。一种称为数据路由器（data router）的设备将接收到的网络数据传送到它所知道的系统，或者将数据传送到另一个网络连接。DirectPlay概述要在工程中使用DirectPlay，必须包含DPlay8.h和DPAddr.h，还要链接DPlayX.lib和 DXGuid.lib。网络对象使用DirectPlay，需要使用前面提到的网络模型：客户端、服务器端和点对点。每一种网络模型都有自己的接口对象，如下所示：IDirectPlay8Client：客户端网络对象，连接到一个服务器端。IDirectPlay8Server：服务器端网络对象，连接多个客户端。IDirectPlay8Peer：   点对点网络对象，连接客户端于其他客户端。IDirectPlay8Address：包含（以及构造）网络地址的对象。要连接到远程网络系统（或主持一次会话），需要使用 IDirectPlay8Address构造一个网络地址，IDirectPlay8Address的惟一用途就是构造并包含单个网络地址。会话指的是主持或加入一个可连接网路系统的时段，终止连接时，会话也就终止了。要主持游戏会话或连接到远程系统，首先需要创建网络对象并给它分配地址。要主持游戏会话，只需要等待其他系统（也就是使用这些系统的人）连接上来即可。连接建立之后，系统就可以和远程系统开始相互传输游戏相关的网络消息， DirectPlay把这些远程系统称作玩家。将玩家进行分组在DirectPlay术语中，“玩家”是指通过网络连接到其他计算机的单个连接（通常是一个游戏玩家）。一台计算机可以有多个玩家，但一般只有一个。实际上，服务器端也被标识为玩家，以便于识别。每一个玩家都会接收到一个标识号码（玩家ID），系统使用这个标识号码来将消息传递到每个玩家。这些号码是追踪玩家的惟一可信任方法，所以需要让程序对它们进行相应地处理。对于大型游戏，可能有成千上万已连接的玩家。为了在游戏中更好地处理这些玩家，可以将一些或所有玩家编制到一些组中。采用组的概念可以减少编程的繁琐，主要原因在于可以将一个游戏区域（比如一张地图或某个级别）中的多个玩家划分为一组，并且一次向整个组发送网络数据，而不是单独发送给各个玩家。使用组还有很多其他原因，但这个原因是最主要的。一个组中包含多少玩家以及创建多少个组完全没有限制，组也可以属于其他组。带消息的网络互联消息是分了类的数据包，其中包含简单的结构。每一个消息都有特定的含义，且都有一个与之对应的宏，而且还和所使用的网络模型有关。要接收消息，网络对象必须给自己指定一个回调函数，以便于每次消息到达时进行调用。为了确保得到平滑的数据流，该函数根据数据类型进行分析并尽快地返回。发送消息，需要使用各个网络对象的发送函数。这些函数易于使用，并且提供了许多发送选项，包括保证发送（guaranteed delivery）、安全编码（secure encryption）以及同步或异步发送。同步与异步DirectPlay提供的第一个发送选项是同步或异步发送消息的功能，也就是说系统在发出发送数据指定之后交回控制权（异步），还是直到所有的数据都成功发送之后再交回控制权（同步）。很多时候使用异步方法，因为它不会像同步方法那样阻塞系统。安全性要引起注意的是任何时候都可能有人在截取并记录游戏的网络数据。因此，就需要采用一种安全的方式编码消息数据，使得那些解码的黑客非常难读懂先前的信息。使用安全网络发送的不好之处在于它会稍稍减慢系统的系统，因为必须在数据发送之前先编码信息，然后在接收到之后进行解码。保证发送就像一些快递公司保证送到包裹一样， DirectPlay也能保证送到消息。可以将一组信息标识为保证的，其余确定的就是DirectPlay将一直执行发送操作直到发送成功，以保证将其发送到目标地址（除非断线），使用保证发送是通过在调用函数时指定一个惟一的标志来实现的。保证发送的不好之处在于速度，保证发送在实际的游戏状况下非常慢，游戏采用UDP（用户数据报协议）发送方法，就不用关心数据是否被接收到（和TCP发送方法相反，它保证数据的发送）。节流有时系统会因为试图处理流数据而过载，尽管这样， DirectPlay有一个内置的消息节流器，它丢弃了发送队列中低优先级的信息。使用GUID识别应用程序如何从众多的网络应用程序中区分出自己的网络应用程序呢？解决这个问题的方法就是给自己的应用程序指定一个惟一的号码，并且只允许使用相同号码的应用程序相互进行连接。这个特殊的号码就是 Windows程序员熟悉的GUID（全局惟一标识符）。创建应用程序之前，花一点时间给它设置一个惟一的GUID，并且保证所有通过网络进行连接的该应用程序使用相同的GUID。初始化网络对象无论是服务器端、客户端还是单点对象，使用DirectPlay的第一步都是创建网络对象。要初始化每一个网络模型接口，必须使用CoCreateInstance函数，可能用到的类ID和引用标识符如下所示:"></span><header class=post-header><h1 class=post-title itemprop="name headline">使用DirectPlay进行网络互联（1）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年08月06日 19:50:00 CST" itemprop="dateCreated datePublished" datetime="2007-08-06 19:50:00 +0800 +0800">2007年08月06日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:15:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:15:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>33419</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>67分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/networking-with-directplay-part-1/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><span style=font-weight:700;color:#20562d>了解网络互联</span><br><br>网络是指多台计算机互联以进行数据传输及通信的系统。除了两个或更多的计算机之外，网路还需要有网络互联软件（或一个网路操作系统）、网络适配器以及电缆。网络适配器有各种形状和大小，但是一般都采用调制解调器的形状。实际上，调制解调器就是一个网路适配器，它能够将一台计算机通过世界上最大的网络&mdash;互联网连接到数百万台计算机上。<br><br><span style=font-weight:700>网路模型</span><br><br>网络互联模型有三种基本类型：服务器端、客户端以及点对点。<br><br>使用服务器端模型，可以建立一个中央网络互联系统。其他计算机使用客户端模型连接到服务器端后，就可以向服务器端发送数据以及从服务器端接收数据。客户端没有其他客户端的信息，不直接与它们连接，客户端都只知道服务器端的信息，而服务器端则拥有所有客户端的信息以及适合这些客户端之间的路由信息。服务器端和客户端常常成对进行描述，即服务器端/客户端（C/S）模型，但是在使用DirectPlay时，将二者分开是有必要的，因为服务器端和客户端是由两个独立的组件组成的。<br><br>点对点（peer-to-peer）这种网络互联模型与服务器端模型或客户端模型正好相反，计算机相互之间直接进行连接。每一台新的计算机加入网络会话中，都会建立一个新的连接，所以每台计算机都能直接连接到其他计算机。连接到网络的时段称为会话，一次会话会有与之相关的属性，如密码、最大连接数等。<br><br><span style=font-weight:700>游戏厅</span><br><br>可以将游戏厅服务器看作在线玩家的会议大厅，一个游戏厅允许所有玩家登录、通信以及加入他们喜爱的一些游戏。一旦游戏厅服务器连满了玩家，就停止对游戏厅的循环（这样做是为了节省网络带宽）。网络带宽（network bandwidth）指的是一个网络连接能够轻松处理的数据量，高网络带宽连接能比低网路带宽连接更快地处理大量的网络数据。<br><br><span style=font-weight:700>响应时间和延迟</span><br><br>带宽引出了两个术语：响应时间和延迟。响应时间是完成一个操作所花的时间（越低越好）的量化。延迟是用来描述网络通信的迟滞的术语，即数据从发送到它被接收到所花的时间。<br><br>低延迟表示网络数据迅速地被接收。高延迟（最不希望出现的事情）表示网络数据被延迟或者根本没有被发送到。延迟是一个主要问题，特别是使用了互联网时，就必须处理这个问题。<br><br><span style=font-weight:700>通信协议</span><br><br>网络可以有各种方式进行相互通信，但是要连接到另一个，两个系统都必须采用相同的协议。目前最流行的协议是TCP/IP协议（传输控制协议/Internet协议），它被广泛应用于互联网。通信协议也被称作服务器提供者，无论服务器提供者是一种诸如IPX、TCP/IP的协议，还是一种诸如调制解调器或者串行电缆的设备，都可以把它看作是网络互联的连接体。<br><br>TCP/IP协议是一种在网络上传输数据包的方法。它将数据分割成很多小数据包，再加上发送方和接收方的地址以及包的数目，便于重组数据。信息在传输过程中丢失（频繁发生的事情），TCP/IP允许网络重发数据包。当出现延迟时，这些数据包可能以错误的顺序被接收，比如旧的数据包在新的数据包之后到达。好在无需担心，因为TCP/IP会重发丢失的包并且重组无序的包。<br><br><span style=font-weight:700>寻址</span><br><br>在TCP/IP协议下，一个系统被分配一个由4个数字（0 -255之间）组成的网络地址（IP地址），数字之间用点分割。一个IP地址就像下面这样：<br><br>64.120.53.2<br><br>IP地址对我们来说不好辨认，但是网络却可以根据每一个数值成功地传递数据。稍加运算就会发现，这4个数字的组合总共可以提供4294967296个可能的地址。为了增加地址数量，网络使用附加的称为端口的地址值，数据被传送到其上。<br><br>如果将IP地址比喻成一个邮政室（mailroom），那么该邮政室（IP地址）描述了与网络相连的单个计算机系统，并且该计算机系统只被分配了惟一的IP地址。在邮政室中有很多箱柜（端口），邮件被分类到其中。每一个箱柜（端口）属于一个特定的工作人员（一个特定的应用程序）。一些应用程序可以拥有多个端口，数据只能被一个同相应IP地址以及相应端口所匹配的系统接收。一种称为数据路由器（data router）的设备将接收到的网络数据传送到它所知道的系统，或者将数据传送到另一个网络连接。<br><br><span style=font-weight:700;color:#20562d>DirectPlay概述</span><br><br><span style=font-weight:700>要在工程中使用DirectPlay，必须包含DPlay8.h和DPAddr.h，还要链接DPlayX.lib和 DXGuid.lib。</span><br><br><span style=font-weight:700>网络对象</span><br><br>使用DirectPlay，需要使用前面提到的网络模型：客户端、服务器端和点对点。每一种网络模型都有自己的接口对象，如下所示：<br><br>IDirectPlay8Client：客户端网络对象，连接到一个服务器端。<br>IDirectPlay8Server：服务器端网络对象，连接多个客户端。<br>IDirectPlay8Peer：   点对点网络对象，连接客户端于其他客户端。<br>IDirectPlay8Address：包含（以及构造）网络地址的对象。<br><br>要连接到远程网络系统（或主持一次会话），需要使用 IDirectPlay8Address构造一个网络地址，IDirectPlay8Address的惟一用途就是构造并包含单个网络地址。会话指的是主持或加入一个可连接网路系统的时段，终止连接时，会话也就终止了。要主持游戏会话或连接到远程系统，首先需要创建网络对象并给它分配地址。要主持游戏会话，只需要等待其他系统（也就是使用这些系统的人）连接上来即可。连接建立之后，系统就可以和远程系统开始相互传输游戏相关的网络消息， DirectPlay把这些远程系统称作玩家。<br><br><span style=font-weight:700>将玩家进行分组</span><br><br>在DirectPlay术语中，“玩家”是指通过网络连接到其他计算机的单个连接（通常是一个游戏玩家）。一台计算机可以有多个玩家，但一般只有一个。实际上，服务器端也被标识为玩家，以便于识别。每一个玩家都会接收到一个标识号码（玩家ID），系统使用这个标识号码来将消息传递到每个玩家。这些号码是追踪玩家的惟一可信任方法，所以需要让程序对它们进行相应地处理。<br><br>对于大型游戏，可能有成千上万已连接的玩家。为了在游戏中更好地处理这些玩家，可以将一些或所有玩家编制到一些组中。采用组的概念可以减少编程的繁琐，主要原因在于可以将一个游戏区域（比如一张地图或某个级别）中的多个玩家划分为一组，并且一次向整个组发送网络数据，而不是单独发送给各个玩家。使用组还有很多其他原因，但这个原因是最主要的。一个组中包含多少玩家以及创建多少个组完全没有限制，组也可以属于其他组。<br><br><span style=font-weight:700>带消息的网络互联</span><br><br>消息是分了类的数据包，其中包含简单的结构。每一个消息都有特定的含义，且都有一个与之对应的宏，而且还和所使用的网络模型有关。要接收消息，网络对象必须给自己指定一个回调函数，以便于每次消息到达时进行调用。为了确保得到平滑的数据流，该函数根据数据类型进行分析并尽快地返回。发送消息，需要使用各个网络对象的发送函数。这些函数易于使用，并且提供了许多发送选项，包括保证发送（guaranteed delivery）、安全编码（secure encryption）以及同步或异步发送。<br><br><span style=font-weight:700>同步与异步</span><br><br>DirectPlay提供的第一个发送选项是同步或异步发送消息的功能，也就是说系统在发出发送数据指定之后交回控制权（异步），还是直到所有的数据都成功发送之后再交回控制权（同步）。很多时候使用异步方法，因为它不会像同步方法那样阻塞系统。<br><br><span style=font-weight:700>安全性</span><br><br>要引起注意的是任何时候都可能有人在截取并记录游戏的网络数据。因此，就需要采用一种安全的方式编码消息数据，使得那些解码的黑客非常难读懂先前的信息。使用安全网络发送的不好之处在于它会稍稍减慢系统的系统，因为必须在数据发送之前先编码信息，然后在接收到之后进行解码。<br><br><span style=font-weight:700>保证发送</span><br><br>就像一些快递公司保证送到包裹一样， DirectPlay也能保证送到消息。可以将一组信息标识为保证的，其余确定的就是DirectPlay将一直执行发送操作直到发送成功，以保证将其发送到目标地址（除非断线），使用保证发送是通过在调用函数时指定一个惟一的标志来实现的。保证发送的不好之处在于速度，保证发送在实际的游戏状况下非常慢，游戏采用UDP（用户数据报协议）发送方法，就不用关心数据是否被接收到（和TCP发送方法相反，它保证数据的发送）。<br><br><span style=font-weight:700>节流</span><br><br>有时系统会因为试图处理流数据而过载，尽管这样， DirectPlay有一个内置的消息节流器，它丢弃了发送队列中低优先级的信息。<br><br><span style=font-weight:700>使用GUID识别应用程序</span><br><br>如何从众多的网络应用程序中区分出自己的网络应用程序呢？解决这个问题的方法就是给自己的应用程序指定一个惟一的号码，并且只允许使用相同号码的应用程序相互进行连接。这个特殊的号码就是 Windows程序员熟悉的GUID（全局惟一标识符）。创建应用程序之前，花一点时间给它设置一个惟一的GUID，并且保证所有通过网络进行连接的该应用程序使用相同的GUID。<br><br><span style=font-weight:700;color:#20562d>初始化网络对象</span><br><br>无论是服务器端、客户端还是单点对象，使用DirectPlay的第一步都是创建网络对象。要初始化每一个网络模型接口，必须使用CoCreateInstance函数，可能用到的类ID和引用标识符如下所示:<br><br></p><a id=more></a><table class=style1><tbody><tr><td style=width:319px>CLSID_DirectPlay8Address&nbsp;</td><td style=width:216px>IID_IDirectPlay8Address</td></tr><tr><td style=width:319px>CLSID_DirectPlay8Client</td><td style=width:216px>IID_IDirectPlay8Client</td></tr><tr><td style=width:319px>CLSID_DirectPlay8Peer</td><td style=width:216px>IID_IDirectPlay8Peer</td></tr><tr><td style=width:319px>CLSID_DirectPlay8Server</td><td style=width:216px>IID_IDirectPlay8Server</td></tr></tbody></table><br>无论创建的是什么网络对象（客户端、单点或服务器端），都需要创建与之匹配的网络回调函数，在网络消息被接收到的时候会调用该回调函数。<br><br>该回调函数使用说明如下：<br><br><p><strong>PFNDPNMESSAGEHANDLER</strong> is an application-defined callback function used by the <strong>IDirectPlay8Peer</strong>, <strong>IDirectPlay8Client</strong>, and <strong>IDirectPlay8Server</strong> <strong>IDirectPlay8LobbyClient</strong> and <strong>IDirectPlay8LobbiedApplication</strong> interfaces to process messages.</p><pre class=syntax><strong>typedef HRESULT (WINAPI *PFNDPNMESSAGEHANDLER)( <br></strong> <strong>PVOID</strong> <em>pvUserContext</em>,<br> <strong>DWORD</strong> <em>dwMessageType</em>,<br> <strong>PVOID</strong> <em>pMessage</em><br><strong>);</strong></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4>Parameters</h4><dl><dt><em>pvUserContext</em><dd>Pointer to the application-defined structure that will be passed to this callback function. This is defined in the <em>pvUserContext</em> parameter of the <strong>Initialize</strong> method.<dt><em>dwMessageType</em><dd>One of the following message types that are generated by the <strong>IDirectPlay8Peer</strong>, <strong>IDirectPlay8Client</strong>, and <strong>IDirectPlay8Server</strong> interfaces. Each interface uses a different subset of the available messages. Refer to the interface documentation for details.</dd></dl><ul><li><strong>DPN_MSGID_ADD_PLAYER_TO_GROUP</strong><li><strong>DPN_MSGID_ASYNC_OP_COMPLETE</strong><li><strong>DPN_MSGID_CLIENT_INFO</strong><li><strong>DPN_MSGID_CONNECT_COMPLETE</strong><li><strong>DPN_MSGID_CREATE_GROUP</strong><li><strong>DPN_MSGID_CREATE_PLAYER</strong><li><strong>DPN_MSGID_DESTROY_GROUP</strong><li><strong>DPN_MSGID_DESTROY_PLAYER</strong><li><strong>DPN_MSGID_ENUM_HOSTS_QUERY</strong><li><strong>DPN_MSGID_ENUM_HOSTS_RESPONSE</strong><li><strong>DPN_MSGID_GROUP_INFO</strong><li><strong>DPN_MSGID_HOST_MIGRATE</strong><li><strong>DPN_MSGID_INDICATE_CONNECT</strong><li><strong>DPN_MSGID_INDICATED_CONNECT_ABORTED</strong><li><strong>DPN_MSGID_PEER_INFO</strong><li><strong>DPN_MSGID_RECEIVE</strong><li><strong>DPN_MSGID_REMOVE_PLAYER_FROM_GROUP</strong><li><strong>DPN_MSGID_RETURN_BUFFER</strong><li><strong>DPN_MSGID_SEND_COMPLETE</strong><li><strong>DPN_MSGID_SERVER_INFO</strong><li><strong>DPN_MSGID_TERMINATE_SESSION</strong><p>Additionally, if the application supports Microsoft® DirectPlay® lobby functionality, this parameter can specify one of the following message types that are generated by the <strong>IDirectPlay8LobbyClient</strong> and <strong>IDirectPlay8LobbiedApplication</strong> interfaces. Each interface uses a different subset of the available messages. Refer to the interface documentation for details.</p><li><strong>DPL_MSGID_CONNECT</strong><li><strong>DPL_MSGID_CONNECTION_SETTINGS</strong><li><strong>DPL_MSGID_DISCONNECT</strong><li><strong>DPL_MSGID_RECEIVE</strong><li><strong>DPL_MSGID_SESSION_STATUS</strong></li></ul><dl><dt><em>pMessage</em><dd>Structure containing message information.</dd></dl><h4>Return Values</h4><p>See the documentation for the individual messages for appropriate return values. Unless otherwise noted, this function should return S_OK.</p><h4>Remarks</h4><p>This function must be threadsafe because it might be called reentrantly through multiple threads.</p><p>Callback messages from the same player are serialized. Once you receive a message from a player, you will not receive another until you have handled the first message, and the callback function has returned.</p><p>The message structures have the same name as the message type except the "DPN_MSGID" is replaces with "DPNMSG". For example, the <strong>DPN_MSGID_CONNECTION_TERMINATED</strong> message type uses the <strong>DPNMSG_CONNECTION_TERMINATED</strong> message structure to convey the actual message information.</p><p>When implementing this callback function, first look at the message type returned in the <em>dwMessageType</em> parameter and then cast the message structure (<em>pMessage</em>) to that type to obtain message information. Some messages don't have a defined structure because they have no parameters. For these messages, the <em>pMessage </em>parameter is NULL.</p><br>要初始化网络对象，需要调用Initialize函数。<br><br><p>Registers an entry point in the client's code that receives the messages from the <strong>IDirectPlay8Client</strong> interface and from the server. This method must be called before calling any other methods of this interface.</p><pre class=syntax><strong>HRESULT Initialize(<br>PVOID const</strong> <em>pvUserContext</em>,<br><strong>const PFNDPNMESSAGEHANDLER</strong> <em>pfn</em>,<br><strong>const DWORD</strong> <em>dwFlags</em><br><strong>);</strong></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4>Parameters</h4><dl><dt><em>pvUserContext</em><dd>[in] Pointer to the user-provided context value in calls to the message handler. Providing a user-context value can be useful to differentiate messages coming from multiple interfaces to a common message handler.<dt><em>pfn</em><dd>[in] Pointer to a <strong>PFNDPNMESSAGEHANDLER</strong> callback function that receives all messages from the server, and receives indications of session changes from the <strong>IDirectPlay8Client</strong> interface.<dt><em>dwFlags</em><dd>[in] You may specify the following flag.<dl><dt>DPNINITIALIZE_DISABLEPARAMVAL<dd>Disable parameter validation for the current object.</dd></dl></dd></dl><h4>Return Values</h4><p>Returns S_OK if successful, or one of the following error values.</p><table><tbody><tr valign=top><td width=100%>DPNERR_INVALIDFLAGS</td></tr><tr valign=top><td width=100%>DPNERR_INVALIDPARAM</td></tr></tbody></table><br><h4>Remarks</h4><p>This is the first method you should call after using <strong>CoCreateInstance</strong> to obtain the <strong>IDirectPlay8Client</strong> interface.</p><br>下面这个函数创建了DirectPlay Client对象并且初始化该对象。<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Create&nbsp;DirectPlay&nbsp;Client&nbsp;and&nbsp;initialize&nbsp;it.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Init_DirectPlay_Client()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;DirectPlay&nbsp;client&nbsp;component</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(CoCreateInstance(CLSID_DirectPlay8Client,&nbsp;NULL,&nbsp;CLSCTX_INPROC,&nbsp;IID_IDirectPlay8Client,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_dp_client)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Assign&nbsp;a&nbsp;message&nbsp;handler&nbsp;to&nbsp;network&nbsp;component<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Registers&nbsp;an&nbsp;entry&nbsp;point&nbsp;in&nbsp;the&nbsp;client's&nbsp;code&nbsp;that&nbsp;receives&nbsp;the&nbsp;messages&nbsp;from&nbsp;the&nbsp;IDirectPlay8Client<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;interface&nbsp;and&nbsp;from&nbsp;the&nbsp;server.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Initialize(NULL,&nbsp;Net_Msg_Handle,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}</span></div><br><span style=font-weight:700>指定设备</span><br><br>虽然已经选择了一个服务提供者，但系统中可能有一个以上的设备使用它。当一个网络适配器和调制解调器都连接到互联网，并且都使用TCP/IP协议时，就会出现这种情况，这是就必须对设备进行枚举并进行选择。<br><br>枚举函数获取了所有可用的服务提供者，并将它们以可用的方式组织在一起。DirectPlay枚举和典型的 Windwos枚举方法有所不同，在查询过程中找到实例对象并不是每次都调用回调函数，而是从包含了以数组形式存储的每个服务提供者的缓冲区中寻找。<br><br>处理枚举可以使用EnumServiceProviders函数。<br><br><p>Enumerates the registered service providers available to the application.</p><pre class=syntax><strong>HRESULT EnumServiceProviders(<br>const GUID *const</strong> <em>pguidServiceProvider</em>,<br><strong>const GUID *const</strong> <em>pguidApplication</em>,<br><strong>DPN_SERVICE_PROVIDER_INFO *const</strong> <em>pSPInfoBuffer</em>,<br><strong>PDWORD const</strong> <em>pcbEnumData</em>,<br><strong>PDWORD const</strong> <em>pcReturned</em>,<br><strong>const DWORD</strong> <em>dwFlags</em><br><strong>);</strong></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4>Parameters</h4><dl><dt><em>pguidServiceProvider</em><dd>[in] Pointer to a variable of type <strong>GUID </strong>that specifies a service provider. This optional parameter forces the enumeration of subdevices for the specified service provider. You should normally set this value to NULL, to enumerate all available service providers.<dt><em>pguidApplication</em><dd>[in] Pointer to a variable of type <strong>GUID </strong>that specifies an application. If a pointer is passed in this parameter, only service providers who can be connected to the application are enumerated. You can also pass NULL to enumerate the registered service providers for the system.<dt><em>pSPInfoBuffer</em><dd>[out] Pointer to an array of <strong>DPN_SERVICE_PROVIDER_INFO</strong> structures that will be filled with service provider information.<dt><em>pcbEnumData</em><dd>[out] Pointer to <strong>DWORD</strong>, which is filled with the size of the <em>pSPInfoBuffer</em> array, in bytes, if the buffer is too small.<dt><em>pcReturned</em><dd>[out] Pointer to a variable of type <strong>DWORD</strong> that specifies the number of <strong>DPN_SERVICE_PROVIDER_INFO</strong> structures returned in the <em>pSPInfoBuffer</em> array.<dt><em>dwFlags</em><dd>[in] The following flag can be specified.<dl><dt>DPNENUMSERVICEPROVIDERS_ALL<dd>Enumerates all the registered service providers for the system, including those that are not available to the application or do not have devices installed.</dd></dl></dd></dl><h4>Return Values</h4><p>Returns S_OK if successful, or one of the following error values.</p><table><tbody><tr valign=top><td width=100%>DPNERR_BUFFERTOOSMALL</td></tr><tr valign=top><td width=100%>DPNERR_INVALIDPARAM</td></tr></tbody></table><br><h4>Remarks</h4><p>Call this method initially by specifying NULL in the <em>pguidServiceProvider</em> parameter to determine the base service providers available to the system. Specific devices for a service provider can be obtained by passing a pointer to a service provider GUID in the <em>pguidServiceProvider</em>. This is useful, for example, when using the Modem Connection for Microsoft® DirectPlay® service provider. You can choose among different modems for dialing out and select specific modems for hosting.</p><p>If the <em>pEnumData </em>buffer is not big enough to hold the requested service provider information, the method returns DPNERR_BUFFERTOOSMALL and the <em>cbEnumData</em> parameter contains the required buffer size. Typically, the best strategy is to call the method once with a zero-length buffer to determine the required size. Then call the method again with the appropriate-sized buffer.</p><p>Normally, this method will return only those service providers that can be used by the application. For example, if the IPX networking protocol is not installed, DirectPlay will not return the IPX service provider. To have DirectPlay return all service providers, even those that cannot be used by the application, set the DPNENUMSERVICEPROVIDERS_ALL flag in <em>dwFlags.</em></p><br>pSPInfoBuffer是指向DPN_SERVICE_PROVIDER_INFO结构体数组的指针，该函数将用枚举的信息填充该结构体。<br><br><p>Used when enumerating information for a specific service provider.</p><pre class=syntax>typedef struct _DPN_SERVICE_PROVIDER_INFO{<br> DWORD dwFlags;<br> GUID guid;<br> WCHAR* pwszName;<br> PVOID pvReserved;<br> DWORD dwReserved;<br>} DPN_SERVICE_PROVIDER_INFO, *PDPN_SERVICE_PROVIDER_INFO;</pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4>Members</h4><dl><dt><strong>dwFlags</strong><dd>Reserved. Must be 0.<dt><strong>guid</strong><dd>GUID for the service provider.<dt><strong>pwszName</strong><dd>Name of the service provider.<dt><strong>pvReserved</strong><dd>Reserved. Must be 0.<dt><strong>dwReserved</strong><dd>Reserved. Must be 0.</dd></dl><br>下面这个函数演示了如何枚举系统中的服务提供者:<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>HWND&nbsp;g_hwnd;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles</span><span style=color:green><br></span><span style=color:#000><br>IDirectPlay8Client</span><span style=color:#000>*</span><span style=color:#000>&nbsp;g_dp_client;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directplay&nbsp;client<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;service&nbsp;provider&nbsp;list,&nbsp;used&nbsp;when&nbsp;enumerating&nbsp;information&nbsp;for&nbsp;a&nbsp;specifice&nbsp;service&nbsp;provider.</span><span style=color:green><br></span><span style=color:#000>DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;g_sp_list;&nbsp;&nbsp;<br><br>DWORD&nbsp;g_sp_number;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;service&nbsp;provider&nbsp;number<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Enumerate&nbsp;all&nbsp;available&nbsp;service&nbsp;provider.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Enum_Service_Provider()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;is&nbsp;no&nbsp;server&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_dp_client&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;a&nbsp;handler&nbsp;to&nbsp;the&nbsp;list&nbsp;box</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;listbox&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;GetDlgItem(g_hwnd,&nbsp;IDC_SERVICE_PROVIDERS);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clear&nbsp;the&nbsp;list&nbsp;box</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(listbox,&nbsp;LB_RESETCONTENT,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;service&nbsp;provider&nbsp;list&nbsp;memory</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;delete[]&nbsp;g_sp_list;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_sp_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;query&nbsp;the&nbsp;required&nbsp;size&nbsp;of&nbsp;the&nbsp;data&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;sp_list_size&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerates&nbsp;the&nbsp;registerd&nbsp;service&nbsp;providers&nbsp;available&nbsp;to&nbsp;the&nbsp;application</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;rv&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>EnumServiceProviders(NULL,&nbsp;NULL,&nbsp;g_sp_list,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>sp_list_size,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_sp_number,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(rv&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;DPNERR_BUFFERTOOSMALL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;allocate&nbsp;a&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((g_sp_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;</span><span style=color:#00f>new</span><span style=color:#000>&nbsp;BYTE[sp_list_size])&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerate&nbsp;again</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>EnumServiceProviders(NULL,&nbsp;NULL,&nbsp;g_sp_list,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>sp_list_size,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_sp_number,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumeration&nbsp;is&nbsp;complete,&nbsp;scan&nbsp;through&nbsp;entries.</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;sp_name[</span><span style=color:#000>1024</span><span style=color:#000>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;sp_ptr&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_sp_list;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(DWORD&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;g_sp_number;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;convert&nbsp;wide&nbsp;string&nbsp;into&nbsp;multi-byte&nbsp;string</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wcstombs(sp_name,&nbsp;sp_ptr</span><span style=color:#000>-></span><span style=color:#000>pwszName,&nbsp;</span><span style=color:#000>1024</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Add&nbsp;the&nbsp;service&nbsp;provider&nbsp;into&nbsp;box<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;An&nbsp;application&nbsp;sends&nbsp;an&nbsp;LB_ADDSTRING&nbsp;message&nbsp;to&nbsp;add&nbsp;a&nbsp;string&nbsp;to&nbsp;a&nbsp;list&nbsp;box.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;If&nbsp;the&nbsp;list&nbsp;box&nbsp;does&nbsp;not&nbsp;have&nbsp;the&nbsp;LBS_SORT&nbsp;style,&nbsp;the&nbsp;string&nbsp;is&nbsp;added&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;list.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Otherwise,&nbsp;the&nbsp;string&nbsp;is&nbsp;inserted&nbsp;into&nbsp;the&nbsp;list&nbsp;and&nbsp;the&nbsp;list&nbsp;is&nbsp;sorted.&nbsp;&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(listbox,&nbsp;LB_ADDSTRING,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPARAM)sp_name);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;go&nbsp;to&nbsp;next&nbsp;service&nbsp;provider&nbsp;in&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp_ptr</span><span style=color:#000>++</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}</span></div><br>下面给出一个完整实例来运用刚才介绍的知识，<span style=font-weight:700>由于DirectX9 SDK已不包含DirectPlay，所以需要安装DirectX8 SDK，并在Visual Studio中进行相应设置。</span><br><br><a href=http://www.cppblog.com/Files/lovedday/Enum.rar><font color=#1b1b1b>点击下载源码和工程</font></a><br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>/*</span><span style=color:green>**************************************************************************************<br>PURPOSE:<br>&nbsp;&nbsp;&nbsp;&nbsp;Enum&nbsp;Network&nbsp;Adapters&nbsp;Demo<br>&nbsp;**************************************************************************************</span><span style=color:green>*/</span><span style=color:#000><br><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>windows.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>dplay8.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>dpaddr.h</span><span style=color:#000>></span><span style=color:#000><br>#include&nbsp;</span><span style=color:#000>"</span><span style=color:#000>resource.h</span><span style=color:#000>"</span><span style=color:#000><br><br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dxguid.lib</span><span style=color:#000>"</span><span style=color:#000>)<br>#pragma&nbsp;comment(lib,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>dplayx.lib</span><span style=color:#000>"</span><span style=color:#000>)<br><br>#pragma&nbsp;warning(disable&nbsp;:&nbsp;</span><span style=color:#000>4996</span><span style=color:#000>)<br><br></span><span style=color:#00f>#define</span><span style=color:#000>&nbsp;Safe_Release(p)&nbsp;if((p))&nbsp;(p)->Release();</span><span style=color:#000><br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;window&nbsp;handles,&nbsp;class.</span><span style=color:green><br></span><span style=color:#000>HWND&nbsp;g_hwnd;<br></span><span style=color:#00f>char</span><span style=color:#000>&nbsp;g_class_name[]&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>"</span><span style=color:#000>EnumClass</span><span style=color:#000>"</span><span style=color:#000>;<br><br>IDirectPlay8Client</span><span style=color:#000>*</span><span style=color:#000>&nbsp;g_dp_client;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directplay&nbsp;client<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;service&nbsp;provider&nbsp;list,&nbsp;used&nbsp;when&nbsp;enumerating&nbsp;information&nbsp;for&nbsp;a&nbsp;specifice&nbsp;service&nbsp;provider.</span><span style=color:green><br></span><span style=color:#000>DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;g_sp_list;&nbsp;&nbsp;<br><br>DWORD&nbsp;g_sp_number;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;service&nbsp;provider&nbsp;number<br><br></span><span style=color:green>//</span><span style=color:green>----------------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;callback&nbsp;function&nbsp;that&nbsp;receives&nbsp;all&nbsp;messages&nbsp;from&nbsp;the&nbsp;server,&nbsp;and&nbsp;receives&nbsp;indications&nbsp;<br></span><span style=color:green>//</span><span style=color:green>&nbsp;of&nbsp;session&nbsp;changes&nbsp;from&nbsp;the&nbsp;IDirectPlay8Client&nbsp;interface.&nbsp;<br></span><span style=color:green>//</span><span style=color:green>----------------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>HRESULT&nbsp;WINAPI&nbsp;Net_Msg_Handle(PVOID&nbsp;user_context,&nbsp;DWORD&nbsp;message_id,&nbsp;PVOID&nbsp;msg_buffer)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;S_OK&nbsp;to&nbsp;signify&nbsp;the&nbsp;message&nbsp;was&nbsp;handled&nbsp;OK.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;S_OK;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Create&nbsp;DirectPlay&nbsp;Client&nbsp;and&nbsp;initialize&nbsp;it.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#000>BOOL&nbsp;Init_DirectPlay_Client()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;DirectPlay&nbsp;client&nbsp;component</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(CoCreateInstance(CLSID_DirectPlay8Client,&nbsp;NULL,&nbsp;CLSCTX_INPROC,&nbsp;IID_IDirectPlay8Client,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_dp_client)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Assign&nbsp;a&nbsp;message&nbsp;handler&nbsp;to&nbsp;network&nbsp;component<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Registers&nbsp;an&nbsp;entry&nbsp;point&nbsp;in&nbsp;the&nbsp;client's&nbsp;code&nbsp;that&nbsp;receives&nbsp;the&nbsp;messages&nbsp;from&nbsp;the&nbsp;IDirectPlay8Client<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;interface&nbsp;and&nbsp;from&nbsp;the&nbsp;server.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Initialize(NULL,&nbsp;Net_Msg_Handle,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;TRUE;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Enumerate&nbsp;all&nbsp;available&nbsp;service&nbsp;provider.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Enum_Service_Provider()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;is&nbsp;no&nbsp;server&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_dp_client&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;a&nbsp;handler&nbsp;to&nbsp;the&nbsp;list&nbsp;box</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;listbox&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;GetDlgItem(g_hwnd,&nbsp;IDC_SERVICE_PROVIDERS);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clear&nbsp;the&nbsp;list&nbsp;box</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(listbox,&nbsp;LB_RESETCONTENT,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;service&nbsp;provider&nbsp;list&nbsp;memory</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;delete[]&nbsp;g_sp_list;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_sp_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;query&nbsp;the&nbsp;required&nbsp;size&nbsp;of&nbsp;the&nbsp;data&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;sp_list_size&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerates&nbsp;the&nbsp;registerd&nbsp;service&nbsp;providers&nbsp;available&nbsp;to&nbsp;the&nbsp;application</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;rv&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>EnumServiceProviders(NULL,&nbsp;NULL,&nbsp;g_sp_list,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>sp_list_size,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_sp_number,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(rv&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;DPNERR_BUFFERTOOSMALL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;allocate&nbsp;a&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((g_sp_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;</span><span style=color:#00f>new</span><span style=color:#000>&nbsp;BYTE[sp_list_size])&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerate&nbsp;again</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>EnumServiceProviders(NULL,&nbsp;NULL,&nbsp;g_sp_list,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>sp_list_size,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>g_sp_number,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumeration&nbsp;is&nbsp;complete,&nbsp;scan&nbsp;through&nbsp;entries.</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;sp_name[</span><span style=color:#000>1024</span><span style=color:#000>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;sp_ptr&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_sp_list;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(DWORD&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;g_sp_number;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;convert&nbsp;wide&nbsp;string&nbsp;into&nbsp;multi-byte&nbsp;string</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wcstombs(sp_name,&nbsp;sp_ptr</span><span style=color:#000>-></span><span style=color:#000>pwszName,&nbsp;</span><span style=color:#000>1024</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Add&nbsp;the&nbsp;service&nbsp;provider&nbsp;into&nbsp;box<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;An&nbsp;application&nbsp;sends&nbsp;an&nbsp;LB_ADDSTRING&nbsp;message&nbsp;to&nbsp;add&nbsp;a&nbsp;string&nbsp;to&nbsp;a&nbsp;list&nbsp;box.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;If&nbsp;the&nbsp;list&nbsp;box&nbsp;does&nbsp;not&nbsp;have&nbsp;the&nbsp;LBS_SORT&nbsp;style,&nbsp;the&nbsp;string&nbsp;is&nbsp;added&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;list.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Otherwise,&nbsp;the&nbsp;string&nbsp;is&nbsp;inserted&nbsp;into&nbsp;the&nbsp;list&nbsp;and&nbsp;the&nbsp;list&nbsp;is&nbsp;sorted.&nbsp;&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(listbox,&nbsp;LB_ADDSTRING,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPARAM)sp_name);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;go&nbsp;to&nbsp;next&nbsp;service&nbsp;provider&nbsp;in&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp_ptr</span><span style=color:#000>++</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Enumerate&nbsp;all&nbsp;adapters&nbsp;which&nbsp;specified&nbsp;by&nbsp;sp_guid.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Enum_Adapters(GUID</span><span style=color:#000>*</span><span style=color:#000>&nbsp;sp_guid)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;return&nbsp;if&nbsp;no&nbsp;server&nbsp;object&nbsp;or&nbsp;GUID</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_dp_client&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL&nbsp;</span><span style=color:#000>||</span><span style=color:#000>&nbsp;sp_guid&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;a&nbsp;handle&nbsp;of&nbsp;the&nbsp;list&nbsp;box</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;listbox&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;GetDlgItem(g_hwnd,&nbsp;IDC_ADAPTERS);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;clear&nbsp;the&nbsp;list&nbsp;box</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(listbox,&nbsp;LB_RESETCONTENT,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;adapter_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;adapter_number&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;adapter_list_size&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;query&nbsp;the&nbsp;required&nbsp;size&nbsp;of&nbsp;the&nbsp;data&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;HRESULT&nbsp;rv&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>EnumServiceProviders(sp_guid,&nbsp;NULL,&nbsp;adapter_list,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>adapter_list_size,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>adapter_number,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(rv&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;DPNERR_BUFFERTOOSMALL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;allocate&nbsp;a&nbsp;buffer</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>((adapter_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>)&nbsp;</span><span style=color:#00f>new</span><span style=color:#000>&nbsp;BYTE[adapter_list_size])&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerate&nbsp;again</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(SUCCEEDED(g_dp_client</span><span style=color:#000>-></span><span style=color:#000>EnumServiceProviders(sp_guid,&nbsp;NULL,&nbsp;adapter_list,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>adapter_list_size,&nbsp;</span><span style=color:#000>&</span><span style=color:#000>adapter_number,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>)))<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;adapter_name[</span><span style=color:#000>1024</span><span style=color:#000>];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumeration&nbsp;is&nbsp;complete,&nbsp;scan&nbsp;through&nbsp;entries.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;adapter_ptr&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;adapter_list;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>for</span><span style=color:#000>(DWORD&nbsp;i&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;&nbsp;i&nbsp;</span><span style=color:#000>&lt;</span><span style=color:#000>&nbsp;adapter_number;&nbsp;i</span><span style=color:#000>++</span><span style=color:#000>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;convert&nbsp;wide&nbsp;string&nbsp;into&nbsp;multi-byte&nbsp;string</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wcstombs(adapter_name,&nbsp;adapter_ptr</span><span style=color:#000>-></span><span style=color:#000>pwszName,&nbsp;</span><span style=color:#000>1024</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;add&nbsp;the&nbsp;adapter&nbsp;name&nbsp;int&nbsp;listbox</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(listbox,&nbsp;LB_ADDSTRING,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;(LPARAM)adapter_name);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;go&nbsp;to&nbsp;next&nbsp;servicec&nbsp;provider</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter_ptr</span><span style=color:#000>++</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;delete&nbsp;the&nbsp;list&nbsp;memory&nbsp;resources</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;delete[]&nbsp;adapter_list;<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Release&nbsp;all&nbsp;resource&nbsp;which&nbsp;allocated&nbsp;for&nbsp;DirectPlay.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>void</span><span style=color:#000>&nbsp;Release_DirectPlay()<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;client&nbsp;service&nbsp;provider&nbsp;list&nbsp;memory</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;delete[]&nbsp;g_sp_list;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_sp_list&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;g_sp_number&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;client&nbsp;component</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(g_dp_client&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;NULL)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Closes&nbsp;the&nbsp;open&nbsp;connection&nbsp;to&nbsp;a&nbsp;session.&nbsp;This&nbsp;method&nbsp;must&nbsp;be&nbsp;called&nbsp;on&nbsp;any&nbsp;object&nbsp;that&nbsp;is&nbsp;successfully&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;IDirectPlay8Client::Initialize&nbsp;method.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Close(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client</span><span style=color:#000>-></span><span style=color:#000>Release();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_dp_client&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Window&nbsp;procedure.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>long</span><span style=color:#000>&nbsp;WINAPI&nbsp;Window_Proc(HWND&nbsp;hwnd,&nbsp;UINT&nbsp;msg,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>switch</span><span style=color:#000>(msg)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;WM_COMMAND:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;The&nbsp;WM_COMMAND&nbsp;message&nbsp;is&nbsp;sent&nbsp;when&nbsp;the&nbsp;user&nbsp;selects&nbsp;a&nbsp;command&nbsp;item&nbsp;from&nbsp;a&nbsp;menu,&nbsp;when&nbsp;a&nbsp;control&nbsp;sends&nbsp;a&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;notification&nbsp;message&nbsp;to&nbsp;its&nbsp;parent&nbsp;window,&nbsp;or&nbsp;when&nbsp;an&nbsp;accelerator&nbsp;keystroke&nbsp;is&nbsp;translated.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;wParam:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;high-order&nbsp;word&nbsp;specifies&nbsp;the&nbsp;notification&nbsp;code&nbsp;if&nbsp;the&nbsp;message&nbsp;is&nbsp;from&nbsp;a&nbsp;control.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;message&nbsp;is&nbsp;from&nbsp;an&nbsp;accelerator,&nbsp;this&nbsp;value&nbsp;is&nbsp;1.&nbsp;If&nbsp;the&nbsp;message&nbsp;is&nbsp;from&nbsp;a&nbsp;menu,&nbsp;this&nbsp;value&nbsp;is&nbsp;zero.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;low-order&nbsp;word&nbsp;specifies&nbsp;the&nbsp;identifier&nbsp;of&nbsp;the&nbsp;menu&nbsp;item,&nbsp;control,&nbsp;or&nbsp;accelerator.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;lParam:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handle&nbsp;to&nbsp;the&nbsp;control&nbsp;sending&nbsp;the&nbsp;message&nbsp;if&nbsp;the&nbsp;message&nbsp;is&nbsp;from&nbsp;a&nbsp;control.&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;this&nbsp;parameter&nbsp;is&nbsp;NULL.&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;An&nbsp;application&nbsp;sends&nbsp;the&nbsp;LBN_SELCHANGE&nbsp;notification&nbsp;message&nbsp;when&nbsp;the&nbsp;selection&nbsp;in&nbsp;a&nbsp;list&nbsp;box&nbsp;is&nbsp;about&nbsp;to&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;change.&nbsp;The&nbsp;parent&nbsp;window&nbsp;of&nbsp;the&nbsp;list&nbsp;box&nbsp;receives&nbsp;this&nbsp;notification&nbsp;message&nbsp;through&nbsp;the&nbsp;WM_COMMAND&nbsp;message.&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(LOWORD(wParam)&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;IDC_SERVICE_PROVIDERS&nbsp;</span><span style=color:#000>&&</span><span style=color:#000>&nbsp;HIWORD(wParam)&nbsp;</span><span style=color:#000>==</span><span style=color:#000>&nbsp;LBN_SELCHANGE)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Get&nbsp;the&nbsp;selection&nbsp;from&nbsp;the&nbsp;list<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Send&nbsp;an&nbsp;LB_GETCURSEL&nbsp;message&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;currently&nbsp;selected&nbsp;item,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;if&nbsp;any,&nbsp;in&nbsp;a&nbsp;single-selection&nbsp;list&nbsp;box.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;selected&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(unsigned&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>)&nbsp;SendMessage(GetDlgItem(hwnd,&nbsp;IDC_SERVICE_PROVIDERS),&nbsp;LB_GETCURSEL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerate&nbsp;the&nbsp;adapters</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPN_SERVICE_PROVIDER_INFO</span><span style=color:#000>*</span><span style=color:#000>&nbsp;sp_ptr&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_sp_list;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp_ptr&nbsp;</span><span style=color:#000>+=</span><span style=color:#000>&nbsp;selected;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerate&nbsp;adapter&nbsp;with&nbsp;specified&nbsp;guid</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enum_Adapters(</span><span style=color:#000>&</span><span style=color:#000>sp_ptr</span><span style=color:#000>-></span><span style=color:#000>guid);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>case</span><span style=color:#000>&nbsp;WM_DESTROY:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Release_DirectPlay();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostQuitMessage(</span><span style=color:#000>0</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>long</span><span style=color:#000>)&nbsp;DefWindowProc(hwnd,&nbsp;msg,&nbsp;wParam,&nbsp;lParam);<br>}<br><br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------<br></span><span style=color:green>//</span><span style=color:green>&nbsp;Main&nbsp;function,&nbsp;routine&nbsp;entry.<br></span><span style=color:green>//</span><span style=color:green>--------------------------------------------------------------------------------</span><span style=color:green><br></span><span style=color:#00f>int</span><span style=color:#000>&nbsp;WINAPI&nbsp;WinMain(HINSTANCE&nbsp;inst,&nbsp;HINSTANCE,&nbsp;LPSTR&nbsp;cmd_line,&nbsp;</span><span style=color:#00f>int</span><span style=color:#000>&nbsp;cmd_show)<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;WNDCLASS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;win_class;<br>&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;window&nbsp;class&nbsp;and&nbsp;register&nbsp;it</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;win_class.style&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CS_HREDRAW&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;CS_VREDRAW;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpfnWndProc&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;Window_Proc;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbClsExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.cbWndExtra&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DLGWINDOWEXTRA;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hInstance&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;inst;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hIcon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadIcon(inst,&nbsp;IDI_APPLICATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;LoadCursor(NULL,&nbsp;IDC_ARROW);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.hbrBackground&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;(HBRUSH)&nbsp;(COLOR_BTNFACE&nbsp;</span><span style=color:#000>+</span><span style=color:#000>&nbsp;</span><span style=color:#000>1</span><span style=color:#000>);<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszMenuName&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;NULL;<br>&nbsp;&nbsp;&nbsp;&nbsp;win_class.lpszClassName&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;g_class_name;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;RegisterClass(</span><span style=color:#000>&</span><span style=color:#000>win_class))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;main&nbsp;window</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_hwnd&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CreateDialog(inst,&nbsp;MAKEINTRESOURCE(IDD_ENUM),&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;NULL);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;ShowWindow(g_hwnd,&nbsp;cmd_show);<br>&nbsp;&nbsp;&nbsp;&nbsp;UpdateWindow(g_hwnd);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;COM<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;the&nbsp;COM&nbsp;library&nbsp;on&nbsp;the&nbsp;current&nbsp;thread&nbsp;and&nbsp;identifies&nbsp;the&nbsp;concurrency&nbsp;model&nbsp;as&nbsp;single-thread<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;apartment&nbsp;(STA).</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;CoInitialize(</span><span style=color:#000>0</span><span style=color:#000>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Initialzie&nbsp;DirectPlay&nbsp;and&nbsp;enumerate&nbsp;service&nbsp;providers.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(</span><span style=color:#000>!</span><span style=color:#000>&nbsp;Init_DirectPlay_Client())<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>Error&nbsp;initializing&nbsp;DirectPlay.</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;</span><span style=color:#000>"</span><span style=color:#000>ERROR</span><span style=color:#000>"</span><span style=color:#000>,&nbsp;MB_OK&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;MB_ICONEXCLAMATION);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;</span><span style=color:#000>0</span><span style=color:#000>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;enumerate&nbsp;all&nbsp;available&nbsp;service&nbsp;provider</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;Enum_Service_Provider();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;start&nbsp;message&nbsp;pump,&nbsp;waiting&nbsp;for&nbsp;signal&nbsp;to&nbsp;quit.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(MSG));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>while</span><span style=color:#000>(msg.message&nbsp;</span><span style=color:#000>!=</span><span style=color:#000>&nbsp;WM_QUIT)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(PeekMessage(</span><span style=color:#000>&</span><span style=color:#000>msg,&nbsp;NULL,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;PM_REMOVE))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage(</span><span style=color:#000>&</span><span style=color:#000>msg);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;UnregisterClass(g_class_name,&nbsp;inst);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;release&nbsp;COM&nbsp;system<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Closes&nbsp;the&nbsp;COM&nbsp;library&nbsp;on&nbsp;the&nbsp;current&nbsp;thread,&nbsp;unloads&nbsp;all&nbsp;DLLs&nbsp;loaded&nbsp;by&nbsp;the&nbsp;thread,&nbsp;frees&nbsp;any&nbsp;other<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;resources&nbsp;that&nbsp;the&nbsp;thread&nbsp;maintains,&nbsp;and&nbsp;forces&nbsp;all&nbsp;RPC&nbsp;connections&nbsp;on&nbsp;the&nbsp;thread&nbsp;to&nbsp;close.</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;CoUninitialize();<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;(</span><span style=color:#00f>int</span><span style=color:#000>)&nbsp;msg.wParam;<br>}<br></span></div><br>运行截图：<br><br><img alt src=http://www.cppblog.com/images/cppblog_com/lovedday/4157/o_enum.jpg><br><br></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
使用DirectPlay进行网络互联（1）</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/networking-with-directplay-part-1/ title=使用DirectPlay进行网络互联（1）>https://blogs.qipai360.cn/post/networking-with-directplay-part-1/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/programmer-oil-poetry/ rel=next title=经典推荐--程序员之打油诗><i class="fa fa-chevron-left"></i> 经典推荐--程序员之打油诗</a></div><div class="post-nav-prev post-nav-item"><a href=/post/directx9-tutorial-id3dxsprite-repost/ rel=prev title=DirectX9.0教程之ID3DXSprite篇[转载]>DirectX9.0教程之ID3DXSprite篇[转载]
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"networking-with-directplay-part-1","permalink":"https://blogs.qipai360.cn/post/networking-with-directplay-part-1/","title":"使用DirectPlay进行网络互联（1）","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1761990624" defer></script></body></html>