<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_32_32_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_128_128_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（5）"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta name=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://blogs.qipai360.cn/imgs/avatar.jpg"><meta itemprop=keywords content="Rise,ZhangTuohui,技术,C++,Unity3D,Lua,NodeJS,C#,JavaScript,游戏开发,机器学习,深度学习,AI,编程,编程语言,编程技术,编程开发,游戏引擎,游戏设计,游戏制作,游戏开发者,游戏开发者博客,游戏开发者网站,游戏开发者工具,游戏开发者教程,游戏开发者学习,游戏开发者交流,游戏开发者分享,游戏开发者经验,游戏开发者心得,游戏开发者技巧,游戏开发者方法,游戏开发者思路,游戏开发者理念,游戏开发者文化,游戏开发者精神,游戏开发者信仰"><meta property="og:type" content="article"><meta property="og:title" content="用DirectX Audio和DirectShow播放声音和音乐（5）"><meta property="og:description" content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-5/"><meta property="og:site_name" content="Rise的自留地"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Rise"><meta property="article:published_time" content="2007-07-31 00:33:00 +0800 +0800"><meta property="article:modified_time" content="2007-08-27 17:17:00 +0800 +0800"><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1761990628"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2b23669184fc49269e400525ac2447d9"}'></script><title>用DirectX Audio和DirectShow播放声音和音乐（5） - Rise的自留地</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>Rise的自留地</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>记录生活中的点滴，分享编程技术和游戏开发经验。</p></div><div class=site-nav-right><div class="toggle popup-trigger"></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>678</span></a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-message"><a href=/message/ class=hvr-icon-pulse rel=section><i class="fa fa-comments hvr-icon"></i>留言板</a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li></ul></nav></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Rise src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>Rise</p><div class=site-description itemprop=description>福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>678</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>34</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>117</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/rise-worlds title="Github → https://github.com/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:rise.worlds@outlook.com title="E-Mail → mailto:rise.worlds@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail
</a></span><span class=links-of-social-item><a href=https://www.zhihu.com/people/rise-worlds title="知乎 → https://www.zhihu.com/people/rise-worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>
知乎
</a></span><span class=links-of-social-item><a href=https://twitter.com/riseworlds title="Twitter → https://twitter.com/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>
Twitter
</a></span><span class=links-of-social-item><a href=https://www.facebook.com/rise.worlds title="facebook → https://www.facebook.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-facebook fa-fw hvr-icon"></i>
facebook
</a></span><span class=links-of-social-item><a href=https://youtube.com/@YiXuan title="YouTube → https://youtube.com/@YiXuan" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-youtube fa-fw hvr-icon"></i>
YouTube
</a></span><span class=links-of-social-item><a href=https://instagram.com/rise.worlds title="Instagram → https://instagram.com/rise.worlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-instagram fa-fw hvr-icon"></i>
Instagram
</a></span><span class=links-of-social-item><a href=https://t.me/riseworlds title="Telegram → https://t.me/riseworlds" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-telegram fa-fw hvr-icon"></i>
Telegram</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://www.qipai360.cn title=https://www.qipai360.cn target=_blank>Qipai360</a></li><li class=links-of-blogroll-item><a href=https://www.cnblogs.com/flying_bat title=https://www.cnblogs.com/flying_bat target=_blank>博客园</a></li><li class=links-of-blogroll-item><a href=https://zishu.me title=https://zishu.me target=_blank>子舒的博客</a></li><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2004-10-06 15:24:00 +0800 +0800"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=2418817></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=5198></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-01 14:55:00 +0800 +0800"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/rise-worlds rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-5/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="Rise"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Rise"><meta itemprop=description content="福兮祸兮，焉知所依？冬去冰泮，春来萌荣。朝生暮死，亦可惊鸿。知足者富，自足者强。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="用DirectX Audio和DirectShow播放声音和音乐（5）"><meta itemprop=description content="使用DirectMusic在DirectAudio 中，DirectSound负责数字音频方面的处理，而DirectMusic则负责Midi文件（Musical Instrument Data Interface，数字音乐格式，.mid作为文件扩展名），DirectMusic固有音乐文件（.sgt文件）和数字录音设备录制的波形格式文件（.wav文件）等文件的播放操作。能体现DirectMusic的强大之处是DirectMusic固有文件格式，一首用DirectMusic固有文件格式制作的音乐包括数个小音乐格式，这些样式还能用不同的乐器组合一个接一个地播放。随机的样式和乐器的选取创造出了随时都在改变的音乐，再加上节拍变化，就形成了一个魅力无穷的音乐系统。DirectMusic的另一个特性是可以使用“基调”，就是在正在播放的音乐片段上叠加一段其他音乐，新加入的音乐可以很平滑的融入到原有的音乐中。这在很多时候都有用，比如一个玩家完成了一个目标，可以马上播放一段“获得荣誉”的音乐提示他。除了传统的音符之外，Midi音乐中可以包含数字音频作为音符，比如枪声、猴子的尖叫、也或者是其他各种各样你觉得奇怪的东西。比如可以在游戏中使用曾经梦想到的最令你心惊胆颤的音乐，而这些MIDI音乐都能完成。使用数字乐谱还有一个巨大的好处，即音乐在所有的计算机上可以发出一致的声音，这点是通过使用统一的DirectSound合成器完成的，当然DirectMusic允许使用 DirectSound接口或者是个人创建的接口。音乐数据使用的合成器通道称为音频通道（Audio Path），你可以获取这个通道，并在普通的DirectSound音频缓冲中播放。使用Midi文件和 DirectMusic固有文件有共同的好处，那就是可以修改播放的节拍，这也是很有用的特性。有了这个特性，就可以设计随着屏幕动作而加速或者减速的背景音乐。如果游戏进入紧张的时期，就加速节拍，使音乐具有紧张感，如果高潮的活动结束，可以放慢节拍。数字录音设备所录制下来的音乐也是非常丰富多彩的，尽管这种音乐可以拥有非常高的音乐质量，但是这种歌曲不能被修改以便匹配游戏活动，也就是说这些音乐只能保持最开始录制的那个样子，不能有更多的变化，也不能减少里面的元素。开始使用DirectMusic使用 DirectMusic的第一步是创建一个主对象，我们把这个对象叫做演奏器对象（performance object），它表现整个音乐系统，第二步创建一个叫加载器（loader object）的对象，加载器加载所有原始的音乐文件。最后必须加载音乐小节到音乐片段对象（segment object）中，多个小节可以被同时加载，并一个接一个地播放，这可以让我们创建更具动态效果的音乐。DirectMusic并没有提供函数帮助创建或初始化DirectMusic主接口，所以需要自行初始化COM接口，初始化COM接口所调用的第一个函数是CoInitialize。"></span><header class=post-header><h1 class=post-title itemprop="name headline">用DirectX Audio和DirectShow播放声音和音乐（5）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2007年07月31日 00:33:00 CST" itemprop="dateCreated datePublished" datetime="2007-07-31 00:33:00 +0800 +0800">2007年07月31日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar-check"></i>
</span><span class=post-meta-item-text title=更新于>更新于：
</span><time title="修改时间：2007年08月27日 17:17:00 CST" itemprop="dateModified dateLastmod" datetime="2007-08-27 17:17:00 +0800 +0800">2007年08月27日
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/gamedev/ itemprop=url rel=index><span itemprop=name>dev/GameDev</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>7422</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>15分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=pageview-count data-path=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-5/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><p><span style=font-weight:700;color:#137a2c>使用DirectMusic</span><br><br>在DirectAudio 中，DirectSound负责数字音频方面的处理，而DirectMusic则负责Midi文件（Musical Instrument Data Interface，数字音乐格式，.mid作为文件扩展名），DirectMusic固有音乐文件（.sgt文件）和数字录音设备录制的波形格式文件（.wav文件）等文件的播放操作。<br><br>能体现DirectMusic的强大之处是DirectMusic固有文件格式，一首用DirectMusic固有文件格式制作的音乐包括数个小音乐格式，这些样式还能用不同的乐器组合一个接一个地播放。随机的样式和乐器的选取创造出了随时都在改变的音乐，再加上节拍变化，就形成了一个魅力无穷的音乐系统。DirectMusic的另一个特性是可以使用“基调”，就是在正在播放的音乐片段上叠加一段其他音乐，新加入的音乐可以很平滑的融入到原有的音乐中。这在很多时候都有用，比如一个玩家完成了一个目标，可以马上播放一段“获得荣誉”的音乐提示他。<br><br>除了传统的音符之外，Midi音乐中可以包含数字音频作为音符，比如枪声、猴子的尖叫、也或者是其他各种各样你觉得奇怪的东西。比如可以在游戏中使用曾经梦想到的最令你心惊胆颤的音乐，而这些MIDI音乐都能完成。使用数字乐谱还有一个巨大的好处，即音乐在所有的计算机上可以发出一致的声音，这点是通过使用统一的DirectSound合成器完成的，当然DirectMusic允许使用 DirectSound接口或者是个人创建的接口。音乐数据使用的合成器通道称为音频通道（Audio Path），你可以获取这个通道，并在普通的DirectSound音频缓冲中播放。<br><br>使用Midi文件和 DirectMusic固有文件有共同的好处，那就是可以修改播放的节拍，这也是很有用的特性。有了这个特性，就可以设计随着屏幕动作而加速或者减速的背景音乐。如果游戏进入紧张的时期，就加速节拍，使音乐具有紧张感，如果高潮的活动结束，可以放慢节拍。数字录音设备所录制下来的音乐也是非常丰富多彩的，尽管这种音乐可以拥有非常高的音乐质量，但是这种歌曲不能被修改以便匹配游戏活动，也就是说这些音乐只能保持最开始录制的那个样子，不能有更多的变化，也不能减少里面的元素。<br><br><span style=font-weight:700;color:#137a2c>开始使用DirectMusic</span><br><br>使用 DirectMusic的第一步是创建一个主对象，我们把这个对象叫做演奏器对象（performance object），它表现整个音乐系统，第二步创建一个叫加载器（loader object）的对象，加载器加载所有原始的音乐文件。最后必须加载音乐小节到音乐片段对象（segment object）中，多个小节可以被同时加载，并一个接一个地播放，这可以让我们创建更具动态效果的音乐。<br><br>DirectMusic并没有提供函数帮助创建或初始化DirectMusic主接口，所以需要自行初始化COM接口，初始化COM接口所调用的第一个函数是CoInitialize。<br><br></p><a id=more></a><p>Initializes the COM library on the current thread and identifies the concurrency model as single-thread apartment (STA). Applications must initialize the COM library before they can call COM library functions other than CoGetMalloc and memory allocation functions.</p><p>New applications should call CoInitializeEx instead of <strong>CoInitialize</strong>.</p><pre class=syntax><strong>HRESULT CoInitialize(<br> LPVOID</strong><em> pvReserved </em>//Reserved; must be NULL<br><strong>);</strong></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4>Parameter</h4><dl><dt><em>pvReserved</em><dd>[in] Reserved; must be NULL.</dd></dl><h4>Return Values</h4><p>This function supports the standard return values E_INVALIDARG, E_OUTOFMEMORY, and E_UNEXPECTED, as well as the following:</p><dl><dt>S_OK<dd>The COM library was initialized successfully on this thread.<dt>S_FALSE<dd>The COM library is already initialized on this thread.<dt>RPC_E_CHANGED_MODE<dd>A previous call to <strong>CoInitializeEx</strong> specified the concurrency model for this thread as multithread apartment (MTA).</dd></dl><h4>Remarks</h4><p>CoInitializeEx provides the same functionality as <strong>CoInitialize</strong> and also provides a parameter to explicitly specify the thread's concurrency model. <strong>CoInitialize</strong> calls <strong>CoInitializeEx</strong> and specifies the concurrency model as single-thread apartment. Applications developed today should call <strong>CoInitializeEx</strong> rather than <strong>CoInitialize</strong>.</p><p>You need to initialize the COM library on a thread before you call any of the library functions except CoGetMalloc, to get a pointer to the standard allocator, and the memory allocation functions.</p><p>Once the concurrency model for a thread is set, it cannot be changed. A call to <strong>CoInitialize</strong> on an apartment that was previously initialized as multithreaded will fail and return RPC_E_CHANGED_MODE.</p><p>Typically, the COM library is initialized on a thread only once. Subsequent calls to <strong>CoInitialize</strong> or <strong>CoInitializeEx</strong> on the same thread will succeed, as long as they do not attempt to change the concurrency model, but will return S_FALSE. To close the COM library gracefully, each successful call to <strong>CoInitialize</strong> or <strong>CoInitializeEx</strong>, including those that return S_FALSE, must be balanced by a corresponding call to <strong>CoUninitialize</strong>. However, the first thread in the application that calls <strong>CoInitialize(0)</strong> or <strong>CoInitializeEx(COINIT_APARTMENTTHREADED)</strong> must be the last thread to call <strong>CoUninitialize()</strong>. If the call sequence is not in this order, then subsequent calls to <strong>CoInitialize</strong> on the STA will fail and the application will not work.</p><p>Because there is no way to control the order in which in-process servers are loaded or unloaded, it is not safe to call <strong>CoInitialize</strong>, <strong>CoInitializeEx</strong>, or <strong>CoUninitialize</strong> from the DllMain function.</p><br>在开始使用DirectMusic的时候调用这个函数，因为该函数有一个内部的计数器，显示被调用的次数，每调用一次这个初始化函数，就必须调用一次关闭COM的函数CoUninitialize。<br><br><p>Closes the COM library on the current thread, unloads all DLLs loaded by the thread, frees any other resources that the thread maintains, and forces all RPC connections on the thread to close.</p><pre class=syntax><strong>void CoUninitialize( );</strong></pre><h4>Remarks</h4><p>A thread must call <strong>CoUninitialize</strong> once for each successful call it has made to CoInitialize or CoInitializeEx. Only the <strong>CoUninitialize</strong> call corresponding to the <strong>CoInitialize</strong> or <strong>CoInitializeEx</strong> call that initialized the library can close it.</p><p>Calls to OleInitialize must be balanced by calls to OleUninitialize. The <strong>OleUninitialize</strong> function calls <strong>CoUninitialize</strong> internally, so applications that call <strong>OleUninitialize</strong> do not also need to call <strong>CoUninitialize</strong>.</p><p><strong>CoUninitialize</strong> should be called on application shutdown, as the last call made to the COM library after the application hides its main windows and falls through its main message loop. If there are open conversations remaining, <strong>CoUninitialize</strong> starts a modal message loop and dispatches any pending messages from the containers or server for this COM application. By dispatching the messages, <strong>CoUninitialize</strong> ensures that the application does not quit before receiving all of its pending messages. Non-COM messages are discarded.</p><p>Because there is no way to control the order in which in-process servers are loaded or unloaded, it is not safe to call <strong>CoInitialize</strong>, <strong>CoInitializeEx</strong>, or <strong>CoUninitialize</strong> from the DllMain function.</p><br>CoUninitialize函数减少COM接口的使用计数器，如果这个计数器减少到0，COM接口就会从系统释放内存，这样做可以提高内存的使用效率，所有的COM对象都遵循这个使用原则。<br><br><span style=font-weight:700;color:#137a2c>创建演奏器对象</span><br><br>演奏器对象是最主要的对象，可以创建多个演奏器对象，但是建议只使用一个演奏器。要创建演奏器，首先要声明一个IDirectMusicPerformance8对象，然后调用 CoCreateInstance初始化。<br><br><p>Creates a single uninitialized object of the class associated with a specified CLSID. Call <strong>CoCreateInstance</strong> when you want to create only one object on the local system. To create a single object on a remote system, call CoCreateInstanceEx. To create multiple objects based on a single CLSID, refer to the CoGetClassObject function.</p><pre class=syntax><strong>STDAPI CoCreateInstance(<br> REFCLSID</strong><em> rclsid</em><strong>, </strong>//Class identifier (CLSID) of the object<br><strong> LPUNKNOWN</strong><em> pUnkOuter</em><strong>, </strong>//Pointer to controlling IUnknown<br><strong> DWORD</strong><em> dwClsContext</em><strong>, </strong>//Context for running executable code<br><strong> REFIID</strong><em> riid</em><strong>, </strong>//Reference to the identifier of the interface<br><strong> LPVOID *</strong><em> ppv </em>//Address of output variable that receives <br> // the interface pointer requested in <em>riid</em><br><strong>);</strong></pre><div class=reftip id=reftip style=visibility:hidden;overflow:visible;position:absolute></div><h4>Parameters</h4><dl><dt><em>rclsid</em><dd>[in] CLSID associated with the data and code that will be used to create the object.<dt><em>pUnkOuter</em><dd>[in] If <strong>NULL</strong>, indicates that the object is not being created as part of an aggregate. If non-<strong>NULL</strong>, pointer to the aggregate object's <strong>IUnknown</strong> interface (the controlling <strong>IUnknown</strong>).<dt><em>dwClsContext</em><dd>[in] Context in which the code that manages the newly created object will run. The values are taken from the enumeration CLSCTX.<dt><em>riid</em><dd>[in] Reference to the identifier of the interface to be used to communicate with the object.<dt><em>ppv</em><dd>[out] Address of pointer variable that receives the interface pointer requested in <em>riid</em>. Upon successful return, *<em>ppv</em> contains the requested interface pointer.</dd></dl><h4>Return Values</h4><dl><dt>S_OK<dd>An instance of the specified object class was successfully created.<dt>REGDB_E_CLASSNOTREG<dd>A specified class is not registered in the registration database. Also can indicate that the type of server you requested in the <strong>CLSCTX</strong> enumeration is not registered or the values for the server types in the registry are corrupt.<dt>CLASS_E_NOAGGREGATION<dd>This class cannot be created as part of an aggregate.<dt>E_NOINTERFACE<dd>The specified class does not implement the requested interface, or the controlling <strong>IUnknown</strong> does not expose the requested interface.</dd></dl><h4>Remarks</h4><p>The <strong>CoCreateInstance</strong> helper function provides a convenient shortcut by connecting to the class object associated with the specified CLSID, creating an uninitialized instance, and releasing the class object. As such, it encapsulates the following functionality:</p><pre>CoGetClassObject(rclsid, dwClsContext, NULL, IID_IClassFactory, &amp;pCF); <br>hresult = pCF-&gt;CreateInstance(pUnkOuter, riid, ppvObj) <br>pCF-&gt;Release(); </pre><p>It is convenient to use <strong>CoCreateInstance</strong> when you need to create only a single instance of an object on the local machine. If you are creating an instance on remote machine, call CoCreateInstanceEx. When you are creating multiple instances, it is more efficient to obtain a pointer to the class object's <strong>IClassFactory</strong> interface and use its methods as needed. In the latter case, you should use the CoGetClassObject function.</p><p>In the CLSCTX enumeration, you can specify the type of server used to manage the object. The constants can be CLSCTX_INPROC_SERVER, CLSCTX_INPROC_HANDLER, CLSCTX_LOCAL_SERVER, or any combination of these values. The constant CLSCTX_ALL is defined as the combination of all three. For more information about the use of one or a combination of these constants, refer to CLSCTX.</p><br>以下代码演示了如何创建演奏器对象：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>IDirectMusicPerformance8</span><span style=color:#000>*</span><span style=color:#000>&nbsp;&nbsp;&nbsp;g_dm_performance;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;directmusic&nbsp;performance<br><br></span><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;DirectMusic&nbsp;performance&nbsp;object<br></span><span style=color:green>//</span><span style=color:green><br></span><span style=color:green>//</span><span style=color:green>&nbsp;creates&nbsp;a&nbsp;single&nbsp;uninitialized&nbsp;object&nbsp;of&nbsp;the&nbsp;class&nbsp;associated&nbsp;with&nbsp;a&nbsp;specified&nbsp;CLSID.</span><span style=color:green><br></span><span style=color:#000>CoCreateInstance(CLSID_DirectMusicPerformance,&nbsp;NULL,&nbsp;CLSCTX_INPROC,&nbsp;IID_IDirectMusicPerformance8,&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_dm_performance);<br></span></div><br>演奏器需要被初始化后才能工作，初始化的过程需要首先创建DirectMusic和DirectSound对象，然后由这两个对象创建音频缓冲区并且设置播放特性，还需要设置的内容是播放音乐所用的音频通道，一般情况的设置使用128种乐器（128乐器通道）并且拥有立体声和混音（回音）效果，可以调用InitAudio来初始化。<br><br><p>The <strong>InitAudio </strong>method initializes the performance and optionally sets up a default audiopath. This method must be called before the performance can play using audiopaths.</p><p>This method should be used in most cases instead of <strong>IDirectMusicPerformance8::Init</strong>.</p><p class=blue><strong>Syntax</strong></p><pre class=syntax><code><strong>HRESULT InitAudio(<br> IDirectMusic** </strong><em>ppDirectMusic</em><strong>,</strong><br><strong> IDirectSound** </strong><em>ppDirectSound</em><strong>,</strong><br><strong> HWND </strong><em>hWnd</em><strong>,</strong><br><strong> DWORD </strong><em>dwDefaultPathType</em><strong>,</strong><br><strong> DWORD </strong><em>dwPChannelCount,</em><br><strong> DWORD </strong><em>dwFlags</em><strong>,</strong><br><strong> DMUS_AUDIOPARAMS *</strong><em>pParams</em><br><strong>);</strong> </code></pre><p class=blue><strong>Parameters</strong></p><p class=dt><em>ppDirectMusic</em></p><p class=indent>Address of a variable that specifies or receives an interface pointer to a DirectMusic object.</p><p class=indent>If the variable pointed to by <em>ppDirectMusic</em> contains a valid <strong>IDirectMusic</strong> or <strong>IDirectMusic8</strong> interface pointer, the existing object is assigned to the performance. The reference count of the interface is incremented.</p><p class=indent>If the variable pointed to by <em>ppDirectMusic</em> contains NULL, a DirectMusic object is created and the <strong>IDirectMusic</strong> interface pointer is returned. Use <strong>QueryInterface</strong> to obtain <strong>IDirectMusic8</strong>.</p><p class=indent>If <em>ppDirectMusic</em> is NULL, a DirectMusic object is created and used internally by the performance.</p><p class=indent>See Remarks.</p><p class=dt><em>ppDirectSound</em></p><p class=indent>Address of a variable that specifies or receives an <strong>IDirectSound</strong> interface pointer for a DirectSound device object to use by default for waveform output. If this parameter contains a NULL pointer, DirectMusic creates a private DirectSound device object. If the variable pointed to contains NULL, DirectMusic creates a DirectSound device object and returns the interface pointer. See Remarks.</p><p class=dt><em>hWnd</em></p><p class=indent>Window handle to use for the creation of DirectSound. This parameter can be NULL, in which case the foreground window is used. See Remarks.</p><p class=indent>This parameter is ignored if an <strong>IDirectSound</strong> interface pointer is passed to the method in <em>ppDirectSound</em>. In that case the application is responsible for setting the window handle by using <strong>IDirectSound8::SetCooperativeLevel</strong>.</p><p class=dt><em>dwDefaultPathType</em></p><p class=indent>Value that specifies the default audiopath type. Can be zero if no default path type is wanted. For a list of defined values, see <strong>IDirectMusicPerformance8::CreateStandardAudioPath</strong>.</p><p class=dt><em>dwPChannelCount</em></p><p class=indent>Value that specifies the number of <nobr><u>performance channels</u></nobr> to allocate to the path, if <em>dwDefaultPathType</em> is not zero.</p><p class=dt><em>dwFlags</em></p><p class=indent>Flags that specify requested features. If <em>pParams</em> is not NULL, this value is ignored and the requested features are specified in the <strong>dwFeatures</strong> member of the <strong>DMUS_AUDIOPARAMS</strong> structure. The values listed in the following table are defined for use in this parameter.</p><table class=style1 cols=2 cellpadding=5 rules=rows frame=below>&nbsp;<tbody>&nbsp;<tr valign=top>&nbsp;<td class=style2 width=50%>Value</td>&nbsp;<td class=style2 width=50%>Description</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=50%>DMUS_AUDIOF_3D</td>&nbsp;<td width=50%>3-D buffers. This flag is not implemented. Buffers in 3-D audiopaths always have 3-D capabilities.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=50%>DMUS_AUDIOF_ALL</td>&nbsp;<td width=50%>All features.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=50%>DMUS_AUDIOF_BUFFERS</td>&nbsp;<td width=50%>Multiple buffers.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=50%>DMUS_AUDIOF_DMOS</td>&nbsp;<td width=50%>Additional DMOs. This flag is not implemented.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=50%>DMUS_AUDIOF_ENVIRON</td>&nbsp;<td width=50%>Environmental modeling. This flag is not implemented.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=50%>DMUS_AUDIOF_EAX</td>&nbsp;<td width=50%>Support for Environmental Audio Extensions (EAX). This flag is not implemented.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=50%>DMUS_AUDIOF_STREAMING</td>&nbsp;<td width=50%>Support for streaming waveforms.</td>&nbsp;</tr>&nbsp;</tbody></table><p class=dt><em>pParams</em></p><p class=indent>Address of a <strong>DMUS_AUDIOPARAMS</strong> structure that specifies parameters for the synthesizer and receives information about what parameters were set. Can be NULL if the default parameters are wanted.</p><p class=blue><strong>Return Values</strong></p><p>If the method succeeds, the return value is S_OK.</p><p>If it fails, the method can return one of the error values shown in the following table.</p><table class=style1 cols=1 cellpadding=5 rules=rows frame=below>&nbsp;<tbody>&nbsp;<tr valign=top>&nbsp;<td class=style2 width=100%>Return code</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=100%>DMUS_E_ALREADY_INITED</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=100%>DSERR_BUFFERLOST</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=100%>DSERR_PRIOLEVELNEEDED</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=100%>DSERR_UNINITIALIZED</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=100%>E_NOINTERFACE</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=100%>E_OUTOFMEMORY</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=100%>E_POINTER</td>&nbsp;</tr>&nbsp;</tbody></table><p class=blue><strong>Remarks</strong></p><p>This method can be called only once. It cannot be used to retrieve an existing <strong>IDirectMusic8</strong> interface.</p><p>A DirectMusic object can be associated with the performance in the following ways.</p><ul type=disc>&nbsp;<li>The application allows the performance to create the DirectMusic object and needs a pointer to that object. In this case, *<em>ppDirectMusic</em> is NULL on entry and contains the <strong>IDirectMusic</strong> pointer on exit. &nbsp;<li>The application allows the performance to initialize itself and does not need a DirectMusic object pointer. In this case, <em>ppDirectMusic</em> is NULL. &nbsp;<li>The application creates its own DirectMusic object and gives it to the performance by passing the address of the <strong>IDirectMusic8</strong> pointer in <em>&nbsp; ppDirectMusic</em>. Most applications do not use this technique.</li></ul><p>If you specify an interface pointer in <em>ppDirectSound</em>, it must be an interface to an object of class CLSID_DirectSound8. Objects of this class support both <strong>IDirectSound</strong> and <strong>IDirectSound8</strong>, but the <strong>IDirectSound</strong> interface must be passed. The DirectSound device object must be fully initialized before being passed to <strong>InitAudio</strong>. If the object was created by using <strong>CoCreateInstance</strong>, call <strong>IDirectSound8::Initialize</strong>. Set the cooperative level to DSSCL_PRIORITY by using <strong>IDirectSound8::SetCooperativeLevel</strong>.</p><p>You can pass NULL in the <em>hWnd</em> parameter to pass the current foreground window handle to DirectSound. However, do not assume that the application window will be in the foreground during initialization. It is best to pass the top-level application window handle.</p><p>The parameters set in <em>dwFlags</em> and <em>pParams</em> apply to the default audiopath and any audiopaths created subsequently.</p><p>The method fails with DSERR_BUFFERLOST if a value other than zero is passed in <em>dwDefaultPathType</em> and any application has initialized DirectSound with the write-primary cooperative level.</p><p>The performance must be terminated by using the <strong>IDirectMusicPerformance8::CloseDown</strong> method before being released.</p><br>以下代码演示了如何使用InitAudio来初始化演奏器对象：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;initialize&nbsp;the&nbsp;performance&nbsp;with&nbsp;the&nbsp;standard&nbsp;audio&nbsp;path.<br></span><span style=color:green>//</span><span style=color:green>&nbsp;this&nbsp;initialize&nbsp;both&nbsp;directmusic&nbsp;and&nbsp;directsound&nbsp;and&nbsp;sets&nbsp;up&nbsp;the&nbsp;synthesizer.</span><span style=color:green></span><span style=color:#000> g_dm_performance</span><span style=color:#000>-></span><span style=color:#000>InitAudio(NULL,&nbsp;NULL,&nbsp;g_hwnd,&nbsp;DMUS_APATH_SHARED_STEREOPLUSREVERB,&nbsp;</span><span style=color:#000>128</span><span style=color:#000>,&nbsp;DMUS_AUDIOF_ALL,&nbsp;NULL);</span></div><br><span style=font-weight:700;color:#137a2c>创建加载器对象</span><br><br>创建加载器是使用DirectMusic 的第二步，这个对象其实是一个缓冲系统，用于加速数据加载和歌曲支持文件（比如乐器库）的加载。<br><br>IDirectMusicLoader8表示加载器对象，以下代码可以创建一个加载器：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;create&nbsp;the&nbsp;DirectMusic&nbsp;loader&nbsp;object</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;CoCreateInstance(CLSID_DirectMusicLoader,&nbsp;NULL,&nbsp;CLSCTX_INPROC,&nbsp;IID_IDirectMusicLoader8,&nbsp;(</span><span style=color:#00f>void</span><span style=color:#000>**</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_dm_loader);</span></div><br>请确定在程序中只有一个加载器对象，这样可以帮助系统控制缓存和经常使用的数据资源。<br><br>使用加载器的下一步是告诉加载器在哪些目录搜索文件，一般情况下我们把这个路径叫做默认搜索路径（default search directory）。对于加载单独的MIDI文件，不需要设置默认的搜索路径，但是对于加载DirectMusic固有文件，必须设置搜索路径，以便让 DirectMusic能顺利找到支持文件。<br><br>可以通过调用IDirectMusicLoader8:: SetSearchDirectory函数来设置工作路径。<br><br><p>The <strong>SetSearchDirectory </strong>method sets a search path for finding object files. The search path can be set for one object file type or for all files.</p><p class=blue><strong>Syntax</strong></p><pre class=syntax><code><strong>HRESULT SetSearchDirectory(<br> REFGUID </strong><em>rguidClass</em><strong>,</strong><br><strong> WCHAR* </strong><em>pwszPath,</em><br> <strong>BOOL</strong><em> fClear</em><br><strong>);</strong> </code></pre><p class=blue><strong>Parameters</strong></p><p class=dt><em>rguidClass</em></p><p class=indent>Reference to (C++) or address of (C) the identifier of the class of objects that the call pertains to. GUID_DirectMusicAllTypes specifies all objects. For a list of standard loadable classes, see <strong>IDirectMusicLoader8</strong>.</p><p class=dt><em>pwszPath</em></p><p class=indent>File path for directory. Must be a valid directory and must be less than MAX_PATH in length. The path, if not fully qualified, is relative to the current directory when <strong>IDirectMusicLoader8::ScanDirectory</strong> is called.</p><p class=dt><em>fClear</em></p><p class=indent>If TRUE, clears all information about objects before setting the directory. This prevents the loader from accessing objects in a previous directory when those objects have the same name. However, objects are not removed from the cache.</p><p class=blue><strong>Return Values</strong></p><p>If the method succeeds, the return value is S_OK, or S_FALSE if the search directory is already set to <em>pwszPath</em>.</p><p>If it fails, the method can return one of the error values shown in the following table.</p><table class=style1 cols=1 cellpadding=5 rules=rows frame=below><tbody><tr valign=top><td class=style2 width=100%>Return code</td></tr><tr valign=top><td width=100%>DMUS_E_LOADER_BADPATH</td></tr><tr valign=top><td width=100%>E_OUTOFMEMORY</td></tr><tr valign=top><td width=100%>E_POINTER</td></tr></tbody></table><p class=blue><strong>Remarks</strong></p><p>After a search path is set, the loader does not need a full path every time it is given an object to load by file name. This enables objects that refer to other objects to find them by file name without knowing the full path.</p><p>When this method has been called, the loader expects the <strong>wszFileName</strong> member of the <strong>DMUS_OBJECTDESC</strong> structure to contain only a file name or a path relative to the search directory, unless the DMUS_OBJ_FULLPATH flag is set in the <strong>dwValidData</strong> member.</p><br>该函数接收的是宽字符串，使用时需要把字符串转换为WCHAR数据类型，可以通过mbstowcs来转换。<br><br><p>Converts a sequence of multibyte characters to a corresponding sequence of wide characters.</p><div class=section id=syntaxSection><div class=code id=syntaxCodeBlocks><span codelanguage=other><table cellspacing=0 cellpadding=0 width=100%><tbody><tr><th align=left><br></th></tr><tr><td><pre>size_t mbstowcs(<br> wchar_t *<span class=parameter>wcstr</span>,<br> const char *<span class=parameter>mbstr</span>,<br> size_t <span class=parameter>count</span> <br>);<br></pre></td></tr></tbody></table></span></div></div><h4 class=subHeading>Parameters</h4><dl><dt>[out] <span class=parameter>wcstr</span><dd><p>The address of a sequence of wide characters.</p></dd></dl><dl><dt>[in] <span class=parameter>mbstr</span><dd><p>The address of a sequence of null terminated multibyte characters.</p></dd></dl><dl><dt>[in] <span class=parameter>count</span><dd><p>The maximum number of multibyte characters to convert.</p></dd></dl><h1 class=heading><span onkeypress=ExpandCollapse_CheckKey(returnValueToggle) style=cursor:default onclick=ExpandCollapse(returnValueToggle) tabindex=0>Return Value</span></h1><div class=section id=returnValueSection name=collapseableSection><p>If <strong>mbstowcs</strong> successfully converts the source string, it returns the number of converted multibyte characters. If the <span class=parameter>wcstr</span> argument is <strong>NULL</strong>, the function returns the required size (in wide characters) of the destination string. If <strong>mbstowcs</strong> encounters an invalid multibyte character, it returns –1. If the return value is <span class=parameter>count</span>, the wide-character string is not null-terminated.</p><div class=alert><table cellspacing=0 cellpadding=0 width=100%><tbody><tr><th align=left>Security Note</th></tr><tr><td><p>Ensure that <span class=parameter>wcstr</span> and <span class=parameter>mbstr</span> do not overlap, and that <span class=parameter>count</span> correctly reflects the number of multibyte characters to convert.</p></td></tr></tbody></table></div></div><br>以下代码演示了如何设置搜索路径：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:green>//</span><span style=color:green>&nbsp;tell&nbsp;directmusic&nbsp;where&nbsp;the&nbsp;default&nbsp;search&nbsp;path&nbsp;is</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>char</span><span style=color:#000>&nbsp;path[MAX_PATH];<br>&nbsp;&nbsp;&nbsp;&nbsp;WCHAR&nbsp;search_path[MAX_PATH];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;GetCurrentDirectory(MAX_PATH,&nbsp;path);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;maps&nbsp;a&nbsp;character&nbsp;string&nbsp;to&nbsp;a&nbsp;wide-character&nbsp;(Unicode)&nbsp;string</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;MultiByteToWideChar(CP_ACP,&nbsp;</span><span style=color:#000>0</span><span style=color:#000>,&nbsp;path,&nbsp;</span><span style=color:#000>-</span><span style=color:#000>1</span><span style=color:#000>,&nbsp;search_path,&nbsp;MAX_PATH);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;set&nbsp;a&nbsp;search&nbsp;path&nbsp;for&nbsp;finding&nbsp;object&nbsp;files</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;g_dm_loader</span><span style=color:#000>-></span><span style=color:#000>SetSearchDirectory(GUID_DirectMusicAllTypes,&nbsp;search_path,&nbsp;FALSE);</span></div><br><span style=font-weight:700;color:#137a2c>使用音乐片段</span><br><br>通过以上步骤，系统已经被初始化，加载器也已经准备就绪，现在该加载歌曲然后播放它们了。完成这个操作是IDirectMusicSegment8对象的工作，DirectMusic加载器的职责是加载音乐和乐器库，并且创建IDirectMusicSegment8对象，整个加载过程有2个步骤，第一个步骤是加载包含所需播放的音乐的音乐片段。<br><br><span style=font-weight:700>加载音乐片段</span><br><br>加载音乐片段的第一步是设置一个对象描述结构，这个结构被称为DMUS_OBJECTDESC，它描述了要加载的信息。<br><br><p>The <strong>DMUS_OBJECTDESC</strong> structure is used to describe a loadable object. This structure is passed to the <strong>IDirectMusicLoader8::GetObject</strong> method to identify the object that the loader should retrieve from storage. Information about an object is retrieved in this structure by the <strong>IDirectMusicLoader8::EnumObject</strong> and <strong>IDirectMusicObject8::GetDescriptor</strong> methods.</p><p class=blue><strong>Syntax</strong></p><pre class=syntax><code>typedef struct _DMUS_OBJECTDESC {<br> DWORD dwSize;<br> DWORD dwValidData;<br> GUID guidObject;<br> GUID guidClass;<br> FILETIME ftDate;<br> DMUS_VERSION vVersion;<br> WCHAR wszName[DMUS_MAX_NAME];<br> WCHAR wszCategory[DMUS_MAX_CATEGORY];<br> WCHAR wszFileName[DMUS_MAX_FILENAME];<br> LONGLONG llMemLength;<br> LPBYTE pbMemData;<br> IStream* pStream<br>} DMUS_OBJECTDESC, *LPDMUS_OBJECTDESC;<br></code></pre><p class=blue><strong>Members</strong></p><p class=dt><strong>dwSize</strong></p><p class=indent>Size of the structure, in bytes. This member must be initialized to <strong>sizeof(DMUS_OBJECTDESC) </strong>before the structure is passed to any method.</p><p class=dt><strong>dwValidData</strong></p><p class=indent>Flags describing which members are valid and giving further information about some members. Thefollowing values are defined:</p><table cols=2 cellpadding=5 rules=rows border=0 frame=below>&nbsp;<tbody>&nbsp;<tr valign=top>&nbsp;<td class=blue width=40%><strong>Flag</strong></td>&nbsp;<td class=blue width=60%><strong>Description</strong></td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_CATEGORY</td>&nbsp;<td width=60%>The <strong>wszCategory</strong> member is valid.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_CLASS</td>&nbsp;<td width=60%>The <strong>guidClass</strong> member is valid.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_DATE</td>&nbsp;<td width=60%>The <strong>ftDate</strong> member is valid.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_FILENAME</td>&nbsp;<td width=60%>The <strong>wszFileName</strong> member is valid. The presence of this flag is assumed if DMUS_OBJ_FULLPATH is set.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_FULLPATH</td>&nbsp;<td width=60%>The <strong>wszFileName</strong> member contains either the full path of a file or a path relative to the application directory. The directory set by <strong>IDirectMusicLoader8::SetSearchDirectory</strong> is not searched. If this flag is not set, <strong>wszFilename</strong> is always assumed to be relative to the application directory, or to the search directory if <strong>SetSearchDirectory</strong> has been called for this object type.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_LOADED</td>&nbsp;<td width=60%>The object is currently loaded in memory.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_MEMORY</td>&nbsp;<td width=60%>The object is in memory, and <strong>llMemLength</strong> and <strong>&nbsp; pbMemData</strong> are valid.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_NAME</td>&nbsp;<td width=60%>The <strong>wszName</strong> member is valid.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_OBJECT</td>&nbsp;<td width=60%>The <strong>guidObject</strong> member is valid.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_STREAM</td>&nbsp;<td width=60%>The <strong>pStream</strong> member contains a pointer to the data stream.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_URL</td>&nbsp;<td width=60%>The <strong>wszFileName</strong> member contains a URL. URLs are not currently supported by the DirectMusic loader.</td>&nbsp;</tr>&nbsp;<tr valign=top>&nbsp;<td width=40%>DMUS_OBJ_VERSION</td>&nbsp;<td width=60%>The <strong>vVersion</strong> member is valid.</td>&nbsp;</tr>&nbsp;</tbody></table><br><p class=dt><strong>guidObject</strong></p><p class=indent>Unique identifier for this object.</p><p class=dt><strong>guidClass</strong></p><p class=indent>Unique identifier for the class of object. See DirectMusic Component GUIDs.</p><p class=dt><strong>ftDate</strong></p><p class=indent>Date that the object was last edited.</p><p class=dt><strong>vVersion</strong></p><p class=indent><strong>DMUS_VERSION</strong> structure containing version information.</p><p class=dt><strong>wszName</strong></p><p class=indent>Name of the object.</p><p class=dt><strong>wszCategory</strong></p><p class=indent>Category for the object.</p><p class=dt><strong>wszFileName</strong></p><p class=indent>File path. If DMUS_OBJ_FULLPATH is set, this is the full path; otherwise, it is the file name. If the <strong>IDirectMusicLoader8::SetSearchDirectory</strong> method has been called, this member must contain only a file name.</p><p class=dt><strong>llMemLength</strong></p><p class=indent>Size of data in memory.</p><p class=dt><strong>pbMemData</strong></p><p class=indent>Pointer to data in memory. Do not use this value except when loading from a resource contained in the executable file.</p><p class=dt><strong>pStream</strong></p><p class=indent>Address of the <strong>IStream</strong> interface of a custom stream that can be used to load the object into memory. In most cases this value should be NULL.See Remarks.</p><p class=blue><strong>Remarks</strong></p><p>At least one of <strong>wszName</strong>, <strong>guidObject</strong>, and <strong>wszFileName</strong> must contain valid data to retrieve the object by using the <strong>IDirectMusicLoader8::GetObject</strong> method.</p><p>The name and category strings use 16-bit characters in the <strong>WCHAR</strong> format, not 8-bit ANSI characters. Be sure to convert as appropriate. You can use the C library <strong>mbstowcs</strong> function to convert from multibyte to Unicode and the <strong>wcstombs</strong> function to convert from Unicode back to multibyte.</p><p>Instead of passing on object descriptor to <strong>IDirectMusicLoader8::GetObject</strong> or <strong>IDirectMusicLoader8::SetObject</strong> with a filename or memory pointer, an application can pass a stream. This is done by setting the DMUS_OBJ_STREAM flag in <strong>dwValidData</strong> and a pointer to the stream in <strong>pStream</strong>. When the application calls <strong>GetObject</strong>, the loader saves the stream's current location, reads the object from the stream, and then restores the saved location. The application can continue reading from the stream without being affected by the call to <strong>GetObject</strong>.</p><p>When <strong>SetObject</strong> is called with a stream, the loader makes a clone of the stream object, and this clone is used if the object is later loaded. Thus an application can release a stream or continue to read from it after passing it to the loader by using <strong>SetObject</strong>. The actual data of the stream is not copied, so the application should not change or delete the data.</p><br>DMUS_OBJECTDESC结构作为参数被传递到IDirectMusicLoader8::GetObject函数中，这个函数确定所有的数据被加载并且被链接到片段对象中。<br><br><p>The <strong>GetObject </strong>method retrieves an object from a file or resource and returns the specified interface.</p><p class=blue><strong>Syntax</strong></p><pre class=syntax><code><strong>HRESULT GetObject(<br> LPDMUS_OBJECTDESC </strong><em>pDesc,</em><br> <strong>REFIID </strong><em>riid</em><strong>,</strong><br><strong> LPVOID FAR * </strong><em>ppv</em><br><strong>);</strong> </code></pre><p class=blue><strong>Parameters</strong></p><p class=dt><em>pDesc</em></p><p class=indent>Address of a <strong>DMUS_OBJECTDESC</strong> structure describing the object.</p><p class=dt><em>riid</em></p><p class=indent>Unique identifier of the interface. See DirectMusic Interface GUIDs.</p><p class=dt><em>ppv</em></p><p class=indent>Address of a variable that receives a pointer to the desired interface of the object.</p><p class=blue><strong>Return Values</strong></p><p>If the method succeeds, the return value is S_OK or DMUS_S_PARTIALLOAD.</p><p>DMUS_S_PARTIALLOAD is returned if any referenced object cannot be found, such as a <nobr><a class=PopLink id=PopUp href="http://www.cppblog.com/lovedday/admin/EditPosts.aspx?opt=1#ProjectID113:style"><u><font color=#1b1b1b>style</font></u></a></nobr> referenced in a segment. The loader might fail to find the style if it is referenced by name but <strong>IDirectMusicLoader8::ScanDirectory</strong> has not been called for styles. DMUS_S_PARTIALLOAD might also mean that the default instrument collection file, Gm.dls, is not available.</p><p>If it fails, the method can return one of the error values shown in the following table.</p><table cols=1 cellpadding=5 rules=rows border=0 frame=below><tbody><tr valign=top><td class=blue width=100%><strong>Return code</strong></td></tr><tr valign=top><td width=100%>DMUS_E_LOADER_FAILEDCREATE</td></tr><tr valign=top><td width=100%>DMUS_E_LOADER_FAILEDOPEN</td></tr><tr valign=top><td width=100%>DMUS_E_LOADER_FORMATNOTSUPPORTED</td></tr><tr valign=top><td width=100%>DMUS_E_LOADER_NOCLASSID</td></tr><tr valign=top><td width=100%>E_FAIL</td></tr><tr valign=top><td width=100%>E_INVALIDARG</td></tr><tr valign=top><td width=100%>E_OUTOFMEMORY</td></tr><tr valign=top><td width=100%>E_POINTER</td></tr><tr valign=top><td width=100%>REGDB_E_CLASSNOTREG</td></tr></tbody></table><br><p class=blue><strong>Remarks</strong></p><p>For file objects, it is simpler to use the <strong>IDirectMusicLoader8::LoadObjectFromFile</strong> method.</p><p>DirectMusic does not support loading from URLs. If the <strong>dwValidData</strong> member of the<strong> DMUS_OBJECTDESC</strong> structure contains DMUS_OBJ_URL, the method returns DMUS_E_LOADER_FORMATNOTSUPPORTED.</p><p>The method does not require that all valid members of the <strong>DMUS_OBJECTDESC</strong> structure match before retrieving an object. The <strong>dwValidData</strong> flags are evaluated in the following order:</p><ol><li>DMUS_OBJ_OBJECT<li>DMUS_OBJ_STREAM<li>DMUS_OBJ_MEMORY<li>DMUS_OBJ_FILENAME and DMUS_OBJ_FULLPATH<li>DMUS_OBJ_NAME and DMUS_OBJ_CATEGORY<li>DMUS_OBJ_NAME<li>DMUS_OBJ_FILENAME</li></ol><p>In other words, the highest priority goes to a unique GUID, followed by a stream pointer, followed by a resource, followed by the full file path name, followed by an internal name plus category, followed by an internal name, followed by a local file name.</p><p>Do not load data from untrusted sources. Loading DirectMusic data files causes objects to be constructed, with the possibility that excessive demand on resources will lead to degradation of performance or system failure.</p><br>以下代码演示了如何加载音乐片段：<br><br><div style="border-right:#fff 1px solid;padding-right:5px;border-top:#fff 1px solid;padding-left:4px;font-size:13px;padding-bottom:4px;border-left:#fff 1px solid;width:98%;padding-top:4px;border-bottom:#fff 1px solid;background-color:#fff"><span style=color:#000>&nbsp;&nbsp;&nbsp; DMUS_OBJECTDESC&nbsp;dm_obj_desc;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;get&nbsp;the&nbsp;object</span><span style=color:green><br></span><span style=color:#000><br>&nbsp;&nbsp;&nbsp;&nbsp;ZeroMemory(</span><span style=color:#000>&</span><span style=color:#000>dm_obj_desc,&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DMUS_OBJECTDESC));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;dm_obj_desc.dwSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;</span><span style=color:#00f>sizeof</span><span style=color:#000>(DMUS_OBJECTDESC);<br>&nbsp;&nbsp;&nbsp;&nbsp;dm_obj_desc.guidClass&nbsp;&nbsp;&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;CLSID_DirectMusicSegment;<br>&nbsp;&nbsp;&nbsp;&nbsp;dm_obj_desc.dwValidData&nbsp;</span><span style=color:#000>=</span><span style=color:#000>&nbsp;DMUS_OBJ_CLASS&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;DMUS_OBJ_FILENAME&nbsp;</span><span style=color:#000>|</span><span style=color:#000>&nbsp;DMUS_OBJ_FULLPATH;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;Converts&nbsp;a&nbsp;sequence&nbsp;of&nbsp;multibyte&nbsp;characters&nbsp;to&nbsp;a&nbsp;corresponding&nbsp;sequence&nbsp;of&nbsp;wide&nbsp;characters</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;mbstowcs(dm_obj_desc.wszFileName,&nbsp;filename,&nbsp;MAX_PATH);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:green>//</span><span style=color:green>&nbsp;retrieves&nbsp;an&nbsp;object&nbsp;from&nbsp;a&nbsp;file&nbsp;or&nbsp;resource&nbsp;and&nbsp;returns&nbsp;the&nbsp;speficied&nbsp;interface</span><span style=color:green><br></span><span style=color:#000>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>if</span><span style=color:#000>(FAILED(g_dm_loader</span><span style=color:#000>-></span><span style=color:#000>GetObject(</span><span style=color:#000>&</span><span style=color:#000>dm_obj_desc,&nbsp;IID_IDirectMusicSegment8,&nbsp;(LPVOID</span><span style=color:#000>*</span><span style=color:#000>)</span><span style=color:#000>&</span><span style=color:#000>g_dm_segment)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style=color:#00f>return</span><span style=color:#000>&nbsp;FALSE;</span></div></div><footer class=post-footer><hr><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
用DirectX Audio和DirectShow播放声音和音乐（5）</li><li class=post-copyright-author><strong>本文作者： </strong>Rise</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-5/ title="用DirectX Audio和DirectShow播放声音和音乐（5）">https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-5/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/black.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=https://www.zhihu.com/people/rise-worlds><span class=icon><i class="fa fa-book"></i>
</span><span class=label>知乎</span></a></div><div class=social-item><a target=_blank class=social-link href=https://twitter.com/riseworlds><span class=icon><i class="fab fa-twitter"></i>
</span><span class=label>Twitter</span></a></div><div class=social-item><a target=_blank class=social-link href=https://www.facebook.com/rise.worlds><span class=icon><i class="fab fa-facebook"></i>
</span><span class=label>facebook</span></a></div><div class=social-item><a target=_blank class=social-link href=https://youtube.com/@YiXuan><span class=icon><i class="fab fa-youtube"></i>
</span><span class=label>YouTube</span></a></div><div class=social-item><a target=_blank class=social-link href=https://instagram.com/rise.worlds><span class=icon><i class="fab fa-instagram"></i>
</span><span class=label>Instagram</span></a></div><div class=social-item><a target=_blank class=social-link href=https://t.me/riseworlds><span class=icon><i class="fab fa-telegram"></i>
</span><span class=label>Telegram</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-6/ rel=next title="用DirectX Audio和DirectShow播放声音和音乐（6）"><i class="fa fa-chevron-left"></i> 用DirectX Audio和DirectShow播放声音和音乐（6）</a></div><div class="post-nav-prev post-nav-item"><a href=/post/playing-sound-and-music-with-directx-audio-and-directshow-part-4/ rel=prev title="用DirectX Audio和DirectShow播放声音和音乐（4）">用DirectX Audio和DirectShow播放声音和音乐（4）
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2004 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>Rise</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>豫ICP备2021009490号</a>
<img src=/imgs/gongan.png alt=豫公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41162302000074" target=_blank>豫公网安备 41162302000074 号</a></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":true,"expired":false,"isHome":false,"isPage":true,"path":"playing-sound-and-music-with-directx-audio-and-directshow-part-5","permalink":"https://blogs.qipai360.cn/post/playing-sound-and-music-with-directx-audio-and-directshow-part-5/","title":"用DirectX Audio和DirectShow播放声音和音乐（5）","toc":false,"waline3":{"pagecnt":{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"3.5.7"}}}</script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://blogs.qipai360.cn/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOA6L0YM4CiXf9","emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"rise-worlds/rise-worlds.github.io","repoid":"MDEwOlJlcG9zaXRvcnk2MTAxMTA0MA==","theme":"transparent_dark"},"js":"https://giscus.app/client.js"},"hostname":"https://blogs.qipai360.cn/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":false,"lang":"zh-CN","lazyload":false,"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline3"},"views":{"enable":true,"plugin":"waline3"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":false},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://blogs.qipai360.cn/js/3rd"}},"version":"4.8.3","waline3":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o 可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄 (Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"search":true,"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"3.5.7"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"3.5.7"}}}</script><script type=text/javascript src="/js/main.min.js?=1761990624" defer></script></body></html>